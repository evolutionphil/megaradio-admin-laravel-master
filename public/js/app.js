/*! For license information please see app.js.LICENSE.txt */
(()=>{var t,e={505:(t,e,n)=>{t.exports=n(15)},592:(t,e,n)=>{"use strict";var i=n(516),r=n(522),o=n(948),a=n(106),s=n(615),l=n(631),u=n(202),c=n(763),d=n(987),h=n(928);t.exports=function(t){return new Promise((function(e,n){var f,p=t.data,g=t.headers,m=t.responseType;function v(){t.cancelToken&&t.cancelToken.unsubscribe(f),t.signal&&t.signal.removeEventListener("abort",f)}i.isFormData(p)&&delete g["Content-Type"];var y=new XMLHttpRequest;if(t.auth){var b=t.auth.username||"",E=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";g.Authorization="Basic "+btoa(b+":"+E)}var T=s(t.baseURL,t.url);function A(){if(y){var i="getAllResponseHeaders"in y?l(y.getAllResponseHeaders()):null,o={data:m&&"text"!==m&&"json"!==m?y.response:y.responseText,status:y.status,statusText:y.statusText,headers:i,config:t,request:y};r((function(t){e(t),v()}),(function(t){n(t),v()}),o),y=null}}if(y.open(t.method.toUpperCase(),a(T,t.params,t.paramsSerializer),!0),y.timeout=t.timeout,"onloadend"in y?y.onloadend=A:y.onreadystatechange=function(){y&&4===y.readyState&&(0!==y.status||y.responseURL&&0===y.responseURL.indexOf("file:"))&&setTimeout(A)},y.onabort=function(){y&&(n(c("Request aborted",t,"ECONNABORTED",y)),y=null)},y.onerror=function(){n(c("Network Error",t,null,y)),y=null},y.ontimeout=function(){var e=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded",i=t.transitional||d.transitional;t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),n(c(e,t,i.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",y)),y=null},i.isStandardBrowserEnv()){var S=(t.withCredentials||u(T))&&t.xsrfCookieName?o.read(t.xsrfCookieName):void 0;S&&(g[t.xsrfHeaderName]=S)}"setRequestHeader"in y&&i.forEach(g,(function(t,e){void 0===p&&"content-type"===e.toLowerCase()?delete g[e]:y.setRequestHeader(e,t)})),i.isUndefined(t.withCredentials)||(y.withCredentials=!!t.withCredentials),m&&"json"!==m&&(y.responseType=t.responseType),"function"==typeof t.onDownloadProgress&&y.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&y.upload&&y.upload.addEventListener("progress",t.onUploadProgress),(t.cancelToken||t.signal)&&(f=function(t){y&&(n(!t||t&&t.type?new h("canceled"):t),y.abort(),y=null)},t.cancelToken&&t.cancelToken.subscribe(f),t.signal&&(t.signal.aborted?f():t.signal.addEventListener("abort",f))),p||(p=null),y.send(p)}))}},15:(t,e,n)=>{"use strict";var i=n(516),r=n(12),o=n(155),a=n(343);var s=function t(e){var n=new o(e),s=r(o.prototype.request,n);return i.extend(s,o.prototype,n),i.extend(s,n),s.create=function(n){return t(a(e,n))},s}(n(987));s.Axios=o,s.Cancel=n(928),s.CancelToken=n(191),s.isCancel=n(864),s.VERSION=n(641).version,s.all=function(t){return Promise.all(t)},s.spread=n(980),s.isAxiosError=n(19),t.exports=s,t.exports.default=s},928:t=>{"use strict";function e(t){this.message=t}e.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},e.prototype.__CANCEL__=!0,t.exports=e},191:(t,e,n)=>{"use strict";var i=n(928);function r(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise((function(t){e=t}));var n=this;this.promise.then((function(t){if(n._listeners){var e,i=n._listeners.length;for(e=0;e<i;e++)n._listeners[e](t);n._listeners=null}})),this.promise.then=function(t){var e,i=new Promise((function(t){n.subscribe(t),e=t})).then(t);return i.cancel=function(){n.unsubscribe(e)},i},t((function(t){n.reason||(n.reason=new i(t),e(n.reason))}))}r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.prototype.subscribe=function(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]},r.prototype.unsubscribe=function(t){if(this._listeners){var e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}},r.source=function(){var t;return{token:new r((function(e){t=e})),cancel:t}},t.exports=r},864:t=>{"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},155:(t,e,n)=>{"use strict";var i=n(516),r=n(106),o=n(471),a=n(490),s=n(343),l=n(841),u=l.validators;function c(t){this.defaults=t,this.interceptors={request:new o,response:new o}}c.prototype.request=function(t,e){if("string"==typeof t?(e=e||{}).url=t:e=t||{},!e.url)throw new Error("Provided config url is not valid");(e=s(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var n=e.transitional;void 0!==n&&l.assertOptions(n,{silentJSONParsing:u.transitional(u.boolean),forcedJSONParsing:u.transitional(u.boolean),clarifyTimeoutError:u.transitional(u.boolean)},!1);var i=[],r=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(r=r&&t.synchronous,i.unshift(t.fulfilled,t.rejected))}));var o,c=[];if(this.interceptors.response.forEach((function(t){c.push(t.fulfilled,t.rejected)})),!r){var d=[a,void 0];for(Array.prototype.unshift.apply(d,i),d=d.concat(c),o=Promise.resolve(e);d.length;)o=o.then(d.shift(),d.shift());return o}for(var h=e;i.length;){var f=i.shift(),p=i.shift();try{h=f(h)}catch(t){p(t);break}}try{o=a(h)}catch(t){return Promise.reject(t)}for(;c.length;)o=o.then(c.shift(),c.shift());return o},c.prototype.getUri=function(t){if(!t.url)throw new Error("Provided config url is not valid");return t=s(this.defaults,t),r(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},i.forEach(["delete","get","head","options"],(function(t){c.prototype[t]=function(e,n){return this.request(s(n||{},{method:t,url:e,data:(n||{}).data}))}})),i.forEach(["post","put","patch"],(function(t){c.prototype[t]=function(e,n,i){return this.request(s(i||{},{method:t,url:e,data:n}))}})),t.exports=c},471:(t,e,n)=>{"use strict";var i=n(516);function r(){this.handlers=[]}r.prototype.use=function(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},r.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},r.prototype.forEach=function(t){i.forEach(this.handlers,(function(e){null!==e&&t(e)}))},t.exports=r},615:(t,e,n)=>{"use strict";var i=n(137),r=n(680);t.exports=function(t,e){return t&&!i(e)?r(t,e):e}},763:(t,e,n)=>{"use strict";var i=n(449);t.exports=function(t,e,n,r,o){var a=new Error(t);return i(a,e,n,r,o)}},490:(t,e,n)=>{"use strict";var i=n(516),r=n(881),o=n(864),a=n(987),s=n(928);function l(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new s("canceled")}t.exports=function(t){return l(t),t.headers=t.headers||{},t.data=r.call(t,t.data,t.headers,t.transformRequest),t.headers=i.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),i.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete t.headers[e]})),(t.adapter||a.adapter)(t).then((function(e){return l(t),e.data=r.call(t,e.data,e.headers,t.transformResponse),e}),(function(e){return o(e)||(l(t),e&&e.response&&(e.response.data=r.call(t,e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)}))}},449:t=>{"use strict";t.exports=function(t,e,n,i,r){return t.config=e,n&&(t.code=n),t.request=i,t.response=r,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},t}},343:(t,e,n)=>{"use strict";var i=n(516);t.exports=function(t,e){e=e||{};var n={};function r(t,e){return i.isPlainObject(t)&&i.isPlainObject(e)?i.merge(t,e):i.isPlainObject(e)?i.merge({},e):i.isArray(e)?e.slice():e}function o(n){return i.isUndefined(e[n])?i.isUndefined(t[n])?void 0:r(void 0,t[n]):r(t[n],e[n])}function a(t){if(!i.isUndefined(e[t]))return r(void 0,e[t])}function s(n){return i.isUndefined(e[n])?i.isUndefined(t[n])?void 0:r(void 0,t[n]):r(void 0,e[n])}function l(n){return n in e?r(t[n],e[n]):n in t?r(void 0,t[n]):void 0}var u={url:a,method:a,data:a,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:l};return i.forEach(Object.keys(t).concat(Object.keys(e)),(function(t){var e=u[t]||o,r=e(t);i.isUndefined(r)&&e!==l||(n[t]=r)})),n}},522:(t,e,n)=>{"use strict";var i=n(763);t.exports=function(t,e,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?e(i("Request failed with status code "+n.status,n.config,null,n.request,n)):t(n)}},881:(t,e,n)=>{"use strict";var i=n(516),r=n(987);t.exports=function(t,e,n){var o=this||r;return i.forEach(n,(function(n){t=n.call(o,t,e)})),t}},987:(t,e,n)=>{"use strict";var i=n(606),r=n(516),o=n(18),a=n(449),s={"Content-Type":"application/x-www-form-urlencoded"};function l(t,e){!r.isUndefined(t)&&r.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var u,c={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==i&&"[object process]"===Object.prototype.toString.call(i))&&(u=n(592)),u),transformRequest:[function(t,e){return o(e,"Accept"),o(e,"Content-Type"),r.isFormData(t)||r.isArrayBuffer(t)||r.isBuffer(t)||r.isStream(t)||r.isFile(t)||r.isBlob(t)?t:r.isArrayBufferView(t)?t.buffer:r.isURLSearchParams(t)?(l(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):r.isObject(t)||e&&"application/json"===e["Content-Type"]?(l(e,"application/json"),function(t,e,n){if(r.isString(t))try{return(e||JSON.parse)(t),r.trim(t)}catch(t){if("SyntaxError"!==t.name)throw t}return(n||JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){var e=this.transitional||c.transitional,n=e&&e.silentJSONParsing,i=e&&e.forcedJSONParsing,o=!n&&"json"===this.responseType;if(o||i&&r.isString(t)&&t.length)try{return JSON.parse(t)}catch(t){if(o){if("SyntaxError"===t.name)throw a(t,this,"E_JSON_PARSE");throw t}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};r.forEach(["delete","get","head"],(function(t){c.headers[t]={}})),r.forEach(["post","put","patch"],(function(t){c.headers[t]=r.merge(s)})),t.exports=c},641:t=>{t.exports={version:"0.25.0"}},12:t=>{"use strict";t.exports=function(t,e){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return t.apply(e,n)}}},106:(t,e,n)=>{"use strict";var i=n(516);function r(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,e,n){if(!e)return t;var o;if(n)o=n(e);else if(i.isURLSearchParams(e))o=e.toString();else{var a=[];i.forEach(e,(function(t,e){null!=t&&(i.isArray(t)?e+="[]":t=[t],i.forEach(t,(function(t){i.isDate(t)?t=t.toISOString():i.isObject(t)&&(t=JSON.stringify(t)),a.push(r(e)+"="+r(t))})))})),o=a.join("&")}if(o){var s=t.indexOf("#");-1!==s&&(t=t.slice(0,s)),t+=(-1===t.indexOf("?")?"?":"&")+o}return t}},680:t=>{"use strict";t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}},948:(t,e,n)=>{"use strict";var i=n(516);t.exports=i.isStandardBrowserEnv()?{write:function(t,e,n,r,o,a){var s=[];s.push(t+"="+encodeURIComponent(e)),i.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),i.isString(r)&&s.push("path="+r),i.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},137:t=>{"use strict";t.exports=function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}},19:(t,e,n)=>{"use strict";var i=n(516);t.exports=function(t){return i.isObject(t)&&!0===t.isAxiosError}},202:(t,e,n)=>{"use strict";var i=n(516);t.exports=i.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(t){var i=t;return e&&(n.setAttribute("href",i),i=n.href),n.setAttribute("href",i),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return t=r(window.location.href),function(e){var n=i.isString(e)?r(e):e;return n.protocol===t.protocol&&n.host===t.host}}():function(){return!0}},18:(t,e,n)=>{"use strict";var i=n(516);t.exports=function(t,e){i.forEach(t,(function(n,i){i!==e&&i.toUpperCase()===e.toUpperCase()&&(t[e]=n,delete t[i])}))}},631:(t,e,n)=>{"use strict";var i=n(516),r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,n,o,a={};return t?(i.forEach(t.split("\n"),(function(t){if(o=t.indexOf(":"),e=i.trim(t.substr(0,o)).toLowerCase(),n=i.trim(t.substr(o+1)),e){if(a[e]&&r.indexOf(e)>=0)return;a[e]="set-cookie"===e?(a[e]?a[e]:[]).concat([n]):a[e]?a[e]+", "+n:n}})),a):a}},980:t=>{"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}},841:(t,e,n)=>{"use strict";var i=n(641).version,r={};["object","boolean","number","function","string","symbol"].forEach((function(t,e){r[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}}));var o={};r.transitional=function(t,e,n){function r(t,e){return"[Axios v"+i+"] Transitional option '"+t+"'"+e+(n?". "+n:"")}return function(n,i,a){if(!1===t)throw new Error(r(i," has been removed"+(e?" in "+e:"")));return e&&!o[i]&&(o[i]=!0,console.warn(r(i," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(n,i,a)}},t.exports={assertOptions:function(t,e,n){if("object"!=typeof t)throw new TypeError("options must be an object");for(var i=Object.keys(t),r=i.length;r-- >0;){var o=i[r],a=e[o];if(a){var s=t[o],l=void 0===s||a(s,o,t);if(!0!==l)throw new TypeError("option "+o+" must be "+l)}else if(!0!==n)throw Error("Unknown option "+o)}},validators:r}},516:(t,e,n)=>{"use strict";var i=n(12),r=Object.prototype.toString;function o(t){return Array.isArray(t)}function a(t){return void 0===t}function s(t){return"[object ArrayBuffer]"===r.call(t)}function l(t){return null!==t&&"object"==typeof t}function u(t){if("[object Object]"!==r.call(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}function c(t){return"[object Function]"===r.call(t)}function d(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),o(t))for(var n=0,i=t.length;n<i;n++)e.call(null,t[n],n,t);else for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.call(null,t[r],r,t)}t.exports={isArray:o,isArrayBuffer:s,isBuffer:function(t){return null!==t&&!a(t)&&null!==t.constructor&&!a(t.constructor)&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},isFormData:function(t){return"[object FormData]"===r.call(t)},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&s(t.buffer)},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:l,isPlainObject:u,isUndefined:a,isDate:function(t){return"[object Date]"===r.call(t)},isFile:function(t){return"[object File]"===r.call(t)},isBlob:function(t){return"[object Blob]"===r.call(t)},isFunction:c,isStream:function(t){return l(t)&&c(t.pipe)},isURLSearchParams:function(t){return"[object URLSearchParams]"===r.call(t)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:d,merge:function t(){var e={};function n(n,i){u(e[i])&&u(n)?e[i]=t(e[i],n):u(n)?e[i]=t({},n):o(n)?e[i]=n.slice():e[i]=n}for(var i=0,r=arguments.length;i<r;i++)d(arguments[i],n);return e},extend:function(t,e,n){return d(e,(function(e,r){t[r]=n&&"function"==typeof e?i(e,n):e})),t},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},stripBOM:function(t){return 65279===t.charCodeAt(0)&&(t=t.slice(1)),t}}},859:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.events={},this.streamUrl=t}return t.prototype.getOriginalStreamUrl=function(){return this.streamUrl.includes("url")?atob(this.streamUrl.split("url")[1].substring(1)):this.streamUrl},t.prototype.on=function(t,e){this.events[t]=this.events[t]||[],this.events[t].push(e)},t.prototype.emit=function(t,e){void 0===e&&(e=null),this.events[t]&&this.events[t].forEach((function(t){return t(e)}))},t}();e.default=n},395:function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},i(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(e,n){void 0===n&&(n={});var i=t.call(this,e)||this;return i.onPlaying=function(){console.log("onPlaying: ".concat(i.player.src)),i.emit("playing")},i.onPlay=function(){console.log("onPlay: ".concat(i.player.src)),i.play(),i.emit("play")},i.onPause=function(){console.log("onPause: ".concat(i.player.src)),i.emit("pause")},i.onError=function(){i.emit("error")},i.player=document.getElementById("player"),i.player.src=e,i.setupEvents(),i}return r(e,t),e.prototype.playing=function(){return this.player&&this.player.duration>0&&!this.player.paused},e.prototype.play=function(){this.player.play()},e.prototype.stop=function(){this.player.pause()},e.prototype.pause=function(){this.player.pause()},e.prototype.resume=function(){this.player.play()},e.prototype.destroy=function(){this.stop(),this.destroyEvents()},e.prototype.setupEvents=function(){console.log("setupEvents"),this.player.addEventListener("playing",this.onPlaying),this.player.addEventListener("play",this.onPlay),this.player.addEventListener("pause",this.onPause),this.player.addEventListener("error",this.onError)},e.prototype.destroyEvents=function(){console.log("destroyEvents"),this.player.removeEventListener("playing",this.onPlaying),this.player.removeEventListener("play",this.onPlay),this.player.removeEventListener("pause",this.onPause),this.player.removeEventListener("error",this.onError)},e.prototype.setVolume=function(t){this.player.volume=t},e}(o(n(859)).default);e.default=a},564:function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},i(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=o(n(859)),s=o(n(473)),l=function(t){function e(e,n){void 0===n&&(n={});var i=t.call(this,e)||this;if(i.onHlsError=function(t,e){i.emit("error"),console.log("PlaylistPlayer: Error")},i.onFragChanged=function(t,e){if(e.title){var n=e.title;console.log("onFragChanged: "+n)}},i.onPlaying=function(){console.log("onPlaying: ".concat(i.player.src)),i.emit("playing")},i.onPlay=function(){console.log("onPlay: ".concat(i.player.src)),i.emit("play"),i.play()},i.onPause=function(){console.log("onPause: ".concat(i.player.src)),i.emit("pause")},i.onError=function(){i.emit("error")},i.player=document.getElementById("player"),i.player.src=e,i.setupEvents(),s.default.isSupported()){var r=new s.default;r.loadSource(e),r.attachMedia(i.player),r.on(s.default.Events.FRAG_CHANGED,i.onFragChanged),r.on(s.default.Events.ERROR,i.onHlsError),i.hls=r}return i}return r(e,t),e.prototype.playing=function(){return this.player&&this.player.duration>0&&!this.player.paused},e.prototype.play=function(){this.player.play()},e.prototype.stop=function(){this.player.pause()},e.prototype.pause=function(){this.player.pause()},e.prototype.resume=function(){this.player.play()},e.prototype.destroy=function(){this.destroyEvents(),this.hls.destroy()},e.prototype.setupEvents=function(){console.log("setupEvents"),this.player.addEventListener("playing",this.onPlaying),this.player.addEventListener("play",this.onPlay),this.player.addEventListener("pause",this.onPause),this.player.addEventListener("error",this.onError)},e.prototype.destroyEvents=function(){console.log("destroyEvents"),this.player.removeEventListener("playing",this.onPlaying),this.player.removeEventListener("play",this.onPlay),this.player.removeEventListener("pause",this.onPause),this.player.removeEventListener("error",this.onError),this.hls&&(this.hls.off(s.default.Events.FRAG_CHANGED,this.onFragChanged),this.hls.off(s.default.Events.ERROR,this.onHlsError))},e.prototype.setVolume=function(t){this.player.volume=t},e}(a.default);e.default=l},297:(t,e,n)=>{"use strict";var i=n(352),r=n.n(i);window.Trix=r();var o="&#8203;";function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function s(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var l={isEnabled:function(){var t;return null===(t=window.TAGIFY_DEBUG)||void 0===t||t},log:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i;this.isEnabled()&&(i=console).log.apply(i,["[Tagify]:"].concat(s(e)))},warn:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i;this.isEnabled()&&(i=console).warn.apply(i,["[Tagify]:"].concat(s(e)))}},u=function(t,e,n,i){return t=""+t,e=""+e,i&&(t=t.trim(),e=e.trim()),n?t==e:t.toLowerCase()==e.toLowerCase()},c=function(t,e){return t&&Array.isArray(t)&&t.map((function(t){return d(t,e)}))};function d(t,e){var n,i={};for(n in t)e.indexOf(n)<0&&(i[n]=t[n]);return i}function h(t){var e=document.createElement("div");return t.replace(/\&#?[0-9a-z]+;/gi,(function(t){return e.innerHTML=t,e.innerText}))}function f(t){return(new DOMParser).parseFromString(t.trim(),"text/html").body.firstElementChild}function p(t,e){for(e=e||"previous";t=t[e+"Sibling"];)if(3==t.nodeType)return t}function g(t){return"string"==typeof t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/`|'/g,"&#039;"):t}function m(t){var e=Object.prototype.toString.call(t).split(" ")[1].slice(0,-1);return t===Object(t)&&"Array"!=e&&"Function"!=e&&"RegExp"!=e&&"HTMLUnknownElement"!=e}function v(t,e,n){var i,r;function o(t,e){for(var n in e)if(e.hasOwnProperty(n)){if(m(e[n])){m(t[n])?o(t[n],e[n]):t[n]=Object.assign({},e[n]);continue}if(Array.isArray(e[n])){t[n]=Object.assign([],e[n]);continue}t[n]=e[n]}}return i=t,(null!=(r=Object)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](i):i instanceof r)||(t={}),o(t,e),n&&o(t,n),t}function y(){var t=[],e={},n=!0,i=!1,r=void 0;try{for(var o,a=arguments[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,l=!0,u=!1,c=void 0;try{for(var d,h=s[Symbol.iterator]();!(l=(d=h.next()).done);l=!0){var f=d.value;m(f)?e[f.value]||(t.push(f),e[f.value]=1):t.includes(f)||t.push(f)}}catch(t){u=!0,c=t}finally{try{l||null==h.return||h.return()}finally{if(u)throw c}}}}catch(t){i=!0,r=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}return t}function b(t){return String.prototype.normalize?"string"==typeof t?t.normalize("NFD").replace(/[\u0300-\u036f]/g,""):void 0:t}var E=function(){return/(?=.*chrome)(?=.*android)/i.test(navigator.userAgent)};function T(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(t){return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}))}function A(t){return t&&t.classList&&t.classList.contains(this.settings.classNames.tag)}function S(t){return t&&t.closest(this.settings.classNames.tagSelector)}function w(t,e){var n=window.getSelection();return e=e||n.getRangeAt(0),"string"==typeof t&&(t=document.createTextNode(t)),e&&(e.deleteContents(),e.insertNode(t)),t}function L(t,e,n){return t?(e&&(t.__tagifyTagData=n?e:v({},t.__tagifyTagData||{},e)),t.__tagifyTagData):(l.warn("tag element doesn't exist",{tagElm:t,data:e}),e)}function x(t){if(t&&t.parentNode){var e=t,n=window.getSelection(),i=n.getRangeAt(0);n.rangeCount&&(i.setStartAfter(e),i.collapse(!0),n.removeAllRanges(),n.addRange(i))}}function D(t,e){t.forEach((function(t){if(L(t.previousSibling)||!t.previousSibling){var n=document.createTextNode("​");t.before(n),e&&x(n)}}))}var R={delimiters:",",pattern:null,tagTextProp:"value",maxTags:1/0,callbacks:{},addTagOnBlur:!0,addTagOn:["blur","tab","enter"],onChangeAfterBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,userInput:!0,focusable:!0,keepInvalidTags:!1,createInvalidTags:!0,mixTagsAllowedAfter:/,|\.|\:|\s/,mixTagsInterpolator:["[[","]]"],backspace:!0,skipInvalid:!1,pasteAsTags:!0,editTags:{clicks:2,keepInvalid:!0},transformTag:function(){},trim:!0,a11y:{focusableTags:!1},mixMode:{insertAfterTag:" "},autoComplete:{enabled:!0,rightKey:!1,tabKey:!1},classNames:{namespace:"tagify",mixMode:"tagify--mix",selectMode:"tagify--select",input:"tagify__input",focus:"tagify--focus",tagNoAnimation:"tagify--noAnim",tagInvalid:"tagify--invalid",tagNotAllowed:"tagify--notAllowed",scopeLoading:"tagify--loading",hasMaxTags:"tagify--hasMaxTags",hasNoTags:"tagify--noTags",empty:"tagify--empty",inputInvalid:"tagify__input--invalid",dropdown:"tagify__dropdown",dropdownWrapper:"tagify__dropdown__wrapper",dropdownHeader:"tagify__dropdown__header",dropdownFooter:"tagify__dropdown__footer",dropdownItem:"tagify__dropdown__item",dropdownItemActive:"tagify__dropdown__item--active",dropdownItemHidden:"tagify__dropdown__item--hidden",dropdownItemSelected:"tagify__dropdown__item--selected",dropdownInital:"tagify__dropdown--initial",tag:"tagify__tag",tagText:"tagify__tag-text",tagX:"tagify__tag__removeBtn",tagLoading:"tagify__tag--loading",tagEditing:"tagify__tag--editable",tagFlash:"tagify__tag--flash",tagHide:"tagify__tag--hide"},dropdown:{classname:"",enabled:2,maxItems:10,searchKeys:["value","searchBy"],fuzzySearch:!0,caseSensitive:!1,accentedSearch:!0,includeSelectedTags:!1,escapeHTML:!0,highlightFirst:!0,closeOnSelect:!0,clearOnSelect:!0,position:"all",appendTarget:null},hooks:{beforeRemoveTag:function(){return Promise.resolve()},beforePaste:function(){return Promise.resolve()},suggestionClick:function(){return Promise.resolve()},beforeKeyDown:function(){return Promise.resolve()}}};function _(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function C(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){_(t,e,n[e])}))}return t}function k(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):function(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n.push.apply(n,i)}return n}(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})),t}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function O(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function P(){for(var t in this.dropdown={},this._dropdown)this.dropdown[t]="function"==typeof this._dropdown[t]?this._dropdown[t].bind(this):this._dropdown[t];this.dropdown.refs(),this.DOM.dropdown.__tagify=this}var M,N,F,B=(M=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){O(t,e,n[e])}))}return t}({},{events:{binding:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.dropdown.events.callbacks,n=this.listeners.dropdown=this.listeners.dropdown||{position:this.dropdown.position.bind(this,null),onKeyDown:e.onKeyDown.bind(this),onMouseOver:e.onMouseOver.bind(this),onMouseLeave:e.onMouseLeave.bind(this),onClick:e.onClick.bind(this),onScroll:e.onScroll.bind(this)},i=t?"addEventListener":"removeEventListener";"manual"!=this.settings.dropdown.position&&(document[i]("scroll",n.position,!0),window[i]("resize",n.position),window[i]("keydown",n.onKeyDown)),this.DOM.dropdown[i]("mouseover",n.onMouseOver),this.DOM.dropdown[i]("mouseleave",n.onMouseLeave),this.DOM.dropdown[i]("mousedown",n.onClick),this.DOM.dropdown.content[i]("scroll",n.onScroll)},callbacks:{onKeyDown:function(t){var e=this;if(this.state.hasFocus&&!this.state.composing){var n=this.settings,i=this.DOM.dropdown.querySelector(n.classNames.dropdownItemActiveSelector),r=this.dropdown.getSuggestionDataByNode(i),o="mix"==n.mode,a="select"==n.mode;n.hooks.beforeKeyDown(t,{tagify:this}).then((function(s){switch(t.key){case"ArrowDown":case"ArrowUp":case"Down":case"Up":t.preventDefault();var u=e.dropdown.getAllSuggestionsRefs(),c="ArrowUp"==t.key||"Up"==t.key;i&&(i=e.dropdown.getNextOrPrevOption(i,!c)),i&&i.matches(n.classNames.dropdownItemSelector)||(i=u[c?u.length-1:0]),e.dropdown.highlightOption(i,!0);break;case"Escape":case"Esc":e.dropdown.hide();break;case"ArrowRight":if(e.state.actions.ArrowLeft||n.autoComplete.rightKey)return;case"Tab":var d=!n.autoComplete.rightKey||!n.autoComplete.tabKey;if(!o&&!a&&i&&d&&!e.state.editing&&r){t.preventDefault();var h=e.dropdown.getMappedValue(r);return e.input.autocomplete.set.call(e,h),!1}return!0;case"Enter":t.preventDefault(),n.hooks.suggestionClick(t,{tagify:e,tagData:r,suggestionElm:i}).then((function(){if(i)return e.dropdown.selectOption(i),i=e.dropdown.getNextOrPrevOption(i,!c),void e.dropdown.highlightOption(i);e.dropdown.hide(),o||e.addTags(e.state.inputText.trim(),!0)})).catch((function(t){return l.warn(t)}));break;case"Backspace":if(o||e.state.editing.scope)return;var f=e.input.raw.call(e);""!=f&&8203!=f.charCodeAt(0)||(!0===n.backspace?e.removeTags():"edit"==n.backspace&&setTimeout(e.editTag.bind(e),0))}}))}},onMouseOver:function(t){var e=t.target.closest(this.settings.classNames.dropdownItemSelector);this.dropdown.highlightOption(e)},onMouseLeave:function(t){this.dropdown.highlightOption()},onClick:function(t){var e=this;if(0==t.button&&t.target!=this.DOM.dropdown&&t.target!=this.DOM.dropdown.content){var n=t.target.closest(this.settings.classNames.dropdownItemSelector),i=this.dropdown.getSuggestionDataByNode(n);this.state.actions.selectOption=!0,setTimeout((function(){return e.state.actions.selectOption=!1}),50),this.settings.hooks.suggestionClick(t,{tagify:this,tagData:i,suggestionElm:n}).then((function(){n?e.dropdown.selectOption(n,t):e.dropdown.hide()})).catch((function(t){return l.warn(t)}))}},onScroll:function(t){var e=t.target,n=e.scrollTop/(e.scrollHeight-e.parentNode.clientHeight)*100;this.trigger("dropdown:scroll",{percentage:Math.round(n)})}}},refilter:function(t){t=t||this.state.dropdown.query||"",this.suggestedListItems=this.dropdown.filterListItems(t),this.dropdown.fill(),this.suggestedListItems.length||this.dropdown.hide(),this.trigger("dropdown:updated",this.DOM.dropdown)},getSuggestionDataByNode:function(t){for(var e,n=t&&t.getAttribute("value"),i=this.suggestedListItems.length;i--;){if(m(e=this.suggestedListItems[i])&&e.value==n)return e;if(e==n)return{value:e}}},getNextOrPrevOption:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.dropdown.getAllSuggestionsRefs(),i=n.findIndex((function(e){return e===t}));return e?n[i+1]:n[i-1]},highlightOption:function(t,e){var n,i=this.settings.classNames.dropdownItemActive;if(this.state.ddItemElm&&(this.state.ddItemElm.classList.remove(i),this.state.ddItemElm.removeAttribute("aria-selected")),!t)return this.state.ddItemData=null,this.state.ddItemElm=null,void this.input.autocomplete.suggest.call(this);n=this.dropdown.getSuggestionDataByNode(t),this.state.ddItemData=n,this.state.ddItemElm=t,t.classList.add(i),t.setAttribute("aria-selected",!0),e&&(t.parentNode.scrollTop=t.clientHeight+t.offsetTop-t.parentNode.clientHeight),this.settings.autoComplete&&(this.input.autocomplete.suggest.call(this,n),this.dropdown.position())},selectOption:function(t,e){var n=this,i=this.settings,r=i.dropdown,o=r.clearOnSelect,a=r.closeOnSelect;if(!t)return this.addTags(this.state.inputText,!0),void(a&&this.dropdown.hide());e=e||{};var s=t.getAttribute("value"),l="noMatch"==s,u="mix"==i.mode,c=this.suggestedListItems.find((function(t){var e;return(null!==(e=t.value)&&void 0!==e?e:t)==s}));if(this.trigger("dropdown:select",{data:c,elm:t,event:e}),s&&(c||l)){if(this.state.editing){var d=this.normalizeTags([c])[0];c=i.transformTag.call(this,d)||d,this.onEditTagDone(null,v({__isValid:!0},c))}else this[u?"addMixTags":"addTags"]([c||this.input.raw.call(this)],o);(u||this.DOM.input.parentNode)&&(setTimeout((function(){n.DOM.input.focus(),n.toggleFocusClass(!0)})),a&&setTimeout(this.dropdown.hide.bind(this)),t.addEventListener("transitionend",(function(){n.dropdown.fillHeaderFooter(),setTimeout((function(){t.remove(),n.dropdown.refilter()}),100)}),{once:!0}),t.classList.add(this.settings.classNames.dropdownItemHidden))}else a&&setTimeout(this.dropdown.hide.bind(this))},selectAll:function(t){this.suggestedListItems.length=0,this.dropdown.hide(),this.dropdown.filterListItems("");var e=this.dropdown.filterListItems("");return t||(e=this.state.dropdown.suggestions),this.addTags(e,!0),this},filterListItems:function(t,e){var n,i,r,o,a,s,l=function(){var t,l,u=void 0,c=void 0;t=p[E],i=(null!=(l=Object)&&"undefined"!=typeof Symbol&&l[Symbol.hasInstance]?l[Symbol.hasInstance](t):t instanceof l)?p[E]:{value:p[E]};var g,v=Object.keys(i).some((function(t){return y.includes(t)}))?y:["value"];d.fuzzySearch&&!e.exact?(o=v.reduce((function(t,e){return t+" "+(i[e]||"")}),"").toLowerCase().trim(),d.accentedSearch&&(o=b(o),s=b(s)),u=0==o.indexOf(s),c=o===s,g=o,r=s.toLowerCase().split(" ").every((function(t){return g.includes(t.toLowerCase())}))):(u=!0,r=v.some((function(t){var n=""+(i[t]||"");return d.accentedSearch&&(n=b(n),s=b(s)),d.caseSensitive||(n=n.toLowerCase()),c=n===s,e.exact?n===s:0==n.indexOf(s)}))),a=!d.includeSelectedTags&&n.isTagDuplicate(m(i)?i.value:i),r&&!a&&(c&&u?f.push(i):"startsWith"==d.sortby&&u?h.unshift(i):h.push(i))},u=this,c=this.settings,d=c.dropdown,h=(e=e||{},[]),f=[],p=c.whitelist,g=d.maxItems>=0?d.maxItems:1/0,v=d.includeSelectedTags||"select"==c.mode,y=d.searchKeys,E=0;if(!(t="select"==c.mode&&this.value.length&&this.value[0][c.tagTextProp]==t?"":t)||!y.length)return h=v?p:p.filter((function(t){return!u.isTagDuplicate(m(t)?t.value:t)})),this.state.dropdown.suggestions=h,h.slice(0,g);for(s=d.caseSensitive?""+t:(""+t).toLowerCase();E<p.length;E++)n=this,l();return this.state.dropdown.suggestions=f.concat(h),"function"==typeof d.sortby?d.sortby(f.concat(h),s):f.concat(h).slice(0,g)},getMappedValue:function(t){var e=this.settings.dropdown.mapValueTo;return e?"function"==typeof e?e(t):t[e]||t.value:t.value},createListHTML:function(t){var e=this;return v([],t).map((function(t,n){"string"!=typeof t&&"number"!=typeof t||(t={value:t});var i=e.dropdown.getMappedValue(t);return i="string"==typeof i&&e.settings.dropdown.escapeHTML?g(i):i,e.settings.templates.dropdownItem.apply(e,[k(C({},t),{mappedValue:i}),e])})).join("")}}),N=null!=(N={refs:function(){this.DOM.dropdown=this.parseTemplate("dropdown",[this.settings]),this.DOM.dropdown.content=this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-wrapper']")},getHeaderRef:function(){return this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-header']")},getFooterRef:function(){return this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-footer']")},getAllSuggestionsRefs:function(){return function(t){return function(t){if(Array.isArray(t))return I(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return I(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.DOM.dropdown.content.querySelectorAll(this.settings.classNames.dropdownItemSelector))},show:function(t){var e,n,i,r=this,o=this.settings,a="mix"==o.mode&&!o.enforceWhitelist,s=!o.whitelist||!o.whitelist.length,l="manual"==o.dropdown.position;if(t=void 0===t?this.state.inputText:t,!(s&&!a&&!o.templates.dropdownItemNoMatch||!1===o.dropdown.enable||this.state.isLoading||this.settings.readonly)){if(clearTimeout(this.dropdownHide__bindEventsTimeout),this.suggestedListItems=this.dropdown.filterListItems(t),t&&!this.suggestedListItems.length&&(this.trigger("dropdown:noMatch",t),o.templates.dropdownItemNoMatch&&(i=o.templates.dropdownItemNoMatch.call(this,{value:t}))),!i){if(this.suggestedListItems.length)t&&a&&!this.state.editing.scope&&!u(this.suggestedListItems[0].value,t)&&this.suggestedListItems.unshift({value:t});else{if(!t||!a||this.state.editing.scope)return this.input.autocomplete.suggest.call(this),void this.dropdown.hide();this.suggestedListItems=[{value:t}]}n=""+(m(e=this.suggestedListItems[0])?e.value:e),o.autoComplete&&n&&0==n.indexOf(t)&&this.input.autocomplete.suggest.call(this,e)}this.dropdown.fill(i),o.dropdown.highlightFirst&&this.dropdown.highlightOption(this.DOM.dropdown.content.querySelector(o.classNames.dropdownItemSelector)),this.state.dropdown.visible||setTimeout(this.dropdown.events.binding.bind(this)),this.state.dropdown.visible=t||!0,this.state.dropdown.query=t,this.setStateSelection(),l||setTimeout((function(){r.dropdown.position(),r.dropdown.render()})),setTimeout((function(){r.trigger("dropdown:show",r.DOM.dropdown)}))}},hide:function(t){var e=this,n=this.DOM,i=n.scope,r=n.dropdown,o="manual"==this.settings.dropdown.position&&!t;if(r&&document.body.contains(r)&&!o)return window.removeEventListener("resize",this.dropdown.position),this.dropdown.events.binding.call(this,!1),i.setAttribute("aria-expanded",!1),r.parentNode.removeChild(r),setTimeout((function(){e.state.dropdown.visible=!1}),100),this.state.dropdown.query=this.state.ddItemData=this.state.ddItemElm=this.state.selection=null,this.state.tag&&this.state.tag.value.length&&(this.state.flaggedTags[this.state.tag.baseOffset]=this.state.tag),this.trigger("dropdown:hide",r),this},toggle:function(t){this.dropdown[this.state.dropdown.visible&&!t?"hide":"show"]()},getAppendTarget:function(){var t=this.settings.dropdown;return"function"==typeof t.appendTarget?t.appendTarget():t.appendTarget},render:function(){var t,e,n=this,i=((e=this.DOM.dropdown.cloneNode(!0)).style.cssText="position:fixed; top:-9999px; opacity:0",document.body.appendChild(e),t=e.clientHeight,e.parentNode.removeChild(e),t),r=this.settings,o="number"==typeof r.dropdown.enabled&&r.dropdown.enabled>=0,a=this.dropdown.getAppendTarget();return o?(this.DOM.scope.setAttribute("aria-expanded",!0),document.body.contains(this.DOM.dropdown)||(this.DOM.dropdown.classList.add(r.classNames.dropdownInital),this.dropdown.position(i),a.appendChild(this.DOM.dropdown),setTimeout((function(){return n.DOM.dropdown.classList.remove(r.classNames.dropdownInital)}))),this):this},fill:function(t){t="string"==typeof t?t:this.dropdown.createListHTML(t||this.suggestedListItems);var e,n=this.settings.templates.dropdownContent.call(this,t);this.DOM.dropdown.content.innerHTML=(e=n)?e.replace(/\>[\r\n ]+\</g,"><").split(/>\s+</).join("><").trim():""},fillHeaderFooter:function(){var t=this.dropdown.filterListItems(this.state.dropdown.query),e=this.parseTemplate("dropdownHeader",[t]),n=this.parseTemplate("dropdownFooter",[t]),i=this.dropdown.getHeaderRef(),r=this.dropdown.getFooterRef();e&&(null==i||i.parentNode.replaceChild(e,i)),n&&(null==r||r.parentNode.replaceChild(n,r))},position:function(t){var e=this.settings.dropdown,n=this.dropdown.getAppendTarget();if("manual"!=e.position&&n){var i,r,o,a,s,l,u,c,d,h=this.DOM.dropdown,f=e.RTL,p=n===document.body,g=n===this.DOM.scope,m=p?window.pageYOffset:n.scrollTop,v=document.fullscreenElement||document.webkitFullscreenElement||document.documentElement,y=v.clientHeight,b=Math.max(v.clientWidth||0,window.innerWidth||0)>480?e.position:"all",E=this.DOM["input"==b?"input":"scope"];if(t=t||h.clientHeight,this.state.dropdown.visible){if("text"==b?(o=(i=function(){var t=document.getSelection();if(t.rangeCount){var e,n,i=t.getRangeAt(0),r=i.startContainer,o=i.startOffset;if(o>0)return(n=document.createRange()).setStart(r,o-1),n.setEnd(r,o),{left:(e=n.getBoundingClientRect()).right,top:e.top,bottom:e.bottom};if(r.getBoundingClientRect)return r.getBoundingClientRect()}return{left:-9999,top:-9999}}()).bottom,r=i.top,a=i.left,s="auto"):(l=function(t){var e=0,n=0;for(t=t.parentNode;t&&t!=v;)e+=t.offsetTop||0,n+=t.offsetLeft||0,t=t.parentNode;return{top:e,left:n}}(n),i=E.getBoundingClientRect(),r=g?-1:i.top-l.top,o=(g?i.height:i.bottom-l.top)-1,a=g?-1:i.left-l.left,s=i.width+"px"),!p){var T=function(){for(var t=0,n=e.appendTarget.parentNode;n;)t+=n.scrollTop||0,n=n.parentNode;return t}();r+=T,o+=T}var A;r=Math.floor(r),o=Math.ceil(o),c=((u=null!==(A=e.placeAbove)&&void 0!==A?A:y-i.bottom<t)?r:o)+m,d="left: ".concat(a+(f&&i.width||0)+window.pageXOffset,"px;"),h.style.cssText="".concat(d,"; top: ").concat(c,"px; min-width: ").concat(s,"; max-width: ").concat(s),h.setAttribute("placement",u?"top":"bottom"),h.setAttribute("position",b)}}}})?N:{},Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(N)):function(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n.push.apply(n,i)}return n}(Object(N)).forEach((function(t){Object.defineProperty(M,t,Object.getOwnPropertyDescriptor(N,t))})),M),U="@yaireo/tagify/",j={empty:"empty",exceed:"number of tags exceeded",pattern:"pattern mismatch",duplicate:"already exists",notAllowed:"not allowed"},G={wrapper:function(t,e){return'<tags class="'.concat(e.classNames.namespace," ").concat(e.mode?"".concat(e.classNames[e.mode+"Mode"]):""," ").concat(t.className,'"\n                    ').concat(e.readonly?"readonly":"","\n                    ").concat(e.disabled?"disabled":"","\n                    ").concat(e.required?"required":"","\n                    ").concat("select"===e.mode?"spellcheck='false'":"",'\n                    tabIndex="-1">\n                    ').concat(this.settings.templates.input.call(this),"\n                ").concat(o,"\n        </tags>")},input:function(){var t=this.settings,e=t.placeholder||o;return"<span ".concat(!t.readonly&&t.userInput?"contenteditable":"",' tabIndex="0" data-placeholder="').concat(e,'" aria-placeholder="').concat(t.placeholder||"",'"\n                    class="').concat(t.classNames.input,'"\n                    role="textbox"\n                    autocapitalize="false"\n                    autocorrect="off"\n                    spellcheck="false"\n                    aria-autocomplete="both"\n                    aria-multiline="').concat("mix"==t.mode,'"></span>')},tag:function(t,e){var n=e.settings;return'<tag title="'.concat(t.title||t.value,"\"\n                    contenteditable='false'\n                    tabIndex=\"").concat(n.a11y.focusableTags?0:-1,'"\n                    class="').concat(n.classNames.tag," ").concat(t.class||"",'"\n                    ').concat(this.getAttributes(t),">\n            <x title='' tabIndex=\"").concat(n.a11y.focusableTags?0:-1,'" class="').concat(n.classNames.tagX,"\" role='button' aria-label='remove tag'></x>\n            <div>\n                <span ").concat("select"===n.mode&&n.userInput?"contenteditable='true'":"",' autocapitalize="false" autocorrect="off" spellcheck=\'false\' class="').concat(n.classNames.tagText,'">').concat(t[n.tagTextProp]||t.value,"</span>\n            </div>\n        </tag>")},dropdown:function(t){var e=t.dropdown,n="manual"==e.position;return'<div class="'.concat(n?"":t.classNames.dropdown," ").concat(e.classname,'" role="listbox" aria-labelledby="dropdown" dir="').concat(e.RTL?"rtl":"","\">\n                    <div data-selector='tagify-suggestions-wrapper' class=\"").concat(t.classNames.dropdownWrapper,'"></div>\n                </div>')},dropdownContent:function(t){var e=this.settings.templates,n=this.state.dropdown.suggestions;return"\n            ".concat(e.dropdownHeader.call(this,n),"\n            ").concat(t,"\n            ").concat(e.dropdownFooter.call(this,n),"\n        ")},dropdownItem:function(t){return"<div ".concat(this.getAttributes(t),"\n                    class='").concat(this.settings.classNames.dropdownItem," ").concat(this.isTagDuplicate(t.value)?this.settings.classNames.dropdownItemSelected:""," ").concat(t.class||"",'\'\n                    tabindex="0"\n                    role="option">').concat(t.mappedValue||t.value,"</div>")},dropdownHeader:function(t){return"<header data-selector='tagify-suggestions-header' class=\"".concat(this.settings.classNames.dropdownHeader,'"></header>')},dropdownFooter:function(t){var e=t.length-this.settings.dropdown.maxItems;return e>0?"<footer data-selector='tagify-suggestions-footer' class=\"".concat(this.settings.classNames.dropdownFooter,'">\n                ').concat(e," more items. Refine your search.\n            </footer>"):""},dropdownItemNoMatch:null};function V(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function H(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function K(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function W(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function q(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function Y(t){return function(t){if(Array.isArray(t))return K(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return K(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?K(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var z={customBinding:function(){var t=this;this.customEventsList.forEach((function(e){t.on(e,t.settings.callbacks[e])}))},binding:function(){var t,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=this.settings,i=this.events.callbacks,r=e?"addEventListener":"removeEventListener";if(!this.state.mainEvents||!e){for(var o in this.state.mainEvents=e,e&&!this.listeners.main&&(this.events.bindGlobal.call(this),this.settings.isJQueryPlugin&&jQuery(this.DOM.originalInput).on("tagify.removeAllTags",this.removeAllTags.bind(this))),t=this.listeners.main=this.listeners.main||{keydown:["input",i.onKeydown.bind(this)],click:["scope",i.onClickScope.bind(this)],dblclick:"select"!=n.mode&&["scope",i.onDoubleClickScope.bind(this)],paste:["input",i.onPaste.bind(this)],drop:["input",i.onDrop.bind(this)],compositionstart:["input",i.onCompositionStart.bind(this)],compositionend:["input",i.onCompositionEnd.bind(this)]})t[o]&&this.DOM[t[o][0]][r](o,t[o][1]);var a=this.listeners.main.inputMutationObserver||new MutationObserver(i.onInputDOMChange.bind(this));a.disconnect(),"mix"==n.mode&&a.observe(this.DOM.input,{childList:!0}),this.events.bindOriginaInputListener.call(this)}},bindOriginaInputListener:function(t){var e=(t||0)+500;this.listeners.main&&(clearInterval(this.listeners.main.originalInputValueObserverInterval),this.listeners.main.originalInputValueObserverInterval=setInterval(this.events.callbacks.observeOriginalInputValue.bind(this),e))},bindGlobal:function(t){var e,n=this.events.callbacks,i=t?"removeEventListener":"addEventListener";if(this.listeners&&(t||!this.listeners.global)){this.listeners.global=this.listeners.global||[{type:this.isIE?"keydown":"input",target:this.DOM.input,cb:n[this.isIE?"onInputIE":"onInput"].bind(this)},{type:"keydown",target:window,cb:n.onWindowKeyDown.bind(this)},{type:"focusin",target:this.DOM.scope,cb:n.onFocusBlur.bind(this)},{type:"focusout",target:this.DOM.scope,cb:n.onFocusBlur.bind(this)},{type:"click",target:document,cb:n.onClickAnywhere.bind(this),useCapture:!0}];var r=!0,o=!1,a=void 0;try{for(var s,l=this.listeners.global[Symbol.iterator]();!(r=(s=l.next()).done);r=!0)(e=s.value).target[i](e.type,e.cb,!!e.useCapture)}catch(t){o=!0,a=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw a}}}},unbindGlobal:function(){this.events.bindGlobal.call(this,!0)},callbacks:{onFocusBlur:function(t){var e,n,i=this.settings,r=S.call(this,t.target),o=A.call(this,t.target),a=t.target.classList.contains(i.classNames.tagX),s="focusin"==t.type,l="focusout"==t.type;r&&s&&!o&&!a&&this.toggleFocusClass(this.state.hasFocus=+new Date);var u=t.target?this.trim(this.DOM.input.textContent):"",c=null===(n=this.value)||void 0===n||null===(e=n[0])||void 0===e?void 0:e[i.tagTextProp],d=i.dropdown.enabled>=0,h={relatedTarget:t.relatedTarget},f=this.state.actions.selectOption&&(d||!i.dropdown.closeOnSelect),p=this.state.actions.addNew&&d;if(l){if(t.relatedTarget===this.DOM.scope)return this.dropdown.hide(),void this.DOM.input.focus();this.postUpdate(),i.onChangeAfterBlur&&this.triggerChangeEvent()}if(!(f||p||a))if(s||r?(this.state.hasFocus=+new Date,this.toggleFocusClass(this.state.hasFocus)):this.state.hasFocus=!1,"mix"!=i.mode){if(s){if(!i.focusable)return;var g=0===i.dropdown.enabled&&!this.state.dropdown.visible;return this.toggleFocusClass(!0),this.trigger("focus",h),void(!g||o&&"select"!==i.mode||this.dropdown.show(this.value.length?"":void 0))}if(l){if(this.trigger("blur",h),this.loading(!1),"select"==i.mode){if(this.value.length){var m=this.getTagElms()[0];u=this.trim(m.textContent)}c===u&&(u="")}u&&!this.state.actions.selectOption&&i.addTagOnBlur&&i.addTagOn.includes("blur")&&this.addTags(u,!0)}r||(this.DOM.input.removeAttribute("style"),this.dropdown.hide())}else s?this.trigger("focus",h):l&&(this.trigger("blur",h),this.loading(!1),this.dropdown.hide(),this.state.dropdown.visible=void 0,this.setStateSelection())},onCompositionStart:function(t){this.state.composing=!0},onCompositionEnd:function(t){this.state.composing=!1},onWindowKeyDown:function(t){var e,n=this.settings,i=document.activeElement,r=S.call(this,i)&&this.DOM.scope.contains(document.activeElement),o=r&&i.hasAttribute("readonly");if(this.state.hasFocus||r&&!o){e=i.nextElementSibling;var a=t.target.classList.contains(n.classNames.tagX);switch(t.key){case"Backspace":n.readonly||this.state.editing||(this.removeTags(i),(e||this.DOM.input).focus());break;case"Enter":if(a)return void this.removeTags(t.target.parentNode);n.a11y.focusableTags&&A.call(this,i)&&setTimeout(this.editTag.bind(this),0,i);break;case"ArrowDown":this.state.dropdown.visible||"mix"==n.mode||this.dropdown.show()}}},onKeydown:function(t){var e=this,n=this.settings;if(!this.state.composing&&n.userInput){"select"==n.mode&&n.enforceWhitelist&&this.value.length&&"Tab"!=t.key&&t.preventDefault();var i=this.trim(t.target.textContent);this.trigger("keydown",{event:t}),n.hooks.beforeKeyDown(t,{tagify:this}).then((function(r){if("mix"==n.mode){switch(t.key){case"Left":case"ArrowLeft":e.state.actions.ArrowLeft=!0;break;case"Delete":case"Backspace":if(e.state.editing)return;var o=document.getSelection(),a="Delete"==t.key&&o.anchorOffset==(o.anchorNode.length||0),s=o.anchorNode.previousSibling,l=1==o.anchorNode.nodeType||!o.anchorOffset&&s&&1==s.nodeType&&o.anchorNode.previousSibling;h(e.DOM.input.innerHTML);var u,c,d,f=e.getTagElms(),g=1===o.anchorNode.length&&o.anchorNode.nodeValue==String.fromCharCode(8203);if("edit"==n.backspace&&l)return u=1==o.anchorNode.nodeType?null:o.anchorNode.previousElementSibling,setTimeout(e.editTag.bind(e),0,u),void t.preventDefault();if(E()&&q(l,Element))return d=p(l),l.hasAttribute("readonly")||l.remove(),e.DOM.input.focus(),void setTimeout((function(){x(d),e.DOM.input.click()}));if("BR"==o.anchorNode.nodeName)return;if((a||l)&&1==o.anchorNode.nodeType?c=0==o.anchorOffset?a?f[0]:null:f[Math.min(f.length,o.anchorOffset)-1]:a?c=o.anchorNode.nextElementSibling:q(l,Element)&&(c=l),3==o.anchorNode.nodeType&&!o.anchorNode.nodeValue&&o.anchorNode.previousElementSibling&&t.preventDefault(),(l||a)&&!n.backspace)return void t.preventDefault();if("Range"!=o.type&&!o.anchorOffset&&o.anchorNode==e.DOM.input&&"Delete"!=t.key)return void t.preventDefault();if("Range"!=o.type&&c&&c.hasAttribute("readonly"))return void x(p(c));"Delete"==t.key&&g&&L(o.anchorNode.nextSibling)&&e.removeTags(o.anchorNode.nextSibling),clearTimeout(F),F=setTimeout((function(){var t=document.getSelection();h(e.DOM.input.innerHTML),!a&&t.anchorNode.previousSibling,e.value=[].map.call(f,(function(t,n){var i=L(t);if(t.parentNode||i.readonly)return i;e.trigger("remove",{tag:t,index:n,data:i})})).filter((function(t){return t}))}),20)}return!0}var m="manual"==n.dropdown.position;switch(t.key){case"Backspace":"select"==n.mode&&n.enforceWhitelist&&e.value.length?e.removeTags():e.state.dropdown.visible&&"manual"!=n.dropdown.position||""!=t.target.textContent&&8203!=i.charCodeAt(0)||(!0===n.backspace?e.removeTags():"edit"==n.backspace&&setTimeout(e.editTag.bind(e),0));break;case"Esc":case"Escape":if(e.state.dropdown.visible)return;t.target.blur();break;case"Down":case"ArrowDown":e.state.dropdown.visible||e.dropdown.show();break;case"ArrowRight":var v=e.state.inputSuggestion||e.state.ddItemData;if(v&&n.autoComplete.rightKey)return void e.addTags([v],!0);break;case"Tab":var y="select"==n.mode;if(!i||y)return!0;t.preventDefault();case"Enter":if(e.state.dropdown.visible&&!m)return;t.preventDefault(),setTimeout((function(){e.state.dropdown.visible&&!m||e.state.actions.selectOption||!n.addTagOn.includes(t.key.toLowerCase())||e.addTags(i,!0)}))}})).catch((function(t){return t}))}},onInput:function(t){this.postUpdate();var e=this.settings;if("mix"==e.mode)return this.events.callbacks.onMixTagsInput.call(this,t);var n=this.input.normalize.call(this,void 0,{trim:!1}),i=n.length>=e.dropdown.enabled,r={value:n,inputElm:this.DOM.input},o=this.validateTag({value:n});"select"==e.mode&&this.toggleScopeValidation(o),r.isValid=o,this.state.inputText!=n&&(this.input.set.call(this,n,!1),-1!=n.search(e.delimiters)?this.addTags(n)&&this.input.set.call(this):e.dropdown.enabled>=0&&this.dropdown[i?"show":"hide"](n),this.trigger("input",r))},onMixTagsInput:function(t){var e,n,i,r,o,a,s,l,u=this,c=this.settings,d=this.value.length,h=this.getTagElms(),f=document.createDocumentFragment(),p=window.getSelection().getRangeAt(0),g=[].map.call(h,(function(t){return L(t).value}));if("deleteContentBackward"==t.inputType&&E()&&this.events.callbacks.onKeydown.call(this,{target:t.target,key:"Backspace"}),D(this.getTagElms()),this.value.slice().forEach((function(t){t.readonly&&!g.includes(t.value)&&f.appendChild(u.createTagElem(t))})),f.childNodes.length&&(p.insertNode(f),this.setRangeAtStartEnd(!1,f.lastChild)),h.length!=d)return this.value=[].map.call(this.getTagElms(),(function(t){return L(t)})),void this.update({withoutChangeEvent:!0});if(this.hasMaxTags())return!0;if(window.getSelection&&(a=window.getSelection()).rangeCount>0&&3==a.anchorNode.nodeType){if((p=a.getRangeAt(0).cloneRange()).collapse(!0),p.setStart(a.focusNode,0),i=(e=p.toString().slice(0,p.endOffset)).split(c.pattern).length-1,(n=e.match(c.pattern))&&(r=e.slice(e.lastIndexOf(n[n.length-1]))),r){if(this.state.actions.ArrowLeft=!1,this.state.tag={prefix:r.match(c.pattern)[0],value:r.replace(c.pattern,"")},this.state.tag.baseOffset=a.baseOffset-this.state.tag.value.length,l=this.state.tag.value.match(c.delimiters))return this.state.tag.value=this.state.tag.value.replace(c.delimiters,""),this.state.tag.delimiters=l[0],this.addTags(this.state.tag.value,c.dropdown.clearOnSelect),void this.dropdown.hide();o=this.state.tag.value.length>=c.dropdown.enabled;try{s=(s=this.state.flaggedTags[this.state.tag.baseOffset]).prefix==this.state.tag.prefix&&s.value[0]==this.state.tag.value[0],this.state.flaggedTags[this.state.tag.baseOffset]&&!this.state.tag.value&&delete this.state.flaggedTags[this.state.tag.baseOffset]}catch(t){}(s||i<this.state.mixMode.matchedPatternCount)&&(o=!1)}else this.state.flaggedTags={};this.state.mixMode.matchedPatternCount=i}setTimeout((function(){u.update({withoutChangeEvent:!0}),u.trigger("input",v({},u.state.tag,{textContent:u.DOM.input.textContent})),u.state.tag&&u.dropdown[o?"show":"hide"](u.state.tag.value)}),10)},onInputIE:function(t){var e=this;setTimeout((function(){e.events.callbacks.onInput.call(e,t)}))},observeOriginalInputValue:function(){this.DOM.originalInput.parentNode||this.destroy(),this.DOM.originalInput.value!=this.DOM.originalInput.tagifyValue&&this.loadOriginalValues()},onClickAnywhere:function(t){t.target==this.DOM.scope||this.DOM.scope.contains(t.target)||(this.toggleFocusClass(!1),this.state.hasFocus=!1,t.target.closest(".tagify__dropdown")&&t.target.closest(".tagify__dropdown").__tagify!=this&&this.dropdown.hide())},onClickScope:function(t){var e=this.settings,n=t.target.closest("."+e.classNames.tag),i=t.target===this.DOM.scope,r=+new Date-this.state.hasFocus;if(i&&"select"!=e.mode)this.DOM.input.focus();else{if(!t.target.classList.contains(e.classNames.tagX))return n&&!this.state.editing?(this.trigger("click",{tag:n,index:this.getNodeIndex(n),data:L(n),event:t}),void(1!==e.editTags&&1!==e.editTags.clicks&&"select"!=e.mode||this.events.callbacks.onDoubleClickScope.call(this,t))):void(t.target==this.DOM.input&&("mix"==e.mode&&this.fixFirefoxLastTagNoCaret(),r>500||!e.focusable)?this.state.dropdown.visible?this.dropdown.hide():0===e.dropdown.enabled&&"mix"!=e.mode&&this.dropdown.show(this.value.length?"":void 0):"select"!=e.mode||0!==e.dropdown.enabled||this.state.dropdown.visible||(this.events.callbacks.onDoubleClickScope.call(this,function(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):function(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n.push.apply(n,i)}return n}(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})),t}(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){W(t,e,n[e])}))}return t}({},t),{target:this.getTagElms()[0]})),!e.userInput&&this.dropdown.show()));this.removeTags(t.target.parentNode)}},onPaste:function(t){var e=this;t.preventDefault();var n,i,r,o=this.settings;if("select"==o.mode&&o.enforceWhitelist||!o.userInput)return!1;o.readonly||(i=t.clipboardData||window.clipboardData,r=i.getData("Text"),o.hooks.beforePaste(t,{tagify:this,pastedText:r,clipboardData:i}).then((function(o){void 0===o&&(o=r),o&&(e.injectAtCaret(o,window.getSelection().getRangeAt(0)),"mix"==e.settings.mode?e.events.callbacks.onMixTagsInput.call(e,t):e.settings.pasteAsTags?n=e.addTags(e.state.inputText+o,!0):(e.state.inputText=o,e.dropdown.show(o))),e.trigger("paste",{event:t,pastedText:r,clipboardData:i,tagsElems:n})})).catch((function(t){return t})))},onDrop:function(t){t.preventDefault()},onEditTagInput:function(t,e){var n,i=t.closest("."+this.settings.classNames.tag),r=this.getNodeIndex(i),o=L(i),a=this.input.normalize.call(this,t),s=(W(n={},this.settings.tagTextProp,a),W(n,"__tagId",o.__tagId),n),l=this.validateTag(s);this.editTagChangeDetected(v(o,s))||!0!==t.originalIsValid||(l=!0),i.classList.toggle(this.settings.classNames.tagInvalid,!0!==l),o.__isValid=l,i.title=!0===l?o.title||o.value:l,a.length>=this.settings.dropdown.enabled&&(this.state.editing&&(this.state.editing.value=a),this.dropdown.show(a)),this.trigger("edit:input",{tag:i,index:r,data:v({},this.value[r],{newValue:a}),event:e})},onEditTagPaste:function(t,e){var n=(e.clipboardData||window.clipboardData).getData("Text");e.preventDefault();var i=w(n);this.setRangeAtStartEnd(!1,i)},onEditTagClick:function(t,e){this.events.callbacks.onClickScope.call(this,e)},onEditTagFocus:function(t){this.state.editing={scope:t,input:t.querySelector("[contenteditable]")}},onEditTagBlur:function(t,e){var n=A.call(this,e.relatedTarget);if("select"==this.settings.mode&&n&&e.relatedTarget.contains(e.target))this.dropdown.hide();else if(this.state.editing&&(this.state.hasFocus||this.toggleFocusClass(),this.DOM.scope.contains(t))){var i,r,o,a=this.settings,s=t.closest("."+a.classNames.tag),l=L(s),u=this.input.normalize.call(this,t),c=(W(i={},a.tagTextProp,u),W(i,"__tagId",l.__tagId),i),d=l.__originalData,h=this.editTagChangeDetected(v(l,c)),f=this.validateTag(c);if(u)if(h){var p;if(r=this.hasMaxTags(),o=v({},d,(W(p={},a.tagTextProp,this.trim(u)),W(p,"__isValid",f),p)),a.transformTag.call(this,o,d),!0!==(f=(!r||!0===d.__isValid)&&this.validateTag(o))){if(this.trigger("invalid",{data:o,tag:s,message:f}),a.editTags.keepInvalid)return;a.keepInvalidTags?o.__isValid=f:o=d}else a.keepInvalidTags&&(delete o.title,delete o["aria-invalid"],delete o.class);this.onEditTagDone(s,o)}else this.onEditTagDone(s,d);else this.onEditTagDone(s)}},onEditTagkeydown:function(t,e){if(!this.state.composing)switch(this.trigger("edit:keydown",{event:t}),t.key){case"Esc":case"Escape":this.state.editing=!1,e.__tagifyTagData.__originalData.value?e.parentNode.replaceChild(e.__tagifyTagData.__originalHTML,e):e.remove();break;case"Enter":case"Tab":t.preventDefault(),setTimeout((function(){return t.target.blur()}),0)}},onDoubleClickScope:function(t){var e,n,i=t.target.closest("."+this.settings.classNames.tag),r=L(i),o=this.settings;i&&!1!==r.editable&&(e=i.classList.contains(this.settings.classNames.tagEditing),n=i.hasAttribute("readonly"),o.readonly||e||n||!this.settings.editTags||!o.userInput||(this.events.callbacks.onEditTagFocus.call(this,i),this.editTag(i)),this.toggleFocusClass(!0),"select"!=o.mode&&this.trigger("dblclick",{tag:i,index:this.getNodeIndex(i),data:L(i)}))},onInputDOMChange:function(t){var e=this;t.forEach((function(t){t.addedNodes.forEach((function(t){if("<div><br></div>"==t.outerHTML)t.replaceWith(document.createElement("br"));else if(1==t.nodeType&&t.querySelector(e.settings.classNames.tagSelector)){var n,i=document.createTextNode("");3==t.childNodes[0].nodeType&&"BR"!=t.previousSibling.nodeName&&(i=document.createTextNode("\n")),(n=t).replaceWith.apply(n,Y([i].concat(Y(Y(t.childNodes).slice(0,-1))))),x(i)}else if(A.call(e,t)){var r;if(3!=(null===(r=t.previousSibling)||void 0===r?void 0:r.nodeType)||t.previousSibling.textContent||t.previousSibling.remove(),t.previousSibling&&"BR"==t.previousSibling.nodeName){t.previousSibling.replaceWith("\n​");for(var o=t.nextSibling,a="";o;)a+=o.textContent,o=o.nextSibling;a.trim()&&x(t.previousSibling)}else t.previousSibling&&!L(t.previousSibling)||t.before("​")}})),t.removedNodes.forEach((function(t){t&&"BR"==t.nodeName&&A.call(e,n)&&(e.removeTags(n),e.fixFirefoxLastTagNoCaret())}))}));var n=this.DOM.input.lastChild;n&&""==n.nodeValue&&n.remove(),n&&"BR"==n.nodeName||this.DOM.input.appendChild(document.createElement("br"))}}};function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function J(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function Q(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){J(t,e,n[e])}))}return t}function Z(t){return function(t){if(Array.isArray(t))return X(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return X(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(t,e){if(!t){l.warn("input element not found",t);var n=new Proxy(this,{get:function(){return function(){return n}}});return n}if(t.__tagify)return l.warn("input element is already Tagified - Same instance is returned.",t),t.__tagify;var i;v(this,function(t){var e=document.createTextNode(""),n={};function i(t,n,i){i&&n.split(/\s+/g).forEach((function(n){return e[t+"EventListener"].call(e,n,i)}))}return{removeAllCustomListeners:function(){Object.entries(n).forEach((function(t){var e=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(i=n.next()).done)&&(o.push(i.value),!e||o.length!==e);a=!0);}catch(t){s=!0,r=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw r}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return V(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?V(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,2),n=e[0];e[1].forEach((function(t){return i("remove",n,t)}))})),n={}},off:function(t,e){return t&&(e?i("remove",t,e):t.split(/\s+/g).forEach((function(t){var e;null===(e=n[t])||void 0===e||e.forEach((function(e){return i("remove",t,e)})),delete n[t]}))),this},on:function(t,e){return e&&"function"==typeof e&&(t.split(/\s+/g).forEach((function(t){Array.isArray(n[t])?n[t].push(e):n[t]=[e]})),i("add",t,e)),this},trigger:function(n,i,r){var o;if(r=r||{cloneData:!0},n)if(t.settings.isJQueryPlugin)"remove"==n&&(n="removeTag"),jQuery(t.DOM.originalInput).triggerHandler(n,[i]);else{try{var a="object"==typeof i?i:{value:i};if((a=r.cloneData?v({},a):a).tagify=this,i.event&&(a.event=this.cloneEvent(i.event)),H(i,Object))for(var s in i)H(i[s],HTMLElement)&&(a[s]=i[s]);o=new CustomEvent(n,{detail:a})}catch(t){l.warn(t)}e.dispatchEvent(o)}}}}(this)),this.isFirefox=/firefox|fxios/i.test(navigator.userAgent)&&!/seamonkey/i.test(navigator.userAgent),this.isIE=window.document.documentMode,e=e||{},this.getPersistedData=(i=e.id,function(t){var e,n="/"+t;if(1==localStorage.getItem(U+i+"/v",1))try{e=JSON.parse(localStorage[U+i+n])}catch(t){}return e}),this.setPersistedData=function(t){return t?(localStorage.setItem(U+t+"/v",1),function(e,n){var i="/"+n,r=JSON.stringify(e);e&&n&&(localStorage.setItem(U+t+i,r),dispatchEvent(new Event("storage")))}):function(){}}(e.id),this.clearPersistedData=function(t){return function(e){var n=U+"/"+t+"/";if(e)localStorage.removeItem(n+e);else for(var i in localStorage)i.includes(n)&&localStorage.removeItem(i)}}(e.id),this.applySettings(t,e),this.state={inputText:"",editing:!1,composing:!1,actions:{},mixMode:{},dropdown:{},flaggedTags:{}},this.value=[],this.listeners={},this.DOM={},this.build(t),P.call(this),this.getCSSVars(),this.loadOriginalValues(),this.events.customBinding.call(this),this.events.binding.call(this),t.autofocus&&this.DOM.input.focus(),t.__tagify=this}tt.prototype={_dropdown:B,placeCaretAfterNode:x,getSetTagData:L,helpers:{sameStr:u,removeCollectionProp:c,omit:d,isObject:m,parseHTML:f,escapeHTML:g,extend:v,concatWithoutDups:y,getUID:T,isNodeTag:A},customEventsList:["change","add","remove","invalid","input","paste","click","keydown","focus","blur","edit:input","edit:beforeUpdate","edit:updated","edit:start","edit:keydown","dropdown:show","dropdown:hide","dropdown:select","dropdown:updated","dropdown:noMatch","dropdown:scroll"],dataProps:["__isValid","__removed","__originalData","__originalHTML","__tagId"],trim:function(t){return this.settings.trim&&t&&"string"==typeof t?t.trim():t},parseHTML:f,templates:G,parseTemplate:function(t,e){return f((t=this.settings.templates[t]||t).apply(this,e))},set whitelist(t){var e=t&&Array.isArray(t);this.settings.whitelist=e?t:[],this.setPersistedData(e?t:[],"whitelist")},get whitelist(){return this.settings.whitelist},set userInput(t){this.settings.userInput=!!t,this.setContentEditable(!!t)},get userInput(){return this.settings.userInput},generateClassSelectors:function(t){var e=function(e){var n=e;Object.defineProperty(t,n+"Selector",{get:function(){return"."+this[n].split(" ")[0]}})};for(var n in t)e(n)},applySettings:function(t,e){var n,i;R.templates=this.templates;var r=v({},R,"mix"==e.mode?{dropdown:{position:"text"}}:{}),o=this.settings=v({},r,e);if(o.disabled=t.hasAttribute("disabled"),o.readonly=o.readonly||t.hasAttribute("readonly"),o.placeholder=g(t.getAttribute("placeholder")||o.placeholder||""),o.required=t.hasAttribute("required"),this.generateClassSelectors(o.classNames),void 0===o.dropdown.includeSelectedTags&&(o.dropdown.includeSelectedTags=o.duplicates),this.isIE&&(o.autoComplete=!1),["whitelist","blacklist"].forEach((function(e){var n=t.getAttribute("data-"+e);n&&$(n=n.split(o.delimiters),Array)&&(o[e]=n)})),"autoComplete"in e&&!m(e.autoComplete)&&(o.autoComplete=R.autoComplete,o.autoComplete.enabled=e.autoComplete),"mix"==o.mode&&(o.pattern=o.pattern||/@/,o.autoComplete.rightKey=!0,o.delimiters=e.delimiters||null,o.tagTextProp&&!o.dropdown.searchKeys.includes(o.tagTextProp)&&o.dropdown.searchKeys.push(o.tagTextProp)),t.pattern)try{o.pattern=new RegExp(t.pattern)}catch(t){}if(o.delimiters){o._delimiters=o.delimiters;try{o.delimiters=new RegExp(this.settings.delimiters,"g")}catch(t){}}o.disabled&&(o.userInput=!1),this.TEXTS=Q({},j,o.texts||{}),("select"!=o.mode||(null===(n=e.dropdown)||void 0===n?void 0:n.enabled))&&o.userInput||(o.dropdown.enabled=0),o.dropdown.appendTarget=(null===(i=e.dropdown)||void 0===i?void 0:i.appendTarget)||document.body;var a=this.getPersistedData("whitelist");Array.isArray(a)&&(this.whitelist=Array.isArray(o.whitelist)?y(o.whitelist,a):a)},getAttributes:function(t){var e,n=this.getCustomAttributes(t),i="";for(e in n)i+=" "+e+(void 0!==t[e]?'="'.concat(n[e],'"'):"");return i},getCustomAttributes:function(t){if(!m(t))return"";var e,n={};for(e in t)"__"!=e.slice(0,2)&&"class"!=e&&t.hasOwnProperty(e)&&void 0!==t[e]&&(n[e]=g(t[e]));return n},setStateSelection:function(){var t=window.getSelection(),e={anchorOffset:t.anchorOffset,anchorNode:t.anchorNode,range:t.getRangeAt&&t.rangeCount&&t.getRangeAt(0)};return this.state.selection=e,e},getCSSVars:function(){var t,e,n=getComputedStyle(this.DOM.scope,null);this.CSSVars={tagHideTransition:(t=function(t){if(!t)return{};var e=(t=t.trim().split(" ")[0]).split(/\d+/g).filter((function(t){return t})).pop().trim();return{value:+t.split(e).filter((function(t){return t}))[0].trim(),unit:e}}(n.getPropertyValue("--tag-hide-transition")),e=t.value,"s"==t.unit?1e3*e:e)}},build:function(t){var e=this.DOM,n=t.closest("label");this.settings.mixMode.integrated?(e.originalInput=null,e.scope=t,e.input=t):(e.originalInput=t,e.originalInput_tabIndex=t.tabIndex,e.scope=this.parseTemplate("wrapper",[t,this.settings]),e.input=e.scope.querySelector(this.settings.classNames.inputSelector),t.parentNode.insertBefore(e.scope,t),t.tabIndex=-1),n&&n.setAttribute("for","")},destroy:function(){this.events.unbindGlobal.call(this),this.DOM.scope.parentNode.removeChild(this.DOM.scope),this.DOM.originalInput.tabIndex=this.DOM.originalInput_tabIndex,delete this.DOM.originalInput.__tagify,this.dropdown.hide(!0),this.removeAllCustomListeners(),clearTimeout(this.dropdownHide__bindEventsTimeout),clearInterval(this.listeners.main.originalInputValueObserverInterval)},loadOriginalValues:function(t){var e,n=this.settings;if(this.state.blockChangeEvent=!0,void 0===t){var i=this.getPersistedData("value");t=i&&!this.DOM.originalInput.value?i:n.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value}if(this.removeAllTags(),t)if("mix"==n.mode)this.parseMixTags(t),(e=this.DOM.input.lastChild)&&"BR"==e.tagName||this.DOM.input.insertAdjacentHTML("beforeend","<br>");else{try{$(JSON.parse(t),Array)&&(t=JSON.parse(t))}catch(t){}this.addTags(t,!0).forEach((function(t){return t&&t.classList.add(n.classNames.tagNoAnimation)}))}else this.postUpdate();this.state.lastOriginalValueReported=n.mixMode.integrated?"":this.DOM.originalInput.value},cloneEvent:function(t){var e={};for(var n in t)"path"!=n&&(e[n]=t[n]);return e},loading:function(t){return this.state.isLoading=t,this.DOM.scope.classList[t?"add":"remove"](this.settings.classNames.scopeLoading),this},tagLoading:function(t,e){return t&&t.classList[e?"add":"remove"](this.settings.classNames.tagLoading),this},toggleClass:function(t,e){"string"==typeof t&&this.DOM.scope.classList.toggle(t,e)},toggleScopeValidation:function(t){var e=!0===t||void 0===t;!this.settings.required&&t&&t===this.TEXTS.empty&&(e=!0),this.toggleClass(this.settings.classNames.tagInvalid,!e),this.DOM.scope.title=e?"":t},toggleFocusClass:function(t){this.toggleClass(this.settings.classNames.focus,!!t)},setPlaceholder:function(t){var e=this;["data","aria"].forEach((function(n){return e.DOM.input.setAttribute("".concat(n,"-placeholder"),t)}))},triggerChangeEvent:function(){if(!this.settings.mixMode.integrated){var t=this.DOM.originalInput,e=this.state.lastOriginalValueReported!==t.value,n=new CustomEvent("change",{bubbles:!0});e&&(this.state.lastOriginalValueReported=t.value,n.simulated=!0,t._valueTracker&&t._valueTracker.setValue(Math.random()),t.dispatchEvent(n),this.trigger("change",this.state.lastOriginalValueReported),t.value=this.state.lastOriginalValueReported)}},events:z,fixFirefoxLastTagNoCaret:function(){},setRangeAtStartEnd:function(t,e){if(e){t="number"==typeof t?t:!!t,e=e.lastChild||e;var n=document.getSelection();if($(n.focusNode,Element)&&!this.DOM.input.contains(n.focusNode))return!0;try{n.rangeCount>=1&&["Start","End"].forEach((function(i){return n.getRangeAt(0)["set"+i](e,t||e.length)}))}catch(t){console.warn(t)}}},insertAfterTag:function(t,e){if(e=e||this.settings.mixMode.insertAfterTag,t&&t.parentNode&&e)return e="string"==typeof e?document.createTextNode(e):e,t.parentNode.insertBefore(e,t.nextSibling),e},editTagChangeDetected:function(t){var e=t.__originalData;for(var n in e)if(!this.dataProps.includes(n)&&t[n]!=e[n])return!0;return!1},getTagTextNode:function(t){return t.querySelector(this.settings.classNames.tagTextSelector)},setTagTextNode:function(t,e){this.getTagTextNode(t).innerHTML=g(e)},editTag:function(t,e){var n=this;t=t||this.getLastTag(),e=e||{};var i=this.settings,r=this.getTagTextNode(t),o=this.getNodeIndex(t),a=L(t),s=this.events.callbacks,u=!0,c="select"==i.mode;if(!c&&this.dropdown.hide(),r){if(!$(a,Object)||!("editable"in a)||a.editable)return a=L(t,{__originalData:v({},a),__originalHTML:t.cloneNode(!0)}),L(a.__originalHTML,a.__originalData),r.setAttribute("contenteditable",!0),t.classList.add(i.classNames.tagEditing),r.addEventListener("click",s.onEditTagClick.bind(this,t)),r.addEventListener("blur",s.onEditTagBlur.bind(this,this.getTagTextNode(t))),r.addEventListener("input",s.onEditTagInput.bind(this,r)),r.addEventListener("paste",s.onEditTagPaste.bind(this,r)),r.addEventListener("keydown",(function(e){return s.onEditTagkeydown.call(n,e,t)})),r.addEventListener("compositionstart",s.onCompositionStart.bind(this)),r.addEventListener("compositionend",s.onCompositionEnd.bind(this)),e.skipValidation||(u=this.editTagToggleValidity(t)),r.originalIsValid=u,this.trigger("edit:start",{tag:t,index:o,data:a,isValid:u}),r.focus(),!c&&this.setRangeAtStartEnd(!1,r),0===i.dropdown.enabled&&!c&&this.dropdown.show(),this.state.hasFocus=!0,this}else l.warn("Cannot find element in Tag template: .",i.classNames.tagTextSelector)},editTagToggleValidity:function(t,e){var n;if(e=e||L(t))return(n=!("__isValid"in e)||!0===e.__isValid)||this.removeTagsFromValue(t),this.update(),t.classList.toggle(this.settings.classNames.tagNotAllowed,!n),e.__isValid=n,e.__isValid;l.warn("tag has no data: ",t,e)},onEditTagDone:function(t,e){e=e||{};var n,i,r={tag:t=t||this.state.editing.scope,index:this.getNodeIndex(t),previousData:L(t),data:e},o=this.settings;this.trigger("edit:beforeUpdate",r,{cloneData:!1}),this.state.editing=!1,delete e.__originalData,delete e.__originalHTML,t&&(void 0!==(i=e[o.tagTextProp])?null===(n=(i+="").trim)||void 0===n?void 0:n.call(i):o.tagTextProp in e?void 0:e.value)?(t=this.replaceTag(t,e),this.editTagToggleValidity(t,e),o.a11y.focusableTags?t.focus():"select"!=o.mode&&x(t)):t&&this.removeTags(t),this.trigger("edit:updated",r),this.dropdown.hide(),this.settings.keepInvalidTags&&this.reCheckInvalidTags()},replaceTag:function(t,e){e&&""!==e.value&&void 0!==e.value||(e=t.__tagifyTagData),e.__isValid&&1!=e.__isValid&&v(e,this.getInvalidTagAttrs(e,e.__isValid));var n=this.createTagElem(e);return t.parentNode.replaceChild(n,t),this.updateValueByDOMTags(),n},updateValueByDOMTags:function(){var t=this;this.value.length=0;var e=this.settings.classNames,n=[e.tagNotAllowed.split(" ")[0],e.tagHide];[].forEach.call(this.getTagElms(),(function(e){Z(e.classList).some((function(t){return n.includes(t)}))||t.value.push(L(e))})),this.update()},injectAtCaret:function(t,e){var n;if(!(e=e||(null===(n=this.state.selection)||void 0===n?void 0:n.range))&&t)return this.appendMixTags(t),this;var i=w(t,e);return this.setRangeAtStartEnd(!1,i),this.updateValueByDOMTags(),this.update(),this},input:{set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.settings,i=n.dropdown.closeOnSelect;this.state.inputText=t,e&&(this.DOM.input.innerHTML=g(""+t),t&&this.toggleClass(n.classNames.empty,!this.DOM.input.innerHTML)),!t&&i&&this.dropdown.hide.bind(this),this.input.autocomplete.suggest.call(this),this.input.validate.call(this)},raw:function(){return this.DOM.input.textContent},validate:function(){var t=!this.state.inputText||!0===this.validateTag({value:this.state.inputText});return this.DOM.input.classList.toggle(this.settings.classNames.inputInvalid,!t),t},normalize:function(t,e){var n=t||this.DOM.input,i=[];n.childNodes.forEach((function(t){return 3==t.nodeType&&i.push(t.nodeValue)})),i=i.join("\n");try{i=i.replace(/(?:\r\n|\r|\n)/g,this.settings.delimiters.source.charAt(0))}catch(t){}return i=i.replace(/\s/g," "),(null==e?void 0:e.trim)?this.trim(i):i},autocomplete:{suggest:function(t){if(this.settings.autoComplete.enabled){"object"!=typeof(t=t||{value:""})&&(t={value:t});var e=this.dropdown.getMappedValue(t);if("number"!=typeof e){var n=this.state.inputText.toLowerCase(),i=e.substr(0,this.state.inputText.length).toLowerCase(),r=e.substring(this.state.inputText.length);e&&this.state.inputText&&i==n?(this.DOM.input.setAttribute("data-suggest",r),this.state.inputSuggestion=t):(this.DOM.input.removeAttribute("data-suggest"),delete this.state.inputSuggestion)}}},set:function(t){var e=this.DOM.input.getAttribute("data-suggest"),n=t||(e?this.state.inputText+e:null);return!!n&&("mix"==this.settings.mode?this.replaceTextWithNode(document.createTextNode(this.state.tag.prefix+n)):(this.input.set.call(this,n),this.setRangeAtStartEnd(!1,this.DOM.input)),this.input.autocomplete.suggest.call(this),this.dropdown.hide(),!0)}}},getTagIdx:function(t){return this.value.findIndex((function(e){return e.__tagId==(t||{}).__tagId}))},getNodeIndex:function(t){var e=0;if(t)for(;t=t.previousElementSibling;)e++;return e},getTagElms:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i="."+Z(this.settings.classNames.tag.split(" ")).concat(Z(e)).join(".");return[].slice.call(this.DOM.scope.querySelectorAll(i))},getLastTag:function(){var t=this.settings.classNames,e=this.DOM.scope.querySelectorAll("".concat(t.tagSelector,":not(.").concat(t.tagHide,"):not([readonly])"));return e[e.length-1]},isTagDuplicate:function(t,e,n){var i=0,r=!0,o=!1,a=void 0;try{for(var s,l=this.value[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var c=s.value;u(this.trim(""+t),c.value,e)&&n!=c.__tagId&&i++}}catch(t){o=!0,a=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw a}}return i},getTagIndexByValue:function(t){var e=this,n=[],i=this.settings.dropdown.caseSensitive;return this.getTagElms().forEach((function(r,o){r.__tagifyTagData&&u(e.trim(r.__tagifyTagData.value),t,i)&&n.push(o)})),n},getTagElmByValue:function(t){var e=this.getTagIndexByValue(t)[0];return this.getTagElms()[e]},flashTag:function(t){var e=this;t&&(t.classList.add(this.settings.classNames.tagFlash),setTimeout((function(){t.classList.remove(e.settings.classNames.tagFlash)}),100))},isTagBlacklisted:function(t){return t=this.trim(t.toLowerCase()),this.settings.blacklist.filter((function(e){return(""+e).toLowerCase()==t})).length},isTagWhitelisted:function(t){return!!this.getWhitelistItem(t)},getWhitelistItem:function(t,e,n){e=e||"value";var i,r=this.settings;return(n=n||r.whitelist).some((function(n){var o="object"==typeof n?n[e]||n.value:n;if(u(o,t,r.dropdown.caseSensitive,r.trim))return i="object"==typeof n?n:{value:n},!0})),i||"value"!=e||"value"==r.tagTextProp||(i=this.getWhitelistItem(t,r.tagTextProp,n)),i},validateTag:function(t){var e=this.settings,n="value"in t?"value":e.tagTextProp,i=this.trim(t[n]+"");return(t[n]+"").trim()?"mix"!=e.mode&&e.pattern&&$(e.pattern,RegExp)&&!e.pattern.test(i)?this.TEXTS.pattern:!e.duplicates&&this.isTagDuplicate(i,e.dropdown.caseSensitive,t.__tagId)?this.TEXTS.duplicate:this.isTagBlacklisted(i)||e.enforceWhitelist&&!this.isTagWhitelisted(i)?this.TEXTS.notAllowed:!e.validate||e.validate(t):this.TEXTS.empty},getInvalidTagAttrs:function(t,e){return{"aria-invalid":!0,class:"".concat(t.class||""," ").concat(this.settings.classNames.tagNotAllowed).trim(),title:e}},hasMaxTags:function(){return this.value.length>=this.settings.maxTags&&this.TEXTS.exceed},setReadonly:function(t,e){var n=this.settings;this.DOM.scope.contains(document.activeElement)&&document.activeElement.blur(),n[e||"readonly"]=t,this.DOM.scope[(t?"set":"remove")+"Attribute"](e||"readonly",!0),this.settings.userInput=!0,this.setContentEditable(!t)},setContentEditable:function(t){this.DOM.input.contentEditable=t,this.DOM.input.tabIndex=t?0:-1},setDisabled:function(t){this.setReadonly(t,"disabled")},normalizeTags:function(t){var e=this,n=this.settings,i=n.whitelist,r=n.delimiters,o=n.mode,a=n.tagTextProp,s=[],l=!!i&&$(i[0],Object),u=Array.isArray(t),c=u&&t[0].value,d=function(t){return(t+"").split(r).reduce((function(t,n){var i,r=e.trim(n);return r&&t.push((J(i={},a,r),J(i,"value",r),i)),t}),[])};if("number"==typeof t&&(t=t.toString()),"string"==typeof t){if(!t.trim())return[];t=d(t)}else u&&(t=t.reduce((function(t,n){if(m(n)){var i=v({},n);a in i||(a="value"),i[a]=e.trim(i[a]),i[a]&&t.push(i)}else if(n){var r;(r=t).push.apply(r,Z(d(n)))}return t}),[]));return l&&!c&&(t.forEach((function(t){var n=s.map((function(t){return t.value})),i=e.dropdown.filterListItems.call(e,t[a],{exact:!0});e.settings.duplicates||(i=i.filter((function(t){return!n.includes(t.value)})));var r=i.length>1?e.getWhitelistItem(t[a],a,i):i[0];r&&$(r,Object)?s.push(r):"mix"!=o&&(null==t.value&&(t.value=t[a]),s.push(t))})),s.length&&(t=s)),t},parseMixTags:function(t){var e=this,n=this.settings,i=n.mixTagsInterpolator,r=n.duplicates,o=n.transformTag,a=n.enforceWhitelist,s=n.maxTags,l=n.tagTextProp,u=[];t=t.split(i[0]).map((function(t,n){var c,d,h,f=t.split(i[1]),p=f[0],g=u.length==s;try{if(p==+p)throw Error;d=JSON.parse(p)}catch(t){d=e.normalizeTags(p)[0]||{value:p}}if(o.call(e,d),g||!(f.length>1)||a&&!e.isTagWhitelisted(d.value)||!r&&e.isTagDuplicate(d.value)){if(t)return n?i[0]+t:t}else d[c=d[l]?l:"value"]=e.trim(d[c]),h=e.createTagElem(d),u.push(d),h.classList.add(e.settings.classNames.tagNoAnimation),f[0]=h.outerHTML,e.value.push(d);return f.join("")})).join(""),this.DOM.input.innerHTML=t,this.DOM.input.appendChild(document.createTextNode("")),this.DOM.input.normalize();var c=this.getTagElms();return c.forEach((function(t,e){return L(t,u[e])})),this.update({withoutChangeEvent:!0}),D(c,this.state.hasFocus),t},replaceTextWithNode:function(t,e){if(this.state.tag||e){e=e||this.state.tag.prefix+this.state.tag.value;var n,i,r=this.state.selection||window.getSelection(),o=r.anchorNode,a=this.state.tag.delimiters?this.state.tag.delimiters.length:0;return o.splitText(r.anchorOffset-a),-1==(n=o.nodeValue.lastIndexOf(e))||(i=o.splitText(n),t&&o.parentNode.replaceChild(t,i)),!0}},prepareNewTagNode:function(t,e){e=e||{};var n=this.settings,i=[],r={},o=Object.assign({},t,{value:t.value+""});if(t=Object.assign({},o),n.transformTag.call(this,t),t.__isValid=this.hasMaxTags()||this.validateTag(t),!0!==t.__isValid){if(e.skipInvalid)return;if(v(r,this.getInvalidTagAttrs(t,t.__isValid),{__preInvalidData:o}),t.__isValid==this.TEXTS.duplicate&&this.flashTag(this.getTagElmByValue(t.value)),!n.createInvalidTags)return void i.push(t.value)}return"readonly"in t&&(t.readonly?r["aria-readonly"]=!0:delete t.readonly),{tagElm:this.createTagElem(t,r),tagData:t,aggregatedInvalidInput:i}},postProcessNewTagNode:function(t,e){var n=this,i=this.settings,r=e.__isValid;r&&!0===r?(this.value.push(e),setTimeout((function(){n.trigger("add",{tag:t,index:n.value.length-1,data:e})}))):(this.trigger("invalid",{data:e,index:this.value.length,tag:t,message:r}),i.keepInvalidTags||setTimeout((function(){return n.removeTags(t,!0)}),1e3)),this.dropdown.position()},selectTag:function(t,e){var n=this;if(!this.settings.enforceWhitelist||this.isTagWhitelisted(e.value)){this.state.actions.selectOption&&setTimeout((function(){return n.setRangeAtStartEnd(!1,n.DOM.input)}));var i=this.getLastTag();return i?this.replaceTag(i,e):this.appendTag(t),this.value[0]=e,this.update(),this.trigger("add",{tag:t,data:e}),[t]}},addEmptyTag:function(t){var e=v({value:""},t||{}),n=this.createTagElem(e);L(n,e),this.appendTag(n),this.editTag(n,{skipValidation:!0}),this.toggleFocusClass(!0)},addTags:function(t,e,n){var i=this,r=[],o=this.settings,a=[],s=document.createDocumentFragment();if(!t||0==t.length)return r;switch(t=this.normalizeTags(t),o.mode){case"mix":return this.addMixTags(t);case"select":e=!1,this.removeAllTags()}return this.DOM.input.removeAttribute("style"),t.forEach((function(t){var e=i.prepareNewTagNode(t,{skipInvalid:n||o.skipInvalid});if(e){var l=e.tagElm;if(t=e.tagData,a=e.aggregatedInvalidInput,r.push(l),"select"==o.mode)return i.selectTag(l,t);s.appendChild(l),i.postProcessNewTagNode(l,t)}})),this.appendTag(s),this.update(),t.length&&e&&(this.input.set.call(this,o.createInvalidTags?"":a.join(o._delimiters)),this.setRangeAtStartEnd(!1,this.DOM.input)),this.dropdown.refilter(),r},addMixTags:function(t){var e=this;if((t=this.normalizeTags(t))[0].prefix||this.state.tag)return this.prefixedTextToTag(t[0]);var n=document.createDocumentFragment();return t.forEach((function(t){var i=e.prepareNewTagNode(t);n.appendChild(i.tagElm),e.insertAfterTag(i.tagElm),e.postProcessNewTagNode(i.tagElm,i.tagData)})),this.appendMixTags(n),n.children},appendMixTags:function(t){var e=!!this.state.selection;e?this.injectAtCaret(t):(this.DOM.input.focus(),(e=this.setStateSelection()).range.setStart(this.DOM.input,e.range.endOffset),e.range.setEnd(this.DOM.input,e.range.endOffset),this.DOM.input.appendChild(t),this.updateValueByDOMTags(),this.update())},prefixedTextToTag:function(t){var e,n,i,r=this,o=this.settings,a=null===(e=this.state.tag)||void 0===e?void 0:e.delimiters;if(t.prefix=t.prefix||this.state.tag?this.state.tag.prefix:(o.pattern.source||o.pattern)[0],i=this.prepareNewTagNode(t),n=i.tagElm,this.replaceTextWithNode(n)||this.DOM.input.appendChild(n),setTimeout((function(){return n.classList.add(r.settings.classNames.tagNoAnimation)}),300),this.value.push(i.tagData),this.update(),!a){var s=this.insertAfterTag(n)||n;setTimeout(x,0,s)}return this.state.tag=null,this.postProcessNewTagNode(n,i.tagData),n},appendTag:function(t){var e=this.DOM,n=e.input;e.scope.insertBefore(t,n)},createTagElem:function(t,e){t.__tagId=T();var n,i=v({},t,Q({value:g(t.value+"")},e));return function(t){for(var e,n=document.createNodeIterator(t,NodeFilter.SHOW_TEXT,null,!1);e=n.nextNode();)e.textContent.trim()||e.parentNode.removeChild(e)}(n=this.parseTemplate("tag",[i,this])),L(n,t),n},reCheckInvalidTags:function(){var t=this,e=this.settings;this.getTagElms(e.classNames.tagNotAllowed).forEach((function(n,i){var r=L(n),o=t.hasMaxTags(),a=t.validateTag(r),s=!0===a&&!o;if("select"==e.mode&&t.toggleScopeValidation(a),s)return r=r.__preInvalidData?r.__preInvalidData:{value:r.value},t.replaceTag(n,r);n.title=o||a}))},removeTags:function(t,e,n){var i,r=this,o=this.settings;if(t=t&&$(t,HTMLElement)?[t]:$(t,Array)?t:t?[t]:[this.getLastTag()].filter((function(t){return t})),i=t.reduce((function(t,e){e&&"string"==typeof e&&(e=r.getTagElmByValue(e));var n=L(e);return e&&n&&!n.readonly&&t.push({node:e,idx:r.getTagIdx(n),data:L(e,{__removed:!0})}),t}),[]),n="number"==typeof n?n:this.CSSVars.tagHideTransition,"select"==o.mode&&(n=0,this.input.set.call(this)),1==i.length&&"select"!=o.mode&&i[0].node.classList.contains(o.classNames.tagNotAllowed)&&(e=!0),i.length)return o.hooks.beforeRemoveTag(i,{tagify:this}).then((function(){var t=function(t){t.node.parentNode&&(t.node.parentNode.removeChild(t.node),e?o.keepInvalidTags&&this.trigger("remove",{tag:t.node,index:t.idx}):(this.trigger("remove",{tag:t.node,index:t.idx,data:t.data}),this.dropdown.refilter(),this.dropdown.position(),this.DOM.input.normalize(),o.keepInvalidTags&&this.reCheckInvalidTags()))};n&&n>10&&1==i.length?function(e){e.node.style.width=parseFloat(window.getComputedStyle(e.node).width)+"px",document.body.clientTop,e.node.classList.add(o.classNames.tagHide),setTimeout(t.bind(this),n,e)}.call(r,i[0]):i.forEach(t.bind(r)),e||(r.removeTagsFromValue(i.map((function(t){return t.node}))),r.update(),"select"==o.mode&&o.userInput&&r.setContentEditable(!0))})).catch((function(t){}))},removeTagsFromDOM:function(){this.getTagElms().forEach((function(t){return t.remove()}))},removeTagsFromValue:function(t){var e=this;(t=Array.isArray(t)?t:[t]).forEach((function(t){var n=L(t),i=e.getTagIdx(n);i>-1&&e.value.splice(i,1)}))},removeAllTags:function(t){var e=this;t=t||{},this.value=[],"mix"==this.settings.mode?this.DOM.input.innerHTML="":this.removeTagsFromDOM(),this.dropdown.refilter(),this.dropdown.position(),this.state.dropdown.visible&&setTimeout((function(){e.DOM.input.focus()})),"select"==this.settings.mode&&(this.input.set.call(this),this.settings.userInput&&this.setContentEditable(!0)),this.update(t)},postUpdate:function(){this.state.blockChangeEvent=!1;var t,e,n=this.settings,i=n.classNames,r="mix"==n.mode?n.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value.trim():this.value.length+this.input.raw.call(this).length;this.toggleClass(i.hasMaxTags,this.value.length>=n.maxTags),this.toggleClass(i.hasNoTags,!this.value.length),this.toggleClass(i.empty,!r),"select"==n.mode&&this.toggleScopeValidation(null===(e=this.value)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.__isValid)},setOriginalInputValue:function(t){var e=this.DOM.originalInput;this.settings.mixMode.integrated||(e.value=t,e.tagifyValue=e.value,this.setPersistedData(t,"value"))},update:function(t){clearTimeout(this.debouncedUpdateTimeout),this.debouncedUpdateTimeout=setTimeout(function(){var e=this.getInputValue();this.setOriginalInputValue(e),this.settings.onChangeAfterBlur&&(t||{}).withoutChangeEvent||this.state.blockChangeEvent||this.triggerChangeEvent(),this.postUpdate()}.bind(this),100),this.events.bindOriginaInputListener.call(this,100)},getInputValue:function(){var t=this.getCleanValue();return"mix"==this.settings.mode?this.getMixedTagsAsString(t):t.length?this.settings.originalInputValueFormat?this.settings.originalInputValueFormat(t):JSON.stringify(t):""},getCleanValue:function(t){return c(t||this.value,this.dataProps)},getMixedTagsAsString:function(){var t="",e=this,n=this.settings,i=n.originalInputValueFormat||JSON.stringify,r=n.mixTagsInterpolator;return function n(o){o.childNodes.forEach((function(o){if(1==o.nodeType){var a=L(o);if("BR"==o.tagName&&(t+="\r\n"),a&&A.call(e,o)){if(a.__removed)return;t+=r[0]+i(d(a,e.dataProps))+r[1]}else o.getAttribute("style")||["B","I","U"].includes(o.tagName)?t+=o.textContent:"DIV"!=o.tagName&&"P"!=o.tagName||(t+="\r\n",n(o))}else t+=o.textContent}))}(this.DOM.input),t}},tt.prototype.removeTag=tt.prototype.removeTags;var et,nt,it,rt,ot=!1,at=!1,st=[],lt=-1;function ut(t){!function(t){st.includes(t)||st.push(t);at||ot||(ot=!0,queueMicrotask(dt))}(t)}function ct(t){let e=st.indexOf(t);-1!==e&&e>lt&&st.splice(e,1)}function dt(){ot=!1,at=!0;for(let t=0;t<st.length;t++)st[t](),lt=t;st.length=0,lt=-1,at=!1}var ht=!0;function ft(t){nt=t}function pt(t,e){let n,i=!0,r=nt((()=>{let r=t();JSON.stringify(r),i?n=r:queueMicrotask((()=>{e(r,n),n=r})),i=!1}));return()=>it(r)}var gt=[],mt=[],vt=[];function yt(t,e){"function"==typeof e?(t._x_cleanups||(t._x_cleanups=[]),t._x_cleanups.push(e)):(e=t,mt.push(e))}function bt(t){gt.push(t)}function Et(t,e,n){t._x_attributeCleanups||(t._x_attributeCleanups={}),t._x_attributeCleanups[e]||(t._x_attributeCleanups[e]=[]),t._x_attributeCleanups[e].push(n)}function Tt(t,e){t._x_attributeCleanups&&Object.entries(t._x_attributeCleanups).forEach((([n,i])=>{(void 0===e||e.includes(n))&&(i.forEach((t=>t())),delete t._x_attributeCleanups[n])}))}var At=new MutationObserver(Ct),St=!1;function wt(){At.observe(document,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0}),St=!0}function Lt(){!function(){let t=At.takeRecords();xt.push((()=>t.length>0&&Ct(t)));let e=xt.length;queueMicrotask((()=>{if(xt.length===e)for(;xt.length>0;)xt.shift()()}))}(),At.disconnect(),St=!1}var xt=[];function Dt(t){if(!St)return t();Lt();let e=t();return wt(),e}var Rt=!1,_t=[];function Ct(t){if(Rt)return void(_t=_t.concat(t));let e=new Set,n=new Set,i=new Map,r=new Map;for(let o=0;o<t.length;o++)if(!t[o].target._x_ignoreMutationObserver&&("childList"===t[o].type&&(t[o].addedNodes.forEach((t=>1===t.nodeType&&e.add(t))),t[o].removedNodes.forEach((t=>1===t.nodeType&&n.add(t)))),"attributes"===t[o].type)){let e=t[o].target,n=t[o].attributeName,a=t[o].oldValue,s=()=>{i.has(e)||i.set(e,[]),i.get(e).push({name:n,value:e.getAttribute(n)})},l=()=>{r.has(e)||r.set(e,[]),r.get(e).push(n)};e.hasAttribute(n)&&null===a?s():e.hasAttribute(n)?(l(),s()):l()}r.forEach(((t,e)=>{Tt(e,t)})),i.forEach(((t,e)=>{gt.forEach((n=>n(e,t)))}));for(let t of n)e.has(t)||mt.forEach((e=>e(t)));e.forEach((t=>{t._x_ignoreSelf=!0,t._x_ignore=!0}));for(let t of e)n.has(t)||t.isConnected&&(delete t._x_ignoreSelf,delete t._x_ignore,vt.forEach((e=>e(t))),t._x_ignore=!0,t._x_ignoreSelf=!0);e.forEach((t=>{delete t._x_ignoreSelf,delete t._x_ignore})),e=null,n=null,i=null,r=null}function kt(t){return Pt(Ot(t))}function It(t,e,n){return t._x_dataStack=[e,...Ot(n||t)],()=>{t._x_dataStack=t._x_dataStack.filter((t=>t!==e))}}function Ot(t){return t._x_dataStack?t._x_dataStack:"function"==typeof ShadowRoot&&t instanceof ShadowRoot?Ot(t.host):t.parentNode?Ot(t.parentNode):[]}function Pt(t){return new Proxy({objects:t},Mt)}var Mt={ownKeys:({objects:t})=>Array.from(new Set(t.flatMap((t=>Object.keys(t))))),has:({objects:t},e)=>e!=Symbol.unscopables&&t.some((t=>Object.prototype.hasOwnProperty.call(t,e)||Reflect.has(t,e))),get:({objects:t},e,n)=>"toJSON"==e?Nt:Reflect.get(t.find((t=>Reflect.has(t,e)))||{},e,n),set({objects:t},e,n,i){const r=t.find((t=>Object.prototype.hasOwnProperty.call(t,e)))||t[t.length-1],o=Object.getOwnPropertyDescriptor(r,e);return o?.set&&o?.get?o.set.call(i,n)||!0:Reflect.set(r,e,n)}};function Nt(){return Reflect.ownKeys(this).reduce(((t,e)=>(t[e]=Reflect.get(this,e),t)),{})}function Ft(t){let e=(n,i="")=>{Object.entries(Object.getOwnPropertyDescriptors(n)).forEach((([r,{value:o,enumerable:a}])=>{if(!1===a||void 0===o)return;if("object"==typeof o&&null!==o&&o.__v_skip)return;let s=""===i?r:`${i}.${r}`;var l;"object"==typeof o&&null!==o&&o._x_interceptor?n[r]=o.initialize(t,s,r):"object"!=typeof(l=o)||Array.isArray(l)||null===l||o===n||o instanceof Element||e(o,s)}))};return e(t)}function Bt(t,e=(()=>{})){let n={initialValue:void 0,_x_interceptor:!0,initialize(e,n,i){return t(this.initialValue,(()=>function(t,e){return e.split(".").reduce(((t,e)=>t[e]),t)}(e,n)),(t=>Ut(e,n,t)),n,i)}};return e(n),t=>{if("object"==typeof t&&null!==t&&t._x_interceptor){let e=n.initialize.bind(n);n.initialize=(i,r,o)=>{let a=t.initialize(i,r,o);return n.initialValue=a,e(i,r,o)}}else n.initialValue=t;return n}}function Ut(t,e,n){if("string"==typeof e&&(e=e.split(".")),1!==e.length){if(0===e.length)throw error;return t[e[0]]||(t[e[0]]={}),Ut(t[e[0]],e.slice(1),n)}t[e[0]]=n}var jt={};function Gt(t,e){jt[t]=e}function Vt(t,e){return Object.entries(jt).forEach((([n,i])=>{let r=null;Object.defineProperty(t,`$${n}`,{get:()=>i(e,function(){if(r)return r;{let[t,n]=le(e);return r={interceptor:Bt,...t},yt(e,n),r}}()),enumerable:!1})})),t}function Ht(t,e,n,...i){try{return n(...i)}catch(n){Kt(n,t,e)}}function Kt(t,e,n=void 0){t=Object.assign(t??{message:"No error message given."},{el:e,expression:n}),console.warn(`Alpine Expression Error: ${t.message}\n\n${n?'Expression: "'+n+'"\n\n':""}`,e),setTimeout((()=>{throw t}),0)}var Wt=!0;function qt(t){let e=Wt;Wt=!1;let n=t();return Wt=e,n}function Yt(t,e,n={}){let i;return zt(t,e)((t=>i=t),n),i}function zt(...t){return Xt(...t)}var Xt=Jt;function Jt(t,e){let n={};Vt(n,t);let i=[n,...Ot(t)],r="function"==typeof e?function(t,e){return(n=(()=>{}),{scope:i={},params:r=[]}={})=>{Qt(n,e.apply(Pt([i,...t]),r))}}(i,e):function(t,e,n){let i=function(t,e){if($t[t])return $t[t];let n=Object.getPrototypeOf((async function(){})).constructor,i=/^[\n\s]*if.*\(.*\)/.test(t.trim())||/^(let|const)\s/.test(t.trim())?`(async()=>{ ${t} })()`:t;const r=()=>{try{let e=new n(["__self","scope"],`with (scope) { __self.result = ${i} }; __self.finished = true; return __self.result;`);return Object.defineProperty(e,"name",{value:`[Alpine] ${t}`}),e}catch(n){return Kt(n,e,t),Promise.resolve()}};let o=r();return $t[t]=o,o}(e,n);return(r=(()=>{}),{scope:o={},params:a=[]}={})=>{i.result=void 0,i.finished=!1;let s=Pt([o,...t]);if("function"==typeof i){let t=i(i,s).catch((t=>Kt(t,n,e)));i.finished?(Qt(r,i.result,s,a,n),i.result=void 0):t.then((t=>{Qt(r,t,s,a,n)})).catch((t=>Kt(t,n,e))).finally((()=>i.result=void 0))}}}(i,e,t);return Ht.bind(null,t,e,r)}var $t={};function Qt(t,e,n,i,r){if(Wt&&"function"==typeof e){let o=e.apply(n,i);o instanceof Promise?o.then((e=>Qt(t,e,n,i))).catch((t=>Kt(t,r,e))):t(o)}else"object"==typeof e&&e instanceof Promise?e.then((e=>t(e))):t(e)}var Zt="x-";function te(t=""){return Zt+t}var ee={};function ne(t,e){return ee[t]=e,{before(e){if(!ee[e])return void console.warn(String.raw`Cannot find directive \`${e}\`. \`${t}\` will use the default order of execution`);const n=me.indexOf(e);me.splice(n>=0?n:me.indexOf("DEFAULT"),0,t)}}}function ie(t,e,n){if(e=Array.from(e),t._x_virtualDirectives){let n=Object.entries(t._x_virtualDirectives).map((([t,e])=>({name:t,value:e}))),i=re(n);n=n.map((t=>i.find((e=>e.name===t.name))?{name:`x-bind:${t.name}`,value:`"${t.value}"`}:t)),e=e.concat(n)}let i={},r=e.map(ce(((t,e)=>i[t]=e))).filter(fe).map(function(t,e){return({name:n,value:i})=>{let r=n.match(pe()),o=n.match(/:([a-zA-Z0-9\-_:]+)/),a=n.match(/\.[^.\]]+(?=[^\]]*$)/g)||[],s=e||t[n]||n;return{type:r?r[1]:null,value:o?o[1]:null,modifiers:a.map((t=>t.replace(".",""))),expression:i,original:s}}}(i,n)).sort(ve);return r.map((e=>function(t,e){let n=()=>{},i=ee[e.type]||n,[r,o]=le(t);Et(t,e.original,o);let a=()=>{t._x_ignore||t._x_ignoreSelf||(i.inline&&i.inline(t,e,r),i=i.bind(i,t,e,r),oe?ae.get(se).push(i):i())};return a.runCleanups=o,a}(t,e)))}function re(t){return Array.from(t).map(ce()).filter((t=>!fe(t)))}var oe=!1,ae=new Map,se=Symbol();function le(t){let e=[],[n,i]=function(t){let e=()=>{};return[n=>{let i=nt(n);return t._x_effects||(t._x_effects=new Set,t._x_runEffects=()=>{t._x_effects.forEach((t=>t()))}),t._x_effects.add(i),e=()=>{void 0!==i&&(t._x_effects.delete(i),it(i))},i},()=>{e()}]}(t);e.push(i);return[{Alpine:pn,effect:n,cleanup:t=>e.push(t),evaluateLater:zt.bind(zt,t),evaluate:Yt.bind(Yt,t)},()=>e.forEach((t=>t()))]}var ue=(t,e)=>({name:n,value:i})=>(n.startsWith(t)&&(n=n.replace(t,e)),{name:n,value:i});function ce(t=(()=>{})){return({name:e,value:n})=>{let{name:i,value:r}=de.reduce(((t,e)=>e(t)),{name:e,value:n});return i!==e&&t(i,e),{name:i,value:r}}}var de=[];function he(t){de.push(t)}function fe({name:t}){return pe().test(t)}var pe=()=>new RegExp(`^${Zt}([^:^.]+)\\b`);var ge="DEFAULT",me=["ignore","ref","data","id","anchor","bind","init","for","model","modelable","transition","show","if",ge,"teleport"];function ve(t,e){let n=-1===me.indexOf(t.type)?ge:t.type,i=-1===me.indexOf(e.type)?ge:e.type;return me.indexOf(n)-me.indexOf(i)}function ye(t,e,n={}){t.dispatchEvent(new CustomEvent(e,{detail:n,bubbles:!0,composed:!0,cancelable:!0}))}function be(t,e){if("function"==typeof ShadowRoot&&t instanceof ShadowRoot)return void Array.from(t.children).forEach((t=>be(t,e)));let n=!1;if(e(t,(()=>n=!0)),n)return;let i=t.firstElementChild;for(;i;)be(i,e),i=i.nextElementSibling}function Ee(t,...e){console.warn(`Alpine Warning: ${t}`,...e)}var Te=!1;var Ae=[],Se=[];function we(){return Ae.map((t=>t()))}function Le(){return Ae.concat(Se).map((t=>t()))}function xe(t){Ae.push(t)}function De(t){Se.push(t)}function Re(t,e=!1){return _e(t,(t=>{if((e?Le():we()).some((e=>t.matches(e))))return!0}))}function _e(t,e){if(t){if(e(t))return t;if(t._x_teleportBack&&(t=t._x_teleportBack),t.parentElement)return _e(t.parentElement,e)}}var Ce=[];function ke(t,e=be,n=(()=>{})){!function(t){oe=!0;let e=Symbol();se=e,ae.set(e,[]);let n=()=>{for(;ae.get(e).length;)ae.get(e).shift()();ae.delete(e)};t(n),oe=!1,n()}((()=>{e(t,((t,e)=>{n(t,e),Ce.forEach((n=>n(t,e))),ie(t,t.attributes).forEach((t=>t())),t._x_ignore&&e()}))}))}function Ie(t,e=be){e(t,(t=>{Tt(t),function(t){if(t._x_cleanups)for(;t._x_cleanups.length;)t._x_cleanups.pop()()}(t)}))}var Oe=[],Pe=!1;function Me(t=(()=>{})){return queueMicrotask((()=>{Pe||setTimeout((()=>{Ne()}))})),new Promise((e=>{Oe.push((()=>{t(),e()}))}))}function Ne(){for(Pe=!1;Oe.length;)Oe.shift()()}function Fe(t,e){return Array.isArray(e)?Be(t,e.join(" ")):"object"==typeof e&&null!==e?function(t,e){let n=t=>t.split(" ").filter(Boolean),i=Object.entries(e).flatMap((([t,e])=>!!e&&n(t))).filter(Boolean),r=Object.entries(e).flatMap((([t,e])=>!e&&n(t))).filter(Boolean),o=[],a=[];return r.forEach((e=>{t.classList.contains(e)&&(t.classList.remove(e),a.push(e))})),i.forEach((e=>{t.classList.contains(e)||(t.classList.add(e),o.push(e))})),()=>{a.forEach((e=>t.classList.add(e))),o.forEach((e=>t.classList.remove(e)))}}(t,e):"function"==typeof e?Fe(t,e()):Be(t,e)}function Be(t,e){return e=!0===e?e="":e||"",n=e.split(" ").filter((e=>!t.classList.contains(e))).filter(Boolean),t.classList.add(...n),()=>{t.classList.remove(...n)};var n}function Ue(t,e){return"object"==typeof e&&null!==e?function(t,e){let n={};return Object.entries(e).forEach((([e,i])=>{n[e]=t.style[e],e.startsWith("--")||(e=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()),t.style.setProperty(e,i)})),setTimeout((()=>{0===t.style.length&&t.removeAttribute("style")})),()=>{Ue(t,n)}}(t,e):function(t,e){let n=t.getAttribute("style",e);return t.setAttribute("style",e),()=>{t.setAttribute("style",n||"")}}(t,e)}function je(t,e=(()=>{})){let n=!1;return function(){n?e.apply(this,arguments):(n=!0,t.apply(this,arguments))}}function Ge(t,e,n={}){t._x_transition||(t._x_transition={enter:{during:n,start:n,end:n},leave:{during:n,start:n,end:n},in(n=(()=>{}),i=(()=>{})){He(t,e,{during:this.enter.during,start:this.enter.start,end:this.enter.end},n,i)},out(n=(()=>{}),i=(()=>{})){He(t,e,{during:this.leave.during,start:this.leave.start,end:this.leave.end},n,i)}})}function Ve(t){let e=t.parentNode;if(e)return e._x_hidePromise?e:Ve(e)}function He(t,e,{during:n,start:i,end:r}={},o=(()=>{}),a=(()=>{})){if(t._x_transitioning&&t._x_transitioning.cancel(),0===Object.keys(n).length&&0===Object.keys(i).length&&0===Object.keys(r).length)return o(),void a();let s,l,u;!function(t,e){let n,i,r,o=je((()=>{Dt((()=>{n=!0,i||e.before(),r||(e.end(),Ne()),e.after(),t.isConnected&&e.cleanup(),delete t._x_transitioning}))}));t._x_transitioning={beforeCancels:[],beforeCancel(t){this.beforeCancels.push(t)},cancel:je((function(){for(;this.beforeCancels.length;)this.beforeCancels.shift()();o()})),finish:o},Dt((()=>{e.start(),e.during()})),Pe=!0,requestAnimationFrame((()=>{if(n)return;let o=1e3*Number(getComputedStyle(t).transitionDuration.replace(/,.*/,"").replace("s","")),a=1e3*Number(getComputedStyle(t).transitionDelay.replace(/,.*/,"").replace("s",""));0===o&&(o=1e3*Number(getComputedStyle(t).animationDuration.replace("s",""))),Dt((()=>{e.before()})),i=!0,requestAnimationFrame((()=>{n||(Dt((()=>{e.end()})),Ne(),setTimeout(t._x_transitioning.finish,o+a),r=!0)}))}))}(t,{start(){s=e(t,i)},during(){l=e(t,n)},before:o,end(){s(),u=e(t,r)},after:a,cleanup(){l(),u()}})}function Ke(t,e,n){if(-1===t.indexOf(e))return n;const i=t[t.indexOf(e)+1];if(!i)return n;if("scale"===e&&isNaN(i))return n;if("duration"===e||"delay"===e){let t=i.match(/([0-9]+)ms/);if(t)return t[1]}return"origin"===e&&["top","right","left","center","bottom"].includes(t[t.indexOf(e)+2])?[i,t[t.indexOf(e)+2]].join(" "):i}ne("transition",((t,{value:e,modifiers:n,expression:i},{evaluate:r})=>{"function"==typeof i&&(i=r(i)),!1!==i&&(i&&"boolean"!=typeof i?function(t,e,n){Ge(t,Fe,"");let i={enter:e=>{t._x_transition.enter.during=e},"enter-start":e=>{t._x_transition.enter.start=e},"enter-end":e=>{t._x_transition.enter.end=e},leave:e=>{t._x_transition.leave.during=e},"leave-start":e=>{t._x_transition.leave.start=e},"leave-end":e=>{t._x_transition.leave.end=e}};i[n](e)}(t,i,e):function(t,e,n){Ge(t,Ue);let i=!e.includes("in")&&!e.includes("out")&&!n,r=i||e.includes("in")||["enter"].includes(n),o=i||e.includes("out")||["leave"].includes(n);e.includes("in")&&!i&&(e=e.filter(((t,n)=>n<e.indexOf("out"))));e.includes("out")&&!i&&(e=e.filter(((t,n)=>n>e.indexOf("out"))));let a=!e.includes("opacity")&&!e.includes("scale"),s=a||e.includes("opacity"),l=a||e.includes("scale"),u=s?0:1,c=l?Ke(e,"scale",95)/100:1,d=Ke(e,"delay",0)/1e3,h=Ke(e,"origin","center"),f="opacity, transform",p=Ke(e,"duration",150)/1e3,g=Ke(e,"duration",75)/1e3,m="cubic-bezier(0.4, 0.0, 0.2, 1)";r&&(t._x_transition.enter.during={transformOrigin:h,transitionDelay:`${d}s`,transitionProperty:f,transitionDuration:`${p}s`,transitionTimingFunction:m},t._x_transition.enter.start={opacity:u,transform:`scale(${c})`},t._x_transition.enter.end={opacity:1,transform:"scale(1)"});o&&(t._x_transition.leave.during={transformOrigin:h,transitionDelay:`${d}s`,transitionProperty:f,transitionDuration:`${g}s`,transitionTimingFunction:m},t._x_transition.leave.start={opacity:1,transform:"scale(1)"},t._x_transition.leave.end={opacity:u,transform:`scale(${c})`})}(t,n,e))})),window.Element.prototype._x_toggleAndCascadeWithTransitions=function(t,e,n,i){const r="visible"===document.visibilityState?requestAnimationFrame:setTimeout;let o=()=>r(n);e?t._x_transition&&(t._x_transition.enter||t._x_transition.leave)?t._x_transition.enter&&(Object.entries(t._x_transition.enter.during).length||Object.entries(t._x_transition.enter.start).length||Object.entries(t._x_transition.enter.end).length)?t._x_transition.in(n):o():t._x_transition?t._x_transition.in(n):o():(t._x_hidePromise=t._x_transition?new Promise(((e,n)=>{t._x_transition.out((()=>{}),(()=>e(i))),t._x_transitioning&&t._x_transitioning.beforeCancel((()=>n({isFromCancelledTransition:!0})))})):Promise.resolve(i),queueMicrotask((()=>{let e=Ve(t);e?(e._x_hideChildren||(e._x_hideChildren=[]),e._x_hideChildren.push(t)):r((()=>{let e=t=>{let n=Promise.all([t._x_hidePromise,...(t._x_hideChildren||[]).map(e)]).then((([t])=>t?.()));return delete t._x_hidePromise,delete t._x_hideChildren,n};e(t).catch((t=>{if(!t.isFromCancelledTransition)throw t}))}))})))};var We=!1;function qe(t,e=(()=>{})){return(...n)=>We?e(...n):t(...n)}var Ye=[];function ze(t){Ye.push(t)}var Xe=!1;function Je(t){let e=nt;ft(((t,n)=>{let i=e(t);return it(i),()=>{}})),t(),ft(e)}function $e(t,e,n,i=[]){switch(t._x_bindings||(t._x_bindings=et({})),t._x_bindings[e]=n,e=i.includes("camel")?e.toLowerCase().replace(/-(\w)/g,((t,e)=>e.toUpperCase())):e){case"value":!function(t,e){if("radio"===t.type)void 0===t.attributes.value&&(t.value=e),window.fromModel&&(t.checked="boolean"==typeof e?tn(t.value)===e:Ze(t.value,e));else if("checkbox"===t.type)Number.isInteger(e)?t.value=e:Array.isArray(e)||"boolean"==typeof e||[null,void 0].includes(e)?Array.isArray(e)?t.checked=e.some((e=>Ze(e,t.value))):t.checked=!!e:t.value=String(e);else if("SELECT"===t.tagName)!function(t,e){const n=[].concat(e).map((t=>t+""));Array.from(t.options).forEach((t=>{t.selected=n.includes(t.value)}))}(t,e);else{if(t.value===e)return;t.value=void 0===e?"":e}}(t,n);break;case"style":!function(t,e){t._x_undoAddedStyles&&t._x_undoAddedStyles();t._x_undoAddedStyles=Ue(t,e)}(t,n);break;case"class":!function(t,e){t._x_undoAddedClasses&&t._x_undoAddedClasses();t._x_undoAddedClasses=Fe(t,e)}(t,n);break;case"selected":case"checked":!function(t,e,n){Qe(t,e,n),function(t,e,n){t[e]!==n&&(t[e]=n)}(t,e,n)}(t,e,n);break;default:Qe(t,e,n)}}function Qe(t,e,n){[null,void 0,!1].includes(n)&&function(t){return!["aria-pressed","aria-checked","aria-expanded","aria-selected"].includes(t)}(e)?t.removeAttribute(e):(en(e)&&(n=e),function(t,e,n){t.getAttribute(e)!=n&&t.setAttribute(e,n)}(t,e,n))}function Ze(t,e){return t==e}function tn(t){return!![1,"1","true","on","yes",!0].includes(t)||![0,"0","false","off","no",!1].includes(t)&&(t?Boolean(t):null)}function en(t){return["disabled","checked","required","readonly","open","selected","autofocus","itemscope","multiple","novalidate","allowfullscreen","allowpaymentrequest","formnovalidate","autoplay","controls","loop","muted","playsinline","default","ismap","reversed","async","defer","nomodule"].includes(t)}function nn(t,e,n){let i=t.getAttribute(e);return null===i?"function"==typeof n?n():n:""===i||(en(e)?!![e,"true"].includes(i):i)}function rn(t,e){var n;return function(){var i=this,r=arguments;clearTimeout(n),n=setTimeout((function(){n=null,t.apply(i,r)}),e)}}function on(t,e){let n;return function(){let i=this,r=arguments;n||(t.apply(i,r),n=!0,setTimeout((()=>n=!1),e))}}function an({get:t,set:e},{get:n,set:i}){let r,o,a=!0,s=nt((()=>{let s=t(),l=n();if(a)i(sn(s)),a=!1;else{let t=JSON.stringify(s),n=JSON.stringify(l);t!==r?i(sn(s)):t!==n&&e(sn(l))}r=JSON.stringify(t()),o=JSON.stringify(n())}));return()=>{it(s)}}function sn(t){return"object"==typeof t?JSON.parse(JSON.stringify(t)):t}var ln={},un=!1;var cn={};function dn(t,e,n){let i=[];for(;i.length;)i.pop()();let r=Object.entries(e).map((([t,e])=>({name:t,value:e}))),o=re(r);return r=r.map((t=>o.find((e=>e.name===t.name))?{name:`x-bind:${t.name}`,value:`"${t.value}"`}:t)),ie(t,r,n).map((t=>{i.push(t.runCleanups),t()})),()=>{for(;i.length;)i.pop()()}}var hn={};var fn={get reactive(){return et},get release(){return it},get effect(){return nt},get raw(){return rt},version:"3.14.1",flushAndStopDeferringMutations:function(){Rt=!1,Ct(_t),_t=[]},dontAutoEvaluateFunctions:qt,disableEffectScheduling:function(t){ht=!1,t(),ht=!0},startObservingMutations:wt,stopObservingMutations:Lt,setReactivityEngine:function(t){et=t.reactive,it=t.release,nt=e=>t.effect(e,{scheduler:t=>{ht?ut(t):t()}}),rt=t.raw},onAttributeRemoved:Et,onAttributesAdded:bt,closestDataStack:Ot,skipDuringClone:qe,onlyDuringClone:function(t){return(...e)=>We&&t(...e)},addRootSelector:xe,addInitSelector:De,interceptClone:ze,addScopeToNode:It,deferMutations:function(){Rt=!0},mapAttributes:he,evaluateLater:zt,interceptInit:function(t){Ce.push(t)},setEvaluator:function(t){Xt=t},mergeProxies:Pt,extractProp:function(t,e,n,i=!0){if(t._x_bindings&&void 0!==t._x_bindings[e])return t._x_bindings[e];if(t._x_inlineBindings&&void 0!==t._x_inlineBindings[e]){let n=t._x_inlineBindings[e];return n.extract=i,qt((()=>Yt(t,n.expression)))}return nn(t,e,n)},findClosest:_e,onElRemoved:yt,closestRoot:Re,destroyTree:Ie,interceptor:Bt,transition:He,setStyles:Ue,mutateDom:Dt,directive:ne,entangle:an,throttle:on,debounce:rn,evaluate:Yt,initTree:ke,nextTick:Me,prefixed:te,prefix:function(t){Zt=t},plugin:function(t){(Array.isArray(t)?t:[t]).forEach((t=>t(pn)))},magic:Gt,store:function(t,e){if(un||(ln=et(ln),un=!0),void 0===e)return ln[t];ln[t]=e,"object"==typeof e&&null!==e&&e.hasOwnProperty("init")&&"function"==typeof e.init&&ln[t].init(),Ft(ln[t])},start:function(){var t;Te&&Ee("Alpine has already been initialized on this page. Calling Alpine.start() more than once can cause problems."),Te=!0,document.body||Ee("Unable to initialize. Trying to load Alpine before `<body>` is available. Did you forget to add `defer` in Alpine's `<script>` tag?"),ye(document,"alpine:init"),ye(document,"alpine:initializing"),wt(),t=t=>ke(t,be),vt.push(t),yt((t=>Ie(t))),bt(((t,e)=>{ie(t,e).forEach((t=>t()))})),Array.from(document.querySelectorAll(Le().join(","))).filter((t=>!Re(t.parentElement,!0))).forEach((t=>{ke(t)})),ye(document,"alpine:initialized"),setTimeout((()=>{[["ui","dialog",["[x-dialog], [x-popover]"]],["anchor","anchor",["[x-anchor]"]],["sort","sort",["[x-sort]"]]].forEach((([t,e,n])=>{var i;i=e,Object.keys(ee).includes(i)||n.some((e=>{if(document.querySelector(e))return Ee(`found "${e}", but missing ${t} plugin`),!0}))}))}))},clone:function(t,e){e._x_dataStack||(e._x_dataStack=t._x_dataStack),We=!0,Xe=!0,Je((()=>{!function(t){let e=!1;ke(t,((t,n)=>{be(t,((t,i)=>{if(e&&function(t){return we().some((e=>t.matches(e)))}(t))return i();e=!0,n(t,i)}))}))}(e)})),We=!1,Xe=!1},cloneNode:function(t,e){Ye.forEach((n=>n(t,e))),We=!0,Je((()=>{ke(e,((t,e)=>{e(t,(()=>{}))}))})),We=!1},bound:function(t,e,n){return t._x_bindings&&void 0!==t._x_bindings[e]?t._x_bindings[e]:nn(t,e,n)},$data:kt,watch:pt,walk:be,data:function(t,e){hn[t]=e},bind:function(t,e){let n="function"!=typeof e?()=>e:e;return t instanceof Element?dn(t,n()):(cn[t]=n,()=>{})}},pn=fn;function gn(t,e){const n=Object.create(null),i=t.split(",");for(let t=0;t<i.length;t++)n[i[t]]=!0;return e?t=>!!n[t.toLowerCase()]:t=>!!n[t]}var mn,vn=Object.freeze({}),yn=(Object.freeze([]),Object.prototype.hasOwnProperty),bn=(t,e)=>yn.call(t,e),En=Array.isArray,Tn=t=>"[object Map]"===Ln(t),An=t=>"symbol"==typeof t,Sn=t=>null!==t&&"object"==typeof t,wn=Object.prototype.toString,Ln=t=>wn.call(t),xn=t=>Ln(t).slice(8,-1),Dn=t=>"string"==typeof t&&"NaN"!==t&&"-"!==t[0]&&""+parseInt(t,10)===t,Rn=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},_n=/-(\w)/g,Cn=(Rn((t=>t.replace(_n,((t,e)=>e?e.toUpperCase():"")))),/\B([A-Z])/g),kn=(Rn((t=>t.replace(Cn,"-$1").toLowerCase())),Rn((t=>t.charAt(0).toUpperCase()+t.slice(1)))),In=(Rn((t=>t?`on${kn(t)}`:"")),(t,e)=>t!==e&&(t==t||e==e)),On=new WeakMap,Pn=[],Mn=Symbol("iterate"),Nn=Symbol("Map key iterate");var Fn=0;function Bn(t){const{deps:e}=t;if(e.length){for(let n=0;n<e.length;n++)e[n].delete(t);e.length=0}}var Un=!0,jn=[];function Gn(){const t=jn.pop();Un=void 0===t||t}function Vn(t,e,n){if(!Un||void 0===mn)return;let i=On.get(t);i||On.set(t,i=new Map);let r=i.get(n);r||i.set(n,r=new Set),r.has(mn)||(r.add(mn),mn.deps.push(r),mn.options.onTrack&&mn.options.onTrack({effect:mn,target:t,type:e,key:n}))}function Hn(t,e,n,i,r,o){const a=On.get(t);if(!a)return;const s=new Set,l=t=>{t&&t.forEach((t=>{(t!==mn||t.allowRecurse)&&s.add(t)}))};if("clear"===e)a.forEach(l);else if("length"===n&&En(t))a.forEach(((t,e)=>{("length"===e||e>=i)&&l(t)}));else switch(void 0!==n&&l(a.get(n)),e){case"add":En(t)?Dn(n)&&l(a.get("length")):(l(a.get(Mn)),Tn(t)&&l(a.get(Nn)));break;case"delete":En(t)||(l(a.get(Mn)),Tn(t)&&l(a.get(Nn)));break;case"set":Tn(t)&&l(a.get(Mn))}s.forEach((a=>{a.options.onTrigger&&a.options.onTrigger({effect:a,target:t,key:n,type:e,newValue:i,oldValue:r,oldTarget:o}),a.options.scheduler?a.options.scheduler(a):a()}))}var Kn=gn("__proto__,__v_isRef,__isVue"),Wn=new Set(Object.getOwnPropertyNames(Symbol).map((t=>Symbol[t])).filter(An)),qn=Jn(),Yn=Jn(!0),zn=Xn();function Xn(){const t={};return["includes","indexOf","lastIndexOf"].forEach((e=>{t[e]=function(...t){const n=Ci(this);for(let t=0,e=this.length;t<e;t++)Vn(n,"get",t+"");const i=n[e](...t);return-1===i||!1===i?n[e](...t.map(Ci)):i}})),["push","pop","shift","unshift","splice"].forEach((e=>{t[e]=function(...t){jn.push(Un),Un=!1;const n=Ci(this)[e].apply(this,t);return Gn(),n}})),t}function Jn(t=!1,e=!1){return function(n,i,r){if("__v_isReactive"===i)return!t;if("__v_isReadonly"===i)return t;if("__v_raw"===i&&r===(t?e?xi:Li:e?wi:Si).get(n))return n;const o=En(n);if(!t&&o&&bn(zn,i))return Reflect.get(zn,i,r);const a=Reflect.get(n,i,r);if(An(i)?Wn.has(i):Kn(i))return a;if(t||Vn(n,"get",i),e)return a;if(ki(a)){return!o||!Dn(i)?a.value:a}return Sn(a)?t?Ri(a):Di(a):a}}function $n(t=!1){return function(e,n,i,r){let o=e[n];if(!t&&(i=Ci(i),o=Ci(o),!En(e)&&ki(o)&&!ki(i)))return o.value=i,!0;const a=En(e)&&Dn(n)?Number(n)<e.length:bn(e,n),s=Reflect.set(e,n,i,r);return e===Ci(r)&&(a?In(i,o)&&Hn(e,"set",n,i,o):Hn(e,"add",n,i)),s}}var Qn={get:qn,set:$n(),deleteProperty:function(t,e){const n=bn(t,e),i=t[e],r=Reflect.deleteProperty(t,e);return r&&n&&Hn(t,"delete",e,void 0,i),r},has:function(t,e){const n=Reflect.has(t,e);return An(e)&&Wn.has(e)||Vn(t,"has",e),n},ownKeys:function(t){return Vn(t,"iterate",En(t)?"length":Mn),Reflect.ownKeys(t)}},Zn={get:Yn,set:(t,e)=>(console.warn(`Set operation on key "${String(e)}" failed: target is readonly.`,t),!0),deleteProperty:(t,e)=>(console.warn(`Delete operation on key "${String(e)}" failed: target is readonly.`,t),!0)},ti=t=>Sn(t)?Di(t):t,ei=t=>Sn(t)?Ri(t):t,ni=t=>t,ii=t=>Reflect.getPrototypeOf(t);function ri(t,e,n=!1,i=!1){const r=Ci(t=t.__v_raw),o=Ci(e);e!==o&&!n&&Vn(r,"get",e),!n&&Vn(r,"get",o);const{has:a}=ii(r),s=i?ni:n?ei:ti;return a.call(r,e)?s(t.get(e)):a.call(r,o)?s(t.get(o)):void(t!==r&&t.get(e))}function oi(t,e=!1){const n=this.__v_raw,i=Ci(n),r=Ci(t);return t!==r&&!e&&Vn(i,"has",t),!e&&Vn(i,"has",r),t===r?n.has(t):n.has(t)||n.has(r)}function ai(t,e=!1){return t=t.__v_raw,!e&&Vn(Ci(t),"iterate",Mn),Reflect.get(t,"size",t)}function si(t){t=Ci(t);const e=Ci(this);return ii(e).has.call(e,t)||(e.add(t),Hn(e,"add",t,t)),this}function li(t,e){e=Ci(e);const n=Ci(this),{has:i,get:r}=ii(n);let o=i.call(n,t);o?Ai(n,i,t):(t=Ci(t),o=i.call(n,t));const a=r.call(n,t);return n.set(t,e),o?In(e,a)&&Hn(n,"set",t,e,a):Hn(n,"add",t,e),this}function ui(t){const e=Ci(this),{has:n,get:i}=ii(e);let r=n.call(e,t);r?Ai(e,n,t):(t=Ci(t),r=n.call(e,t));const o=i?i.call(e,t):void 0,a=e.delete(t);return r&&Hn(e,"delete",t,void 0,o),a}function ci(){const t=Ci(this),e=0!==t.size,n=Tn(t)?new Map(t):new Set(t),i=t.clear();return e&&Hn(t,"clear",void 0,void 0,n),i}function di(t,e){return function(n,i){const r=this,o=r.__v_raw,a=Ci(o),s=e?ni:t?ei:ti;return!t&&Vn(a,"iterate",Mn),o.forEach(((t,e)=>n.call(i,s(t),s(e),r)))}}function hi(t,e,n){return function(...i){const r=this.__v_raw,o=Ci(r),a=Tn(o),s="entries"===t||t===Symbol.iterator&&a,l="keys"===t&&a,u=r[t](...i),c=n?ni:e?ei:ti;return!e&&Vn(o,"iterate",l?Nn:Mn),{next(){const{value:t,done:e}=u.next();return e?{value:t,done:e}:{value:s?[c(t[0]),c(t[1])]:c(t),done:e}},[Symbol.iterator](){return this}}}}function fi(t){return function(...e){{const n=e[0]?`on key "${e[0]}" `:"";console.warn(`${kn(t)} operation ${n}failed: target is readonly.`,Ci(this))}return"delete"!==t&&this}}function pi(){const t={get(t){return ri(this,t)},get size(){return ai(this)},has:oi,add:si,set:li,delete:ui,clear:ci,forEach:di(!1,!1)},e={get(t){return ri(this,t,!1,!0)},get size(){return ai(this)},has:oi,add:si,set:li,delete:ui,clear:ci,forEach:di(!1,!0)},n={get(t){return ri(this,t,!0)},get size(){return ai(this,!0)},has(t){return oi.call(this,t,!0)},add:fi("add"),set:fi("set"),delete:fi("delete"),clear:fi("clear"),forEach:di(!0,!1)},i={get(t){return ri(this,t,!0,!0)},get size(){return ai(this,!0)},has(t){return oi.call(this,t,!0)},add:fi("add"),set:fi("set"),delete:fi("delete"),clear:fi("clear"),forEach:di(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach((r=>{t[r]=hi(r,!1,!1),n[r]=hi(r,!0,!1),e[r]=hi(r,!1,!0),i[r]=hi(r,!0,!0)})),[t,n,e,i]}var[gi,mi,vi,yi]=pi();function bi(t,e){const n=e?t?yi:vi:t?mi:gi;return(e,i,r)=>"__v_isReactive"===i?!t:"__v_isReadonly"===i?t:"__v_raw"===i?e:Reflect.get(bn(n,i)&&i in e?n:e,i,r)}var Ei={get:bi(!1,!1)},Ti={get:bi(!0,!1)};function Ai(t,e,n){const i=Ci(n);if(i!==n&&e.call(t,i)){const e=xn(t);console.warn(`Reactive ${e} contains both the raw and reactive versions of the same object${"Map"===e?" as keys":""}, which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible.`)}}var Si=new WeakMap,wi=new WeakMap,Li=new WeakMap,xi=new WeakMap;function Di(t){return t&&t.__v_isReadonly?t:_i(t,!1,Qn,Ei,Si)}function Ri(t){return _i(t,!0,Zn,Ti,Li)}function _i(t,e,n,i,r){if(!Sn(t))return console.warn(`value cannot be made reactive: ${String(t)}`),t;if(t.__v_raw&&(!e||!t.__v_isReactive))return t;const o=r.get(t);if(o)return o;const a=(s=t).__v_skip||!Object.isExtensible(s)?0:function(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}(xn(s));var s;if(0===a)return t;const l=new Proxy(t,2===a?i:n);return r.set(t,l),l}function Ci(t){return t&&Ci(t.__v_raw)||t}function ki(t){return Boolean(t&&!0===t.__v_isRef)}Gt("nextTick",(()=>Me)),Gt("dispatch",(t=>ye.bind(ye,t))),Gt("watch",((t,{evaluateLater:e,cleanup:n})=>(t,i)=>{let r=e(t),o=pt((()=>{let t;return r((e=>t=e)),t}),i);n(o)})),Gt("store",(function(){return ln})),Gt("data",(t=>kt(t))),Gt("root",(t=>Re(t))),Gt("refs",(t=>(t._x_refs_proxy||(t._x_refs_proxy=Pt(function(t){let e=[];return _e(t,(t=>{t._x_refs&&e.push(t._x_refs)})),e}(t))),t._x_refs_proxy)));var Ii={};function Oi(t){return Ii[t]||(Ii[t]=0),++Ii[t]}function Pi(t,e,n){Gt(e,(i=>Ee(`You can't use [$${e}] without first installing the "${t}" plugin here: https://alpinejs.dev/plugins/${n}`,i)))}Gt("id",((t,{cleanup:e})=>(n,i=null)=>function(t,e,n,i){t._x_id||(t._x_id={});if(t._x_id[e])return t._x_id[e];let r=i();return t._x_id[e]=r,n((()=>{delete t._x_id[e]})),r}(t,`${n}${i?`-${i}`:""}`,e,(()=>{let e=function(t,e){return _e(t,(t=>{if(t._x_ids&&t._x_ids[e])return!0}))}(t,n),r=e?e._x_ids[n]:Oi(n);return i?`${n}-${r}-${i}`:`${n}-${r}`})))),ze(((t,e)=>{t._x_id&&(e._x_id=t._x_id)})),Gt("el",(t=>t)),Pi("Focus","focus","focus"),Pi("Persist","persist","persist"),ne("modelable",((t,{expression:e},{effect:n,evaluateLater:i,cleanup:r})=>{let o=i(e),a=()=>{let t;return o((e=>t=e)),t},s=i(`${e} = __placeholder`),l=t=>s((()=>{}),{scope:{__placeholder:t}}),u=a();l(u),queueMicrotask((()=>{if(!t._x_model)return;t._x_removeModelListeners.default();let e=t._x_model.get,n=t._x_model.set,i=an({get:()=>e(),set(t){n(t)}},{get:()=>a(),set(t){l(t)}});r(i)}))})),ne("teleport",((t,{modifiers:e,expression:n},{cleanup:i})=>{"template"!==t.tagName.toLowerCase()&&Ee("x-teleport can only be used on a <template> tag",t);let r=Ni(n),o=t.content.cloneNode(!0).firstElementChild;t._x_teleport=o,o._x_teleportBack=t,t.setAttribute("data-teleport-template",!0),o.setAttribute("data-teleport-target",!0),t._x_forwardEvents&&t._x_forwardEvents.forEach((e=>{o.addEventListener(e,(e=>{e.stopPropagation(),t.dispatchEvent(new e.constructor(e.type,e))}))})),It(o,{},t);let a=(t,e,n)=>{n.includes("prepend")?e.parentNode.insertBefore(t,e):n.includes("append")?e.parentNode.insertBefore(t,e.nextSibling):e.appendChild(t)};Dt((()=>{a(o,r,e),qe((()=>{ke(o),o._x_ignore=!0}))()})),t._x_teleportPutBack=()=>{let i=Ni(n);Dt((()=>{a(t._x_teleport,i,e)}))},i((()=>o.remove()))}));var Mi=document.createElement("div");function Ni(t){let e=qe((()=>document.querySelector(t)),(()=>Mi))();return e||Ee(`Cannot find x-teleport element for selector: "${t}"`),e}var Fi=()=>{};function Bi(t,e,n,i){let r=t,o=t=>i(t),a={},s=(t,e)=>n=>e(t,n);if(n.includes("dot")&&(e=e.replace(/-/g,".")),n.includes("camel")&&(e=function(t){return t.toLowerCase().replace(/-(\w)/g,((t,e)=>e.toUpperCase()))}(e)),n.includes("passive")&&(a.passive=!0),n.includes("capture")&&(a.capture=!0),n.includes("window")&&(r=window),n.includes("document")&&(r=document),n.includes("debounce")){let t=n[n.indexOf("debounce")+1]||"invalid-wait",e=Ui(t.split("ms")[0])?Number(t.split("ms")[0]):250;o=rn(o,e)}if(n.includes("throttle")){let t=n[n.indexOf("throttle")+1]||"invalid-wait",e=Ui(t.split("ms")[0])?Number(t.split("ms")[0]):250;o=on(o,e)}return n.includes("prevent")&&(o=s(o,((t,e)=>{e.preventDefault(),t(e)}))),n.includes("stop")&&(o=s(o,((t,e)=>{e.stopPropagation(),t(e)}))),n.includes("once")&&(o=s(o,((t,n)=>{t(n),r.removeEventListener(e,o,a)}))),(n.includes("away")||n.includes("outside"))&&(r=document,o=s(o,((e,n)=>{t.contains(n.target)||!1!==n.target.isConnected&&(t.offsetWidth<1&&t.offsetHeight<1||!1!==t._x_isShown&&e(n))}))),n.includes("self")&&(o=s(o,((e,n)=>{n.target===t&&e(n)}))),(function(t){return["keydown","keyup"].includes(t)}(e)||ji(e))&&(o=s(o,((t,e)=>{(function(t,e){let n=e.filter((t=>!["window","document","prevent","stop","once","capture","self","away","outside","passive"].includes(t)));if(n.includes("debounce")){let t=n.indexOf("debounce");n.splice(t,Ui((n[t+1]||"invalid-wait").split("ms")[0])?2:1)}if(n.includes("throttle")){let t=n.indexOf("throttle");n.splice(t,Ui((n[t+1]||"invalid-wait").split("ms")[0])?2:1)}if(0===n.length)return!1;if(1===n.length&&Gi(t.key).includes(n[0]))return!1;const i=["ctrl","shift","alt","meta","cmd","super"].filter((t=>n.includes(t)));if(n=n.filter((t=>!i.includes(t))),i.length>0){if(i.filter((e=>("cmd"!==e&&"super"!==e||(e="meta"),t[`${e}Key`]))).length===i.length){if(ji(t.type))return!1;if(Gi(t.key).includes(n[0]))return!1}}return!0})(e,n)||t(e)}))),r.addEventListener(e,o,a),()=>{r.removeEventListener(e,o,a)}}function Ui(t){return!Array.isArray(t)&&!isNaN(t)}function ji(t){return["contextmenu","click","mouse"].some((e=>t.includes(e)))}function Gi(t){if(!t)return[];var e;t=[" ","_"].includes(e=t)?e:e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[_\s]/,"-").toLowerCase();let n={ctrl:"control",slash:"/",space:" ",spacebar:" ",cmd:"meta",esc:"escape",up:"arrow-up",down:"arrow-down",left:"arrow-left",right:"arrow-right",period:".",comma:",",equal:"=",minus:"-",underscore:"_"};return n[t]=t,Object.keys(n).map((e=>{if(n[e]===t)return e})).filter((t=>t))}function Vi(t,e,n,i){return Dt((()=>{if(n instanceof CustomEvent&&void 0!==n.detail)return null!==n.detail&&void 0!==n.detail?n.detail:n.target.value;if("checkbox"===t.type){if(Array.isArray(i)){let t=null;return t=e.includes("number")?Hi(n.target.value):e.includes("boolean")?tn(n.target.value):n.target.value,n.target.checked?i.includes(t)?i:i.concat([t]):i.filter((e=>!(e==t)))}return n.target.checked}if("select"===t.tagName.toLowerCase()&&t.multiple)return e.includes("number")?Array.from(n.target.selectedOptions).map((t=>Hi(t.value||t.text))):e.includes("boolean")?Array.from(n.target.selectedOptions).map((t=>tn(t.value||t.text))):Array.from(n.target.selectedOptions).map((t=>t.value||t.text));{let r;return r="radio"===t.type?n.target.checked?n.target.value:i:n.target.value,e.includes("number")?Hi(r):e.includes("boolean")?tn(r):e.includes("trim")?r.trim():r}}))}function Hi(t){let e=t?parseFloat(t):null;return n=e,Array.isArray(n)||isNaN(n)?t:e;var n}function Ki(t){return null!==t&&"object"==typeof t&&"function"==typeof t.get&&"function"==typeof t.set}Fi.inline=(t,{modifiers:e},{cleanup:n})=>{e.includes("self")?t._x_ignoreSelf=!0:t._x_ignore=!0,n((()=>{e.includes("self")?delete t._x_ignoreSelf:delete t._x_ignore}))},ne("ignore",Fi),ne("effect",qe(((t,{expression:e},{effect:n})=>{n(zt(t,e))}))),ne("model",((t,{modifiers:e,expression:n},{effect:i,cleanup:r})=>{let o=t;e.includes("parent")&&(o=t.parentNode);let a,s=zt(o,n);a="string"==typeof n?zt(o,`${n} = __placeholder`):"function"==typeof n&&"string"==typeof n()?zt(o,`${n()} = __placeholder`):()=>{};let l=()=>{let t;return s((e=>t=e)),Ki(t)?t.get():t},u=t=>{let e;s((t=>e=t)),Ki(e)?e.set(t):a((()=>{}),{scope:{__placeholder:t}})};"string"==typeof n&&"radio"===t.type&&Dt((()=>{t.hasAttribute("name")||t.setAttribute("name",n)}));var c="select"===t.tagName.toLowerCase()||["checkbox","radio"].includes(t.type)||e.includes("lazy")?"change":"input";let d=We?()=>{}:Bi(t,c,e,(n=>{u(Vi(t,e,n,l()))}));if(e.includes("fill")&&([void 0,null,""].includes(l())||"checkbox"===t.type&&Array.isArray(l())||"select"===t.tagName.toLowerCase()&&t.multiple)&&u(Vi(t,e,{target:t},l())),t._x_removeModelListeners||(t._x_removeModelListeners={}),t._x_removeModelListeners.default=d,r((()=>t._x_removeModelListeners.default())),t.form){let n=Bi(t.form,"reset",[],(n=>{Me((()=>t._x_model&&t._x_model.set(Vi(t,e,{target:t},l()))))}));r((()=>n()))}t._x_model={get:()=>l(),set(t){u(t)}},t._x_forceModelUpdate=e=>{void 0===e&&"string"==typeof n&&n.match(/\./)&&(e=""),window.fromModel=!0,Dt((()=>$e(t,"value",e))),delete window.fromModel},i((()=>{let n=l();e.includes("unintrusive")&&document.activeElement.isSameNode(t)||t._x_forceModelUpdate(n)}))})),ne("cloak",(t=>queueMicrotask((()=>Dt((()=>t.removeAttribute(te("cloak")))))))),De((()=>`[${te("init")}]`)),ne("init",qe(((t,{expression:e},{evaluate:n})=>"string"==typeof e?!!e.trim()&&n(e,{},!1):n(e,{},!1)))),ne("text",((t,{expression:e},{effect:n,evaluateLater:i})=>{let r=i(e);n((()=>{r((e=>{Dt((()=>{t.textContent=e}))}))}))})),ne("html",((t,{expression:e},{effect:n,evaluateLater:i})=>{let r=i(e);n((()=>{r((e=>{Dt((()=>{t.innerHTML=e,t._x_ignoreSelf=!0,ke(t),delete t._x_ignoreSelf}))}))}))})),he(ue(":",te("bind:")));var Wi=(t,{value:e,modifiers:n,expression:i,original:r},{effect:o,cleanup:a})=>{if(!e){let e={};return s=e,Object.entries(cn).forEach((([t,e])=>{Object.defineProperty(s,t,{get:()=>(...t)=>e(...t)})})),void zt(t,i)((e=>{dn(t,e,r)}),{scope:e})}var s;if("key"===e)return function(t,e){t._x_keyExpression=e}(t,i);if(t._x_inlineBindings&&t._x_inlineBindings[e]&&t._x_inlineBindings[e].extract)return;let l=zt(t,i);o((()=>l((r=>{void 0===r&&"string"==typeof i&&i.match(/\./)&&(r=""),Dt((()=>$e(t,e,r,n)))})))),a((()=>{t._x_undoAddedClasses&&t._x_undoAddedClasses(),t._x_undoAddedStyles&&t._x_undoAddedStyles()}))};function qi(t,e,n,i){let r={};if(/^\[.*\]$/.test(t.item)&&Array.isArray(e)){let n=t.item.replace("[","").replace("]","").split(",").map((t=>t.trim()));n.forEach(((t,n)=>{r[t]=e[n]}))}else if(/^\{.*\}$/.test(t.item)&&!Array.isArray(e)&&"object"==typeof e){let n=t.item.replace("{","").replace("}","").split(",").map((t=>t.trim()));n.forEach((t=>{r[t]=e[t]}))}else r[t.item]=e;return t.index&&(r[t.index]=n),t.collection&&(r[t.collection]=i),r}function Yi(){}function zi(t,e,n){ne(e,(i=>Ee(`You can't use [x-${e}] without first installing the "${t}" plugin here: https://alpinejs.dev/plugins/${n}`,i)))}Wi.inline=(t,{value:e,modifiers:n,expression:i})=>{e&&(t._x_inlineBindings||(t._x_inlineBindings={}),t._x_inlineBindings[e]={expression:i,extract:!1})},ne("bind",Wi),xe((()=>`[${te("data")}]`)),ne("data",((t,{expression:e},{cleanup:n})=>{if(function(t){return!!We&&(!!Xe||t.hasAttribute("data-has-alpine-state"))}(t))return;e=""===e?"{}":e;let i={};Vt(i,t);let r={};var o,a;o=r,a=i,Object.entries(hn).forEach((([t,e])=>{Object.defineProperty(o,t,{get:()=>(...t)=>e.bind(a)(...t),enumerable:!1})}));let s=Yt(t,e,{scope:r});void 0!==s&&!0!==s||(s={}),Vt(s,t);let l=et(s);Ft(l);let u=It(t,l);l.init&&Yt(t,l.init),n((()=>{l.destroy&&Yt(t,l.destroy),u()}))})),ze(((t,e)=>{t._x_dataStack&&(e._x_dataStack=t._x_dataStack,e.setAttribute("data-has-alpine-state",!0))})),ne("show",((t,{modifiers:e,expression:n},{effect:i})=>{let r=zt(t,n);t._x_doHide||(t._x_doHide=()=>{Dt((()=>{t.style.setProperty("display","none",e.includes("important")?"important":void 0)}))}),t._x_doShow||(t._x_doShow=()=>{Dt((()=>{1===t.style.length&&"none"===t.style.display?t.removeAttribute("style"):t.style.removeProperty("display")}))});let o,a=()=>{t._x_doHide(),t._x_isShown=!1},s=()=>{t._x_doShow(),t._x_isShown=!0},l=()=>setTimeout(s),u=je((t=>t?s():a()),(e=>{"function"==typeof t._x_toggleAndCascadeWithTransitions?t._x_toggleAndCascadeWithTransitions(t,e,s,a):e?l():a()})),c=!0;i((()=>r((t=>{(c||t!==o)&&(e.includes("immediate")&&(t?l():a()),u(t),o=t,c=!1)}))))})),ne("for",((t,{expression:e},{effect:n,cleanup:i})=>{let r=function(t){let e=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,n=/^\s*\(|\)\s*$/g,i=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,r=t.match(i);if(!r)return;let o={};o.items=r[2].trim();let a=r[1].replace(n,"").trim(),s=a.match(e);s?(o.item=a.replace(e,"").trim(),o.index=s[1].trim(),s[2]&&(o.collection=s[2].trim())):o.item=a;return o}(e),o=zt(t,r.items),a=zt(t,t._x_keyExpression||"index");t._x_prevKeys=[],t._x_lookup={},n((()=>function(t,e,n,i){let r=t=>"object"==typeof t&&!Array.isArray(t),o=t;n((n=>{var a;a=n,!Array.isArray(a)&&!isNaN(a)&&n>=0&&(n=Array.from(Array(n).keys(),(t=>t+1))),void 0===n&&(n=[]);let s=t._x_lookup,l=t._x_prevKeys,u=[],c=[];if(r(n))n=Object.entries(n).map((([r,o])=>{let a=qi(e,o,r,n);i((e=>{c.includes(e)&&Ee("Duplicate key on x-for",t),c.push(e)}),{scope:{index:r,...a}}),u.push(a)}));else for(let r=0;r<n.length;r++){let o=qi(e,n[r],r,n);i((e=>{c.includes(e)&&Ee("Duplicate key on x-for",t),c.push(e)}),{scope:{index:r,...o}}),u.push(o)}let d=[],h=[],f=[],p=[];for(let t=0;t<l.length;t++){let e=l[t];-1===c.indexOf(e)&&f.push(e)}l=l.filter((t=>!f.includes(t)));let g="template";for(let t=0;t<c.length;t++){let e=c[t],n=l.indexOf(e);if(-1===n)l.splice(t,0,e),d.push([g,t]);else if(n!==t){let e=l.splice(t,1)[0],i=l.splice(n-1,1)[0];l.splice(t,0,i),l.splice(n,0,e),h.push([e,i])}else p.push(e);g=e}for(let t=0;t<f.length;t++){let e=f[t];s[e]._x_effects&&s[e]._x_effects.forEach(ct),s[e].remove(),s[e]=null,delete s[e]}for(let t=0;t<h.length;t++){let[e,n]=h[t],i=s[e],r=s[n],a=document.createElement("div");Dt((()=>{r||Ee('x-for ":key" is undefined or invalid',o,n,s),r.after(a),i.after(r),r._x_currentIfEl&&r.after(r._x_currentIfEl),a.before(i),i._x_currentIfEl&&i.after(i._x_currentIfEl),a.remove()})),r._x_refreshXForScope(u[c.indexOf(n)])}for(let t=0;t<d.length;t++){let[e,n]=d[t],i="template"===e?o:s[e];i._x_currentIfEl&&(i=i._x_currentIfEl);let r=u[n],a=c[n],l=document.importNode(o.content,!0).firstElementChild,h=et(r);It(l,h,o),l._x_refreshXForScope=t=>{Object.entries(t).forEach((([t,e])=>{h[t]=e}))},Dt((()=>{i.after(l),qe((()=>ke(l)))()})),"object"==typeof a&&Ee("x-for key cannot be an object, it must be a string or an integer",o),s[a]=l}for(let t=0;t<p.length;t++)s[p[t]]._x_refreshXForScope(u[c.indexOf(p[t])]);o._x_prevKeys=c}))}(t,r,o,a))),i((()=>{Object.values(t._x_lookup).forEach((t=>t.remove())),delete t._x_prevKeys,delete t._x_lookup}))})),Yi.inline=(t,{expression:e},{cleanup:n})=>{let i=Re(t);i._x_refs||(i._x_refs={}),i._x_refs[e]=t,n((()=>delete i._x_refs[e]))},ne("ref",Yi),ne("if",((t,{expression:e},{effect:n,cleanup:i})=>{"template"!==t.tagName.toLowerCase()&&Ee("x-if can only be used on a <template> tag",t);let r=zt(t,e);n((()=>r((e=>{e?(()=>{if(t._x_currentIfEl)return t._x_currentIfEl;let e=t.content.cloneNode(!0).firstElementChild;It(e,{},t),Dt((()=>{t.after(e),qe((()=>ke(e)))()})),t._x_currentIfEl=e,t._x_undoIf=()=>{be(e,(t=>{t._x_effects&&t._x_effects.forEach(ct)})),e.remove(),delete t._x_currentIfEl}})():t._x_undoIf&&(t._x_undoIf(),delete t._x_undoIf)})))),i((()=>t._x_undoIf&&t._x_undoIf()))})),ne("id",((t,{expression:e},{evaluate:n})=>{n(e).forEach((e=>function(t,e){t._x_ids||(t._x_ids={}),t._x_ids[e]||(t._x_ids[e]=Oi(e))}(t,e)))})),ze(((t,e)=>{t._x_ids&&(e._x_ids=t._x_ids)})),he(ue("@",te("on:"))),ne("on",qe(((t,{value:e,modifiers:n,expression:i},{cleanup:r})=>{let o=i?zt(t,i):()=>{};"template"===t.tagName.toLowerCase()&&(t._x_forwardEvents||(t._x_forwardEvents=[]),t._x_forwardEvents.includes(e)||t._x_forwardEvents.push(e));let a=Bi(t,e,n,(t=>{o((()=>{}),{scope:{$event:t},params:[t]})}));r((()=>a()))}))),zi("Collapse","collapse","collapse"),zi("Intersect","intersect","intersect"),zi("Focus","trap","focus"),zi("Mask","mask","mask"),pn.setEvaluator(Jt),pn.setReactivityEngine({reactive:Di,effect:function(t,e=vn){(function(t){return t&&!0===t._isEffect})(t)&&(t=t.raw);const n=function(t,e){const n=function(){if(!n.active)return t();if(!Pn.includes(n)){Bn(n);try{return jn.push(Un),Un=!0,Pn.push(n),mn=n,t()}finally{Pn.pop(),Gn(),mn=Pn[Pn.length-1]}}};return n.id=Fn++,n.allowRecurse=!!e.allowRecurse,n._isEffect=!0,n.active=!0,n.raw=t,n.deps=[],n.options=e,n}(t,e);return e.lazy||n(),n},release:function(t){t.active&&(Bn(t),t.options.onStop&&t.options.onStop(),t.active=!1)},raw:Ci});var Xi=pn;function Ji(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function $i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ji(Object(n),!0).forEach((function(e){Zi(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ji(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Qi(t){return(Qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Zi(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function tr(){return tr=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},tr.apply(this,arguments)}function er(t,e){if(null==t)return{};var n,i,r=function(t,e){if(null==t)return{};var n,i,r={},o=Object.keys(t);for(i=0;i<o.length;i++)n=o[i],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function nr(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}var ir=nr(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),rr=nr(/Edge/i),or=nr(/firefox/i),ar=nr(/safari/i)&&!nr(/chrome/i)&&!nr(/android/i),sr=nr(/iP(ad|od|hone)/i),lr=nr(/chrome/i)&&nr(/android/i),ur={capture:!1,passive:!1};function cr(t,e,n){t.addEventListener(e,n,!ir&&ur)}function dr(t,e,n){t.removeEventListener(e,n,!ir&&ur)}function hr(t,e){if(e){if(">"===e[0]&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(t){return!1}return!1}}function fr(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function pr(t,e,n,i){if(t){n=n||document;do{if(null!=e&&(">"===e[0]?t.parentNode===n&&hr(t,e):hr(t,e))||i&&t===n)return t;if(t===n)break}while(t=fr(t))}return null}var gr,mr=/\s+/g;function vr(t,e,n){if(t&&e)if(t.classList)t.classList[n?"add":"remove"](e);else{var i=(" "+t.className+" ").replace(mr," ").replace(" "+e+" "," ");t.className=(i+(n?" "+e:"")).replace(mr," ")}}function yr(t,e,n){var i=t&&t.style;if(i){if(void 0===n)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),void 0===e?n:n[e];e in i||-1!==e.indexOf("webkit")||(e="-webkit-"+e),i[e]=n+("string"==typeof n?"":"px")}}function br(t,e){var n="";if("string"==typeof t)n=t;else do{var i=yr(t,"transform");i&&"none"!==i&&(n=i+" "+n)}while(!e&&(t=t.parentNode));var r=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return r&&new r(n)}function Er(t,e,n){if(t){var i=t.getElementsByTagName(e),r=0,o=i.length;if(n)for(;r<o;r++)n(i[r],r);return i}return[]}function Tr(){var t=document.scrollingElement;return t||document.documentElement}function Ar(t,e,n,i,r){if(t.getBoundingClientRect||t===window){var o,a,s,l,u,c,d;if(t!==window&&t.parentNode&&t!==Tr()?(a=(o=t.getBoundingClientRect()).top,s=o.left,l=o.bottom,u=o.right,c=o.height,d=o.width):(a=0,s=0,l=window.innerHeight,u=window.innerWidth,c=window.innerHeight,d=window.innerWidth),(e||n)&&t!==window&&(r=r||t.parentNode,!ir))do{if(r&&r.getBoundingClientRect&&("none"!==yr(r,"transform")||n&&"static"!==yr(r,"position"))){var h=r.getBoundingClientRect();a-=h.top+parseInt(yr(r,"border-top-width")),s-=h.left+parseInt(yr(r,"border-left-width")),l=a+o.height,u=s+o.width;break}}while(r=r.parentNode);if(i&&t!==window){var f=br(r||t),p=f&&f.a,g=f&&f.d;f&&(l=(a/=g)+(c/=g),u=(s/=p)+(d/=p))}return{top:a,left:s,bottom:l,right:u,width:d,height:c}}}function Sr(t,e,n){for(var i=Rr(t,!0),r=Ar(t)[e];i;){var o=Ar(i)[n];if(!("top"===n||"left"===n?r>=o:r<=o))return i;if(i===Tr())break;i=Rr(i,!1)}return!1}function wr(t,e,n,i){for(var r=0,o=0,a=t.children;o<a.length;){if("none"!==a[o].style.display&&a[o]!==Oo.ghost&&(i||a[o]!==Oo.dragged)&&pr(a[o],n.draggable,t,!1)){if(r===e)return a[o];r++}o++}return null}function Lr(t,e){for(var n=t.lastElementChild;n&&(n===Oo.ghost||"none"===yr(n,"display")||e&&!hr(n,e));)n=n.previousElementSibling;return n||null}function xr(t,e){var n=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)"TEMPLATE"===t.nodeName.toUpperCase()||t===Oo.clone||e&&!hr(t,e)||n++;return n}function Dr(t){var e=0,n=0,i=Tr();if(t)do{var r=br(t),o=r.a,a=r.d;e+=t.scrollLeft*o,n+=t.scrollTop*a}while(t!==i&&(t=t.parentNode));return[e,n]}function Rr(t,e){if(!t||!t.getBoundingClientRect)return Tr();var n=t,i=!1;do{if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var r=yr(n);if(n.clientWidth<n.scrollWidth&&("auto"==r.overflowX||"scroll"==r.overflowX)||n.clientHeight<n.scrollHeight&&("auto"==r.overflowY||"scroll"==r.overflowY)){if(!n.getBoundingClientRect||n===document.body)return Tr();if(i||e)return n;i=!0}}}while(n=n.parentNode);return Tr()}function _r(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}function Cr(t,e){return function(){if(!gr){var n=arguments;1===n.length?t.call(this,n[0]):t.apply(this,n),gr=setTimeout((function(){gr=void 0}),e)}}}function kr(t,e,n){t.scrollLeft+=e,t.scrollTop+=n}function Ir(t){var e=window.Polymer,n=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):n?n(t).clone(!0)[0]:t.cloneNode(!0)}function Or(t,e,n){var i={};return Array.from(t.children).forEach((function(r){var o,a,s,l;if(pr(r,e.draggable,t,!1)&&!r.animated&&r!==n){var u=Ar(r);i.left=Math.min(null!==(o=i.left)&&void 0!==o?o:1/0,u.left),i.top=Math.min(null!==(a=i.top)&&void 0!==a?a:1/0,u.top),i.right=Math.max(null!==(s=i.right)&&void 0!==s?s:-1/0,u.right),i.bottom=Math.max(null!==(l=i.bottom)&&void 0!==l?l:-1/0,u.bottom)}})),i.width=i.right-i.left,i.height=i.bottom-i.top,i.x=i.left,i.y=i.top,i}var Pr="Sortable"+(new Date).getTime();function Mr(){var t,e=[];return{captureAnimationState:function(){(e=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(t){if("none"!==yr(t,"display")&&t!==Oo.ghost){e.push({target:t,rect:Ar(t)});var n=$i({},e[e.length-1].rect);if(t.thisAnimationDuration){var i=br(t,!0);i&&(n.top-=i.f,n.left-=i.e)}t.fromRect=n}}))},addAnimationState:function(t){e.push(t)},removeAnimationState:function(t){e.splice(function(t,e){for(var n in t)if(t.hasOwnProperty(n))for(var i in e)if(e.hasOwnProperty(i)&&e[i]===t[n][i])return Number(n);return-1}(e,{target:t}),1)},animateAll:function(n){var i=this;if(!this.options.animation)return clearTimeout(t),void("function"==typeof n&&n());var r=!1,o=0;e.forEach((function(t){var e=0,n=t.target,a=n.fromRect,s=Ar(n),l=n.prevFromRect,u=n.prevToRect,c=t.rect,d=br(n,!0);d&&(s.top-=d.f,s.left-=d.e),n.toRect=s,n.thisAnimationDuration&&_r(l,s)&&!_r(a,s)&&(c.top-s.top)/(c.left-s.left)==(a.top-s.top)/(a.left-s.left)&&(e=function(t,e,n,i){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-n.top,2)+Math.pow(e.left-n.left,2))*i.animation}(c,l,u,i.options)),_r(s,a)||(n.prevFromRect=a,n.prevToRect=s,e||(e=i.options.animation),i.animate(n,c,s,e)),e&&(r=!0,o=Math.max(o,e),clearTimeout(n.animationResetTimer),n.animationResetTimer=setTimeout((function(){n.animationTime=0,n.prevFromRect=null,n.fromRect=null,n.prevToRect=null,n.thisAnimationDuration=null}),e),n.thisAnimationDuration=e)})),clearTimeout(t),r?t=setTimeout((function(){"function"==typeof n&&n()}),o):"function"==typeof n&&n(),e=[]},animate:function(t,e,n,i){if(i){yr(t,"transition",""),yr(t,"transform","");var r=br(this.el),o=r&&r.a,a=r&&r.d,s=(e.left-n.left)/(o||1),l=(e.top-n.top)/(a||1);t.animatingX=!!s,t.animatingY=!!l,yr(t,"transform","translate3d("+s+"px,"+l+"px,0)"),this.forRepaintDummy=function(t){return t.offsetWidth}(t),yr(t,"transition","transform "+i+"ms"+(this.options.easing?" "+this.options.easing:"")),yr(t,"transform","translate3d(0,0,0)"),"number"==typeof t.animated&&clearTimeout(t.animated),t.animated=setTimeout((function(){yr(t,"transition",""),yr(t,"transform",""),t.animated=!1,t.animatingX=!1,t.animatingY=!1}),i)}}}}var Nr=[],Fr={initializeByDefault:!0},Br={mount:function(t){for(var e in Fr)Fr.hasOwnProperty(e)&&!(e in t)&&(t[e]=Fr[e]);Nr.forEach((function(e){if(e.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")})),Nr.push(t)},pluginEvent:function(t,e,n){var i=this;this.eventCanceled=!1,n.cancel=function(){i.eventCanceled=!0};var r=t+"Global";Nr.forEach((function(i){e[i.pluginName]&&(e[i.pluginName][r]&&e[i.pluginName][r]($i({sortable:e},n)),e.options[i.pluginName]&&e[i.pluginName][t]&&e[i.pluginName][t]($i({sortable:e},n)))}))},initializePlugins:function(t,e,n,i){for(var r in Nr.forEach((function(i){var r=i.pluginName;if(t.options[r]||i.initializeByDefault){var o=new i(t,e,t.options);o.sortable=t,o.options=t.options,t[r]=o,tr(n,o.defaults)}})),t.options)if(t.options.hasOwnProperty(r)){var o=this.modifyOption(t,r,t.options[r]);void 0!==o&&(t.options[r]=o)}},getEventProperties:function(t,e){var n={};return Nr.forEach((function(i){"function"==typeof i.eventProperties&&tr(n,i.eventProperties.call(e[i.pluginName],t))})),n},modifyOption:function(t,e,n){var i;return Nr.forEach((function(r){t[r.pluginName]&&r.optionListeners&&"function"==typeof r.optionListeners[e]&&(i=r.optionListeners[e].call(t[r.pluginName],n))})),i}};var Ur,jr,Gr,Vr,Hr,Kr,Wr,qr,Yr,zr,Xr,Jr,$r,Qr,Zr=["evt"],to=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.evt,r=er(n,Zr);Br.pluginEvent.bind(Oo)(t,e,$i({dragEl:Ur,parentEl:jr,ghostEl:Gr,rootEl:Vr,nextEl:Hr,lastDownEl:Kr,cloneEl:Wr,cloneHidden:qr,dragStarted:lo,putSortable:Qr,activeSortable:Oo.active,originalEvent:i,oldIndex:Yr,oldDraggableIndex:Xr,newIndex:zr,newDraggableIndex:Jr,hideGhostForTarget:_o,unhideGhostForTarget:Co,cloneNowHidden:function(){qr=!0},cloneNowShown:function(){qr=!1},dispatchSortableEvent:function(t){eo({sortable:e,name:t,originalEvent:i})}},r))};function eo(t){!function(t){var e=t.sortable,n=t.rootEl,i=t.name,r=t.targetEl,o=t.cloneEl,a=t.toEl,s=t.fromEl,l=t.oldIndex,u=t.newIndex,c=t.oldDraggableIndex,d=t.newDraggableIndex,h=t.originalEvent,f=t.putSortable,p=t.extraEventProperties;if(e=e||n&&n[Pr]){var g,m=e.options,v="on"+i.charAt(0).toUpperCase()+i.substr(1);!window.CustomEvent||ir||rr?(g=document.createEvent("Event")).initEvent(i,!0,!0):g=new CustomEvent(i,{bubbles:!0,cancelable:!0}),g.to=a||n,g.from=s||n,g.item=r||n,g.clone=o,g.oldIndex=l,g.newIndex=u,g.oldDraggableIndex=c,g.newDraggableIndex=d,g.originalEvent=h,g.pullMode=f?f.lastPutMode:void 0;var y=$i($i({},p),Br.getEventProperties(i,e));for(var b in y)g[b]=y[b];n&&n.dispatchEvent(g),m[v]&&m[v].call(e,g)}}($i({putSortable:Qr,cloneEl:Wr,targetEl:Ur,rootEl:Vr,oldIndex:Yr,oldDraggableIndex:Xr,newIndex:zr,newDraggableIndex:Jr},t))}var no,io,ro,oo,ao,so,lo,uo,co,ho,fo,po=!1,go=!1,mo=[],vo=!1,yo=!1,bo=[],Eo=!1,To=[],Ao="undefined"!=typeof document,So=sr,wo=rr||ir?"cssFloat":"float",Lo=Ao&&!lr&&!sr&&"draggable"in document.createElement("div"),xo=function(){if(Ao){if(ir)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto","auto"===t.style.pointerEvents}}(),Do=function(t,e){var n=yr(t),i=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),r=wr(t,0,e),o=wr(t,1,e),a=r&&yr(r),s=o&&yr(o),l=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+Ar(r).width,u=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+Ar(o).width;if("flex"===n.display)return"column"===n.flexDirection||"column-reverse"===n.flexDirection?"vertical":"horizontal";if("grid"===n.display)return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(r&&a.float&&"none"!==a.float){var c="left"===a.float?"left":"right";return!o||"both"!==s.clear&&s.clear!==c?"horizontal":"vertical"}return r&&("block"===a.display||"flex"===a.display||"table"===a.display||"grid"===a.display||l>=i&&"none"===n[wo]||o&&"none"===n[wo]&&l+u>i)?"vertical":"horizontal"},Ro=function(t){function e(t,n){return function(i,r,o,a){var s=i.options.group.name&&r.options.group.name&&i.options.group.name===r.options.group.name;if(null==t&&(n||s))return!0;if(null==t||!1===t)return!1;if(n&&"clone"===t)return t;if("function"==typeof t)return e(t(i,r,o,a),n)(i,r,o,a);var l=(n?i:r).options.group.name;return!0===t||"string"==typeof t&&t===l||t.join&&t.indexOf(l)>-1}}var n={},i=t.group;i&&"object"==Qi(i)||(i={name:i}),n.name=i.name,n.checkPull=e(i.pull,!0),n.checkPut=e(i.put),n.revertClone=i.revertClone,t.group=n},_o=function(){!xo&&Gr&&yr(Gr,"display","none")},Co=function(){!xo&&Gr&&yr(Gr,"display","")};Ao&&!lr&&document.addEventListener("click",(function(t){if(go)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),go=!1,!1}),!0);var ko=function(t){if(Ur){var e=function(t,e){var n;return mo.some((function(i){var r=i[Pr].options.emptyInsertThreshold;if(r&&!Lr(i)){var o=Ar(i),a=t>=o.left-r&&t<=o.right+r,s=e>=o.top-r&&e<=o.bottom+r;return a&&s?n=i:void 0}})),n}((t=t.touches?t.touches[0]:t).clientX,t.clientY);if(e){var n={};for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.target=n.rootEl=e,n.preventDefault=void 0,n.stopPropagation=void 0,e[Pr]._onDragOver(n)}}},Io=function(t){Ur&&Ur.parentNode[Pr]._isOutsideThisEl(t.target)};function Oo(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=tr({},e),t[Pr]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Do(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Oo.supportPointer&&"PointerEvent"in window&&!ar,emptyInsertThreshold:5};for(var i in Br.initializePlugins(this,t,n),n)!(i in e)&&(e[i]=n[i]);for(var r in Ro(e),this)"_"===r.charAt(0)&&"function"==typeof this[r]&&(this[r]=this[r].bind(this));this.nativeDraggable=!e.forceFallback&&Lo,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?cr(t,"pointerdown",this._onTapStart):(cr(t,"mousedown",this._onTapStart),cr(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(cr(t,"dragover",this),cr(t,"dragenter",this)),mo.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),tr(this,Mr())}function Po(t,e,n,i,r,o,a,s){var l,u,c=t[Pr],d=c.options.onMove;return!window.CustomEvent||ir||rr?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=e,l.from=t,l.dragged=n,l.draggedRect=i,l.related=r||e,l.relatedRect=o||Ar(e),l.willInsertAfter=s,l.originalEvent=a,t.dispatchEvent(l),d&&(u=d.call(c,l,a)),u}function Mo(t){t.draggable=!1}function No(){Eo=!1}function Fo(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,n=e.length,i=0;n--;)i+=e.charCodeAt(n);return i.toString(36)}function Bo(t){return setTimeout(t,0)}function Uo(t){return clearTimeout(t)}Oo.prototype={constructor:Oo,_isOutsideThisEl:function(t){this.el.contains(t)||t===this.el||(uo=null)},_getDirection:function(t,e){return"function"==typeof this.options.direction?this.options.direction.call(this,t,e,Ur):this.options.direction},_onTapStart:function(t){if(t.cancelable){var e=this,n=this.el,i=this.options,r=i.preventOnFilter,o=t.type,a=t.touches&&t.touches[0]||t.pointerType&&"touch"===t.pointerType&&t,s=(a||t).target,l=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||s,u=i.filter;if(function(t){To.length=0;var e=t.getElementsByTagName("input"),n=e.length;for(;n--;){var i=e[n];i.checked&&To.push(i)}}(n),!Ur&&!(/mousedown|pointerdown/.test(o)&&0!==t.button||i.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!ar||!s||"SELECT"!==s.tagName.toUpperCase())&&!((s=pr(s,i.draggable,n,!1))&&s.animated||Kr===s)){if(Yr=xr(s),Xr=xr(s,i.draggable),"function"==typeof u){if(u.call(this,t,s,this))return eo({sortable:e,rootEl:l,name:"filter",targetEl:s,toEl:n,fromEl:n}),to("filter",e,{evt:t}),void(r&&t.cancelable&&t.preventDefault())}else if(u&&(u=u.split(",").some((function(i){if(i=pr(l,i.trim(),n,!1))return eo({sortable:e,rootEl:i,name:"filter",targetEl:s,fromEl:n,toEl:n}),to("filter",e,{evt:t}),!0}))))return void(r&&t.cancelable&&t.preventDefault());i.handle&&!pr(l,i.handle,n,!1)||this._prepareDragStart(t,a,s)}}},_prepareDragStart:function(t,e,n){var i,r=this,o=r.el,a=r.options,s=o.ownerDocument;if(n&&!Ur&&n.parentNode===o){var l=Ar(n);if(Vr=o,jr=(Ur=n).parentNode,Hr=Ur.nextSibling,Kr=n,$r=a.group,Oo.dragged=Ur,no={target:Ur,clientX:(e||t).clientX,clientY:(e||t).clientY},ao=no.clientX-l.left,so=no.clientY-l.top,this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,Ur.style["will-change"]="all",i=function(){to("delayEnded",r,{evt:t}),Oo.eventCanceled?r._onDrop():(r._disableDelayedDragEvents(),!or&&r.nativeDraggable&&(Ur.draggable=!0),r._triggerDragStart(t,e),eo({sortable:r,name:"choose",originalEvent:t}),vr(Ur,a.chosenClass,!0))},a.ignore.split(",").forEach((function(t){Er(Ur,t.trim(),Mo)})),cr(s,"dragover",ko),cr(s,"mousemove",ko),cr(s,"touchmove",ko),cr(s,"mouseup",r._onDrop),cr(s,"touchend",r._onDrop),cr(s,"touchcancel",r._onDrop),or&&this.nativeDraggable&&(this.options.touchStartThreshold=4,Ur.draggable=!0),to("delayStart",this,{evt:t}),!a.delay||a.delayOnTouchOnly&&!e||this.nativeDraggable&&(rr||ir))i();else{if(Oo.eventCanceled)return void this._onDrop();cr(s,"mouseup",r._disableDelayedDrag),cr(s,"touchend",r._disableDelayedDrag),cr(s,"touchcancel",r._disableDelayedDrag),cr(s,"mousemove",r._delayedDragTouchMoveHandler),cr(s,"touchmove",r._delayedDragTouchMoveHandler),a.supportPointer&&cr(s,"pointermove",r._delayedDragTouchMoveHandler),r._dragStartTimer=setTimeout(i,a.delay)}}},_delayedDragTouchMoveHandler:function(t){var e=t.touches?t.touches[0]:t;Math.max(Math.abs(e.clientX-this._lastX),Math.abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){Ur&&Mo(Ur),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;dr(t,"mouseup",this._disableDelayedDrag),dr(t,"touchend",this._disableDelayedDrag),dr(t,"touchcancel",this._disableDelayedDrag),dr(t,"mousemove",this._delayedDragTouchMoveHandler),dr(t,"touchmove",this._delayedDragTouchMoveHandler),dr(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,e){e=e||"touch"==t.pointerType&&t,!this.nativeDraggable||e?this.options.supportPointer?cr(document,"pointermove",this._onTouchMove):cr(document,e?"touchmove":"mousemove",this._onTouchMove):(cr(Ur,"dragend",this),cr(Vr,"dragstart",this._onDragStart));try{document.selection?Bo((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(t,e){if(po=!1,Vr&&Ur){to("dragStarted",this,{evt:e}),this.nativeDraggable&&cr(document,"dragover",Io);var n=this.options;!t&&vr(Ur,n.dragClass,!1),vr(Ur,n.ghostClass,!0),Oo.active=this,t&&this._appendGhost(),eo({sortable:this,name:"start",originalEvent:e})}else this._nulling()},_emulateDragOver:function(){if(io){this._lastX=io.clientX,this._lastY=io.clientY,_o();for(var t=document.elementFromPoint(io.clientX,io.clientY),e=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(io.clientX,io.clientY))!==e;)e=t;if(Ur.parentNode[Pr]._isOutsideThisEl(t),e)do{if(e[Pr]){if(e[Pr]._onDragOver({clientX:io.clientX,clientY:io.clientY,target:t,rootEl:e})&&!this.options.dragoverBubble)break}t=e}while(e=e.parentNode);Co()}},_onTouchMove:function(t){if(no){var e=this.options,n=e.fallbackTolerance,i=e.fallbackOffset,r=t.touches?t.touches[0]:t,o=Gr&&br(Gr,!0),a=Gr&&o&&o.a,s=Gr&&o&&o.d,l=So&&fo&&Dr(fo),u=(r.clientX-no.clientX+i.x)/(a||1)+(l?l[0]-bo[0]:0)/(a||1),c=(r.clientY-no.clientY+i.y)/(s||1)+(l?l[1]-bo[1]:0)/(s||1);if(!Oo.active&&!po){if(n&&Math.max(Math.abs(r.clientX-this._lastX),Math.abs(r.clientY-this._lastY))<n)return;this._onDragStart(t,!0)}if(Gr){o?(o.e+=u-(ro||0),o.f+=c-(oo||0)):o={a:1,b:0,c:0,d:1,e:u,f:c};var d="matrix(".concat(o.a,",").concat(o.b,",").concat(o.c,",").concat(o.d,",").concat(o.e,",").concat(o.f,")");yr(Gr,"webkitTransform",d),yr(Gr,"mozTransform",d),yr(Gr,"msTransform",d),yr(Gr,"transform",d),ro=u,oo=c,io=r}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!Gr){var t=this.options.fallbackOnBody?document.body:Vr,e=Ar(Ur,!0,So,!0,t),n=this.options;if(So){for(fo=t;"static"===yr(fo,"position")&&"none"===yr(fo,"transform")&&fo!==document;)fo=fo.parentNode;fo!==document.body&&fo!==document.documentElement?(fo===document&&(fo=Tr()),e.top+=fo.scrollTop,e.left+=fo.scrollLeft):fo=Tr(),bo=Dr(fo)}vr(Gr=Ur.cloneNode(!0),n.ghostClass,!1),vr(Gr,n.fallbackClass,!0),vr(Gr,n.dragClass,!0),yr(Gr,"transition",""),yr(Gr,"transform",""),yr(Gr,"box-sizing","border-box"),yr(Gr,"margin",0),yr(Gr,"top",e.top),yr(Gr,"left",e.left),yr(Gr,"width",e.width),yr(Gr,"height",e.height),yr(Gr,"opacity","0.8"),yr(Gr,"position",So?"absolute":"fixed"),yr(Gr,"zIndex","100000"),yr(Gr,"pointerEvents","none"),Oo.ghost=Gr,t.appendChild(Gr),yr(Gr,"transform-origin",ao/parseInt(Gr.style.width)*100+"% "+so/parseInt(Gr.style.height)*100+"%")}},_onDragStart:function(t,e){var n=this,i=t.dataTransfer,r=n.options;to("dragStart",this,{evt:t}),Oo.eventCanceled?this._onDrop():(to("setupClone",this),Oo.eventCanceled||((Wr=Ir(Ur)).removeAttribute("id"),Wr.draggable=!1,Wr.style["will-change"]="",this._hideClone(),vr(Wr,this.options.chosenClass,!1),Oo.clone=Wr),n.cloneId=Bo((function(){to("clone",n),Oo.eventCanceled||(n.options.removeCloneOnHide||Vr.insertBefore(Wr,Ur),n._hideClone(),eo({sortable:n,name:"clone"}))})),!e&&vr(Ur,r.dragClass,!0),e?(go=!0,n._loopId=setInterval(n._emulateDragOver,50)):(dr(document,"mouseup",n._onDrop),dr(document,"touchend",n._onDrop),dr(document,"touchcancel",n._onDrop),i&&(i.effectAllowed="move",r.setData&&r.setData.call(n,i,Ur)),cr(document,"drop",n),yr(Ur,"transform","translateZ(0)")),po=!0,n._dragStartId=Bo(n._dragStarted.bind(n,e,t)),cr(document,"selectstart",n),lo=!0,ar&&yr(document.body,"user-select","none"))},_onDragOver:function(t){var e,n,i,r,o=this.el,a=t.target,s=this.options,l=s.group,u=Oo.active,c=$r===l,d=s.sort,h=Qr||u,f=this,p=!1;if(!Eo){if(void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),a=pr(a,s.draggable,o,!0),_("dragOver"),Oo.eventCanceled)return p;if(Ur.contains(t.target)||a.animated&&a.animatingX&&a.animatingY||f._ignoreWhileAnimating===a)return k(!1);if(go=!1,u&&!s.disabled&&(c?d||(i=jr!==Vr):Qr===this||(this.lastPutMode=$r.checkPull(this,u,Ur,t))&&l.checkPut(this,u,Ur,t))){if(r="vertical"===this._getDirection(t,a),e=Ar(Ur),_("dragOverValid"),Oo.eventCanceled)return p;if(i)return jr=Vr,C(),this._hideClone(),_("revert"),Oo.eventCanceled||(Hr?Vr.insertBefore(Ur,Hr):Vr.appendChild(Ur)),k(!0);var g=Lr(o,s.draggable);if(!g||function(t,e,n){var i=Ar(Lr(n.el,n.options.draggable)),r=Or(n.el,n.options,Gr),o=10;return e?t.clientX>r.right+o||t.clientY>i.bottom&&t.clientX>i.left:t.clientY>r.bottom+o||t.clientX>i.right&&t.clientY>i.top}(t,r,this)&&!g.animated){if(g===Ur)return k(!1);if(g&&o===t.target&&(a=g),a&&(n=Ar(a)),!1!==Po(Vr,o,Ur,e,a,n,t,!!a))return C(),g&&g.nextSibling?o.insertBefore(Ur,g.nextSibling):o.appendChild(Ur),jr=o,I(),k(!0)}else if(g&&function(t,e,n){var i=Ar(wr(n.el,0,n.options,!0)),r=Or(n.el,n.options,Gr),o=10;return e?t.clientX<r.left-o||t.clientY<i.top&&t.clientX<i.right:t.clientY<r.top-o||t.clientY<i.bottom&&t.clientX<i.left}(t,r,this)){var m=wr(o,0,s,!0);if(m===Ur)return k(!1);if(n=Ar(a=m),!1!==Po(Vr,o,Ur,e,a,n,t,!1))return C(),o.insertBefore(Ur,m),jr=o,I(),k(!0)}else if(a.parentNode===o){n=Ar(a);var v,y,b,E=Ur.parentNode!==o,T=!function(t,e,n){var i=n?t.left:t.top,r=n?t.right:t.bottom,o=n?t.width:t.height,a=n?e.left:e.top,s=n?e.right:e.bottom,l=n?e.width:e.height;return i===a||r===s||i+o/2===a+l/2}(Ur.animated&&Ur.toRect||e,a.animated&&a.toRect||n,r),A=r?"top":"left",S=Sr(a,"top","top")||Sr(Ur,"top","top"),w=S?S.scrollTop:void 0;if(uo!==a&&(y=n[A],vo=!1,yo=!T&&s.invertSwap||E),v=function(t,e,n,i,r,o,a,s){var l=i?t.clientY:t.clientX,u=i?n.height:n.width,c=i?n.top:n.left,d=i?n.bottom:n.right,h=!1;if(!a)if(s&&ho<u*r){if(!vo&&(1===co?l>c+u*o/2:l<d-u*o/2)&&(vo=!0),vo)h=!0;else if(1===co?l<c+ho:l>d-ho)return-co}else if(l>c+u*(1-r)/2&&l<d-u*(1-r)/2)return function(t){return xr(Ur)<xr(t)?1:-1}(e);if((h=h||a)&&(l<c+u*o/2||l>d-u*o/2))return l>c+u/2?1:-1;return 0}(t,a,n,r,T?1:s.swapThreshold,null==s.invertedSwapThreshold?s.swapThreshold:s.invertedSwapThreshold,yo,uo===a),0!==v){var L=xr(Ur);do{L-=v,b=jr.children[L]}while(b&&("none"===yr(b,"display")||b===Gr))}if(0===v||b===a)return k(!1);uo=a,co=v;var x=a.nextElementSibling,D=!1,R=Po(Vr,o,Ur,e,a,n,t,D=1===v);if(!1!==R)return 1!==R&&-1!==R||(D=1===R),Eo=!0,setTimeout(No,30),C(),D&&!x?o.appendChild(Ur):a.parentNode.insertBefore(Ur,D?x:a),S&&kr(S,0,w-S.scrollTop),jr=Ur.parentNode,void 0===y||yo||(ho=Math.abs(y-Ar(a)[A])),I(),k(!0)}if(o.contains(Ur))return k(!1)}return!1}function _(s,l){to(s,f,$i({evt:t,isOwner:c,axis:r?"vertical":"horizontal",revert:i,dragRect:e,targetRect:n,canSort:d,fromSortable:h,target:a,completed:k,onMove:function(n,i){return Po(Vr,o,Ur,e,n,Ar(n),t,i)},changed:I},l))}function C(){_("dragOverAnimationCapture"),f.captureAnimationState(),f!==h&&h.captureAnimationState()}function k(e){return _("dragOverCompleted",{insertion:e}),e&&(c?u._hideClone():u._showClone(f),f!==h&&(vr(Ur,Qr?Qr.options.ghostClass:u.options.ghostClass,!1),vr(Ur,s.ghostClass,!0)),Qr!==f&&f!==Oo.active?Qr=f:f===Oo.active&&Qr&&(Qr=null),h===f&&(f._ignoreWhileAnimating=a),f.animateAll((function(){_("dragOverAnimationComplete"),f._ignoreWhileAnimating=null})),f!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(a===Ur&&!Ur.animated||a===o&&!a.animated)&&(uo=null),s.dragoverBubble||t.rootEl||a===document||(Ur.parentNode[Pr]._isOutsideThisEl(t.target),!e&&ko(t)),!s.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),p=!0}function I(){zr=xr(Ur),Jr=xr(Ur,s.draggable),eo({sortable:f,name:"change",toEl:o,newIndex:zr,newDraggableIndex:Jr,originalEvent:t})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){dr(document,"mousemove",this._onTouchMove),dr(document,"touchmove",this._onTouchMove),dr(document,"pointermove",this._onTouchMove),dr(document,"dragover",ko),dr(document,"mousemove",ko),dr(document,"touchmove",ko)},_offUpEvents:function(){var t=this.el.ownerDocument;dr(t,"mouseup",this._onDrop),dr(t,"touchend",this._onDrop),dr(t,"pointerup",this._onDrop),dr(t,"touchcancel",this._onDrop),dr(document,"selectstart",this)},_onDrop:function(t){var e=this.el,n=this.options;zr=xr(Ur),Jr=xr(Ur,n.draggable),to("drop",this,{evt:t}),jr=Ur&&Ur.parentNode,zr=xr(Ur),Jr=xr(Ur,n.draggable),Oo.eventCanceled||(po=!1,yo=!1,vo=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Uo(this.cloneId),Uo(this._dragStartId),this.nativeDraggable&&(dr(document,"drop",this),dr(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),ar&&yr(document.body,"user-select",""),yr(Ur,"transform",""),t&&(lo&&(t.cancelable&&t.preventDefault(),!n.dropBubble&&t.stopPropagation()),Gr&&Gr.parentNode&&Gr.parentNode.removeChild(Gr),(Vr===jr||Qr&&"clone"!==Qr.lastPutMode)&&Wr&&Wr.parentNode&&Wr.parentNode.removeChild(Wr),Ur&&(this.nativeDraggable&&dr(Ur,"dragend",this),Mo(Ur),Ur.style["will-change"]="",lo&&!po&&vr(Ur,Qr?Qr.options.ghostClass:this.options.ghostClass,!1),vr(Ur,this.options.chosenClass,!1),eo({sortable:this,name:"unchoose",toEl:jr,newIndex:null,newDraggableIndex:null,originalEvent:t}),Vr!==jr?(zr>=0&&(eo({rootEl:jr,name:"add",toEl:jr,fromEl:Vr,originalEvent:t}),eo({sortable:this,name:"remove",toEl:jr,originalEvent:t}),eo({rootEl:jr,name:"sort",toEl:jr,fromEl:Vr,originalEvent:t}),eo({sortable:this,name:"sort",toEl:jr,originalEvent:t})),Qr&&Qr.save()):zr!==Yr&&zr>=0&&(eo({sortable:this,name:"update",toEl:jr,originalEvent:t}),eo({sortable:this,name:"sort",toEl:jr,originalEvent:t})),Oo.active&&(null!=zr&&-1!==zr||(zr=Yr,Jr=Xr),eo({sortable:this,name:"end",toEl:jr,originalEvent:t}),this.save())))),this._nulling()},_nulling:function(){to("nulling",this),Vr=Ur=jr=Gr=Hr=Wr=Kr=qr=no=io=lo=zr=Jr=Yr=Xr=uo=co=Qr=$r=Oo.dragged=Oo.ghost=Oo.clone=Oo.active=null,To.forEach((function(t){t.checked=!0})),To.length=ro=oo=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":Ur&&(this._onDragOver(t),function(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move");t.cancelable&&t.preventDefault()}(t));break;case"selectstart":t.preventDefault()}},toArray:function(){for(var t,e=[],n=this.el.children,i=0,r=n.length,o=this.options;i<r;i++)pr(t=n[i],o.draggable,this.el,!1)&&e.push(t.getAttribute(o.dataIdAttr)||Fo(t));return e},sort:function(t,e){var n={},i=this.el;this.toArray().forEach((function(t,e){var r=i.children[e];pr(r,this.options.draggable,i,!1)&&(n[t]=r)}),this),e&&this.captureAnimationState(),t.forEach((function(t){n[t]&&(i.removeChild(n[t]),i.appendChild(n[t]))})),e&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return pr(t,e||this.options.draggable,this.el,!1)},option:function(t,e){var n=this.options;if(void 0===e)return n[t];var i=Br.modifyOption(this,t,e);n[t]=void 0!==i?i:e,"group"===t&&Ro(n)},destroy:function(){to("destroy",this);var t=this.el;t[Pr]=null,dr(t,"mousedown",this._onTapStart),dr(t,"touchstart",this._onTapStart),dr(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(dr(t,"dragover",this),dr(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),(function(t){t.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),mo.splice(mo.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!qr){if(to("hideClone",this),Oo.eventCanceled)return;yr(Wr,"display","none"),this.options.removeCloneOnHide&&Wr.parentNode&&Wr.parentNode.removeChild(Wr),qr=!0}},_showClone:function(t){if("clone"===t.lastPutMode){if(qr){if(to("showClone",this),Oo.eventCanceled)return;Ur.parentNode!=Vr||this.options.group.revertClone?Hr?Vr.insertBefore(Wr,Hr):Vr.appendChild(Wr):Vr.insertBefore(Wr,Ur),this.options.group.revertClone&&this.animate(Ur,Wr),yr(Wr,"display",""),qr=!1}}else this._hideClone()}},Ao&&cr(document,"touchmove",(function(t){(Oo.active||po)&&t.cancelable&&t.preventDefault()})),Oo.utils={on:cr,off:dr,css:yr,find:Er,is:function(t,e){return!!pr(t,e,t,!1)},extend:function(t,e){if(t&&e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},throttle:Cr,closest:pr,toggleClass:vr,clone:Ir,index:xr,nextTick:Bo,cancelNextTick:Uo,detectDirection:Do,getChild:wr},Oo.get=function(t){return t[Pr]},Oo.mount=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e[0].constructor===Array&&(e=e[0]),e.forEach((function(t){if(!t.prototype||!t.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(t));t.utils&&(Oo.utils=$i($i({},Oo.utils),t.utils)),Br.mount(t)}))},Oo.create=function(t,e){return new Oo(t,e)},Oo.version="1.15.2";var jo,Go,Vo,Ho,Ko,Wo,qo=[],Yo=!1;function zo(){qo.forEach((function(t){clearInterval(t.pid)})),qo=[]}function Xo(){clearInterval(Wo)}var Jo=Cr((function(t,e,n,i){if(e.scroll){var r,o=(t.touches?t.touches[0]:t).clientX,a=(t.touches?t.touches[0]:t).clientY,s=e.scrollSensitivity,l=e.scrollSpeed,u=Tr(),c=!1;Go!==n&&(Go=n,zo(),jo=e.scroll,r=e.scrollFn,!0===jo&&(jo=Rr(n,!0)));var d=0,h=jo;do{var f=h,p=Ar(f),g=p.top,m=p.bottom,v=p.left,y=p.right,b=p.width,E=p.height,T=void 0,A=void 0,S=f.scrollWidth,w=f.scrollHeight,L=yr(f),x=f.scrollLeft,D=f.scrollTop;f===u?(T=b<S&&("auto"===L.overflowX||"scroll"===L.overflowX||"visible"===L.overflowX),A=E<w&&("auto"===L.overflowY||"scroll"===L.overflowY||"visible"===L.overflowY)):(T=b<S&&("auto"===L.overflowX||"scroll"===L.overflowX),A=E<w&&("auto"===L.overflowY||"scroll"===L.overflowY));var R=T&&(Math.abs(y-o)<=s&&x+b<S)-(Math.abs(v-o)<=s&&!!x),_=A&&(Math.abs(m-a)<=s&&D+E<w)-(Math.abs(g-a)<=s&&!!D);if(!qo[d])for(var C=0;C<=d;C++)qo[C]||(qo[C]={});qo[d].vx==R&&qo[d].vy==_&&qo[d].el===f||(qo[d].el=f,qo[d].vx=R,qo[d].vy=_,clearInterval(qo[d].pid),0==R&&0==_||(c=!0,qo[d].pid=setInterval(function(){i&&0===this.layer&&Oo.active._onTouchMove(Ko);var e=qo[this.layer].vy?qo[this.layer].vy*l:0,n=qo[this.layer].vx?qo[this.layer].vx*l:0;"function"==typeof r&&"continue"!==r.call(Oo.dragged.parentNode[Pr],n,e,t,Ko,qo[this.layer].el)||kr(qo[this.layer].el,n,e)}.bind({layer:d}),24))),d++}while(e.bubbleScroll&&h!==u&&(h=Rr(h,!1)));Yo=c}}),30),$o=function(t){var e=t.originalEvent,n=t.putSortable,i=t.dragEl,r=t.activeSortable,o=t.dispatchSortableEvent,a=t.hideGhostForTarget,s=t.unhideGhostForTarget;if(e){var l=n||r;a();var u=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e,c=document.elementFromPoint(u.clientX,u.clientY);s(),l&&!l.el.contains(c)&&(o("spill"),this.onSpill({dragEl:i,putSortable:n}))}};function Qo(){}function Zo(){}Qo.prototype={startIndex:null,dragStart:function(t){var e=t.oldDraggableIndex;this.startIndex=e},onSpill:function(t){var e=t.dragEl,n=t.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var i=wr(this.sortable.el,this.startIndex,this.options);i?this.sortable.el.insertBefore(e,i):this.sortable.el.appendChild(e),this.sortable.animateAll(),n&&n.animateAll()},drop:$o},tr(Qo,{pluginName:"revertOnSpill"}),Zo.prototype={onSpill:function(t){var e=t.dragEl,n=t.putSortable||this.sortable;n.captureAnimationState(),e.parentNode&&e.parentNode.removeChild(e),n.animateAll()},drop:$o},tr(Zo,{pluginName:"removeOnSpill"}),Oo.mount(new function(){function t(){for(var t in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===t.charAt(0)&&"function"==typeof this[t]&&(this[t]=this[t].bind(this))}return t.prototype={dragStarted:function(t){var e=t.originalEvent;this.sortable.nativeDraggable?cr(document,"dragover",this._handleAutoScroll):this.options.supportPointer?cr(document,"pointermove",this._handleFallbackAutoScroll):e.touches?cr(document,"touchmove",this._handleFallbackAutoScroll):cr(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var e=t.originalEvent;this.options.dragOverBubble||e.rootEl||this._handleAutoScroll(e)},drop:function(){this.sortable.nativeDraggable?dr(document,"dragover",this._handleAutoScroll):(dr(document,"pointermove",this._handleFallbackAutoScroll),dr(document,"touchmove",this._handleFallbackAutoScroll),dr(document,"mousemove",this._handleFallbackAutoScroll)),Xo(),zo(),clearTimeout(gr),gr=void 0},nulling:function(){Ko=Go=jo=Yo=Wo=Vo=Ho=null,qo.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,e){var n=this,i=(t.touches?t.touches[0]:t).clientX,r=(t.touches?t.touches[0]:t).clientY,o=document.elementFromPoint(i,r);if(Ko=t,e||this.options.forceAutoScrollFallback||rr||ir||ar){Jo(t,this.options,o,e);var a=Rr(o,!0);!Yo||Wo&&i===Vo&&r===Ho||(Wo&&Xo(),Wo=setInterval((function(){var o=Rr(document.elementFromPoint(i,r),!0);o!==a&&(a=o,zo()),Jo(t,n.options,o,e)}),10),Vo=i,Ho=r)}else{if(!this.options.bubbleScroll||Rr(o,!0)===Tr())return void zo();Jo(t,this.options,Rr(o,!1),!1)}}},tr(t,{pluginName:"scroll",initializeByDefault:!0})}),Oo.mount(Zo,Qo);var ta=Oo;function ea(t,e){return t.hasAttribute("x-sort:group")?t.getAttribute("x-sort:group"):-1!==e.indexOf("group")?e[e.indexOf("group")+1]:null}var na=function(t){t.directive("sort",((t,{value:e,modifiers:n,expression:i},{effect:r,evaluate:o,evaluateLater:a,cleanup:s})=>{if("config"===e)return;if("handle"===e)return;if("group"===e)return;if("key"===e||"item"===e){if([void 0,null,""].includes(i))return;return void(t._x_sort_key=o(i))}let l={hideGhost:!n.includes("ghost"),useHandles:!!t.querySelector("[x-sort\\:handle]"),group:ea(t,n)},u=function(t,e){if([void 0,null,""].includes(t))return()=>{};let n=e(t);return(t,e)=>{Alpine.dontAutoEvaluateFunctions((()=>{n((n=>{"function"==typeof n&&n(t,e)}),{scope:{$key:t,$item:t,$position:e}})}))}}(i,a),c=function(t,e,n){return t.hasAttribute("x-sort:config")?n(t.getAttribute("x-sort:config")):{}}(t,0,o),d=function(t,e,n,i){let r,o={animation:150,handle:n.useHandles?"[x-sort\\:handle]":null,group:n.group,filter(e){if(!t.querySelector("[x-sort\\:item]"))return!1;return!e.target.closest("[x-sort\\:item]")},onSort(t){if(t.from!==t.to&&t.to!==t.target)return;let e=t.item._x_sort_key,n=t.newIndex;void 0===e&&null===e||i(e,n)},onStart(){document.body.classList.add("sorting"),r=document.querySelector(".sortable-ghost"),n.hideGhost&&r&&(r.style.opacity="0")},onEnd(){document.body.classList.remove("sorting"),n.hideGhost&&r&&(r.style.opacity="1"),r=void 0,function(t){let e=t.firstChild;for(;e.nextSibling;){if("[if ENDBLOCK]><![endif]"===e.textContent.trim()){t.append(e);break}e=e.nextSibling}}(t)}};return new ta(t,{...o,...e})}(t,c,l,((t,e)=>{u(t,e)}));s((()=>d.destroy()))}))},ia=n(564),ra=n.n(ia),oa=n(395),aa=n.n(oa),sa=n(606);const la={player:null,station:null,status:"playing",getStreamingUrl:function(t){var e=station.url_resolved&&""!==station.url_resolved?station.url_resolved:station.url,n=new URL(e);if("http:"===n.protocol||station.ssl_error){n.protocol="http:";var i=n.toString().replace("http://","");return"".concat(sa.env.PROXY_URL,"?url=").concat(i)}return station.hls&&n.searchParams.append("isPlaylistUrl",station.hls?"yes":"no"),n.toString()},playRadio:function(t){var e=this;t="string"==typeof t?JSON.parse(atob(t)):t;var n=this.getStreamingUrl(t);this.player&&this.player.stop();var i=null;(i=t.hls?new(ra())(n):new(aa())(n)).on("error",(function(){alert("Failed to play."),e.stop()})),i&&(i.play(),this.station=t,this.player=i)},stop:function(){this.player&&(this.player.stop(),this.player.destroy(),this.player=null)}};n(488),Xi.store("radioPlayer",la),Xi.plugin(na),setTimeout((function(){Xi.start()}),300),window.Alpine=Xi,window.Tagify=tt,Livewire.on("notify",(function(t){window.dispatchEvent(new CustomEvent("notify",{detail:t}))}))},488:(t,e,n)=>{window.axios=n(505),window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"},473:t=>{!function e(n){t.exports=function(){"use strict";function t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function i(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?t(Object(i),!0).forEach((function(t){l(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function r(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function o(t){var e=r(t,"string");return"symbol"==typeof e?e:String(e)}function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,o(i.key),i)}}function s(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function l(t,e,n){return(e=o(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(){return u=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},u.apply(this,arguments)}function c(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,h(t,e)}function d(t){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},d(t)}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function p(t,e,n){return p=f()?Reflect.construct.bind():function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&h(r,n.prototype),r},p.apply(null,arguments)}function g(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}function m(t){var e="function"==typeof Map?new Map:void 0;return m=function(t){if(null===t||!g(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return p(t,arguments,d(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),h(n,t)},m(t)}function v(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(t,e){if(t){if("string"==typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function E(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=y(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var A={exports:{}};!function(t,e){var n,i,r,o,a;n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(t,e,n){if(n=n||{},t=t.trim(),!(e=e.trim())){if(!n.alwaysNormalize)return t;var r=a.parseURL(t);if(!r)throw new Error("Error trying to parse base URL.");return r.path=a.normalizePath(r.path),a.buildURLFromParts(r)}var o=a.parseURL(e);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return n.alwaysNormalize?(o.path=a.normalizePath(o.path),a.buildURLFromParts(o)):e;var s=a.parseURL(t);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var l=i.exec(s.path);s.netLoc=l[1],s.path=l[2]}s.netLoc&&!s.path&&(s.path="/");var u={scheme:s.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(u.netLoc=s.netLoc,"/"!==o.path[0]))if(o.path){var c=s.path,d=c.substring(0,c.lastIndexOf("/")+1)+o.path;u.path=a.normalizePath(d)}else u.path=s.path,o.params||(u.params=s.params,o.query||(u.query=s.query));return null===u.path&&(u.path=n.alwaysNormalize?a.normalizePath(o.path):o.path),a.buildURLFromParts(u)},parseURL:function(t){var e=n.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(r,"");t.length!==(t=t.replace(o,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=a}(A);var S=A.exports,w=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},L=Number.isSafeInteger||function(t){return"number"==typeof t&&Math.abs(t)<=x},x=Number.MAX_SAFE_INTEGER||9007199254740991,D=function(t){return t.MEDIA_ATTACHING="hlsMediaAttaching",t.MEDIA_ATTACHED="hlsMediaAttached",t.MEDIA_DETACHING="hlsMediaDetaching",t.MEDIA_DETACHED="hlsMediaDetached",t.BUFFER_RESET="hlsBufferReset",t.BUFFER_CODECS="hlsBufferCodecs",t.BUFFER_CREATED="hlsBufferCreated",t.BUFFER_APPENDING="hlsBufferAppending",t.BUFFER_APPENDED="hlsBufferAppended",t.BUFFER_EOS="hlsBufferEos",t.BUFFER_FLUSHING="hlsBufferFlushing",t.BUFFER_FLUSHED="hlsBufferFlushed",t.MANIFEST_LOADING="hlsManifestLoading",t.MANIFEST_LOADED="hlsManifestLoaded",t.MANIFEST_PARSED="hlsManifestParsed",t.LEVEL_SWITCHING="hlsLevelSwitching",t.LEVEL_SWITCHED="hlsLevelSwitched",t.LEVEL_LOADING="hlsLevelLoading",t.LEVEL_LOADED="hlsLevelLoaded",t.LEVEL_UPDATED="hlsLevelUpdated",t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",t.LEVELS_UPDATED="hlsLevelsUpdated",t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",t.CUES_PARSED="hlsCuesParsed",t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",t.INIT_PTS_FOUND="hlsInitPtsFound",t.FRAG_LOADING="hlsFragLoading",t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",t.FRAG_LOADED="hlsFragLoaded",t.FRAG_DECRYPTED="hlsFragDecrypted",t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",t.FRAG_PARSING_METADATA="hlsFragParsingMetadata",t.FRAG_PARSED="hlsFragParsed",t.FRAG_BUFFERED="hlsFragBuffered",t.FRAG_CHANGED="hlsFragChanged",t.FPS_DROP="hlsFpsDrop",t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",t.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",t.ERROR="hlsError",t.DESTROYING="hlsDestroying",t.KEY_LOADING="hlsKeyLoading",t.KEY_LOADED="hlsKeyLoaded",t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",t.BACK_BUFFER_REACHED="hlsBackBufferReached",t.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",t}({}),R=function(t){return t.NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError",t}({}),_=function(t){return t.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",t.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",t.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",t.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_PARSING_ERROR="levelParsingError",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",t.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.FRAG_GAP="fragGap",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.INTERNAL_EXCEPTION="internalException",t.INTERNAL_ABORTED="aborted",t.UNKNOWN="unknown",t}({}),C=function(){},k={trace:C,debug:C,log:C,warn:C,info:C,error:C},I=k;function O(t){var e=self.console[t];return e?e.bind(self.console,"["+t+"] >"):C}function P(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];n.forEach((function(e){I[e]=t[e]?t[e].bind(t):O(e)}))}function M(t,e){if("object"==typeof console&&!0===t||"object"==typeof t){P(t,"debug","log","info","warn","error");try{I.log('Debug logs enabled for "'+e+'" in hls.js version 1.5.13')}catch(t){I=k}}else I=k}var N=I,F=/^(\d+)x(\d+)$/,B=/(.+?)=(".*?"|.*?)(?:,|$)/g,U=function(){function t(e){"string"==typeof e&&(e=t.parseAttrList(e)),u(this,e)}var e=t.prototype;return e.decimalInteger=function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var n=new Uint8Array(e.length/2),i=0;i<e.length/2;i++)n[i]=parseInt(e.slice(2*i,2*i+2),16);return n}return null},e.hexadecimalIntegerAsNumber=function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.decimalFloatingPoint=function(t){return parseFloat(this[t])},e.optionalFloat=function(t,e){var n=this[t];return n?parseFloat(n):e},e.enumeratedString=function(t){return this[t]},e.bool=function(t){return"YES"===this[t]},e.decimalResolution=function(t){var e=F.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},t.parseAttrList=function(t){var e,n={},i='"';for(B.lastIndex=0;null!==(e=B.exec(t));){var r=e[2];0===r.indexOf(i)&&r.lastIndexOf(i)===r.length-1&&(r=r.slice(1,-1)),n[e[1].trim()]=r}return n},s(t,[{key:"clientAttrs",get:function(){return Object.keys(this).filter((function(t){return"X-"===t.substring(0,2)}))}}]),t}();function j(t){return"ID"!==t&&"CLASS"!==t&&"START-DATE"!==t&&"DURATION"!==t&&"END-DATE"!==t&&"END-ON-NEXT"!==t}function G(t){return"SCTE35-OUT"===t||"SCTE35-IN"===t}var V=function(){function t(t,e){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,e){var n=e.attr;for(var i in n)if(Object.prototype.hasOwnProperty.call(t,i)&&t[i]!==n[i]){N.warn('DATERANGE tag attribute: "'+i+'" does not match for tags with ID: "'+t.ID+'"'),this._badValueForSameId=i;break}t=u(new U({}),n,t)}if(this.attr=t,this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){var r=new Date(this.attr["END-DATE"]);w(r.getTime())&&(this._endDate=r)}}return s(t,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var t=this.duration;return null!==t?new Date(this._startDate.getTime()+1e3*t):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var t=this.attr.decimalFloatingPoint("DURATION");if(w(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&w(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),t}(),H=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},K={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},W=function(){function t(t){var e;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((e={})[K.AUDIO]=null,e[K.VIDEO]=null,e[K.AUDIOVIDEO]=null,e),this.baseurl=t}return t.prototype.setByteRange=function(t,e){var n,i=t.split("@",2);n=1===i.length?(null==e?void 0:e.byteRangeEndOffset)||0:parseInt(i[1]),this._byteRange=[n,parseInt(i[0])+n]},s(t,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=S.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),t}(),q=function(t){function e(e,n){var i;return(i=t.call(this,n)||this)._decryptdata=null,i.rawProgramDateTime=null,i.programDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkeys=void 0,i.type=void 0,i.loader=null,i.keyLoader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.stats=new H,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.endList=void 0,i.gap=void 0,i.urlId=0,i.type=e,i}c(e,t);var n=e.prototype;return n.setKeyFormat=function(t){if(this.levelkeys){var e=this.levelkeys[t];e&&!this._decryptdata&&(this._decryptdata=e.getDecryptData(this.sn))}},n.abortRequests=function(){var t,e;null==(t=this.loader)||t.abort(),null==(e=this.keyLoader)||e.abort()},n.setElementaryStreamInfo=function(t,e,n,i,r,o){void 0===o&&(o=!1);var a=this.elementaryStreams,s=a[t];s?(s.startPTS=Math.min(s.startPTS,e),s.endPTS=Math.max(s.endPTS,n),s.startDTS=Math.min(s.startDTS,i),s.endDTS=Math.max(s.endDTS,r)):a[t]={startPTS:e,endPTS:n,startDTS:i,endDTS:r,partial:o}},n.clearElementaryStreamInfo=function(){var t=this.elementaryStreams;t[K.AUDIO]=null,t[K.VIDEO]=null,t[K.AUDIOVIDEO]=null},s(e,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{var e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!w(this.programDateTime))return null;var t=w(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){var t;if(null!=(t=this._decryptdata)&&t.encrypted)return!0;if(this.levelkeys){var e=Object.keys(this.levelkeys),n=e.length;if(n>1||1===n&&this.levelkeys[e[0]].encrypted)return!0}return!1}}]),e}(W),Y=function(t){function e(e,n,i,r,o){var a;(a=t.call(this,i)||this).fragOffset=0,a.duration=0,a.gap=!1,a.independent=!1,a.relurl=void 0,a.fragment=void 0,a.index=void 0,a.stats=new H,a.duration=e.decimalFloatingPoint("DURATION"),a.gap=e.bool("GAP"),a.independent=e.bool("INDEPENDENT"),a.relurl=e.enumeratedString("URI"),a.fragment=n,a.index=r;var s=e.enumeratedString("BYTERANGE");return s&&a.setByteRange(s,o),o&&(a.fragOffset=o.fragOffset+o.duration),a}return c(e,t),s(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]),e}(W),z=10,X=function(){function t(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}return t.prototype.reloaded=function(t){if(!t)return this.advanced=!0,void(this.updated=!0);var e=this.lastPartSn-t.lastPartSn,n=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!n||!!e||!this.live,this.advanced=this.endSN>t.endSN||e>0||0===e&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay},s(t,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&w(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||z}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;return t>0?1e3*(this.driftEnd-this.driftStart)/t:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return null!=(t=this.fragments)&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),t}();function J(t){return Uint8Array.from(atob(t),(function(t){return t.charCodeAt(0)}))}function $(t){var e=tt(t).subarray(0,16),n=new Uint8Array(16);return n.set(e,16-e.length),n}function Q(t){var e=function(t,e,n){var i=t[e];t[e]=t[n],t[n]=i};e(t,0,3),e(t,1,2),e(t,4,5),e(t,6,7)}function Z(t){var e=t.split(":"),n=null;if("data"===e[0]&&2===e.length){var i=e[1].split(";"),r=i[i.length-1].split(",");if(2===r.length){var o="base64"===r[0],a=r[1];o?(i.splice(-1,1),n=J(a)):n=$(a)}}return n}function tt(t){return Uint8Array.from(unescape(encodeURIComponent(t)),(function(t){return t.charCodeAt(0)}))}var et="undefined"!=typeof self?self:void 0,nt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},it={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function rt(t){switch(t){case it.FAIRPLAY:return nt.FAIRPLAY;case it.PLAYREADY:return nt.PLAYREADY;case it.WIDEVINE:return nt.WIDEVINE;case it.CLEARKEY:return nt.CLEARKEY}}var ot={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function at(t){if(t===ot.WIDEVINE)return nt.WIDEVINE}function st(t){switch(t){case nt.FAIRPLAY:return it.FAIRPLAY;case nt.PLAYREADY:return it.PLAYREADY;case nt.WIDEVINE:return it.WIDEVINE;case nt.CLEARKEY:return it.CLEARKEY}}function lt(t){var e=t.drmSystems,n=t.widevineLicenseUrl,i=e?[nt.FAIRPLAY,nt.WIDEVINE,nt.PLAYREADY,nt.CLEARKEY].filter((function(t){return!!e[t]})):[];return!i[nt.WIDEVINE]&&n&&i.push(nt.WIDEVINE),i}var ut,ct=null!=et&&null!=(ut=et.navigator)&&ut.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function dt(t,e,n,i){var r;switch(t){case nt.FAIRPLAY:r=["cenc","sinf"];break;case nt.WIDEVINE:case nt.PLAYREADY:r=["cenc"];break;case nt.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+t)}return ht(r,e,n,i)}function ht(t,e,n,i){return[{initDataTypes:t,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map((function(t){return{contentType:'audio/mp4; codecs="'+t+'"',robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null}})),videoCapabilities:n.map((function(t){return{contentType:'video/mp4; codecs="'+t+'"',robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}}))}]}function ft(t,e,n){return Uint8Array.prototype.slice?t.slice(e,n):new Uint8Array(Array.prototype.slice.call(t,e,n))}var pt,gt=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},mt=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},vt=function(t,e){for(var n=e,i=0;gt(t,e);)i+=10,i+=yt(t,e+6),mt(t,e+10)&&(i+=10),e+=i;if(i>0)return t.subarray(n,n+i)},yt=function(t,e){var n=0;return n=(127&t[e])<<21,n|=(127&t[e+1])<<14,n|=(127&t[e+2])<<7,n|=127&t[e+3]},bt=function(t,e){return gt(t,e)&&yt(t,e+6)+10<=t.length-e},Et=function(t){for(var e=St(t),n=0;n<e.length;n++){var i=e[n];if(Tt(i))return Rt(i)}},Tt=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},At=function(t){var e=String.fromCharCode(t[0],t[1],t[2],t[3]),n=yt(t,4),i=10;return{type:e,size:n,data:t.subarray(i,i+n)}},St=function(t){for(var e=0,n=[];gt(t,e);){for(var i=yt(t,e+6),r=(e+=10)+i;e+8<r;){var o=At(t.subarray(e)),a=wt(o);a&&n.push(a),e+=o.size+10}mt(t,e)&&(e+=10)}return n},wt=function(t){return"PRIV"===t.type?Lt(t):"W"===t.type[0]?Dt(t):xt(t)},Lt=function(t){if(!(t.size<2)){var e=_t(t.data,!0),n=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:n.buffer}}},xt=function(t){if(!(t.size<2)){if("TXXX"===t.type){var e=1,n=_t(t.data.subarray(e),!0);e+=n.length+1;var i=_t(t.data.subarray(e));return{key:t.type,info:n,data:i}}var r=_t(t.data.subarray(1));return{key:t.type,data:r}}},Dt=function(t){if("WXXX"===t.type){if(t.size<2)return;var e=1,n=_t(t.data.subarray(e),!0);e+=n.length+1;var i=_t(t.data.subarray(e));return{key:t.type,info:n,data:i}}var r=_t(t.data);return{key:t.type,data:r}},Rt=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),n=1&e[3],i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,n&&(i+=47721858.84),Math.round(i)}},_t=function(t,e){void 0===e&&(e=!1);var n=Ct();if(n){var i=n.decode(t);if(e){var r=i.indexOf("\0");return-1!==r?i.substring(0,r):i}return i.replace(/\0/g,"")}for(var o,a,s,l=t.length,u="",c=0;c<l;){if(0===(o=t[c++])&&e)return u;if(0!==o&&3!==o)switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(o);break;case 12:case 13:a=t[c++],u+=String.fromCharCode((31&o)<<6|63&a);break;case 14:a=t[c++],s=t[c++],u+=String.fromCharCode((15&o)<<12|(63&a)<<6|63&s)}}return u};function Ct(){if(!navigator.userAgent.includes("PlayStation 4"))return pt||void 0===self.TextDecoder||(pt=new self.TextDecoder("utf-8")),pt}var kt={hexDump:function(t){for(var e="",n=0;n<t.length;n++){var i=t[n].toString(16);i.length<2&&(i="0"+i),e+=i}return e}},It=Math.pow(2,32)-1,Ot=[].push,Pt={video:1,audio:2,id3:3,text:4};function Mt(t){return String.fromCharCode.apply(null,t)}function Nt(t,e){var n=t[e]<<8|t[e+1];return n<0?65536+n:n}function Ft(t,e){var n=Ut(t,e);return n<0?4294967296+n:n}function Bt(t,e){var n=Ft(t,e);return n*=Math.pow(2,32),n+=Ft(t,e+4)}function Ut(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}function jt(t,e,n){t[e]=n>>24,t[e+1]=n>>16&255,t[e+2]=n>>8&255,t[e+3]=255&n}function Gt(t){for(var e=t.byteLength,n=0;n<e;){var i=Ft(t,n);if(i>8&&109===t[n+4]&&111===t[n+5]&&111===t[n+6]&&102===t[n+7])return!0;n=i>1?n+i:e}return!1}function Vt(t,e){var n=[];if(!e.length)return n;for(var i=t.byteLength,r=0;r<i;){var o=Ft(t,r),a=o>1?r+o:i;if(Mt(t.subarray(r+4,r+8))===e[0])if(1===e.length)n.push(t.subarray(r+8,a));else{var s=Vt(t.subarray(r+8,a),e.slice(1));s.length&&Ot.apply(n,s)}r=a}return n}function Ht(t){var e=[],n=t[0],i=8,r=Ft(t,i);i+=4;var o=0,a=0;0===n?(o=Ft(t,i),a=Ft(t,i+4),i+=8):(o=Bt(t,i),a=Bt(t,i+8),i+=16),i+=2;var s=t.length+a,l=Nt(t,i);i+=2;for(var u=0;u<l;u++){var c=i,d=Ft(t,c);c+=4;var h=2147483647&d;if(1==(2147483648&d)>>>31)return N.warn("SIDX has hierarchical references (not supported)"),null;var f=Ft(t,c);c+=4,e.push({referenceSize:h,subsegmentDuration:f,info:{duration:f/r,start:s,end:s+h-1}}),s+=h,i=c+=4}return{earliestPresentationTime:o,timescale:r,version:n,referencesCount:l,references:e}}function Kt(t){for(var e=[],n=Vt(t,["moov","trak"]),r=0;r<n.length;r++){var o=n[r],a=Vt(o,["tkhd"])[0];if(a){var s=a[0],l=Ft(a,0===s?12:20),u=Vt(o,["mdia","mdhd"])[0];if(u){var c=Ft(u,0===(s=u[0])?12:20),d=Vt(o,["mdia","hdlr"])[0];if(d){var h=Mt(d.subarray(8,12)),f={soun:K.AUDIO,vide:K.VIDEO}[h];if(f){var p=Wt(Vt(o,["mdia","minf","stbl","stsd"])[0]);e[l]={timescale:c,type:f},e[f]=i({timescale:c,id:l},p)}}}}}return Vt(t,["moov","mvex","trex"]).forEach((function(t){var n=Ft(t,4),i=e[n];i&&(i.default={duration:Ft(t,12),flags:Ft(t,20)})})),e}function Wt(t){var e=t.subarray(8),n=e.subarray(86),i=Mt(e.subarray(4,8)),r=i,o="enca"===i||"encv"===i;if(o){var a=Vt(e,[i])[0];Vt(a.subarray("enca"===i?28:78),["sinf"]).forEach((function(t){var e=Vt(t,["schm"])[0];if(e){var n=Mt(e.subarray(4,8));if("cbcs"===n||"cenc"===n){var i=Vt(t,["frma"])[0];i&&(r=Mt(i))}}}))}switch(r){case"avc1":case"avc2":case"avc3":case"avc4":var s=Vt(n,["avcC"])[0];r+="."+Yt(s[1])+Yt(s[2])+Yt(s[3]);break;case"mp4a":var l=Vt(e,[i])[0],u=Vt(l.subarray(28),["esds"])[0];if(u&&u.length>12){var c=4;if(3!==u[c++])break;c=qt(u,c),c+=2;var d=u[c++];if(128&d&&(c+=2),64&d&&(c+=u[c++]),4!==u[c++])break;c=qt(u,c);var h=u[c++];if(64!==h)break;if(r+="."+Yt(h),c+=12,5!==u[c++])break;c=qt(u,c);var f=u[c++],p=(248&f)>>3;31===p&&(p+=1+((7&f)<<3)+((224&u[c])>>5)),r+="."+p}break;case"hvc1":case"hev1":var g=Vt(n,["hvcC"])[0],m=g[1],v=["","A","B","C"][m>>6],y=31&m,b=Ft(g,2),E=(32&m)>>5?"H":"L",T=g[12],A=g.subarray(6,12);r+="."+v+y,r+="."+b.toString(16).toUpperCase(),r+="."+E+T;for(var S="",w=A.length;w--;){var L=A[w];(L||S)&&(S="."+L.toString(16).toUpperCase()+S)}r+=S;break;case"dvh1":case"dvhe":var x=Vt(n,["dvcC"])[0],D=x[2]>>1&127,R=x[2]<<5&32|x[3]>>3&31;r+="."+zt(D)+"."+zt(R);break;case"vp09":var _=Vt(n,["vpcC"])[0],C=_[4],k=_[5],I=_[6]>>4&15;r+="."+zt(C)+"."+zt(k)+"."+zt(I);break;case"av01":var O=Vt(n,["av1C"])[0],P=O[1]>>>5,M=31&O[1],N=O[2]>>>7?"H":"M",F=(64&O[2])>>6,B=(32&O[2])>>5,U=2===P&&F?B?12:10:F?10:8,j=(16&O[2])>>4,G=(8&O[2])>>3,V=(4&O[2])>>2,H=3&O[2],K=1,W=1,q=1,Y=0;r+="."+P+"."+zt(M)+N+"."+zt(U)+"."+j+"."+G+V+H+"."+zt(K)+"."+zt(W)+"."+zt(q)+"."+Y}return{codec:r,encrypted:o}}function qt(t,e){for(var n=e+5;128&t[e++]&&e<n;);return e}function Yt(t){return("0"+t.toString(16).toUpperCase()).slice(-2)}function zt(t){return(t<10?"0":"")+t}function Xt(t,e){if(!t||!e)return t;var n=e.keyId;return n&&e.isCommonEncryption&&Vt(t,["moov","trak"]).forEach((function(t){var e=Vt(t,["mdia","minf","stbl","stsd"])[0].subarray(8),i=Vt(e,["enca"]),r=i.length>0;r||(i=Vt(e,["encv"])),i.forEach((function(t){Vt(r?t.subarray(28):t.subarray(78),["sinf"]).forEach((function(t){var e=Jt(t);if(e){var i=e.subarray(8,24);i.some((function(t){return 0!==t}))||(N.log("[eme] Patching keyId in 'enc"+(r?"a":"v")+">sinf>>tenc' box: "+kt.hexDump(i)+" -> "+kt.hexDump(n)),e.set(n,8))}}))}))})),t}function Jt(t){var e=Vt(t,["schm"])[0];if(e){var n=Mt(e.subarray(4,8));if("cbcs"===n||"cenc"===n)return Vt(t,["schi","tenc"])[0]}return N.error("[eme] missing 'schm' box"),null}function $t(t,e){return Vt(e,["moof","traf"]).reduce((function(e,n){var i=Vt(n,["tfdt"])[0],r=i[0],o=Vt(n,["tfhd"]).reduce((function(e,n){var o=Ft(n,4),a=t[o];if(a){var s=Ft(i,4);if(1===r){if(s===It)return N.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),e;s*=It+1,s+=Ft(i,8)}var l=s/(a.timescale||9e4);if(w(l)&&(null===e||l<e))return l}return e}),null);return null!==o&&w(o)&&(null===e||o<e)?o:e}),null)}function Qt(t,e){for(var n=0,i=0,r=0,o=Vt(t,["moof","traf"]),a=0;a<o.length;a++){var s=o[a],l=Vt(s,["tfhd"])[0],u=e[Ft(l,4)];if(u){var c=u.default,d=Ft(l,0)|(null==c?void 0:c.flags),h=null==c?void 0:c.duration;8&d&&(h=Ft(l,2&d?12:8));for(var f=u.timescale||9e4,p=Vt(s,["trun"]),g=0;g<p.length;g++)!(n=Zt(p[g]))&&h&&(n=h*Ft(p[g],4)),u.type===K.VIDEO?i+=n/f:u.type===K.AUDIO&&(r+=n/f)}}if(0===i&&0===r){for(var m=1/0,v=0,y=0,b=Vt(t,["sidx"]),E=0;E<b.length;E++){var T=Ht(b[E]);if(null!=T&&T.references){m=Math.min(m,T.earliestPresentationTime/T.timescale);var A=T.references.reduce((function(t,e){return t+e.info.duration||0}),0);y=(v=Math.max(v,A+T.earliestPresentationTime/T.timescale))-m}}if(y&&w(y))return y}return i||r}function Zt(t){var e=Ft(t,0),n=8;1&e&&(n+=4),4&e&&(n+=4);for(var i=0,r=Ft(t,4),o=0;o<r;o++)256&e&&(i+=Ft(t,n),n+=4),512&e&&(n+=4),1024&e&&(n+=4),2048&e&&(n+=4);return i}function te(t,e,n){Vt(e,["moof","traf"]).forEach((function(e){Vt(e,["tfhd"]).forEach((function(i){var r=Ft(i,4),o=t[r];if(o){var a=o.timescale||9e4;Vt(e,["tfdt"]).forEach((function(t){var e=t[0],i=n*a;if(i){var r=Ft(t,4);if(0===e)r-=i,jt(t,4,r=Math.max(r,0));else{r*=Math.pow(2,32),r+=Ft(t,8),r-=i,r=Math.max(r,0);var o=Math.floor(r/(It+1)),s=Math.floor(r%(It+1));jt(t,4,o),jt(t,8,s)}}}))}}))}))}function ee(t){var e={valid:null,remainder:null},n=Vt(t,["moof"]);if(n.length<2)return e.remainder=t,e;var i=n[n.length-1];return e.valid=ft(t,0,i.byteOffset-8),e.remainder=ft(t,i.byteOffset-8),e}function ne(t,e){var n=new Uint8Array(t.length+e.length);return n.set(t),n.set(e,t.length),n}function ie(t,e){var n=[],i=e.samples,r=e.timescale,o=e.id,a=!1;return Vt(i,["moof"]).map((function(s){var l=s.byteOffset-8;Vt(s,["traf"]).map((function(s){var u=Vt(s,["tfdt"]).map((function(t){var e=t[0],n=Ft(t,4);return 1===e&&(n*=Math.pow(2,32),n+=Ft(t,8)),n/r}))[0];return void 0!==u&&(t=u),Vt(s,["tfhd"]).map((function(u){var c=Ft(u,4),d=16777215&Ft(u,0),h=0,f=!!(16&d),p=0,g=!!(32&d),m=8;c===o&&(!!(1&d)&&(m+=8),!!(2&d)&&(m+=4),!!(8&d)&&(h=Ft(u,m),m+=4),f&&(p=Ft(u,m),m+=4),g&&(m+=4),"video"===e.type&&(a=re(e.codec)),Vt(s,["trun"]).map((function(o){var s=o[0],u=16777215&Ft(o,0),c=!!(1&u),d=0,f=!!(4&u),g=!!(256&u),m=0,v=!!(512&u),y=0,b=!!(1024&u),E=!!(2048&u),T=0,A=Ft(o,4),S=8;c&&(d=Ft(o,S),S+=4),f&&(S+=4);for(var w=d+l,L=0;L<A;L++){if(g?(m=Ft(o,S),S+=4):m=h,v?(y=Ft(o,S),S+=4):y=p,b&&(S+=4),E&&(T=0===s?Ft(o,S):Ut(o,S),S+=4),e.type===K.VIDEO)for(var x=0;x<y;){var D=Ft(i,w);oe(a,i[w+=4])&&ae(i.subarray(w,w+D),a?2:1,t+T/r,n),w+=D,x+=D+4}t+=m/r}})))}))}))})),n}function re(t){if(!t)return!1;var e=t.indexOf("."),n=e<0?t:t.substring(0,e);return"hvc1"===n||"hev1"===n||"dvh1"===n||"dvhe"===n}function oe(t,e){if(t){var n=e>>1&63;return 39===n||40===n}return 6==(31&e)}function ae(t,e,n,i){var r=se(t),o=0;o+=e;for(var a=0,s=0,l=0;o<r.length;){a=0;do{if(o>=r.length)break;a+=l=r[o++]}while(255===l);s=0;do{if(o>=r.length)break;s+=l=r[o++]}while(255===l);var u=r.length-o,c=o;if(s<u)o+=s;else if(s>u){N.error("Malformed SEI payload. "+s+" is too small, only "+u+" bytes left to parse.");break}if(4===a){if(181===r[c++]){var d=Nt(r,c);if(c+=2,49===d){var h=Ft(r,c);if(c+=4,1195456820===h){var f=r[c++];if(3===f){var p=r[c++],g=64&p,m=g?2+3*(31&p):0,v=new Uint8Array(m);if(g){v[0]=p;for(var y=1;y<m;y++)v[y]=r[c++]}i.push({type:f,payloadType:a,pts:n,bytes:v})}}}}}else if(5===a&&s>16){for(var b=[],E=0;E<16;E++){var T=r[c++].toString(16);b.push(1==T.length?"0"+T:T),3!==E&&5!==E&&7!==E&&9!==E||b.push("-")}for(var A=s-16,S=new Uint8Array(A),w=0;w<A;w++)S[w]=r[c++];i.push({payloadType:a,pts:n,uuid:b.join(""),userData:_t(S),userDataBytes:S})}}}function se(t){for(var e=t.byteLength,n=[],i=1;i<e-2;)0===t[i]&&0===t[i+1]&&3===t[i+2]?(n.push(i+2),i+=2):i++;if(0===n.length)return t;var r=e-n.length,o=new Uint8Array(r),a=0;for(i=0;i<r;a++,i++)a===n[0]&&(a++,n.shift()),o[i]=t[a];return o}function le(t){var e=t[0],n="",i="",r=0,o=0,a=0,s=0,l=0,u=0;if(0===e){for(;"\0"!==Mt(t.subarray(u,u+1));)n+=Mt(t.subarray(u,u+1)),u+=1;for(n+=Mt(t.subarray(u,u+1)),u+=1;"\0"!==Mt(t.subarray(u,u+1));)i+=Mt(t.subarray(u,u+1)),u+=1;i+=Mt(t.subarray(u,u+1)),u+=1,r=Ft(t,12),o=Ft(t,16),s=Ft(t,20),l=Ft(t,24),u=28}else if(1===e){r=Ft(t,u+=4);var c=Ft(t,u+=4),d=Ft(t,u+=4);for(u+=4,a=Math.pow(2,32)*c+d,L(a)||(a=Number.MAX_SAFE_INTEGER,N.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),s=Ft(t,u),l=Ft(t,u+=4),u+=4;"\0"!==Mt(t.subarray(u,u+1));)n+=Mt(t.subarray(u,u+1)),u+=1;for(n+=Mt(t.subarray(u,u+1)),u+=1;"\0"!==Mt(t.subarray(u,u+1));)i+=Mt(t.subarray(u,u+1)),u+=1;i+=Mt(t.subarray(u,u+1)),u+=1}return{schemeIdUri:n,value:i,timeScale:r,presentationTime:a,presentationTimeDelta:o,eventDuration:s,id:l,payload:t.subarray(u,t.byteLength)}}function ue(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(var r=n.length,o=8,a=r;a--;)o+=n[a].byteLength;var s=new Uint8Array(o);for(s[0]=o>>24&255,s[1]=o>>16&255,s[2]=o>>8&255,s[3]=255&o,s.set(t,4),a=0,o=8;a<r;a++)s.set(n[a],o),o+=n[a].byteLength;return s}function ce(t,e,n){if(16!==t.byteLength)throw new RangeError("Invalid system id");var i,r,o;if(e){i=1,r=new Uint8Array(16*e.length);for(var a=0;a<e.length;a++){var s=e[a];if(16!==s.byteLength)throw new RangeError("Invalid key");r.set(s,16*a)}}else i=0,r=new Uint8Array;i>0?(o=new Uint8Array(4),e.length>0&&new DataView(o.buffer).setUint32(0,e.length,!1)):o=new Uint8Array;var l=new Uint8Array(4);return n&&n.byteLength>0&&new DataView(l.buffer).setUint32(0,n.byteLength,!1),ue([112,115,115,104],new Uint8Array([i,0,0,0]),t,o,r,l,n||new Uint8Array)}function de(t){if(!(t instanceof ArrayBuffer)||t.byteLength<32)return null;var e={version:0,systemId:"",kids:null,data:null},n=new DataView(t),i=n.getUint32(0);if(t.byteLength!==i&&i>44)return null;if(1886614376!==n.getUint32(4))return null;if(e.version=n.getUint32(8)>>>24,e.version>1)return null;e.systemId=kt.hexDump(new Uint8Array(t,12,16));var r=n.getUint32(28);if(0===e.version){if(i-32<r)return null;e.data=new Uint8Array(t,32,r)}else if(1===e.version){e.kids=[];for(var o=0;o<r;o++)e.kids.push(new Uint8Array(t,32+16*o,16))}return e}var he={},fe=function(){function t(t,e,n,i,r){void 0===i&&(i=[1]),void 0===r&&(r=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=e,this.keyFormat=n,this.keyFormatVersions=i,this.iv=r,this.encrypted=!!t&&"NONE"!==t,this.isCommonEncryption=this.encrypted&&"AES-128"!==t}t.clearKeyUriToKeyIdMap=function(){he={}};var e=t.prototype;return e.isSupported=function(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case it.FAIRPLAY:case it.WIDEVINE:case it.PLAYREADY:case it.CLEARKEY:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1},e.getDecryptData=function(e){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof e&&("AES-128"!==this.method||this.iv||N.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),e=0);var n=pe(e);return new t(this.method,this.uri,"identity",this.keyFormatVersions,n)}var i=Z(this.uri);if(i)switch(this.keyFormat){case it.WIDEVINE:this.pssh=i,i.length>=22&&(this.keyId=i.subarray(i.length-22,i.length-6));break;case it.PLAYREADY:var r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=ce(r,null,i);var o=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),a=String.fromCharCode.apply(null,Array.from(o)),s=a.substring(a.indexOf("<"),a.length),l=(new DOMParser).parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(l){var u=l.childNodes[0]?l.childNodes[0].nodeValue:l.getAttribute("VALUE");if(u){var c=J(u).subarray(0,16);Q(c),this.keyId=c}}break;default:var d=i.subarray(0,16);if(16!==d.length){var h=new Uint8Array(16);h.set(d,16-d.length),d=h}this.keyId=d}if(!this.keyId||16!==this.keyId.byteLength){var f=he[this.uri];if(!f){var p=Object.keys(he).length%Number.MAX_SAFE_INTEGER;f=new Uint8Array(16),new DataView(f.buffer,12,4).setUint32(0,p),he[this.uri]=f}this.keyId=f}return this},t}();function pe(t){for(var e=new Uint8Array(16),n=12;n<16;n++)e[n]=t>>8*(15-n)&255;return e}var ge=/\{\$([a-zA-Z0-9-_]+)\}/g;function me(t){return ge.test(t)}function ve(t,e,n){if(null!==t.variableList||t.hasVariableRefs)for(var i=n.length;i--;){var r=n[i],o=e[r];o&&(e[r]=ye(t,o))}}function ye(t,e){if(null!==t.variableList||t.hasVariableRefs){var n=t.variableList;return e.replace(ge,(function(e){var i=e.substring(2,e.length-1),r=null==n?void 0:n[i];return void 0===r?(t.playlistParsingError||(t.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'+i+'"')),e):r}))}return e}function be(t,e,n){var i,r,o=t.variableList;if(o||(t.variableList=o={}),"QUERYPARAM"in e){i=e.QUERYPARAM;try{var a=new self.URL(n).searchParams;if(!a.has(i))throw new Error('"'+i+'" does not match any query parameter in URI: "'+n+'"');r=a.get(i)}catch(e){t.playlistParsingError||(t.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: "+e.message))}}else i=e.NAME,r=e.VALUE;i in o?t.playlistParsingError||(t.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'+i+'"')):o[i]=r||""}function Ee(t,e,n){var i=e.IMPORT;if(n&&i in n){var r=t.variableList;r||(t.variableList=r={}),r[i]=n[i]}else t.playlistParsingError||(t.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'+i+'"'))}function Te(t){if(void 0===t&&(t=!0),"undefined"!=typeof self)return(t||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function Ae(t){return"undefined"!=typeof self&&t===self.ManagedMediaSource}var Se={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function we(t,e){var n=Se[e];return!!n&&!!n[t.slice(0,4)]}function Le(t,e,n){return void 0===n&&(n=!0),!t.split(",").some((function(t){return!xe(t,e,n)}))}function xe(t,e,n){var i;void 0===n&&(n=!0);var r=Te(n);return null!=(i=null==r?void 0:r.isTypeSupported(De(t,e)))&&i}function De(t,e){return e+'/mp4;codecs="'+t+'"'}function Re(t){if(t){var e=t.substring(0,4);return Se.video[e]}return 2}function _e(t){return t.split(",").reduce((function(t,e){var n=Se.video[e];return n?(2*n+t)/(t?3:2):(Se.audio[e]+t)/(t?2:1)}),0)}var Ce={};function ke(t,e){if(void 0===e&&(e=!0),Ce[t])return Ce[t];for(var n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[t],i=0;i<n.length;i++)if(xe(n[i],"audio",e))return Ce[t]=n[i],n[i];return t}var Ie=/flac|opus/i;function Oe(t,e){return void 0===e&&(e=!0),t.replace(Ie,(function(t){return ke(t.toLowerCase(),e)}))}function Pe(t,e){return t&&"mp4a"!==t?t:e?e.split(",")[0]:e}function Me(t){for(var e=t.split(","),n=0;n<e.length;n++){var i=e[n].split(".");if(i.length>2){var r=i.shift()+".";r+=parseInt(i.shift()).toString(16),r+=("000"+parseInt(i.shift()).toString(16)).slice(-4),e[n]=r}}return e.join(",")}var Ne=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Fe=/#EXT-X-MEDIA:(.*)/g,Be=/^#EXT(?:INF|-X-TARGETDURATION):/m,Ue=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),je=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Ge=function(){function t(){}return t.findGroup=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(i.id===e)return i}},t.resolve=function(t,e){return S.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},t.isMediaPlaylist=function(t){return Be.test(t)},t.parseMasterPlaylist=function(e,n){var i,r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:me(e)},o=[];for(Ne.lastIndex=0;null!=(i=Ne.exec(e));)if(i[1]){var a,s=new U(i[1]);ve(r,s,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);var l=ye(r,i[2]),u={attrs:s,bitrate:s.decimalInteger("BANDWIDTH")||s.decimalInteger("AVERAGE-BANDWIDTH"),name:s.NAME,url:t.resolve(l,n)},c=s.decimalResolution("RESOLUTION");c&&(u.width=c.width,u.height=c.height),Ke(s.CODECS,u),null!=(a=u.unknownCodecs)&&a.length||o.push(u),r.levels.push(u)}else if(i[3]){var d=i[3],h=i[4];switch(d){case"SESSION-DATA":var f=new U(h);ve(r,f,["DATA-ID","LANGUAGE","VALUE","URI"]);var p=f["DATA-ID"];p&&(null===r.sessionData&&(r.sessionData={}),r.sessionData[p]=f);break;case"SESSION-KEY":var g=Ve(h,n,r);g.encrypted&&g.isSupported()?(null===r.sessionKeys&&(r.sessionKeys=[]),r.sessionKeys.push(g)):N.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+h+'"');break;case"DEFINE":var m=new U(h);ve(r,m,["NAME","VALUE","QUERYPARAM"]),be(r,m,n);break;case"CONTENT-STEERING":var v=new U(h);ve(r,v,["SERVER-URI","PATHWAY-ID"]),r.contentSteering={uri:t.resolve(v["SERVER-URI"],n),pathwayId:v["PATHWAY-ID"]||"."};break;case"START":r.startTimeOffset=He(h)}}var y=o.length>0&&o.length<r.levels.length;return r.levels=y?o:r.levels,0===r.levels.length&&(r.playlistParsingError=new Error("no levels found in manifest")),r},t.parseMasterPlaylistMedia=function(e,n,i){var r,o={},a=i.levels,s={AUDIO:a.map((function(t){return{id:t.attrs.AUDIO,audioCodec:t.audioCodec}})),SUBTITLES:a.map((function(t){return{id:t.attrs.SUBTITLES,textCodec:t.textCodec}})),"CLOSED-CAPTIONS":[]},l=0;for(Fe.lastIndex=0;null!==(r=Fe.exec(e));){var u=new U(r[1]),c=u.TYPE;if(c){var d=s[c],h=o[c]||[];o[c]=h,ve(i,u,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);var f=u.LANGUAGE,p=u["ASSOC-LANGUAGE"],g=u.CHANNELS,m=u.CHARACTERISTICS,v=u["INSTREAM-ID"],y={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||f||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:f,url:u.URI?t.resolve(u.URI,n):""};if(p&&(y.assocLang=p),g&&(y.channels=g),m&&(y.characteristics=m),v&&(y.instreamId=v),null!=d&&d.length){var b=t.findGroup(d,y.groupId)||d[0];We(y,b,"audioCodec"),We(y,b,"textCodec")}h.push(y)}}return o},t.parseLevelPlaylist=function(t,e,n,i,r,o){var a,s,l,c=new X(e),d=c.fragments,h=null,f=0,p=0,g=0,m=0,v=null,y=new q(i,e),b=-1,E=!1,T=null;for(Ue.lastIndex=0,c.m3u8=t,c.hasVariableRefs=me(t);null!==(a=Ue.exec(t));){E&&(E=!1,(y=new q(i,e)).start=g,y.sn=f,y.cc=m,y.level=n,h&&(y.initSegment=h,y.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null,T&&(y.setByteRange(T),T=null)));var A=a[1];if(A){y.duration=parseFloat(A);var S=(" "+a[2]).slice(1);y.title=S||null,y.tagList.push(S?["INF",A,S]:["INF",A])}else if(a[3]){if(w(y.duration)){y.start=g,l&&Xe(y,l,c),y.sn=f,y.level=n,y.cc=m,d.push(y);var L=(" "+a[3]).slice(1);y.relurl=ye(c,L),Ye(y,v),v=y,g+=y.duration,f++,p=0,E=!0}}else if(a[4]){var x=(" "+a[4]).slice(1);v?y.setByteRange(x,v):y.setByteRange(x)}else if(a[5])y.rawProgramDateTime=(" "+a[5]).slice(1),y.tagList.push(["PROGRAM-DATE-TIME",y.rawProgramDateTime]),-1===b&&(b=d.length);else{if(!(a=a[0].match(je))){N.warn("No matches on slow regex match for level playlist!");continue}for(s=1;s<a.length&&void 0===a[s];s++);var D=(" "+a[s]).slice(1),R=(" "+a[s+1]).slice(1),_=a[s+2]?(" "+a[s+2]).slice(1):"";switch(D){case"PLAYLIST-TYPE":c.type=R.toUpperCase();break;case"MEDIA-SEQUENCE":f=c.startSN=parseInt(R);break;case"SKIP":var C=new U(R);ve(c,C,["RECENTLY-REMOVED-DATERANGES"]);var k=C.decimalInteger("SKIPPED-SEGMENTS");if(w(k)){c.skippedSegments=k;for(var I=k;I--;)d.unshift(null);f+=k}var O=C.enumeratedString("RECENTLY-REMOVED-DATERANGES");O&&(c.recentlyRemovedDateranges=O.split("\t"));break;case"TARGETDURATION":c.targetduration=Math.max(parseInt(R),1);break;case"VERSION":c.version=parseInt(R);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":c.live=!1;break;case"#":(R||_)&&y.tagList.push(_?[R,_]:[R]);break;case"DISCONTINUITY":m++,y.tagList.push(["DIS"]);break;case"GAP":y.gap=!0,y.tagList.push([D]);break;case"BITRATE":y.tagList.push([D,R]);break;case"DATERANGE":var P=new U(R);ve(c,P,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),ve(c,P,P.clientAttrs);var M=new V(P,c.dateRanges[P.ID]);M.isValid||c.skippedSegments?c.dateRanges[M.id]=M:N.warn('Ignoring invalid DATERANGE tag: "'+R+'"'),y.tagList.push(["EXT-X-DATERANGE",R]);break;case"DEFINE":var F=new U(R);ve(c,F,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in F?Ee(c,F,o):be(c,F,e);break;case"DISCONTINUITY-SEQUENCE":m=parseInt(R);break;case"KEY":var B=Ve(R,e,c);if(B.isSupported()){if("NONE"===B.method){l=void 0;break}l||(l={}),l[B.keyFormat]&&(l=u({},l)),l[B.keyFormat]=B}else N.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+R+'"');break;case"START":c.startTimeOffset=He(R);break;case"MAP":var j=new U(R);if(ve(c,j,["BYTERANGE","URI"]),y.duration){var G=new q(i,e);ze(G,j,n,l),h=G,y.initSegment=h,h.rawProgramDateTime&&!y.rawProgramDateTime&&(y.rawProgramDateTime=h.rawProgramDateTime)}else{var H=y.byteRangeEndOffset;if(H){var K=y.byteRangeStartOffset;T=H-K+"@"+K}else T=null;ze(y,j,n,l),h=y,E=!0}break;case"SERVER-CONTROL":var W=new U(R);c.canBlockReload=W.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=W.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&W.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=W.optionalFloat("PART-HOLD-BACK",0),c.holdBack=W.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var z=new U(R);c.partTarget=z.decimalFloatingPoint("PART-TARGET");break;case"PART":var J=c.partList;J||(J=c.partList=[]);var $=p>0?J[J.length-1]:void 0,Q=p++,Z=new U(R);ve(c,Z,["BYTERANGE","URI"]);var tt=new Y(Z,y,e,Q,$);J.push(tt),y.duration+=tt.duration;break;case"PRELOAD-HINT":var et=new U(R);ve(c,et,["URI"]),c.preloadHint=et;break;case"RENDITION-REPORT":var nt=new U(R);ve(c,nt,["URI"]),c.renditionReports=c.renditionReports||[],c.renditionReports.push(nt);break;default:N.warn("line parsed but not handled: "+a)}}}v&&!v.relurl?(d.pop(),g-=v.duration,c.partList&&(c.fragmentHint=v)):c.partList&&(Ye(y,v),y.cc=m,c.fragmentHint=y,l&&Xe(y,l,c));var it=d.length,rt=d[0],ot=d[it-1];if((g+=c.skippedSegments*c.targetduration)>0&&it&&ot){c.averagetargetduration=g/it;var at=ot.sn;c.endSN="initSegment"!==at?at:0,c.live||(ot.endList=!0),rt&&(c.startCC=rt.cc)}else c.endSN=0,c.startCC=0;return c.fragmentHint&&(g+=c.fragmentHint.duration),c.totalduration=g,c.endCC=m,b>0&&qe(d,b),c},t}();function Ve(t,e,n){var i,r,o=new U(t);ve(n,o,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);var a=null!=(i=o.METHOD)?i:"",s=o.URI,l=o.hexadecimalInteger("IV"),u=o.KEYFORMATVERSIONS,c=null!=(r=o.KEYFORMAT)?r:"identity";s&&o.IV&&!l&&N.error("Invalid IV: "+o.IV);var d=s?Ge.resolve(s,e):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new fe(a,d,c,h,l)}function He(t){var e=new U(t).decimalFloatingPoint("TIME-OFFSET");return w(e)?e:null}function Ke(t,e){var n=(t||"").split(/[ ,]+/).filter((function(t){return t}));["video","audio","text"].forEach((function(t){var i=n.filter((function(e){return we(e,t)}));i.length&&(e[t+"Codec"]=i.join(","),n=n.filter((function(t){return-1===i.indexOf(t)})))})),e.unknownCodecs=n}function We(t,e,n){var i=e[n];i&&(t[n]=i)}function qe(t,e){for(var n=t[e],i=e;i--;){var r=t[i];if(!r)return;r.programDateTime=n.programDateTime-1e3*r.duration,n=r}}function Ye(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):null!=e&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime),w(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}function ze(t,e,n,i){t.relurl=e.URI,e.BYTERANGE&&t.setByteRange(e.BYTERANGE),t.level=n,t.sn="initSegment",i&&(t.levelkeys=i),t.initSegment=null}function Xe(t,e,n){t.levelkeys=e;var i=n.encryptedFragments;i.length&&i[i.length-1].levelkeys===e||!Object.keys(e).some((function(t){return e[t].isCommonEncryption}))||i.push(t)}var Je={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},$e={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function Qe(t){switch(t.type){case Je.AUDIO_TRACK:return $e.AUDIO;case Je.SUBTITLE_TRACK:return $e.SUBTITLE;default:return $e.MAIN}}function Ze(t,e){var n=t.url;return void 0!==n&&0!==n.indexOf("data:")||(n=e.url),n}var tn=function(){function t(t){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=t,this.registerListeners()}var e=t.prototype;return e.startLoad=function(t){},e.stopLoad=function(){this.destroyInternalLoaders()},e.registerListeners=function(){var t=this.hls;t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.LEVEL_LOADING,this.onLevelLoading,this),t.on(D.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(D.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},e.unregisterListeners=function(){var t=this.hls;t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.LEVEL_LOADING,this.onLevelLoading,this),t.off(D.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(D.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},e.createInternalLoader=function(t){var e=this.hls.config,n=e.pLoader,i=e.loader,r=new(n||i)(e);return this.loaders[t.type]=r,r},e.getInternalLoader=function(t){return this.loaders[t.type]},e.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},e.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},e.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},e.onManifestLoading=function(t,e){var n=e.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Je.MANIFEST,url:n,deliveryDirectives:null})},e.onLevelLoading=function(t,e){var n=e.id,i=e.level,r=e.pathwayId,o=e.url,a=e.deliveryDirectives;this.load({id:n,level:i,pathwayId:r,responseType:"text",type:Je.LEVEL,url:o,deliveryDirectives:a})},e.onAudioTrackLoading=function(t,e){var n=e.id,i=e.groupId,r=e.url,o=e.deliveryDirectives;this.load({id:n,groupId:i,level:null,responseType:"text",type:Je.AUDIO_TRACK,url:r,deliveryDirectives:o})},e.onSubtitleTrackLoading=function(t,e){var n=e.id,i=e.groupId,r=e.url,o=e.deliveryDirectives;this.load({id:n,groupId:i,level:null,responseType:"text",type:Je.SUBTITLE_TRACK,url:r,deliveryDirectives:o})},e.load=function(t){var e,n,i,r=this,o=this.hls.config,a=this.getInternalLoader(t);if(a){var s=a.context;if(s&&s.url===t.url&&s.level===t.level)return void N.trace("[playlist-loader]: playlist request ongoing");N.log("[playlist-loader]: aborting previous loader for type: "+t.type),a.abort()}if(n=t.type===Je.MANIFEST?o.manifestLoadPolicy.default:u({},o.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),a=this.createInternalLoader(t),w(null==(e=t.deliveryDirectives)?void 0:e.part)&&(t.type===Je.LEVEL&&null!==t.level?i=this.hls.levels[t.level].details:t.type===Je.AUDIO_TRACK&&null!==t.id?i=this.hls.audioTracks[t.id].details:t.type===Je.SUBTITLE_TRACK&&null!==t.id&&(i=this.hls.subtitleTracks[t.id].details),i)){var l=i.partTarget,c=i.targetduration;if(l&&c){var d=1e3*Math.max(3*l,.8*c);n=u({},n,{maxTimeToFirstByteMs:Math.min(d,n.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(d,n.maxTimeToFirstByteMs)})}}var h=n.errorRetry||n.timeoutRetry||{},f={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:h.maxNumRetry||0,retryDelay:h.retryDelayMs||0,maxRetryDelay:h.maxRetryDelayMs||0},p={onSuccess:function(t,e,n,i){var o=r.getInternalLoader(n);r.resetInternalLoader(n.type);var a=t.data;0===a.indexOf("#EXTM3U")?(e.parsing.start=performance.now(),Ge.isMediaPlaylist(a)?r.handleTrackOrLevelPlaylist(t,e,n,i||null,o):r.handleMasterPlaylist(t,e,n,i)):r.handleManifestParsingError(t,n,new Error("no EXTM3U delimiter"),i||null,e)},onError:function(t,e,n,i){r.handleNetworkError(e,n,!1,t,i)},onTimeout:function(t,e,n){r.handleNetworkError(e,n,!0,void 0,t)}};a.load(t,f,p)},e.handleMasterPlaylist=function(t,e,n,i){var r=this.hls,o=t.data,a=Ze(t,n),s=Ge.parseMasterPlaylist(o,a);if(s.playlistParsingError)this.handleManifestParsingError(t,n,s.playlistParsingError,i,e);else{var l=s.contentSteering,u=s.levels,c=s.sessionData,d=s.sessionKeys,h=s.startTimeOffset,f=s.variableList;this.variableList=f;var p=Ge.parseMasterPlaylistMedia(o,a,s),g=p.AUDIO,m=void 0===g?[]:g,v=p.SUBTITLES,y=p["CLOSED-CAPTIONS"];m.length&&(m.some((function(t){return!t.url}))||!u[0].audioCodec||u[0].attrs.AUDIO||(N.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new U({}),bitrate:0,url:""}))),r.trigger(D.MANIFEST_LOADED,{levels:u,audioTracks:m,subtitles:v,captions:y,contentSteering:l,url:a,stats:e,networkDetails:i,sessionData:c,sessionKeys:d,startTimeOffset:h,variableList:f})}},e.handleTrackOrLevelPlaylist=function(t,e,n,i,r){var o=this.hls,a=n.id,s=n.level,l=n.type,u=Ze(t,n),c=0,d=w(s)?s:w(a)?a:0,h=Qe(n),f=Ge.parseLevelPlaylist(t.data,u,d,h,c,this.variableList);if(l===Je.MANIFEST){var p={attrs:new U({}),bitrate:0,details:f,name:"",url:u};o.trigger(D.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:u,stats:e,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),n.levelDetails=f,this.handlePlaylistLoaded(f,t,e,n,i,r)},e.handleManifestParsingError=function(t,e,n,i,r){this.hls.trigger(D.ERROR,{type:R.NETWORK_ERROR,details:_.MANIFEST_PARSING_ERROR,fatal:e.type===Je.MANIFEST,url:t.url,err:n,error:n,reason:n.message,response:t,context:e,networkDetails:i,stats:r})},e.handleNetworkError=function(t,e,n,r,o){void 0===n&&(n=!1);var a="A network "+(n?"timeout":"error"+(r?" (status "+r.code+")":""))+" occurred while loading "+t.type;t.type===Je.LEVEL?a+=": "+t.level+" id: "+t.id:t.type!==Je.AUDIO_TRACK&&t.type!==Je.SUBTITLE_TRACK||(a+=" id: "+t.id+' group-id: "'+t.groupId+'"');var s=new Error(a);N.warn("[playlist-loader]: "+a);var l=_.UNKNOWN,u=!1,c=this.getInternalLoader(t);switch(t.type){case Je.MANIFEST:l=n?_.MANIFEST_LOAD_TIMEOUT:_.MANIFEST_LOAD_ERROR,u=!0;break;case Je.LEVEL:l=n?_.LEVEL_LOAD_TIMEOUT:_.LEVEL_LOAD_ERROR,u=!1;break;case Je.AUDIO_TRACK:l=n?_.AUDIO_TRACK_LOAD_TIMEOUT:_.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case Je.SUBTITLE_TRACK:l=n?_.SUBTITLE_TRACK_LOAD_TIMEOUT:_.SUBTITLE_LOAD_ERROR,u=!1}c&&this.resetInternalLoader(t.type);var d={type:R.NETWORK_ERROR,details:l,fatal:u,url:t.url,loader:c,context:t,error:s,networkDetails:e,stats:o};if(r){var h=(null==e?void 0:e.url)||t.url;d.response=i({url:h,data:void 0},r)}this.hls.trigger(D.ERROR,d)},e.handlePlaylistLoaded=function(t,e,n,i,r,o){var a=this.hls,s=i.type,l=i.level,u=i.id,c=i.groupId,d=i.deliveryDirectives,h=Ze(e,i),f=Qe(i),p="number"==typeof i.level&&f===$e.MAIN?l:void 0;if(t.fragments.length){t.targetduration||(t.playlistParsingError=new Error("Missing Target Duration"));var g=t.playlistParsingError;if(g)a.trigger(D.ERROR,{type:R.NETWORK_ERROR,details:_.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:g,reason:g.message,response:e,context:i,level:p,parent:f,networkDetails:r,stats:n});else switch(t.live&&o&&(o.getCacheAge&&(t.ageHeader=o.getCacheAge()||0),o.getCacheAge&&!isNaN(t.ageHeader)||(t.ageHeader=0)),s){case Je.MANIFEST:case Je.LEVEL:a.trigger(D.LEVEL_LOADED,{details:t,level:p||0,id:u||0,stats:n,networkDetails:r,deliveryDirectives:d});break;case Je.AUDIO_TRACK:a.trigger(D.AUDIO_TRACK_LOADED,{details:t,id:u||0,groupId:c||"",stats:n,networkDetails:r,deliveryDirectives:d});break;case Je.SUBTITLE_TRACK:a.trigger(D.SUBTITLE_TRACK_LOADED,{details:t,id:u||0,groupId:c||"",stats:n,networkDetails:r,deliveryDirectives:d})}}else{var m=new Error("No Segments found in Playlist");a.trigger(D.ERROR,{type:R.NETWORK_ERROR,details:_.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:m,reason:m.message,response:e,context:i,level:p,parent:f,networkDetails:r,stats:n})}},t}();function en(t,e){var n;try{n=new Event("addtrack")}catch(t){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=t,e.dispatchEvent(n)}function nn(t,e){var n=t.mode;if("disabled"===n&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(e.id))try{if(t.addCue(e),!t.cues.getCueById(e.id))throw new Error("addCue is failed for: "+e)}catch(n){N.debug("[texttrack-utils]: "+n);try{var i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,t.addCue(i)}catch(t){N.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: "+t)}}"disabled"===n&&(t.mode=n)}function rn(t){var e=t.mode;if("disabled"===e&&(t.mode="hidden"),t.cues)for(var n=t.cues.length;n--;)t.removeCue(t.cues[n]);"disabled"===e&&(t.mode=e)}function on(t,e,n,i){var r=t.mode;if("disabled"===r&&(t.mode="hidden"),t.cues&&t.cues.length>0)for(var o=sn(t.cues,e,n),a=0;a<o.length;a++)i&&!i(o[a])||t.removeCue(o[a]);"disabled"===r&&(t.mode=r)}function an(t,e){if(e<t[0].startTime)return 0;var n=t.length-1;if(e>t[n].endTime)return-1;for(var i=0,r=n;i<=r;){var o=Math.floor((r+i)/2);if(e<t[o].startTime)r=o-1;else{if(!(e>t[o].startTime&&i<n))return o;i=o+1}}return t[i].startTime-e<e-t[r].startTime?i:r}function sn(t,e,n){var i=[],r=an(t,e);if(r>-1)for(var o=r,a=t.length;o<a;o++){var s=t[o];if(s.startTime>=e&&s.endTime<=n)i.push(s);else if(s.startTime>n)return i}return i}function ln(t){for(var e=[],n=0;n<t.length;n++){var i=t[n];"subtitles"!==i.kind&&"captions"!==i.kind||!i.label||e.push(t[n])}return e}var un={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"},cn=.25;function dn(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function hn(t,e,n,r,o){var a=new t(e,n,"");try{a.value=r,o&&(a.type=o)}catch(s){a=new t(e,n,JSON.stringify(o?i({type:o},r):r))}return a}var fn=function(){var t=dn();try{t&&new t(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function pn(t,e){return t.getTime()/1e3-e}function gn(t){return Uint8Array.from(t.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var mn=function(){function t(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}var e=t.prototype;return e.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},e._registerListeners=function(){var t=this.hls;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(D.LEVEL_UPDATED,this.onLevelUpdated,this)},e._unregisterListeners=function(){var t=this.hls;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(D.LEVEL_UPDATED,this.onLevelUpdated,this)},e.onMediaAttached=function(t,e){this.media=e.media},e.onMediaDetaching=function(){this.id3Track&&(rn(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},e.onManifestLoading=function(){this.dateRangeCuesAppended={}},e.createTrack=function(t){var e=this.getID3Track(t.textTracks);return e.mode="hidden",e},e.getID3Track=function(t){if(this.media){for(var e=0;e<t.length;e++){var n=t[e];if("metadata"===n.kind&&"id3"===n.label)return en(n,this.media),n}return this.media.addTextTrack("metadata","id3")}},e.onFragParsingMetadata=function(t,e){if(this.media){var n=this.hls.config,i=n.enableEmsgMetadataCues,r=n.enableID3MetadataCues;if(i||r){var o=e.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));var a=dn();if(a)for(var s=0;s<o.length;s++){var l=o[s].type;if((l!==un.emsg||i)&&r){var u=St(o[s].data);if(u){var c=o[s].pts,d=c+o[s].duration;d>fn&&(d=fn),d-c<=0&&(d=c+cn);for(var h=0;h<u.length;h++){var f=u[h];if(!Tt(f)){this.updateId3CueEnds(c,l);var p=hn(a,c,d,f,l);p&&this.id3Track.addCue(p)}}}}}}}},e.updateId3CueEnds=function(t,e){var n,i=null==(n=this.id3Track)?void 0:n.cues;if(i)for(var r=i.length;r--;){var o=i[r];o.type===e&&o.startTime<t&&o.endTime===fn&&(o.endTime=t)}},e.onBufferFlushing=function(t,e){var n=e.startOffset,i=e.endOffset,r=e.type,o=this.id3Track,a=this.hls;if(a){var s=a.config,l=s.enableEmsgMetadataCues,u=s.enableID3MetadataCues;o&&(l||u)&&on(o,n,i,"audio"===r?function(t){return t.type===un.audioId3&&u}:"video"===r?function(t){return t.type===un.emsg&&l}:function(t){return t.type===un.audioId3&&u||t.type===un.emsg&&l})}},e.onLevelUpdated=function(t,e){var n=this,i=e.details;if(this.media&&i.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var r=this.dateRangeCuesAppended,o=this.id3Track,a=i.dateRanges,s=Object.keys(a);if(o)for(var l=Object.keys(r).filter((function(t){return!s.includes(t)})),u=function(){var t=l[c];Object.keys(r[t].cues).forEach((function(e){o.removeCue(r[t].cues[e])})),delete r[t]},c=l.length;c--;)u();var d=i.fragments[i.fragments.length-1];if(0!==s.length&&w(null==d?void 0:d.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var h=d.programDateTime/1e3-d.start,f=dn(),p=function(){var t=s[g],e=a[t],i=pn(e.startDate,h),o=r[t],l=(null==o?void 0:o.cues)||{},u=(null==o?void 0:o.durationKnown)||!1,c=fn,d=e.endDate;if(d)c=pn(d,h),u=!0;else if(e.endOnNext&&!u){var p=s.reduce((function(t,n){if(n!==e.id){var i=a[n];if(i.class===e.class&&i.startDate>e.startDate&&(!t||e.startDate<t.startDate))return i}return t}),null);p&&(c=pn(p.startDate,h),u=!0)}for(var m=Object.keys(e.attr),v=0;v<m.length;v++){var y=m[v];if(j(y)){var b=l[y];if(b)u&&!o.durationKnown&&(b.endTime=c);else if(f){var E=e.attr[y];G(y)&&(E=gn(E));var T=hn(f,i,c,{key:y,data:E},un.dateRange);T&&(T.id=t,n.id3Track.addCue(T),l[y]=T)}}}r[t]={cues:l,dateRange:e,durationKnown:u}},g=0;g<s.length;g++)p()}}},t}(),vn=function(){function t(t){var e=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return e.timeupdate()},this.hls=t,this.config=t.config,this.registerListeners()}var e=t.prototype;return e.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},e.registerListeners=function(){this.hls.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(D.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(D.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(D.ERROR,this.onError,this)},e.unregisterListeners=function(){this.hls.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(D.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(D.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(D.ERROR,this.onError,this)},e.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},e.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},e.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},e.onLevelUpdated=function(t,e){var n=e.details;this.levelDetails=n,n.advanced&&this.timeupdate(),!n.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},e.onError=function(t,e){var n;e.details===_.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(n=this.levelDetails)&&n.live&&N.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},e.timeupdate=function(){var t=this.media,e=this.levelDetails;if(t&&e){this.currentTime=t.currentTime;var n=this.computeLatency();if(null!==n){this._latency=n;var i=this.config,r=i.lowLatencyMode,o=i.maxLiveSyncPlaybackRate;if(r&&1!==o&&e.live){var a=this.targetLatency;if(null!==a){var s=n-a;if(s<Math.min(this.maxLatency,a+e.targetduration)&&s>.05&&this.forwardBufferLength>1){var l=Math.min(2,Math.max(1,o)),u=Math.round(2/(1+Math.exp(-.75*s-this.edgeStalled))*20)/20;t.playbackRate=Math.min(l,Math.max(1,u))}else 1!==t.playbackRate&&0!==t.playbackRate&&(t.playbackRate=1)}}}}},e.estimateLiveEdge=function(){var t=this.levelDetails;return null===t?null:t.edge+t.age},e.computeLatency=function(){var t=this.estimateLiveEdge();return null===t?null:t-this.currentTime},s(t,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var t=this.config,e=this.levelDetails;return void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:e?t.liveMaxLatencyDurationCount*e.targetduration:0}},{key:"targetLatency",get:function(){var t=this.levelDetails;if(null===t)return null;var e=t.holdBack,n=t.partHoldBack,i=t.targetduration,r=this.config,o=r.liveSyncDuration,a=r.liveSyncDurationCount,s=r.lowLatencyMode,l=this.hls.userConfig,u=s&&n||e;(l.liveSyncDuration||l.liveSyncDurationCount||0===u)&&(u=void 0!==o?o:a*i);var c=i,d=1;return u+Math.min(this.stallCount*d,c)}},{key:"liveSyncPosition",get:function(){var t=this.estimateLiveEdge(),e=this.targetLatency,n=this.levelDetails;if(null===t||null===e||null===n)return null;var i=n.edge,r=t-e-this.edgeStalled,o=i-n.totalduration,a=i-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(o,r),a)}},{key:"drift",get:function(){var t=this.levelDetails;return null===t?1:t.drift}},{key:"edgeStalled",get:function(){var t=this.levelDetails;if(null===t)return 0;var e=3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return Math.max(t.age-e,0)}},{key:"forwardBufferLength",get:function(){var t=this.media,e=this.levelDetails;if(!t||!e)return 0;var n=t.buffered.length;return(n?t.buffered.end(n-1):e.edge)-this.currentTime}}]),t}(),yn=["NONE","TYPE-0","TYPE-1",null];function bn(t){return yn.indexOf(t)>-1}var En=["SDR","PQ","HLG"];function Tn(t){return!!t&&En.indexOf(t)>-1}var An={No:"",Yes:"YES",v2:"v2"};function Sn(t){var e=t.canSkipUntil,n=t.canSkipDateRanges,i=t.age;return e&&i<e/2?n?An.v2:An.Yes:An.No}var wn=function(){function t(t,e,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=n}return t.prototype.addDirectives=function(t){var e=new self.URL(t);return void 0!==this.msn&&e.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href},t}(),Ln=function(){function t(t){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.frameRate=t.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=t.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.codecSet=[t.videoCodec,t.audioCodec].filter((function(t){return!!t})).map((function(t){return t.substring(0,4)})).join(","),this.addGroupId("audio",t.attrs.AUDIO),this.addGroupId("text",t.attrs.SUBTITLES)}var e=t.prototype;return e.hasAudioGroup=function(t){return xn(this._audioGroups,t)},e.hasSubtitleGroup=function(t){return xn(this._subtitleGroups,t)},e.addGroupId=function(t,e){if(e)if("audio"===t){var n=this._audioGroups;n||(n=this._audioGroups=[]),-1===n.indexOf(e)&&n.push(e)}else if("text"===t){var i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),-1===i.indexOf(e)&&i.push(e)}},e.addFallback=function(){},s(t,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"averageBitrate",get:function(){return this._avgBitrate||this.realBitrate||this.bitrate}},{key:"attrs",get:function(){return this._attrs[0]}},{key:"codecs",get:function(){return this.attrs.CODECS||""}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"videoRange",get:function(){return this.attrs["VIDEO-RANGE"]||"SDR"}},{key:"score",get:function(){return this.attrs.optionalFloat("SCORE",0)}},{key:"uri",get:function(){return this.url[0]||""}},{key:"audioGroups",get:function(){return this._audioGroups}},{key:"subtitleGroups",get:function(){return this._subtitleGroups}},{key:"urlId",get:function(){return 0},set:function(t){}},{key:"audioGroupIds",get:function(){return this.audioGroups?[this.audioGroupId]:void 0}},{key:"textGroupIds",get:function(){return this.subtitleGroups?[this.textGroupId]:void 0}},{key:"audioGroupId",get:function(){var t;return null==(t=this.audioGroups)?void 0:t[0]}},{key:"textGroupId",get:function(){var t;return null==(t=this.subtitleGroups)?void 0:t[0]}}]),t}();function xn(t,e){return!(!e||!t)&&-1!==t.indexOf(e)}function Dn(t,e){var n=e.startPTS;if(w(n)){var i,r=0;e.sn>t.sn?(r=n-t.start,i=t):(r=t.start-n,i=e),i.duration!==r&&(i.duration=r)}else e.sn>t.sn?t.cc===e.cc&&t.minEndPTS?e.start=t.start+(t.minEndPTS-t.start):e.start=t.start+t.duration:e.start=Math.max(t.start-e.duration,0)}function Rn(t,e,n,i,r,o){i-n<=0&&(N.warn("Fragment should have a positive duration",e),i=n+e.duration,o=r+e.duration);var a=n,s=i,l=e.startPTS,u=e.endPTS;if(w(l)){var c=Math.abs(l-n);w(e.deltaPTS)?e.deltaPTS=Math.max(c,e.deltaPTS):e.deltaPTS=c,a=Math.max(n,l),n=Math.min(n,l),r=Math.min(r,e.startDTS),s=Math.min(i,u),i=Math.max(i,u),o=Math.max(o,e.endDTS)}var d=n-e.start;0!==e.start&&(e.start=n),e.duration=i-e.start,e.startPTS=n,e.maxStartPTS=a,e.startDTS=r,e.endPTS=i,e.minEndPTS=s,e.endDTS=o;var h,f=e.sn;if(!t||f<t.startSN||f>t.endSN)return 0;var p=f-t.startSN,g=t.fragments;for(g[p]=e,h=p;h>0;h--)Dn(g[h],g[h-1]);for(h=p;h<g.length-1;h++)Dn(g[h],g[h+1]);return t.fragmentHint&&Dn(g[g.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,d}function _n(t,e){for(var n=null,i=t.fragments,r=i.length-1;r>=0;r--){var o=i[r].initSegment;if(o){n=o;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var a,s=0;if(In(t,e,(function(t,i){t.relurl&&(s=t.cc-i.cc),w(t.startPTS)&&w(t.endPTS)&&(i.start=i.startPTS=t.startPTS,i.startDTS=t.startDTS,i.maxStartPTS=t.maxStartPTS,i.endPTS=t.endPTS,i.endDTS=t.endDTS,i.minEndPTS=t.minEndPTS,i.duration=t.endPTS-t.startPTS,i.duration&&(a=i),e.PTSKnown=e.alignedSliding=!0),i.elementaryStreams=t.elementaryStreams,i.loader=t.loader,i.stats=t.stats,t.initSegment&&(i.initSegment=t.initSegment,n=t.initSegment)})),n&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach((function(t){var e;!t||t.initSegment&&t.initSegment.relurl!==(null==(e=n)?void 0:e.relurl)||(t.initSegment=n)})),e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some((function(t){return!t})),e.deltaUpdateFailed){N.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var l=e.skippedSegments;l--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=Cn(t.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));var u=e.fragments;if(s){N.warn("discontinuity sliding from playlist, take drift into account");for(var c=0;c<u.length;c++)u[c].cc+=s}e.skippedSegments&&(e.startCC=e.fragments[0].cc),kn(t.partList,e.partList,(function(t,e){e.elementaryStreams=t.elementaryStreams,e.stats=t.stats})),a?Rn(e,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS):On(t,e),u.length&&(e.totalduration=e.edge-u[0].start),e.driftStartTime=t.driftStartTime,e.driftStart=t.driftStart;var d=e.advancedDateTime;if(e.advanced&&d){var h=e.edge;e.driftStart||(e.driftStartTime=d,e.driftStart=h),e.driftEndTime=d,e.driftEnd=h}else e.driftEndTime=t.driftEndTime,e.driftEnd=t.driftEnd,e.advancedDateTime=t.advancedDateTime}function Cn(t,e,n){var i=u({},t);return n&&n.forEach((function(t){delete i[t]})),Object.keys(e).forEach((function(t){var n=new V(e[t].attr,i[t]);n.isValid?i[t]=n:N.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(e[t].attr)+'"')})),i}function kn(t,e,n){if(t&&e)for(var i=0,r=0,o=t.length;r<=o;r++){var a=t[r],s=e[r+i];a&&s&&a.index===s.index&&a.fragment.sn===s.fragment.sn?n(a,s):i--}}function In(t,e,n){for(var i=e.skippedSegments,r=Math.max(t.startSN,e.startSN)-e.startSN,o=(t.fragmentHint?1:0)+(i?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,a=e.startSN-t.startSN,s=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,u=r;u<=o;u++){var c=l[a+u],d=s[u];i&&!d&&u<i&&(d=e.fragments[u]=c),c&&d&&n(c,d)}}function On(t,e){var n=e.startSN+e.skippedSegments-t.startSN,i=t.fragments;n<0||n>=i.length||Pn(e,i[n].start)}function Pn(t,e){if(e){for(var n=t.fragments,i=t.skippedSegments;i<n.length;i++)n[i].start+=e;t.fragmentHint&&(t.fragmentHint.start+=e)}}function Mn(t,e){void 0===e&&(e=1/0);var n=1e3*t.targetduration;if(t.updated){var i=t.fragments,r=4;if(i.length&&n*r>e){var o=1e3*i[i.length-1].duration;o<n&&(n=o)}}else n/=2;return Math.round(n)}function Nn(t,e,n){if(null==t||!t.details)return null;var i=t.details,r=i.fragments[e-i.startSN];return r||((r=i.fragmentHint)&&r.sn===e?r:e<i.startSN&&n&&n.sn===e?n:null)}function Fn(t,e,n){var i;return null!=t&&t.details?Bn(null==(i=t.details)?void 0:i.partList,e,n):null}function Bn(t,e,n){if(t)for(var i=t.length;i--;){var r=t[i];if(r.index===n&&r.fragment.sn===e)return r}return null}function Un(t){t.forEach((function(t,e){var n=t.details;null!=n&&n.fragments&&n.fragments.forEach((function(t){t.level=e}))}))}function jn(t){switch(t.details){case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_TIMEOUT:case _.LEVEL_LOAD_TIMEOUT:case _.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Gn(t,e){var n=jn(e);return t.default[(n?"timeout":"error")+"Retry"]}function Vn(t,e){var n="linear"===t.backoff?1:Math.pow(2,e);return Math.min(n*t.retryDelayMs,t.maxRetryDelayMs)}function Hn(t){return i(i({},t),{errorRetry:null,timeoutRetry:null})}function Kn(t,e,n,i){if(!t)return!1;var r=null==i?void 0:i.code,o=e<t.maxNumRetry&&(Wn(r)||!!n);return t.shouldRetry?t.shouldRetry(t,e,n,i,o):o}function Wn(t){return 0===t&&!1===navigator.onLine||!!t&&(t<400||t>499)}var qn={search:function(t,e){for(var n=0,i=t.length-1,r=null,o=null;n<=i;){var a=e(o=t[r=(n+i)/2|0]);if(a>0)n=r+1;else{if(!(a<0))return o;i=r-1}}return null}};function Yn(t,e,n){if(null===e||!Array.isArray(t)||!t.length||!w(e))return null;if(e<(t[0].programDateTime||0))return null;if(e>=(t[t.length-1].endProgramDateTime||0))return null;n=n||0;for(var i=0;i<t.length;++i){var r=t[i];if($n(e,n,r))return r}return null}function zn(t,e,n,i,r){void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=.005);var o=null;if(t){o=e[t.sn-e[0].sn+1]||null;var a=t.endDTS-n;a>0&&a<15e-7&&(n+=15e-7)}else 0===n&&0===e[0].start&&(o=e[0]);if(o&&((!t||t.level===o.level)&&0===Jn(n,i,o)||Xn(o,t,Math.min(r,i))))return o;var s=qn.search(e,Jn.bind(null,n,i));return!s||s===t&&o?o:s}function Xn(t,e,n){if(e&&0===e.start&&e.level<t.level&&(e.endPTS||0)>0){var i=e.tagList.reduce((function(t,e){return"INF"===e[0]&&(t+=parseFloat(e[1])),t}),n);return t.start<=i}return!1}function Jn(t,e,n){if(void 0===t&&(t=0),void 0===e&&(e=0),n.start<=t&&n.start+n.duration>t)return 0;var i=Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-i<=t?1:n.start-i>t&&n.start?-1:0}function $n(t,e,n){var i=1e3*Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-i>t}function Qn(t,e){return qn.search(t,(function(t){return t.cc<e?1:t.cc>e?-1:0}))}var Zn={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ti={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4},ei=function(){function t(t){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=t,this.log=N.log.bind(N,"[info]:"),this.warn=N.warn.bind(N,"[warning]:"),this.error=N.error.bind(N,"[error]:"),this.registerListeners()}var e=t.prototype;return e.registerListeners=function(){var t=this.hls;t.on(D.ERROR,this.onError,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.LEVEL_UPDATED,this.onLevelUpdated,this)},e.unregisterListeners=function(){var t=this.hls;t&&(t.off(D.ERROR,this.onError,this),t.off(D.ERROR,this.onErrorOut,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.LEVEL_UPDATED,this.onLevelUpdated,this))},e.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},e.startLoad=function(t){},e.stopLoad=function(){this.playlistError=0},e.getVariantLevelIndex=function(t){return(null==t?void 0:t.type)===$e.MAIN?t.level:this.hls.loadLevel},e.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},e.onLevelUpdated=function(){this.playlistError=0},e.onError=function(t,e){var n,i;if(!e.fatal){var r=this.hls,o=e.context;switch(e.details){case _.FRAG_LOAD_ERROR:case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_ERROR:case _.KEY_LOAD_TIMEOUT:return void(e.errorAction=this.getFragRetryOrSwitchAction(e));case _.FRAG_PARSING_ERROR:if(null!=(n=e.frag)&&n.gap)return void(e.errorAction={action:Zn.DoNothing,flags:ti.None});case _.FRAG_GAP:case _.FRAG_DECRYPT_ERROR:return e.errorAction=this.getFragRetryOrSwitchAction(e),void(e.errorAction.action=Zn.SendAlternateToPenaltyBox);case _.LEVEL_EMPTY_ERROR:case _.LEVEL_PARSING_ERROR:var a,s,l=e.parent===$e.MAIN?e.level:r.loadLevel;return void(e.details===_.LEVEL_EMPTY_ERROR&&null!=(a=e.context)&&null!=(s=a.levelDetails)&&s.live?e.errorAction=this.getPlaylistRetryOrSwitchAction(e,l):(e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,l)));case _.LEVEL_LOAD_ERROR:case _.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==o?void 0:o.level)&&(e.errorAction=this.getPlaylistRetryOrSwitchAction(e,o.level)));case _.AUDIO_TRACK_LOAD_ERROR:case _.AUDIO_TRACK_LOAD_TIMEOUT:case _.SUBTITLE_LOAD_ERROR:case _.SUBTITLE_TRACK_LOAD_TIMEOUT:if(o){var u=r.levels[r.loadLevel];if(u&&(o.type===Je.AUDIO_TRACK&&u.hasAudioGroup(o.groupId)||o.type===Je.SUBTITLE_TRACK&&u.hasSubtitleGroup(o.groupId)))return e.errorAction=this.getPlaylistRetryOrSwitchAction(e,r.loadLevel),e.errorAction.action=Zn.SendAlternateToPenaltyBox,void(e.errorAction.flags=ti.MoveAllAlternatesMatchingHost)}return;case _.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var c=r.levels[r.loadLevel],d=null==c?void 0:c.attrs["HDCP-LEVEL"];return void(d?e.errorAction={action:Zn.SendAlternateToPenaltyBox,flags:ti.MoveAllAlternatesMatchingHDCP,hdcpLevel:d}:this.keySystemError(e));case _.BUFFER_ADD_CODEC_ERROR:case _.REMUX_ALLOC_ERROR:case _.BUFFER_APPEND_ERROR:return void(e.errorAction=this.getLevelSwitchAction(e,null!=(i=e.level)?i:r.loadLevel));case _.INTERNAL_EXCEPTION:case _.BUFFER_APPENDING_ERROR:case _.BUFFER_FULL_ERROR:case _.LEVEL_SWITCH_ERROR:case _.BUFFER_STALLED_ERROR:case _.BUFFER_SEEK_OVER_HOLE:case _.BUFFER_NUDGE_ON_STALL:return void(e.errorAction={action:Zn.DoNothing,flags:ti.None})}e.type===R.KEY_SYSTEM_ERROR&&this.keySystemError(e)}},e.keySystemError=function(t){var e=this.getVariantLevelIndex(t.frag);t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e)},e.getPlaylistRetryOrSwitchAction=function(t,e){var n=Gn(this.hls.config.playlistLoadPolicy,t),i=this.playlistError++;if(Kn(n,i,jn(t),t.response))return{action:Zn.RetryRequest,flags:ti.None,retryConfig:n,retryCount:i};var r=this.getLevelSwitchAction(t,e);return n&&(r.retryConfig=n,r.retryCount=i),r},e.getFragRetryOrSwitchAction=function(t){var e=this.hls,n=this.getVariantLevelIndex(t.frag),i=e.levels[n],r=e.config,o=r.fragLoadPolicy,a=r.keyLoadPolicy,s=Gn(t.details.startsWith("key")?a:o,t),l=e.levels.reduce((function(t,e){return t+e.fragmentError}),0);if(i&&(t.details!==_.FRAG_GAP&&i.fragmentError++,Kn(s,l,jn(t),t.response)))return{action:Zn.RetryRequest,flags:ti.None,retryConfig:s,retryCount:l};var u=this.getLevelSwitchAction(t,n);return s&&(u.retryConfig=s,u.retryCount=l),u},e.getLevelSwitchAction=function(t,e){var n=this.hls;null==e&&(e=n.loadLevel);var i=this.hls.levels[e];if(i){var r,o,a=t.details;i.loadError++,a===_.BUFFER_APPEND_ERROR&&i.fragmentError++;var s=-1,l=n.levels,u=n.loadLevel,c=n.minAutoLevel,d=n.maxAutoLevel;n.autoLevelEnabled||(n.loadLevel=-1);for(var h,f=null==(r=t.frag)?void 0:r.type,p=(f===$e.AUDIO&&a===_.FRAG_PARSING_ERROR||"audio"===t.sourceBufferName&&(a===_.BUFFER_ADD_CODEC_ERROR||a===_.BUFFER_APPEND_ERROR))&&l.some((function(t){var e=t.audioCodec;return i.audioCodec!==e})),g="video"===t.sourceBufferName&&(a===_.BUFFER_ADD_CODEC_ERROR||a===_.BUFFER_APPEND_ERROR)&&l.some((function(t){var e=t.codecSet,n=t.audioCodec;return i.codecSet!==e&&i.audioCodec===n})),m=null!=(o=t.context)?o:{},v=m.type,y=m.groupId,b=function(){var e=(E+u)%l.length;if(e!==u&&e>=c&&e<=d&&0===l[e].loadError){var n,r,o=l[e];if(a===_.FRAG_GAP&&f===$e.MAIN&&t.frag){var h=l[e].details;if(h){var m=zn(t.frag,h.fragments,t.frag.start);if(null!=m&&m.gap)return 0}}else{if(v===Je.AUDIO_TRACK&&o.hasAudioGroup(y)||v===Je.SUBTITLE_TRACK&&o.hasSubtitleGroup(y))return 0;if(f===$e.AUDIO&&null!=(n=i.audioGroups)&&n.some((function(t){return o.hasAudioGroup(t)}))||f===$e.SUBTITLE&&null!=(r=i.subtitleGroups)&&r.some((function(t){return o.hasSubtitleGroup(t)}))||p&&i.audioCodec===o.audioCodec||!p&&i.audioCodec!==o.audioCodec||g&&i.codecSet===o.codecSet)return 0}return s=e,1}},E=l.length;E--&&(0===(h=b())||1!==h););if(s>-1&&n.loadLevel!==s)return t.levelRetry=!0,this.playlistError=0,{action:Zn.SendAlternateToPenaltyBox,flags:ti.None,nextAutoLevel:s}}return{action:Zn.SendAlternateToPenaltyBox,flags:ti.MoveAllAlternatesMatchingHost}},e.onErrorOut=function(t,e){var n;switch(null==(n=e.errorAction)?void 0:n.action){case Zn.DoNothing:break;case Zn.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(e),e.errorAction.resolved||e.details===_.FRAG_GAP?/MediaSource readyState: ended/.test(e.error.message)&&(this.warn('MediaSource ended after "'+e.sourceBufferName+'" sourceBuffer append error. Attempting to recover from media error.'),this.hls.recoverMediaError()):e.fatal=!0}e.fatal&&this.hls.stopLoad()},e.sendAlternateToPenaltyBox=function(t){var e=this.hls,n=t.errorAction;if(n){var i=n.flags,r=n.hdcpLevel,o=n.nextAutoLevel;switch(i){case ti.None:this.switchLevel(t,o);break;case ti.MoveAllAlternatesMatchingHDCP:r&&(e.maxHdcpLevel=yn[yn.indexOf(r)-1],n.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+e.maxHdcpLevel+'" or lower')}n.resolved||this.switchLevel(t,o)}},e.switchLevel=function(t,e){void 0!==e&&t.errorAction&&(this.warn("switching to level "+e+" after "+t.details),this.hls.nextAutoLevel=e,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)},t}(),ni=function(){function t(t,e){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=N.log.bind(N,e+":"),this.warn=N.warn.bind(N,e+":"),this.hls=t}var e=t.prototype;return e.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},e.clearTimer=function(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)},e.startLoad=function(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()},e.stopLoad=function(){this.canLoad=!1,this.clearTimer()},e.switchParams=function(t,e,n){var i=null==e?void 0:e.renditionReports;if(i){for(var r=-1,o=0;o<i.length;o++){var a=i[o],s=void 0;try{s=new self.URL(a.URI,e.url).href}catch(t){N.warn("Could not construct new URL for Rendition Report: "+t),s=a.URI||""}if(s===t){r=o;break}s===t.substring(0,s.length)&&(r=o)}if(-1!==r){var l=i[r],u=parseInt(l["LAST-MSN"])||(null==e?void 0:e.lastPartSn),c=parseInt(l["LAST-PART"])||(null==e?void 0:e.lastPartIndex);if(this.hls.config.lowLatencyMode){var d=Math.min(e.age-e.partTarget,e.targetduration);c>=0&&d>e.partTarget&&(c+=1)}var h=n&&Sn(n);return new wn(u,c>=0?c:void 0,h)}}},e.loadPlaylist=function(t){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())},e.shouldLoadPlaylist=function(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)},e.shouldReloadPlaylist=function(t){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(t)},e.playlistLoaded=function(t,e,n){var i=this,r=e.details,o=e.stats,a=self.performance.now(),s=o.loading.first?Math.max(0,a-o.loading.first):0;if(r.advancedDateTime=Date.now()-s,r.live||null!=n&&n.live){if(r.reloaded(n),n&&this.log("live playlist "+t+" "+(r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED")),n&&r.fragments.length>0&&_n(n,r),!this.canLoad||!r.live)return;var l,u=void 0,c=void 0;if(r.canBlockReload&&r.endSN&&r.advanced){var d=this.hls.config.lowLatencyMode,h=r.lastPartSn,f=r.endSN,p=r.lastPartIndex,g=h===f;-1!==p?(u=g?f+1:h,c=g?d?0:p:p+1):u=f+1;var m=r.age,v=m+r.ageHeader,y=Math.min(v-r.partTarget,1.5*r.targetduration);if(y>0){if(n&&y>n.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+n.tuneInGoal+" to: "+y+" with playlist age: "+r.age),y=0;else{var b=Math.floor(y/r.targetduration);u+=b,void 0!==c&&(c+=Math.round(y%r.targetduration/r.partTarget)),this.log("CDN Tune-in age: "+r.ageHeader+"s last advanced "+m.toFixed(2)+"s goal: "+y+" skip sn "+b+" to part "+c)}r.tuneInGoal=y}if(l=this.getDeliveryDirectives(r,e.deliveryDirectives,u,c),d||!g)return void this.loadPlaylist(l)}else(r.canBlockReload||r.canSkipUntil)&&(l=this.getDeliveryDirectives(r,e.deliveryDirectives,u,c));var E=this.hls.mainForwardBufferInfo,T=E?E.end-E.len:0,A=Mn(r,1e3*(r.edge-T));r.updated&&a>this.requestScheduled+A&&(this.requestScheduled=o.loading.start),void 0!==u&&r.canBlockReload?this.requestScheduled=o.loading.first+A-(1e3*r.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+A<a?this.requestScheduled=a:this.requestScheduled-a<=0&&(this.requestScheduled+=A);var S=this.requestScheduled-a;S=Math.max(0,S),this.log("reload live playlist "+t+" in "+Math.round(S)+" ms"),this.timer=self.setTimeout((function(){return i.loadPlaylist(l)}),S)}else this.clearTimer()},e.getDeliveryDirectives=function(t,e,n,i){var r=Sn(t);return null!=e&&e.skip&&t.deltaUpdateFailed&&(n=e.msn,i=e.part,r=An.No),new wn(n,i,r)},e.checkRetry=function(t){var e=this,n=t.details,i=jn(t),r=t.errorAction,o=r||{},a=o.action,s=o.retryCount,l=void 0===s?0:s,u=o.retryConfig,c=!!r&&!!u&&(a===Zn.RetryRequest||!r.resolved&&a===Zn.SendAlternateToPenaltyBox);if(c){var d;if(this.requestScheduled=-1,l>=u.maxNumRetry)return!1;if(i&&null!=(d=t.context)&&d.deliveryDirectives)this.warn("Retrying playlist loading "+(l+1)+"/"+u.maxNumRetry+' after "'+n+'" without delivery-directives'),this.loadPlaylist();else{var h=Vn(u,l);this.timer=self.setTimeout((function(){return e.loadPlaylist()}),h),this.warn("Retrying playlist loading "+(l+1)+"/"+u.maxNumRetry+' after "'+n+'" in '+h+"ms")}t.levelRetry=!0,r.resolved=!0}return c},t}(),ii=function(){function t(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=n}var e=t.prototype;return e.sample=function(t,e){var n=Math.pow(this.alpha_,t);this.estimate_=e*(1-n)+n*this.estimate_,this.totalWeight_+=t},e.getTotalWeight=function(){return this.totalWeight_},e.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_},t}(),ri=function(){function t(t,e,n,i){void 0===i&&(i=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ii(t),this.fast_=new ii(e),this.defaultTTFB_=i,this.ttfb_=new ii(t)}var e=t.prototype;return e.update=function(t,e){var n=this.slow_,i=this.fast_,r=this.ttfb_;n.halfLife!==t&&(this.slow_=new ii(t,n.getEstimate(),n.getTotalWeight())),i.halfLife!==e&&(this.fast_=new ii(e,i.getEstimate(),i.getTotalWeight())),r.halfLife!==t&&(this.ttfb_=new ii(t,r.getEstimate(),r.getTotalWeight()))},e.sample=function(t,e){var n=(t=Math.max(t,this.minDelayMs_))/1e3,i=8*e/n;this.fast_.sample(n,i),this.slow_.sample(n,i)},e.sampleTTFB=function(t){var e=t/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(n,Math.max(t,5))},e.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},e.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},e.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},e.destroy=function(){},t}(),oi={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},ai={};function si(t,e,n,i,r,o){var a=t.audioCodec?t.audioGroups:null,s=null==o?void 0:o.audioCodec,l=null==o?void 0:o.channels,u=l?parseInt(l):s?1/0:2,c=null;if(null!=a&&a.length)try{c=1===a.length&&a[0]?e.groups[a[0]].channels:a.reduce((function(t,n){if(n){var i=e.groups[n];if(!i)throw new Error("Audio track group "+n+" not found");Object.keys(i.channels).forEach((function(e){t[e]=(t[e]||0)+i.channels[e]}))}return t}),{2:0})}catch(t){return!0}return void 0!==t.videoCodec&&(t.width>1920&&t.height>1088||t.height>1920&&t.width>1088||t.frameRate>Math.max(i,30)||"SDR"!==t.videoRange&&t.videoRange!==n||t.bitrate>Math.max(r,8e6))||!!c&&w(u)&&Object.keys(c).some((function(t){return parseInt(t)>u}))}function li(t,e,n){var r=t.videoCodec,o=t.audioCodec;if(!r||!o||!n)return Promise.resolve(oi);var a={width:t.width,height:t.height,bitrate:Math.ceil(Math.max(.9*t.bitrate,t.averageBitrate)),framerate:t.frameRate||30},s=t.videoRange;"SDR"!==s&&(a.transferFunction=s.toLowerCase());var l=r.split(",").map((function(t){return{type:"media-source",video:i(i({},a),{},{contentType:De(t,"video")})}}));return o&&t.audioGroups&&t.audioGroups.forEach((function(t){var n;t&&(null==(n=e.groups[t])||n.tracks.forEach((function(e){if(e.groupId===t){var n=e.channels||"",i=parseFloat(n);w(i)&&i>2&&l.push.apply(l,o.split(",").map((function(t){return{type:"media-source",audio:{contentType:De(t,"audio"),channels:""+i}}})))}})))})),Promise.all(l.map((function(t){var e=ui(t);return ai[e]||(ai[e]=n.decodingInfo(t))}))).then((function(t){return{supported:!t.some((function(t){return!t.supported})),configurations:l,decodingInfoResults:t}})).catch((function(t){return{supported:!1,configurations:l,decodingInfoResults:[],error:t}}))}function ui(t){var e=t.audio,n=t.video,i=n||e;if(i){var r=i.contentType.split('"')[1];if(n)return"r"+n.height+"x"+n.width+"f"+Math.ceil(n.framerate)+(n.transferFunction||"sd")+"_"+r+"_"+Math.ceil(n.bitrate/1e5);if(e)return"c"+e.channels+(e.spatialRendering?"s":"n")+"_"+r}return""}function ci(){if("function"==typeof matchMedia){var t=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(t.media!==e.media)return!0===t.matches}return!1}function di(t,e){var n=!1,i=[];return t&&(n="SDR"!==t,i=[t]),e&&(i=e.allowedVideoRanges||En.slice(0),i=(n=void 0!==e.preferHDR?e.preferHDR:ci())?i.filter((function(t){return"SDR"!==t})):["SDR"]),{preferHDR:n,allowedVideoRanges:i}}function hi(t,e,n,i,r){for(var o=Object.keys(t),a=null==i?void 0:i.channels,s=null==i?void 0:i.audioCodec,l=a&&2===parseInt(a),u=!0,c=!1,d=1/0,h=1/0,f=1/0,p=0,g=[],m=di(e,r),v=m.preferHDR,y=m.allowedVideoRanges,b=function(){var e=t[o[E]];u=e.channels[2]>0,d=Math.min(d,e.minHeight),h=Math.min(h,e.minFramerate),f=Math.min(f,e.minBitrate);var n=y.filter((function(t){return e.videoRanges[t]>0}));n.length>0&&(c=!0,g=n)},E=o.length;E--;)b();d=w(d)?d:0,h=w(h)?h:0;var T=Math.max(1080,d),A=Math.max(30,h);return f=w(f)?f:n,n=Math.max(f,n),c||(e=void 0,g=[]),{codecSet:o.reduce((function(e,i){var r=t[i];if(i===e)return e;if(r.minBitrate>n)return fi(i,"min bitrate of "+r.minBitrate+" > current estimate of "+n),e;if(!r.hasDefaultAudio)return fi(i,"no renditions with default or auto-select sound found"),e;if(s&&i.indexOf(s.substring(0,4))%5!=0)return fi(i,'audio codec preference "'+s+'" not found'),e;if(a&&!l){if(!r.channels[a])return fi(i,"no renditions with "+a+" channel sound found (channels options: "+Object.keys(r.channels)+")"),e}else if((!s||l)&&u&&0===r.channels[2])return fi(i,"no renditions with stereo sound found"),e;return r.minHeight>T?(fi(i,"min resolution of "+r.minHeight+" > maximum of "+T),e):r.minFramerate>A?(fi(i,"min framerate of "+r.minFramerate+" > maximum of "+A),e):g.some((function(t){return r.videoRanges[t]>0}))?r.maxScore<p?(fi(i,"max score of "+r.maxScore+" < selected max of "+p),e):e&&(_e(i)>=_e(e)||r.fragmentError>t[e].fragmentError)?e:(p=r.maxScore,i):(fi(i,"no variants with VIDEO-RANGE of "+JSON.stringify(g)+" found"),e)}),void 0),videoRanges:g,preferHDR:v,minFramerate:h,minBitrate:f}}function fi(t,e){N.log('[abr] start candidates with "'+t+'" ignored because '+e)}function pi(t){return t.reduce((function(t,e){var n=t.groups[e.groupId];n||(n=t.groups[e.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(e);var i=e.channels||"2";return n.channels[i]=(n.channels[i]||0)+1,n.hasDefault=n.hasDefault||e.default,n.hasAutoSelect=n.hasAutoSelect||e.autoselect,n.hasDefault&&(t.hasDefaultAudio=!0),n.hasAutoSelect&&(t.hasAutoSelectAudio=!0),t}),{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function gi(t,e,n,i){return t.slice(n,i+1).reduce((function(t,n){if(!n.codecSet)return t;var i=n.audioGroups,r=t[n.codecSet];r||(t[n.codecSet]=r={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!i,fragmentError:0}),r.minBitrate=Math.min(r.minBitrate,n.bitrate);var o=Math.min(n.height,n.width);return r.minHeight=Math.min(r.minHeight,o),r.minFramerate=Math.min(r.minFramerate,n.frameRate),r.maxScore=Math.max(r.maxScore,n.score),r.fragmentError+=n.fragmentError,r.videoRanges[n.videoRange]=(r.videoRanges[n.videoRange]||0)+1,i&&i.forEach((function(t){if(t){var n=e.groups[t];n&&(r.hasDefaultAudio=r.hasDefaultAudio||e.hasDefaultAudio?n.hasDefault:n.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(n.channels).forEach((function(t){r.channels[t]=(r.channels[t]||0)+n.channels[t]})))}})),t}),{})}function mi(t,e,n){if("attrs"in t){var i=e.indexOf(t);if(-1!==i)return i}for(var r=0;r<e.length;r++)if(vi(t,e[r],n))return r;return-1}function vi(t,e,n){var i=t.groupId,r=t.name,o=t.lang,a=t.assocLang,s=t.characteristics,l=t.default,u=t.forced;return(void 0===i||e.groupId===i)&&(void 0===r||e.name===r)&&(void 0===o||e.lang===o)&&(void 0===o||e.assocLang===a)&&(void 0===l||e.default===l)&&(void 0===u||e.forced===u)&&(void 0===s||yi(s,e.characteristics))&&(void 0===n||n(t,e))}function yi(t,e){void 0===e&&(e="");var n=t.split(","),i=e.split(",");return n.length===i.length&&!n.some((function(t){return-1===i.indexOf(t)}))}function bi(t,e){var n=t.audioCodec,i=t.channels;return!(void 0!==n&&(e.audioCodec||"").substring(0,4)!==n.substring(0,4)||void 0!==i&&i!==(e.channels||"2"))}function Ei(t,e,n,i,r){var o=e[i],a=e.reduce((function(t,e,n){var i=e.uri;return(t[i]||(t[i]=[])).push(n),t}),{})[o.uri];a.length>1&&(i=Math.max.apply(Math,a));var s=o.videoRange,l=o.frameRate,u=o.codecSet.substring(0,4),c=Ti(e,i,(function(e){if(e.videoRange!==s||e.frameRate!==l||e.codecSet.substring(0,4)!==u)return!1;var i=e.audioGroups,o=n.filter((function(t){return!i||-1!==i.indexOf(t.groupId)}));return mi(t,o,r)>-1}));return c>-1?c:Ti(e,i,(function(e){var i=e.audioGroups,o=n.filter((function(t){return!i||-1!==i.indexOf(t.groupId)}));return mi(t,o,r)>-1}))}function Ti(t,e,n){for(var i=e;i;i--)if(n(t[i]))return i;for(var r=e+1;r<t.length;r++)if(n(t[r]))return r;return-1}var Ai=function(){function t(t){var e=this;this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=function(){var t=e.fragCurrent,n=e.partCurrent,i=e.hls,r=i.autoLevelEnabled,o=i.media;if(t&&o){var a=performance.now(),s=n?n.stats:t.stats,l=n?n.duration:t.duration,u=a-s.loading.start,c=i.minAutoLevel;if(s.aborted||s.loaded&&s.loaded===s.total||t.level<=c)return e.clearTimer(),void(e._nextAutoLevel=-1);if(r&&!o.paused&&o.playbackRate&&o.readyState){var d=i.mainForwardBufferInfo;if(null!==d){var h=e.bwEstimator.getEstimateTTFB(),f=Math.abs(o.playbackRate);if(!(u<=Math.max(h,l/(2*f)*1e3))){var p=d.len/f,g=s.loading.first?s.loading.first-s.loading.start:-1,m=s.loaded&&g>-1,v=e.getBwEstimate(),y=i.levels,b=y[t.level],E=s.total||Math.max(s.loaded,Math.round(l*b.averageBitrate/8)),T=m?u-g:u;T<1&&m&&(T=Math.min(u,8*s.loaded/v));var A=m?1e3*s.loaded/T:0,S=A?(E-s.loaded)/A:8*E/v+h/1e3;if(!(S<=p)){var L,x=A?8*A:v,R=Number.POSITIVE_INFINITY;for(L=t.level-1;L>c;L--){var _=y[L].maxBitrate;if((R=e.getTimeToLoadFrag(h/1e3,x,l*_,!y[L].details))<p)break}if(!(R>=S||R>10*l)){i.nextLoadLevel=i.nextAutoLevel=L,m?e.bwEstimator.sample(u-Math.min(h,g),s.loaded):e.bwEstimator.sampleTTFB(u);var C=y[L].maxBitrate;e.getBwEstimate()*e.hls.config.abrBandWidthUpFactor>C&&e.resetEstimator(C),e.clearTimer(),N.warn("[abr] Fragment "+t.sn+(n?" part "+n.index:"")+" of level "+t.level+" is loading too slowly;\n      Time to underbuffer: "+p.toFixed(3)+" s\n      Estimated load time for current fragment: "+S.toFixed(3)+" s\n      Estimated load time for down switch fragment: "+R.toFixed(3)+" s\n      TTFB estimate: "+(0|g)+" ms\n      Current BW estimate: "+(w(v)?0|v:"Unknown")+" bps\n      New BW estimate: "+(0|e.getBwEstimate())+" bps\n      Switching to level "+L+" @ "+(0|C)+" bps"),i.trigger(D.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:n,stats:s})}}}}}}},this.hls=t,this.bwEstimator=this.initEstimator(),this.registerListeners()}var e=t.prototype;return e.resetEstimator=function(t){t&&(N.log("setting initial bwe to "+t),this.hls.config.abrEwmaDefaultEstimate=t),this.firstSelection=-1,this.bwEstimator=this.initEstimator()},e.initEstimator=function(){var t=this.hls.config;return new ri(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate)},e.registerListeners=function(){var t=this.hls;t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.FRAG_LOADING,this.onFragLoading,this),t.on(D.FRAG_LOADED,this.onFragLoaded,this),t.on(D.FRAG_BUFFERED,this.onFragBuffered,this),t.on(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(D.LEVEL_LOADED,this.onLevelLoaded,this),t.on(D.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(D.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.on(D.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t&&(t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.FRAG_LOADING,this.onFragLoading,this),t.off(D.FRAG_LOADED,this.onFragLoaded,this),t.off(D.FRAG_BUFFERED,this.onFragBuffered,this),t.off(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(D.LEVEL_LOADED,this.onLevelLoaded,this),t.off(D.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(D.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.off(D.ERROR,this.onError,this))},e.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null},e.onManifestLoading=function(t,e){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()},e.onLevelsUpdated=function(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null},e.onMaxAutoLevelUpdated=function(){this.firstSelection=-1,this.nextAutoLevelKey=""},e.onFragLoading=function(t,e){var n,i=e.frag;this.ignoreFragment(i)||(i.bitrateTest||(this.fragCurrent=i,this.partCurrent=null!=(n=e.part)?n:null),this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100))},e.onLevelSwitching=function(t,e){this.clearTimer()},e.onError=function(t,e){if(!e.fatal)switch(e.details){case _.BUFFER_ADD_CODEC_ERROR:case _.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case _.FRAG_LOAD_TIMEOUT:var n=e.frag,i=this.fragCurrent,r=this.partCurrent;if(n&&i&&n.sn===i.sn&&n.level===i.level){var o=performance.now(),a=r?r.stats:n.stats,s=o-a.loading.start,l=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&l>-1){var u=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(s-Math.min(u,l),a.loaded)}else this.bwEstimator.sampleTTFB(s)}}},e.getTimeToLoadFrag=function(t,e,n,i){return t+n/e+(i?this.lastLevelLoadSec:0)},e.onLevelLoaded=function(t,e){var n=this.hls.config,i=e.stats.loading,r=i.end-i.start;w(r)&&(this.lastLevelLoadSec=r/1e3),e.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)},e.onFragLoaded=function(t,e){var n=e.frag,i=e.part,r=i?i.stats:n.stats;if(n.type===$e.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(n)){if(this.clearTimer(),n.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){var o=i?i.duration:n.duration,a=this.hls.levels[n.level],s=(a.loaded?a.loaded.bytes:0)+r.loaded,l=(a.loaded?a.loaded.duration:0)+o;a.loaded={bytes:s,duration:l},a.realBitrate=Math.round(8*s/l)}if(n.bitrateTest){var u={stats:r,frag:n,part:i,id:n.type};this.onFragBuffered(D.FRAG_BUFFERED,u),n.bitrateTest=!1}else this.lastLoadedFragLevel=n.level}},e.onFragBuffered=function(t,e){var n=e.frag,i=e.part,r=null!=i&&i.stats.loaded?i.stats:n.stats;if(!r.aborted&&!this.ignoreFragment(n)){var o=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,r.loaded),r.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}},e.ignoreFragment=function(t){return t.type!==$e.MAIN||"initSegment"===t.sn},e.clearTimer=function(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)},e.getAutoLevelKey=function(){return this.getBwEstimate()+"_"+this.getStarvationDelay().toFixed(2)},e.getNextABRAutoLevel=function(){var t=this.fragCurrent,e=this.partCurrent,n=this.hls,i=n.maxAutoLevel,r=n.config,o=n.minAutoLevel,a=e?e.duration:t?t.duration:0,s=this.getBwEstimate(),l=this.getStarvationDelay(),u=r.abrBandWidthFactor,c=r.abrBandWidthUpFactor;if(l){var d=this.findBestLevel(s,o,i,l,0,u,c);if(d>=0)return d}var h=a?Math.min(a,r.maxStarvationDelay):r.maxStarvationDelay;if(!l){var f=this.bitrateTestDelay;f&&(h=(a?Math.min(a,r.maxLoadingDelay):r.maxLoadingDelay)-f,N.info("[abr] bitrate test took "+Math.round(1e3*f)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*h)+" ms"),u=c=1)}var p=this.findBestLevel(s,o,i,l,h,u,c);if(N.info("[abr] "+(l?"rebuffering expected":"buffer is empty")+", optimal quality level "+p),p>-1)return p;var g=n.levels[o],m=n.levels[n.loadLevel];return(null==g?void 0:g.bitrate)<(null==m?void 0:m.bitrate)?o:n.loadLevel},e.getStarvationDelay=function(){var t=this.hls,e=t.media;if(!e)return 1/0;var n=e&&0!==e.playbackRate?Math.abs(e.playbackRate):1,i=t.mainForwardBufferInfo;return(i?i.len:0)/n},e.getBwEstimate=function(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate},e.findBestLevel=function(t,e,n,i,r,o,a){var s,l=this,u=i+r,c=this.lastLoadedFragLevel,d=-1===c?this.hls.firstLevel:c,h=this.fragCurrent,f=this.partCurrent,p=this.hls,g=p.levels,m=p.allAudioTracks,v=p.loadLevel,y=p.config;if(1===g.length)return 0;var b,E=g[d],T=!(null==E||null==(s=E.details)||!s.live),A=-1===v||-1===c,S="SDR",L=(null==E?void 0:E.frameRate)||0,x=y.audioPreference,D=y.videoPreference,R=this.audioTracksByGroup||(this.audioTracksByGroup=pi(m));if(A){if(-1!==this.firstSelection)return this.firstSelection;var _=hi(this.codecTiers||(this.codecTiers=gi(g,R,e,n)),S,t,x,D),C=_.codecSet,k=_.videoRanges,I=_.minFramerate,O=_.minBitrate,P=_.preferHDR;b=C,S=P?k[k.length-1]:k[0],L=I,t=Math.max(t,O),N.log("[abr] picked start tier "+JSON.stringify(_))}else b=null==E?void 0:E.codecSet,S=null==E?void 0:E.videoRange;for(var M,F=f?f.duration:h?h.duration:0,B=this.bwEstimator.getEstimateTTFB()/1e3,U=[],j=function(){var e,s=g[G],h=G>d;if(!s)return 0;if(y.useMediaCapabilities&&!s.supportedResult&&!s.supportedPromise){var p=navigator.mediaCapabilities;"function"==typeof(null==p?void 0:p.decodingInfo)&&si(s,R,S,L,t,x)?(s.supportedPromise=li(s,R,p),s.supportedPromise.then((function(t){if(l.hls){s.supportedResult=t;var e=l.hls.levels,n=e.indexOf(s);t.error?N.warn('[abr] MediaCapabilities decodingInfo error: "'+t.error+'" for level '+n+" "+JSON.stringify(t)):t.supported||(N.warn("[abr] Unsupported MediaCapabilities decodingInfo result for level "+n+" "+JSON.stringify(t)),n>-1&&e.length>1&&(N.log("[abr] Removing unsupported level "+n),l.hls.removeLevel(n)))}}))):s.supportedResult=oi}if(b&&s.codecSet!==b||S&&s.videoRange!==S||h&&L>s.frameRate||!h&&L>0&&L<s.frameRate||s.supportedResult&&(null==(e=s.supportedResult.decodingInfoResults)||!e[0].smooth))return U.push(G),0;var m,D=s.details,_=(f?null==D?void 0:D.partTarget:null==D?void 0:D.averagetargetduration)||F;m=h?a*t:o*t;var C=F&&i>=2*F&&0===r?g[G].averageBitrate:g[G].maxBitrate,k=l.getTimeToLoadFrag(B,m,C*_,void 0===D);if(m>=C&&(G===c||0===s.loadError&&0===s.fragmentError)&&(k<=B||!w(k)||T&&!l.bitrateTestDelay||k<u)){var I=l.forcedAutoLevel;return G===v||-1!==I&&I===v||(U.length&&N.trace("[abr] Skipped level(s) "+U.join(",")+" of "+n+' max with CODECS and VIDEO-RANGE:"'+g[U[0]].codecs+'" '+g[U[0]].videoRange+'; not compatible with "'+E.codecs+'" '+S),N.info("[abr] switch candidate:"+d+"->"+G+" adjustedbw("+Math.round(m)+")-bitrate="+Math.round(m-C)+" ttfb:"+B.toFixed(1)+" avgDuration:"+_.toFixed(1)+" maxFetchDuration:"+u.toFixed(1)+" fetchDuration:"+k.toFixed(1)+" firstSelection:"+A+" codecSet:"+b+" videoRange:"+S+" hls.loadLevel:"+v)),A&&(l.firstSelection=G),{v:G}}},G=n;G>=e;G--)if(0!==(M=j())&&M)return M.v;return-1},s(t,[{key:"firstAutoLevel",get:function(){var t=this.hls,e=t.maxAutoLevel,n=t.minAutoLevel,i=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,o=this.findBestLevel(i,n,e,0,r,1,1);if(o>-1)return o;var a=this.hls.firstLevel,s=Math.min(Math.max(a,n),e);return N.warn("[abr] Could not find best starting auto level. Defaulting to first in playlist "+a+" clamped to "+s),s}},{key:"forcedAutoLevel",get:function(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}},{key:"nextAutoLevel",get:function(){var t=this.forcedAutoLevel,e=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(!(-1===t||e&&n&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return t;var i=e&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==t){var r=this.hls.levels;if(r.length>Math.max(t,i)&&r[t].loadError<=r[i].loadError)return t}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i},set:function(t){var e=this.hls,n=e.maxAutoLevel,i=e.minAutoLevel,r=Math.min(Math.max(t,i),n);this._nextAutoLevel!==r&&(this.nextAutoLevelKey="",this._nextAutoLevel=r)}}]),t}(),Si=function(){function t(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var e=t.prototype;return e.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},e.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},e.onHandlerDestroyed=function(){},e.hasInterval=function(){return!!this._tickInterval},e.hasNextTick=function(){return!!this._tickTimer},e.setInterval=function(t){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)},e.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},e.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},e.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},e.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},e.doTick=function(){},t}(),wi={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},Li=function(){function t(t){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}var e=t.prototype;return e._registerListeners=function(){var t=this.hls;t.on(D.BUFFER_APPENDED,this.onBufferAppended,this),t.on(D.FRAG_BUFFERED,this.onFragBuffered,this),t.on(D.FRAG_LOADED,this.onFragLoaded,this)},e._unregisterListeners=function(){var t=this.hls;t.off(D.BUFFER_APPENDED,this.onBufferAppended,this),t.off(D.FRAG_BUFFERED,this.onFragBuffered,this),t.off(D.FRAG_LOADED,this.onFragLoaded,this)},e.destroy=function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},e.getAppendedFrag=function(t,e){var n=this.activePartLists[e];if(n)for(var i=n.length;i--;){var r=n[i];if(!r)break;var o=r.end;if(r.start<=t&&null!==o&&t<=o)return r}return this.getBufferedFrag(t,e)},e.getBufferedFrag=function(t,e){for(var n=this.fragments,i=Object.keys(n),r=i.length;r--;){var o=n[i[r]];if((null==o?void 0:o.body.type)===e&&o.buffered){var a=o.body;if(a.start<=t&&t<=a.end)return a}}return null},e.detectEvictedFragments=function(t,e,n,i){var r=this;this.timeRanges&&(this.timeRanges[t]=e);var o=(null==i?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach((function(i){var a=r.fragments[i];if(a&&!(o>=a.body.sn))if(a.buffered||a.loaded){var s=a.range[t];s&&s.time.some((function(t){var n=!r.isTimeBuffered(t.startPTS,t.endPTS,e);return n&&r.removeFragment(a.body),n}))}else a.body.type===n&&r.removeFragment(a.body)}))},e.detectPartialFragments=function(t){var e=this,n=this.timeRanges,i=t.frag,r=t.part;if(n&&"initSegment"!==i.sn){var o=Di(i),a=this.fragments[o];if(!(!a||a.buffered&&i.gap)){var s=!i.relurl;Object.keys(n).forEach((function(t){var o=i.elementaryStreams[t];if(o){var l=n[t],u=s||!0===o.partial;a.range[t]=e.getBufferedTimes(i,r,u,l)}})),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,(a.body.endList=i.endList||a.body.endList)&&(this.endListFragments[a.body.type]=a),xi(a)||this.removeParts(i.sn-1,i.type)):this.removeFragment(a.body)}}},e.removeParts=function(t,e){var n=this.activePartLists[e];n&&(this.activePartLists[e]=n.filter((function(e){return e.fragment.sn>=t})))},e.fragBuffered=function(t,e){var n=Di(t),i=this.fragments[n];!i&&e&&(i=this.fragments[n]={body:t,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},t.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)},e.getBufferedTimes=function(t,e,n,i){for(var r={time:[],partial:n},o=t.start,a=t.end,s=t.minEndPTS||a,l=t.maxStartPTS||o,u=0;u<i.length;u++){var c=i.start(u)-this.bufferPadding,d=i.end(u)+this.bufferPadding;if(l>=c&&s<=d){r.time.push({startPTS:Math.max(o,i.start(u)),endPTS:Math.min(a,i.end(u))});break}if(o<d&&a>c){var h=Math.max(o,i.start(u)),f=Math.min(a,i.end(u));f>h&&(r.partial=!0,r.time.push({startPTS:h,endPTS:f}))}else if(a<=c)break}return r},e.getPartialFragment=function(t){var e,n,i,r=null,o=0,a=this.bufferPadding,s=this.fragments;return Object.keys(s).forEach((function(l){var u=s[l];u&&xi(u)&&(n=u.body.start-a,i=u.body.end+a,t>=n&&t<=i&&(e=Math.min(t-n,i-t),o<=e&&(r=u.body,o=e)))})),r},e.isEndListAppended=function(t){var e=this.endListFragments[t];return void 0!==e&&(e.buffered||xi(e))},e.getState=function(t){var e=Di(t),n=this.fragments[e];return n?n.buffered?xi(n)?wi.PARTIAL:wi.OK:wi.APPENDING:wi.NOT_LOADED},e.isTimeBuffered=function(t,e,n){for(var i,r,o=0;o<n.length;o++){if(i=n.start(o)-this.bufferPadding,r=n.end(o)+this.bufferPadding,t>=i&&e<=r)return!0;if(e<=i)return!1}return!1},e.onFragLoaded=function(t,e){var n=e.frag,i=e.part;if("initSegment"!==n.sn&&!n.bitrateTest){var r=i?null:e,o=Di(n);this.fragments[o]={body:n,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}},e.onBufferAppended=function(t,e){var n=this,i=e.frag,r=e.part,o=e.timeRanges;if("initSegment"!==i.sn){var a=i.type;if(r){var s=this.activePartLists[a];s||(this.activePartLists[a]=s=[]),s.push(r)}this.timeRanges=o,Object.keys(o).forEach((function(t){var e=o[t];n.detectEvictedFragments(t,e,a,r)}))}},e.onFragBuffered=function(t,e){this.detectPartialFragments(e)},e.hasFragment=function(t){var e=Di(t);return!!this.fragments[e]},e.hasParts=function(t){var e;return!(null==(e=this.activePartLists[t])||!e.length)},e.removeFragmentsInRange=function(t,e,n,i,r){var o=this;i&&!this.hasGaps||Object.keys(this.fragments).forEach((function(a){var s=o.fragments[a];if(s){var l=s.body;l.type!==n||i&&!l.gap||l.start<e&&l.end>t&&(s.buffered||r)&&o.removeFragment(l)}}))},e.removeFragment=function(t){var e=Di(t);t.stats.loaded=0,t.clearElementaryStreamInfo();var n=this.activePartLists[t.type];if(n){var i=t.sn;this.activePartLists[t.type]=n.filter((function(t){return t.fragment.sn!==i}))}delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]},e.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1},t}();function xi(t){var e,n,i;return t.buffered&&(t.body.gap||(null==(e=t.range.video)?void 0:e.partial)||(null==(n=t.range.audio)?void 0:n.partial)||(null==(i=t.range.audiovideo)?void 0:i.partial))}function Di(t){return t.type+"_"+t.level+"_"+t.sn}var Ri={length:0,start:function(){return 0},end:function(){return 0}},_i=function(){function t(){}return t.isBuffered=function(e,n){try{if(e)for(var i=t.getBuffered(e),r=0;r<i.length;r++)if(n>=i.start(r)&&n<=i.end(r))return!0}catch(t){}return!1},t.bufferInfo=function(e,n,i){try{if(e){var r,o=t.getBuffered(e),a=[];for(r=0;r<o.length;r++)a.push({start:o.start(r),end:o.end(r)});return this.bufferedInfo(a,n,i)}}catch(t){}return{len:0,start:n,end:n,nextStart:void 0}},t.bufferedInfo=function(t,e,n){e=Math.max(0,e),t.sort((function(t,e){var n=t.start-e.start;return n||e.end-t.end}));var i=[];if(n)for(var r=0;r<t.length;r++){var o=i.length;if(o){var a=i[o-1].end;t[r].start-a<n?t[r].end>a&&(i[o-1].end=t[r].end):i.push(t[r])}else i.push(t[r])}else i=t;for(var s,l=0,u=e,c=e,d=0;d<i.length;d++){var h=i[d].start,f=i[d].end;if(e+n>=h&&e<f)u=h,l=(c=f)-e;else if(e+n<h){s=h;break}}return{len:l,start:u||0,end:c||0,nextStart:s}},t.getBuffered=function(t){try{return t.buffered}catch(t){return N.log("failed to get media.buffered",t),Ri}},t}(),Ci=function(t,e,n,i,r,o){void 0===i&&(i=0),void 0===r&&(r=-1),void 0===o&&(o=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=ki(),this.buffering={audio:ki(),video:ki(),audiovideo:ki()},this.level=t,this.sn=e,this.id=n,this.size=i,this.part=r,this.partial=o};function ki(){return{start:0,executeStart:0,executeEnd:0,end:0}}function Ii(t,e){for(var n=0,i=t.length;n<i;n++){var r;if((null==(r=t[n])?void 0:r.cc)===e)return t[n]}return null}function Oi(t,e,n){return!(!e||!(n.endCC>n.startCC||t&&t.cc<n.startCC))}function Pi(t,e){var n=t.fragments,i=e.fragments;if(i.length&&n.length){var r=Ii(n,i[0].cc);if(r&&(!r||r.startPTS))return r;N.log("No frag in previous level to align on")}else N.log("No fragments to align")}function Mi(t,e){if(t){var n=t.start+e;t.start=t.startPTS=n,t.endPTS=n+t.duration}}function Ni(t,e){for(var n=e.fragments,i=0,r=n.length;i<r;i++)Mi(n[i],t);e.fragmentHint&&Mi(e.fragmentHint,t),e.alignedSliding=!0}function Fi(t,e,n){e&&(Bi(t,n,e),!n.alignedSliding&&e&&Ui(n,e),n.alignedSliding||!e||n.skippedSegments||On(e,n))}function Bi(t,e,n){if(Oi(t,n,e)){var i=Pi(n,e);i&&w(i.start)&&(N.log("Adjusting PTS using last level due to CC increase within current level "+e.url),Ni(i.start,e))}}function Ui(t,e){if(t.hasProgramDateTime&&e.hasProgramDateTime){var n=t.fragments,i=e.fragments;if(n.length&&i.length){var r,o,a=Math.min(e.endCC,t.endCC);e.startCC<a&&t.startCC<a&&(r=Ii(i,a),o=Ii(n,a)),r&&o||(o=Ii(n,(r=i[Math.floor(i.length/2)]).cc)||n[Math.floor(n.length/2)]);var s=r.programDateTime,l=o.programDateTime;s&&l&&Ni((l-s)/1e3-(o.start-r.start),t)}}}var ji=Math.pow(2,17),Gi=function(){function t(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var e=t.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(t,e){var n=this,r=t.url;if(!r)return Promise.reject(new Ki({type:R.NETWORK_ERROR,details:_.FRAG_LOAD_ERROR,fatal:!1,frag:t,error:new Error("Fragment does not have a "+(r?"part list":"url")),networkDetails:null}));this.abort();var o=this.config,a=o.fLoader,s=o.loader;return new Promise((function(l,u){if(n.loader&&n.loader.destroy(),t.gap){if(t.tagList.some((function(t){return"GAP"===t[0]})))return void u(Hi(t));t.gap=!1}var c=n.loader=t.loader=a?new a(o):new s(o),d=Vi(t),h=Hn(o.fragLoadPolicy.default),f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===t.sn?1/0:ji};t.stats=c.stats,c.load(d,f,{onSuccess:function(e,i,r,o){n.resetLoader(t,c);var a=e.data;r.resetIV&&t.decryptdata&&(t.decryptdata.iv=new Uint8Array(a.slice(0,16)),a=a.slice(16)),l({frag:t,part:null,payload:a,networkDetails:o})},onError:function(e,o,a,s){n.resetLoader(t,c),u(new Ki({type:R.NETWORK_ERROR,details:_.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:i({url:r,data:void 0},e),error:new Error("HTTP Error "+e.code+" "+e.text),networkDetails:a,stats:s}))},onAbort:function(e,i,r){n.resetLoader(t,c),u(new Ki({type:R.NETWORK_ERROR,details:_.INTERNAL_ABORTED,fatal:!1,frag:t,error:new Error("Aborted"),networkDetails:r,stats:e}))},onTimeout:function(e,i,r){n.resetLoader(t,c),u(new Ki({type:R.NETWORK_ERROR,details:_.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,error:new Error("Timeout after "+f.timeout+"ms"),networkDetails:r,stats:e}))},onProgress:function(n,i,r,o){e&&e({frag:t,part:null,payload:r,networkDetails:o})}})}))},e.loadPart=function(t,e,n){var r=this;this.abort();var o=this.config,a=o.fLoader,s=o.loader;return new Promise((function(l,u){if(r.loader&&r.loader.destroy(),t.gap||e.gap)u(Hi(t,e));else{var c=r.loader=t.loader=a?new a(o):new s(o),d=Vi(t,e),h=Hn(o.fragLoadPolicy.default),f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:ji};e.stats=c.stats,c.load(d,f,{onSuccess:function(i,o,a,s){r.resetLoader(t,c),r.updateStatsFromPart(t,e);var u={frag:t,part:e,payload:i.data,networkDetails:s};n(u),l(u)},onError:function(n,o,a,s){r.resetLoader(t,c),u(new Ki({type:R.NETWORK_ERROR,details:_.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:i({url:d.url,data:void 0},n),error:new Error("HTTP Error "+n.code+" "+n.text),networkDetails:a,stats:s}))},onAbort:function(n,i,o){t.stats.aborted=e.stats.aborted,r.resetLoader(t,c),u(new Ki({type:R.NETWORK_ERROR,details:_.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,error:new Error("Aborted"),networkDetails:o,stats:n}))},onTimeout:function(n,i,o){r.resetLoader(t,c),u(new Ki({type:R.NETWORK_ERROR,details:_.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,error:new Error("Timeout after "+f.timeout+"ms"),networkDetails:o,stats:n}))}})}}))},e.updateStatsFromPart=function(t,e){var n=t.stats,i=e.stats,r=i.total;if(n.loaded+=i.loaded,r){var o=Math.round(t.duration/e.duration),a=Math.min(Math.round(n.loaded/r),o),s=(o-a)*Math.round(n.loaded/a);n.total=n.loaded+s}else n.total=Math.max(n.loaded,n.total);var l=n.loading,u=i.loading;l.start?l.first+=u.first-u.start:(l.start=u.start,l.first=u.first),l.end=u.end},e.resetLoader=function(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},t}();function Vi(t,e){void 0===e&&(e=null);var n=e||t,i={frag:t,part:e,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},r=n.byteRangeStartOffset,o=n.byteRangeEndOffset;if(w(r)&&w(o)){var a,s=r,l=o;if("initSegment"===t.sn&&"AES-128"===(null==(a=t.decryptdata)?void 0:a.method)){var u=o-r;u%16&&(l=o+(16-u%16)),0!==r&&(i.resetIV=!0,s=r-16)}i.rangeStart=s,i.rangeEnd=l}return i}function Hi(t,e){var n=new Error("GAP "+(t.gap?"tag":"attribute")+" found"),i={type:R.MEDIA_ERROR,details:_.FRAG_GAP,fatal:!1,frag:t,error:n,networkDetails:null};return e&&(i.part=e),(e||t).stats.aborted=!0,new Ki(i)}var Ki=function(t){function e(e){var n;return(n=t.call(this,e.error.message)||this).data=void 0,n.data=e,n}return c(e,t),e}(m(Error)),Wi=function(){function t(t,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=e}return t.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},t}(),qi=function(){function t(t,e){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=e}return t.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}();function Yi(t){var e=t.byteLength,n=e&&new DataView(t.buffer).getUint8(e-1);return n?ft(t,0,e-n):t}var zi=function(){function t(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var e=t.prototype;return e.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),n=new Uint32Array(4),i=0;i<4;i++)n[i]=e.getUint32(4*i);return n},e.initTable=function(){var t=this.sBox,e=this.invSBox,n=this.subMix,i=n[0],r=n[1],o=n[2],a=n[3],s=this.invSubMix,l=s[0],u=s[1],c=s[2],d=s[3],h=new Uint32Array(256),f=0,p=0,g=0;for(g=0;g<256;g++)h[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){var m=p^p<<1^p<<2^p<<3^p<<4;m=m>>>8^255&m^99,t[f]=m,e[m]=f;var v=h[f],y=h[v],b=h[y],E=257*h[m]^16843008*m;i[f]=E<<24|E>>>8,r[f]=E<<16|E>>>16,o[f]=E<<8|E>>>24,a[f]=E,E=16843009*b^65537*y^257*v^16843008*f,l[m]=E<<24|E>>>8,u[m]=E<<16|E>>>16,c[m]=E<<8|E>>>24,d[m]=E,f?(f=v^h[h[h[b^v]]],p^=h[h[p]]):f=p=1}},e.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),n=!0,i=0;i<e.length&&n;)n=e[i]===this.key[i],i++;if(!n){this.key=e;var r=this.keySize=e.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);var o,a,s,l,u=this.ksRows=4*(r+6+1),c=this.keySchedule=new Uint32Array(u),d=this.invKeySchedule=new Uint32Array(u),h=this.sBox,f=this.rcon,p=this.invSubMix,g=p[0],m=p[1],v=p[2],y=p[3];for(o=0;o<u;o++)o<r?s=c[o]=e[o]:(l=s,o%r==0?(l=h[(l=l<<8|l>>>24)>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l],l^=f[o/r|0]<<24):r>6&&o%r==4&&(l=h[l>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l]),c[o]=s=(c[o-r]^l)>>>0);for(a=0;a<u;a++)o=u-a,l=3&a?c[o]:c[o-4],d[a]=a<4||o<=4?l:g[h[l>>>24]]^m[h[l>>>16&255]]^v[h[l>>>8&255]]^y[h[255&l]],d[a]=d[a]>>>0}},e.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},e.decrypt=function(t,e,n){for(var i,r,o,a,s,l,u,c,d,h,f,p,g,m,v=this.keySize+6,y=this.invKeySchedule,b=this.invSBox,E=this.invSubMix,T=E[0],A=E[1],S=E[2],w=E[3],L=this.uint8ArrayToUint32Array_(n),x=L[0],D=L[1],R=L[2],_=L[3],C=new Int32Array(t),k=new Int32Array(C.length),I=this.networkToHostOrderSwap;e<C.length;){for(d=I(C[e]),h=I(C[e+1]),f=I(C[e+2]),p=I(C[e+3]),s=d^y[0],l=p^y[1],u=f^y[2],c=h^y[3],g=4,m=1;m<v;m++)i=T[s>>>24]^A[l>>16&255]^S[u>>8&255]^w[255&c]^y[g],r=T[l>>>24]^A[u>>16&255]^S[c>>8&255]^w[255&s]^y[g+1],o=T[u>>>24]^A[c>>16&255]^S[s>>8&255]^w[255&l]^y[g+2],a=T[c>>>24]^A[s>>16&255]^S[l>>8&255]^w[255&u]^y[g+3],s=i,l=r,u=o,c=a,g+=4;i=b[s>>>24]<<24^b[l>>16&255]<<16^b[u>>8&255]<<8^b[255&c]^y[g],r=b[l>>>24]<<24^b[u>>16&255]<<16^b[c>>8&255]<<8^b[255&s]^y[g+1],o=b[u>>>24]<<24^b[c>>16&255]<<16^b[s>>8&255]<<8^b[255&l]^y[g+2],a=b[c>>>24]<<24^b[s>>16&255]<<16^b[l>>8&255]<<8^b[255&u]^y[g+3],k[e]=I(i^x),k[e+1]=I(a^D),k[e+2]=I(o^R),k[e+3]=I(r^_),x=d,D=h,R=f,_=p,e+=4}return k.buffer},t}(),Xi=16,Ji=function(){function t(t,e){var n=(void 0===e?{}:e).removePKCS7Padding,i=void 0===n||n;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=t.enableSoftwareAES,this.removePKCS7Padding=i,i)try{var r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch(t){}this.useSoftware=!this.subtle}var e=t.prototype;return e.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},e.isSync=function(){return this.useSoftware},e.flush=function(){var t=this.currentResult,e=this.remainderData;if(!t||e)return this.reset(),null;var n=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?Yi(n):n},e.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},e.decrypt=function(t,e,n){var i=this;return this.useSoftware?new Promise((function(r,o){i.softwareDecrypt(new Uint8Array(t),e,n);var a=i.flush();a?r(a.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(t),e,n)},e.softwareDecrypt=function(t,e,n){var i=this.currentIV,r=this.currentResult,o=this.remainderData;this.logOnce("JS AES decrypt"),o&&(t=ne(o,t),this.remainderData=null);var a=this.getValidChunk(t);if(!a.length)return null;i&&(n=i);var s=this.softwareDecrypter;s||(s=this.softwareDecrypter=new zi),s.expandKey(e);var l=r;return this.currentResult=s.decrypt(a.buffer,0,n),this.currentIV=ft(a,-16).buffer,l||null},e.webCryptoDecrypt=function(t,e,n){var i=this;if(this.key!==e||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(t,e,n));this.key=e,this.fastAesKey=new qi(this.subtle,e)}return this.fastAesKey.expandKey().then((function(e){return i.subtle?(i.logOnce("WebCrypto AES decrypt"),new Wi(i.subtle,new Uint8Array(n)).decrypt(t.buffer,e)):Promise.reject(new Error("web crypto not initialized"))})).catch((function(r){return N.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+r.name+": "+r.message),i.onWebCryptoError(t,e,n)}))},e.onWebCryptoError=function(t,e,n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(t,e,n);var i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},e.getValidChunk=function(t){var e=t,n=t.length-t.length%Xi;return n!==t.length&&(e=ft(t,0,n),this.remainderData=ft(t,n)),e},e.logOnce=function(t){this.logEnabled&&(N.log("[decrypter]: "+t),this.logEnabled=!1)},t}(),$i={toString:function(t){for(var e="",n=t.length,i=0;i<n;i++)e+="["+t.start(i).toFixed(3)+"-"+t.end(i).toFixed(3)+"]";return e}},Qi={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},Zi=function(t){function e(e,n,i,r,o){var a;return(a=t.call(this)||this).hls=void 0,a.fragPrevious=null,a.fragCurrent=null,a.fragmentTracker=void 0,a.transmuxer=null,a._state=Qi.STOPPED,a.playlistType=void 0,a.media=null,a.mediaBuffer=null,a.config=void 0,a.bitrateTest=!1,a.lastCurrentTime=0,a.nextLoadPosition=0,a.startPosition=0,a.startTimeOffset=null,a.loadedmetadata=!1,a.retryDate=0,a.levels=null,a.fragmentLoader=void 0,a.keyLoader=void 0,a.levelLastLoaded=null,a.startFragRequested=!1,a.decrypter=void 0,a.initPTS=[],a.onvseeking=null,a.onvended=null,a.logPrefix="",a.log=void 0,a.warn=void 0,a.playlistType=o,a.logPrefix=r,a.log=N.log.bind(N,r+":"),a.warn=N.warn.bind(N,r+":"),a.hls=e,a.fragmentLoader=new Gi(e.config),a.keyLoader=i,a.fragmentTracker=n,a.config=e.config,a.decrypter=new Ji(e.config),e.on(D.MANIFEST_LOADED,a.onManifestLoaded,v(a)),a}c(e,t);var n=e.prototype;return n.doTick=function(){this.onTickEnd()},n.onTickEnd=function(){},n.startLoad=function(t){},n.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var t=this.fragCurrent;null!=t&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Qi.STOPPED},n._streamEnded=function(t,e){if(e.live||t.nextStart||!t.end||!this.media)return!1;var n=e.partList;if(null!=n&&n.length){var i=n[n.length-1];return _i.isBuffered(this.media,i.start+i.duration/2)}var r=e.fragments[e.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(r)},n.getLevelDetails=function(){var t;if(this.levels&&null!==this.levelLastLoaded)return null==(t=this.levelLastLoaded)?void 0:t.details},n.onMediaAttached=function(t,e){var n=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),n.addEventListener("seeking",this.onvseeking),n.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.state===Qi.STOPPED&&this.startLoad(i.startPosition)},n.onMediaDetaching=function(){var t=this.media;null!=t&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&this.onvseeking&&this.onvended&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},n.onMediaSeeking=function(){var t=this.config,e=this.fragCurrent,n=this.media,i=this.mediaBuffer,r=this.state,o=n?n.currentTime:0,a=_i.bufferInfo(i||n,o,t.maxBufferHole);if(this.log("media seeking to "+(w(o)?o.toFixed(3):o)+", state: "+r),this.state===Qi.ENDED)this.resetLoadingState();else if(e){var s=t.maxFragLookUpTolerance,l=e.start-s,u=e.start+e.duration+s;if(!a.len||u<a.start||l>a.end){var c=o>u;(o<l||c)&&(c&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}n&&(this.fragmentTracker.removeFragmentsInRange(o,1/0,this.playlistType,!0),this.lastCurrentTime=o),this.loadedmetadata||a.len||(this.nextLoadPosition=this.startPosition=o),this.tickImmediate()},n.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},n.onManifestLoaded=function(t,e){this.startTimeOffset=e.startTimeOffset,this.initPTS=[]},n.onHandlerDestroying=function(){this.hls.off(D.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),t.prototype.onHandlerDestroying.call(this),this.hls=null},n.onHandlerDestroyed=function(){this.state=Qi.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,t.prototype.onHandlerDestroyed.call(this)},n.loadFragment=function(t,e,n){this._loadFragForPlayback(t,e,n)},n._loadFragForPlayback=function(t,e,n){var i=this,r=function(e){if(i.fragContextChanged(t))return i.warn("Fragment "+t.sn+(e.part?" p: "+e.part.index:"")+" of level "+t.level+" was dropped during download."),void i.fragmentTracker.removeFragment(t);t.stats.chunkCount++,i._handleFragmentLoadProgress(e)};this._doFragLoad(t,e,n,r).then((function(e){if(e){var n=i.state;i.fragContextChanged(t)?(n===Qi.FRAG_LOADING||!i.fragCurrent&&n===Qi.PARSING)&&(i.fragmentTracker.removeFragment(t),i.state=Qi.IDLE):("payload"in e&&(i.log("Loaded fragment "+t.sn+" of level "+t.level),i.hls.trigger(D.FRAG_LOADED,e)),i._handleFragmentLoadComplete(e))}})).catch((function(e){i.state!==Qi.STOPPED&&i.state!==Qi.ERROR&&(i.warn("Frag error: "+((null==e?void 0:e.message)||e)),i.resetFragmentLoading(t))}))},n.clearTrackerIfNeeded=function(t){var e,n=this.fragmentTracker;if(n.getState(t)===wi.APPENDING){var i=t.type,r=this.getFwdBufferInfo(this.mediaBuffer,i),o=Math.max(t.duration,r?r.len:this.config.maxBufferLength),a=this.backtrackFragment;(1==(a?t.sn-a.sn:0)||this.reduceMaxBufferLength(o,t.duration))&&n.removeFragment(t)}else 0===(null==(e=this.mediaBuffer)?void 0:e.buffered.length)?n.removeAllFragments():n.hasParts(t.type)&&(n.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),n.getState(t)===wi.PARTIAL&&n.removeFragment(t))},n.checkLiveUpdate=function(t){if(t.updated&&!t.live){var e=t.fragments[t.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type})}t.fragments[0]||(t.deltaUpdateFailed=!0)},n.flushMainBuffer=function(t,e,n){if(void 0===n&&(n=null),t-e){var i={startOffset:t,endOffset:e,type:n};this.hls.trigger(D.BUFFER_FLUSHING,i)}},n._loadInitSegment=function(t,e){var n=this;this._doFragLoad(t,e).then((function(e){if(!e||n.fragContextChanged(t)||!n.levels)throw new Error("init load aborted");return e})).then((function(e){var i=n.hls,r=e.payload,o=t.decryptdata;if(r&&r.byteLength>0&&null!=o&&o.key&&o.iv&&"AES-128"===o.method){var a=self.performance.now();return n.decrypter.decrypt(new Uint8Array(r),o.key.buffer,o.iv.buffer).catch((function(e){throw i.trigger(D.ERROR,{type:R.MEDIA_ERROR,details:_.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e})).then((function(r){var o=self.performance.now();return i.trigger(D.FRAG_DECRYPTED,{frag:t,payload:r,stats:{tstart:a,tdecrypt:o}}),e.payload=r,n.completeInitSegmentLoad(e)}))}return n.completeInitSegmentLoad(e)})).catch((function(e){n.state!==Qi.STOPPED&&n.state!==Qi.ERROR&&(n.warn(e),n.resetFragmentLoading(t))}))},n.completeInitSegmentLoad=function(t){if(!this.levels)throw new Error("init load aborted, missing levels");var e=t.frag.stats;this.state=Qi.IDLE,t.frag.data=new Uint8Array(t.payload),e.parsing.start=e.buffering.start=self.performance.now(),e.parsing.end=e.buffering.end=self.performance.now(),this.tick()},n.fragContextChanged=function(t){var e=this.fragCurrent;return!t||!e||t.sn!==e.sn||t.level!==e.level},n.fragBufferedComplete=function(t,e){var n,i,r,o,a=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered "+t.type+" sn: "+t.sn+(e?" part: "+e.index:"")+" of "+(this.playlistType===$e.MAIN?"level":"track")+" "+t.level+" (frag:["+(null!=(n=t.startPTS)?n:NaN).toFixed(3)+"-"+(null!=(i=t.endPTS)?i:NaN).toFixed(3)+"] > buffer:"+(a?$i.toString(_i.getBuffered(a)):"(detached)")+")"),"initSegment"!==t.sn){var s;if(t.type!==$e.SUBTITLE){var l=t.elementaryStreams;if(!Object.keys(l).some((function(t){return!!l[t]})))return void(this.state=Qi.IDLE)}var u=null==(s=this.levels)?void 0:s[t.level];null!=u&&u.fragmentError&&(this.log("Resetting level fragment error count of "+u.fragmentError+" on frag buffered"),u.fragmentError=0)}this.state=Qi.IDLE,a&&(!this.loadedmetadata&&t.type==$e.MAIN&&a.buffered.length&&(null==(r=this.fragCurrent)?void 0:r.sn)===(null==(o=this.fragPrevious)?void 0:o.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},n.seekToStartPos=function(){},n._handleFragmentLoadComplete=function(t){var e=this.transmuxer;if(e){var n=t.frag,i=t.part,r=t.partsLoaded,o=!r||0===r.length||r.some((function(t){return!t})),a=new Ci(n.level,n.sn,n.stats.chunkCount+1,0,i?i.index:-1,!o);e.flush(a)}},n._handleFragmentLoadProgress=function(t){},n._doFragLoad=function(t,e,n,i){var r,o=this;void 0===n&&(n=null);var a=null==e?void 0:e.details;if(!this.levels||!a)throw new Error("frag load aborted, missing level"+(a?"":" detail")+"s");var s=null;if(!t.encrypted||null!=(r=t.decryptdata)&&r.key?!t.encrypted&&a.encryptedFragments.length&&this.keyLoader.loadClear(t,a.encryptedFragments):(this.log("Loading key for "+t.sn+" of ["+a.startSN+"-"+a.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level),this.state=Qi.KEY_LOADING,this.fragCurrent=t,s=this.keyLoader.load(t).then((function(t){if(!o.fragContextChanged(t.frag))return o.hls.trigger(D.KEY_LOADED,t),o.state===Qi.KEY_LOADING&&(o.state=Qi.IDLE),t})),this.hls.trigger(D.KEY_LOADING,{frag:t}),null===this.fragCurrent&&(s=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),n=Math.max(t.start,n||0),this.config.lowLatencyMode&&"initSegment"!==t.sn){var l=a.partList;if(l&&i){n>t.end&&a.fragmentHint&&(t=a.fragmentHint);var u=this.getNextPart(l,t,n);if(u>-1){var c,d=l[u];return this.log("Loading part sn: "+t.sn+" p: "+d.index+" cc: "+t.cc+" of playlist ["+a.startSN+"-"+a.endSN+"] parts [0-"+u+"-"+(l.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(n.toFixed(3))),this.nextLoadPosition=d.start+d.duration,this.state=Qi.FRAG_LOADING,c=s?s.then((function(n){return!n||o.fragContextChanged(n.frag)?null:o.doFragPartsLoad(t,d,e,i)})).catch((function(t){return o.handleFragLoadError(t)})):this.doFragPartsLoad(t,d,e,i).catch((function(t){return o.handleFragLoadError(t)})),this.hls.trigger(D.FRAG_LOADING,{frag:t,part:d,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!t.url||this.loadedEndOfParts(l,n))return Promise.resolve(null)}}this.log("Loading fragment "+t.sn+" cc: "+t.cc+" "+(a?"of ["+a.startSN+"-"+a.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(n.toFixed(3))),w(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=Qi.FRAG_LOADING;var h,f=this.config.progressive;return h=f&&s?s.then((function(e){return!e||o.fragContextChanged(null==e?void 0:e.frag)?null:o.fragmentLoader.load(t,i)})).catch((function(t){return o.handleFragLoadError(t)})):Promise.all([this.fragmentLoader.load(t,f?i:void 0),s]).then((function(t){var e=t[0];return!f&&e&&i&&i(e),e})).catch((function(t){return o.handleFragLoadError(t)})),this.hls.trigger(D.FRAG_LOADING,{frag:t,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):h},n.doFragPartsLoad=function(t,e,n,i){var r=this;return new Promise((function(o,a){var s,l=[],u=null==(s=n.details)?void 0:s.partList;!function e(s){r.fragmentLoader.loadPart(t,s,i).then((function(i){l[s.index]=i;var a=i.part;r.hls.trigger(D.FRAG_LOADED,i);var c=Fn(n,t.sn,s.index+1)||Bn(u,t.sn,s.index+1);if(!c)return o({frag:t,part:a,partsLoaded:l});e(c)})).catch(a)}(e)}))},n.handleFragLoadError=function(t){if("data"in t){var e=t.data;t.data&&e.details===_.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):this.hls.trigger(D.ERROR,e)}else this.hls.trigger(D.ERROR,{type:R.OTHER_ERROR,details:_.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null},n._handleTransmuxerFlush=function(t){var e=this.getCurrentContext(t);if(e&&this.state===Qi.PARSING){var n=e.frag,i=e.part,r=e.level,o=self.performance.now();n.stats.parsing.end=o,i&&(i.stats.parsing.end=o),this.updateLevelTiming(n,i,r,t.partial)}else this.fragCurrent||this.state===Qi.STOPPED||this.state===Qi.ERROR||(this.state=Qi.IDLE)},n.getCurrentContext=function(t){var e=this.levels,n=this.fragCurrent,i=t.level,r=t.sn,o=t.part;if(null==e||!e[i])return this.warn("Levels object was unset while buffering fragment "+r+" of level "+i+". The current chunk will not be buffered."),null;var a=e[i],s=o>-1?Fn(a,r,o):null,l=s?s.fragment:Nn(a,r,n);return l?(n&&n!==l&&(l.stats=n.stats),{frag:l,part:s,level:a}):null},n.bufferFragmentData=function(t,e,n,i,r){var o;if(t&&this.state===Qi.PARSING){var a=t.data1,s=t.data2,l=a;if(a&&s&&(l=ne(a,s)),null!=(o=l)&&o.length){var u={type:t.type,frag:e,part:n,chunkMeta:i,parent:e.type,data:l};if(this.hls.trigger(D.BUFFER_APPENDING,u),t.dropped&&t.independent&&!n){if(r)return;this.flushBufferGap(e)}}}},n.flushBufferGap=function(t){var e=this.media;if(e)if(_i.isBuffered(e,e.currentTime)){var n=e.currentTime,i=_i.bufferInfo(e,n,0),r=t.duration,o=Math.min(2*this.config.maxFragLookUpTolerance,.25*r),a=Math.max(Math.min(t.start-o,i.end-o),n+o);t.start-a>o&&this.flushMainBuffer(a,t.start)}else this.flushMainBuffer(0,t.start)},n.getFwdBufferInfo=function(t,e){var n=this.getLoadPosition();return w(n)?this.getFwdBufferInfoAtPos(t,n,e):null},n.getFwdBufferInfoAtPos=function(t,e,n){var i=this.config.maxBufferHole,r=_i.bufferInfo(t,e,i);if(0===r.len&&void 0!==r.nextStart){var o=this.fragmentTracker.getBufferedFrag(e,n);if(o&&r.nextStart<o.end)return _i.bufferInfo(t,e,Math.max(r.nextStart,i))}return r},n.getMaxBufferLength=function(t){var e,n=this.config;return e=t?Math.max(8*n.maxBufferSize/t,n.maxBufferLength):n.maxBufferLength,Math.min(e,n.maxMaxBufferLength)},n.reduceMaxBufferLength=function(t,e){var n=this.config,i=Math.max(Math.min(t-e,n.maxBufferLength),e),r=Math.max(t-3*e,n.maxMaxBufferLength/2,i);return r>=i&&(n.maxMaxBufferLength=r,this.warn("Reduce max buffer length to "+r+"s"),!0)},n.getAppendedFrag=function(t,e){var n=this.fragmentTracker.getAppendedFrag(t,$e.MAIN);return n&&"fragment"in n?n.fragment:n},n.getNextFragment=function(t,e){var n=e.fragments,i=n.length;if(!i)return null;var r,o=this.config,a=n[0].start;if(e.live){var s=o.initialLiveManifestSize;if(i<s)return this.warn("Not enough fragments to start playback (have: "+i+", need: "+s+")"),null;(!e.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||t<a)&&(r=this.getInitialLiveFragment(e,n),this.startPosition=this.nextLoadPosition=r?this.hls.liveSyncPosition||r.start:t)}else t<=a&&(r=n[0]);if(!r){var l=o.lowLatencyMode?e.partEnd:e.fragmentEnd;r=this.getFragmentAtPosition(t,l,e)}return this.mapToInitFragWhenRequired(r)},n.isLoopLoading=function(t,e){var n=this.fragmentTracker.getState(t);return(n===wi.OK||n===wi.PARTIAL&&!!t.gap)&&this.nextLoadPosition>e},n.getNextFragmentLoopLoading=function(t,e,n,i,r){var o=t.gap,a=this.getNextFragment(this.nextLoadPosition,e);if(null===a)return a;if(t=a,o&&t&&!t.gap&&n.nextStart){var s=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,i);if(null!==s&&n.len+s.len>=r)return this.log('buffer full after gaps in "'+i+'" playlist starting at sn: '+t.sn),null}return t},n.mapToInitFragWhenRequired=function(t){return null==t||!t.initSegment||null!=t&&t.initSegment.data||this.bitrateTest?t:t.initSegment},n.getNextPart=function(t,e,n){for(var i=-1,r=!1,o=!0,a=0,s=t.length;a<s;a++){var l=t[a];if(o=o&&!l.independent,i>-1&&n<l.start)break;var u=l.loaded;u?i=-1:(r||l.independent||o)&&l.fragment===e&&(i=a),r=u}return i},n.loadedEndOfParts=function(t,e){var n=t[t.length-1];return n&&e>n.start&&n.loaded},n.getInitialLiveFragment=function(t,e){var n=this.fragPrevious,i=null;if(n){if(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+n.programDateTime),i=Yn(e,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){var r=n.sn+1;if(r>=t.startSN&&r<=t.endSN){var o=e[r-t.startSN];n.cc===o.cc&&(i=o,this.log("Live playlist, switching playlist, load frag with next SN: "+i.sn))}i||(i=Qn(e,n.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+i.sn)}}else{var a=this.hls.liveSyncPosition;null!==a&&(i=this.getFragmentAtPosition(a,this.bitrateTest?t.fragmentEnd:t.edge,t))}return i},n.getFragmentAtPosition=function(t,e,n){var i,r=this.config,o=this.fragPrevious,a=n.fragments,s=n.endSN,l=n.fragmentHint,u=r.maxFragLookUpTolerance,c=n.partList,d=!!(r.lowLatencyMode&&null!=c&&c.length&&l);if(d&&l&&!this.bitrateTest&&(a=a.concat(l),s=l.sn),i=t<e?zn(o,a,t,t>e-u?0:u):a[a.length-1]){var h=i.sn-n.startSN,f=this.fragmentTracker.getState(i);if((f===wi.OK||f===wi.PARTIAL&&i.gap)&&(o=i),o&&i.sn===o.sn&&(!d||c[0].fragment.sn>i.sn)&&o&&i.level===o.level){var p=a[h+1];i=i.sn<s&&this.fragmentTracker.getState(p)!==wi.OK?p:null}}return i},n.synchronizeToLiveEdge=function(t){var e=this.config,n=this.media;if(n){var i=this.hls.liveSyncPosition,r=n.currentTime,o=t.fragments[0].start,a=t.edge,s=r>=o-e.maxFragLookUpTolerance&&r<=a;if(null!==i&&n.duration>i&&(r<i||!s)){var l=void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;(!s&&n.readyState<4||r<a-l)&&(this.loadedmetadata||(this.nextLoadPosition=i),n.readyState&&(this.warn("Playback: "+r.toFixed(3)+" is located too far from the end of live sliding playlist: "+a+", reset currentTime to : "+i.toFixed(3)),n.currentTime=i))}}},n.alignPlaylists=function(t,e,n){var i=t.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;var r=t.fragments[0].start,o=!e,a=t.alignedSliding&&w(r);if(o||!a&&!r){var s=this.fragPrevious;Fi(s,n,t);var l=t.fragments[0].start;return this.log("Live playlist sliding: "+l.toFixed(2)+" start-sn: "+(e?e.startSN:"na")+"->"+t.startSN+" prev-sn: "+(s?s.sn:"na")+" fragments: "+i),l}return r},n.waitForCdnTuneIn=function(t){var e=3;return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,t.partTarget*e)},n.setStartPosition=function(t,e){var n=this.startPosition;if(n<e&&(n=-1),-1===n||-1===this.lastCurrentTime){var i=null!==this.startTimeOffset,r=i?this.startTimeOffset:t.startTimeOffset;null!==r&&w(r)?(n=e+r,r<0&&(n+=t.totalduration),n=Math.min(Math.max(e,n),e+t.totalduration),this.log("Start time offset "+r+" found in "+(i?"multivariant":"media")+" playlist, adjust startPosition to "+n),this.startPosition=n):t.live?n=this.hls.liveSyncPosition||e:this.startPosition=n=0,this.lastCurrentTime=n}this.nextLoadPosition=n},n.getLoadPosition=function(){var t=this.media,e=0;return this.loadedmetadata&&t?e=t.currentTime:this.nextLoadPosition&&(e=this.nextLoadPosition),e},n.handleFragLoadAborted=function(t,e){this.transmuxer&&"initSegment"!==t.sn&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(e?" part "+e.index:"")+" of level "+t.level+" was aborted"),this.resetFragmentLoading(t))},n.resetFragmentLoading=function(t){this.fragCurrent&&(this.fragContextChanged(t)||this.state===Qi.FRAG_LOADING_WAITING_RETRY)||(this.state=Qi.IDLE)},n.onFragmentOrKeyLoadError=function(t,e){if(e.chunkMeta&&!e.frag){var n=this.getCurrentContext(e.chunkMeta);n&&(e.frag=n.frag)}var i=e.frag;if(i&&i.type===t&&this.levels)if(this.fragContextChanged(i)){var r;this.warn("Frag load error must match current frag to retry "+i.url+" > "+(null==(r=this.fragCurrent)?void 0:r.url))}else{var o=e.details===_.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(i,!0);var a=e.errorAction,s=a||{},l=s.action,u=s.retryCount,c=void 0===u?0:u,d=s.retryConfig;if(a&&l===Zn.RetryRequest&&d){this.resetStartWhenNotLoaded(this.levelLastLoaded);var h=Vn(d,c);this.warn("Fragment "+i.sn+" of "+t+" "+i.level+" errored with "+e.details+", retrying loading "+(c+1)+"/"+d.maxNumRetry+" in "+h+"ms"),a.resolved=!0,this.retryDate=self.performance.now()+h,this.state=Qi.FRAG_LOADING_WAITING_RETRY}else if(d&&a){if(this.resetFragmentErrors(t),!(c<d.maxNumRetry))return void N.warn(e.details+" reached or exceeded max retry ("+c+")");o||l===Zn.RemoveAlternatePermanently||(a.resolved=!0)}else(null==a?void 0:a.action)===Zn.SendAlternateToPenaltyBox?this.state=Qi.WAITING_LEVEL:this.state=Qi.ERROR;this.tickImmediate()}},n.reduceLengthAndFlushBuffer=function(t){if(this.state===Qi.PARSING||this.state===Qi.PARSED){var e=t.frag,n=t.parent,i=this.getFwdBufferInfo(this.mediaBuffer,n),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len,(null==e?void 0:e.duration)||10);var o=!r;return o&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+n+" buffer"),e&&(this.fragmentTracker.removeFragment(e),this.nextLoadPosition=e.start),this.resetLoadingState(),o}return!1},n.resetFragmentErrors=function(t){t===$e.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==Qi.STOPPED&&(this.state=Qi.IDLE)},n.afterBufferFlushed=function(t,e,n){if(t){var i=_i.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,i,n),this.state===Qi.ENDED&&this.resetLoadingState()}},n.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Qi.IDLE},n.resetStartWhenNotLoaded=function(t){if(!this.loadedmetadata){this.startFragRequested=!1;var e=t?t.details:null;null!=e&&e.live?(this.startPosition=-1,this.setStartPosition(e,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},n.resetWhenMissingContext=function(t){this.warn("The loading context changed while buffering fragment "+t.sn+" of level "+t.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()},n.removeUnbufferedFrags=function(t){void 0===t&&(t=0),this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)},n.updateLevelTiming=function(t,e,n,i){var r,o=this,a=n.details;if(a){if(!Object.keys(t.elementaryStreams).reduce((function(e,r){var s=t.elementaryStreams[r];if(s){var l=s.endPTS-s.startPTS;if(l<=0)return o.warn("Could not parse fragment "+t.sn+" "+r+" duration reliably ("+l+")"),e||!1;var u=i?0:Rn(a,t,s.startPTS,s.endPTS,s.startDTS,s.endDTS);return o.hls.trigger(D.LEVEL_PTS_UPDATED,{details:a,level:n,drift:u,type:r,frag:t,start:s.startPTS,end:s.endPTS}),!0}return e}),!1)&&null===(null==(r=this.transmuxer)?void 0:r.error)){var s=new Error("Found no media in fragment "+t.sn+" of level "+t.level+" resetting transmuxer to fallback to playlist timing");if(0===n.fragmentError&&(n.fragmentError++,t.gap=!0,this.fragmentTracker.removeFragment(t),this.fragmentTracker.fragBuffered(t,!0)),this.warn(s.message),this.hls.trigger(D.ERROR,{type:R.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!1,error:s,frag:t,reason:"Found no media in msn "+t.sn+' of level "'+n.url+'"'}),!this.hls)return;this.resetTransmuxer()}this.state=Qi.PARSED,this.hls.trigger(D.FRAG_PARSED,{frag:t,part:e})}else this.warn("level.details undefined")},n.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},n.recoverWorkerError=function(t){"demuxerWorker"===t.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())},s(e,[{key:"state",get:function(){return this._state},set:function(t){var e=this._state;e!==t&&(this._state=t,this.log(e+"->"+t))}}]),e}(Si),tr=function(){function t(){this.chunks=[],this.dataLength=0}var e=t.prototype;return e.push=function(t){this.chunks.push(t),this.dataLength+=t.length},e.flush=function(){var t,e=this.chunks,n=this.dataLength;return e.length?(t=1===e.length?e[0]:er(e,n),this.reset(),t):new Uint8Array(0)},e.reset=function(){this.chunks.length=0,this.dataLength=0},t}();function er(t,e){for(var n=new Uint8Array(e),i=0,r=0;r<t.length;r++){var o=t[r];n.set(o,i),i+=o.length}return n}function nr(t,e){return void 0===t&&(t=""),void 0===e&&(e=9e4),{type:t,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}var ir=function(){function t(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var e=t.prototype;return e.resetInitSegment=function(t,e,n,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},e.resetTimeStamp=function(t){this.initPTS=t,this.resetContiguity()},e.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},e.canParse=function(t,e){return!1},e.appendFrame=function(t,e,n){},e.demux=function(t,e){this.cachedData&&(t=ne(this.cachedData,t),this.cachedData=null);var n,i=vt(t,0),r=i?i.length:0,o=this._audioTrack,a=this._id3Track,s=i?Et(i):void 0,l=t.length;for((null===this.basePTS||0===this.frameIndex&&w(s))&&(this.basePTS=rr(s,e,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),i&&i.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:un.audioId3,duration:Number.POSITIVE_INFINITY});r<l;){if(this.canParse(t,r)){var u=this.appendFrame(o,t,r);u?(this.frameIndex++,this.lastPTS=u.sample.pts,n=r+=u.length):r=l}else bt(t,r)?(i=vt(t,r),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:un.audioId3,duration:Number.POSITIVE_INFINITY}),n=r+=i.length):r++;if(r===l&&n!==l){var c=ft(t,n);this.cachedData?this.cachedData=ne(this.cachedData,c):this.cachedData=c}}return{audioTrack:o,videoTrack:nr(),id3Track:a,textTrack:nr()}},e.demuxSampleAes=function(t,e,n){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},e.flush=function(t){var e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:nr(),id3Track:this._id3Track,textTrack:nr()}},e.destroy=function(){},t}(),rr=function(t,e,n){return w(t)?90*t:9e4*e+(n?9e4*n.baseTime/n.timescale:0)};function or(t,e,n,i){var r,o,a,s,l=navigator.userAgent.toLowerCase(),u=i,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=1+((192&e[n+2])>>>6);var d=(60&e[n+2])>>>2;if(!(d>c.length-1))return a=(1&e[n+2])<<2,a|=(192&e[n+3])>>>6,N.log("manifest codec:"+i+", ADTS type:"+r+", samplingIndex:"+d),/firefox/i.test(l)?d>=6?(r=5,s=new Array(4),o=d-3):(r=2,s=new Array(2),o=d):-1!==l.indexOf("android")?(r=2,s=new Array(2),o=d):(r=5,s=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&d>=6?o=d-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(d>=6&&1===a||/vivaldi/i.test(l))||!i&&1===a)&&(r=2,s=new Array(2)),o=d)),s[0]=r<<3,s[0]|=(14&d)>>1,s[1]|=(1&d)<<7,s[1]|=a<<3,5===r&&(s[1]|=(14&o)>>1,s[2]=(1&o)<<7,s[2]|=8,s[3]=0),{config:s,samplerate:c[d],channelCount:a,codec:"mp4a.40."+r,manifestCodec:u};var h=new Error("invalid ADTS sampling index:"+d);t.emit(D.ERROR,D.ERROR,{type:R.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!0,error:h,reason:h.message})}function ar(t,e){return 255===t[e]&&240==(246&t[e+1])}function sr(t,e){return 1&t[e+1]?7:9}function lr(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function ur(t,e){return e+5<t.length}function cr(t,e){return e+1<t.length&&ar(t,e)}function dr(t,e){return ur(t,e)&&ar(t,e)&&lr(t,e)<=t.length-e}function hr(t,e){if(cr(t,e)){var n=sr(t,e);if(e+n>=t.length)return!1;var i=lr(t,e);if(i<=n)return!1;var r=e+i;return r===t.length||cr(t,r)}return!1}function fr(t,e,n,i,r){if(!t.samplerate){var o=or(e,n,i,r);if(!o)return;t.config=o.config,t.samplerate=o.samplerate,t.channelCount=o.channelCount,t.codec=o.codec,t.manifestCodec=o.manifestCodec,N.log("parsed codec:"+t.codec+", rate:"+o.samplerate+", channels:"+o.channelCount)}}function pr(t){return 9216e4/t}function gr(t,e){var n=sr(t,e);if(e+n<=t.length){var i=lr(t,e)-n;if(i>0)return{headerLength:n,frameLength:i}}}function mr(t,e,n,i,r){var o,a=i+r*pr(t.samplerate),s=gr(e,n);if(s){var l=s.frameLength,u=s.headerLength,c=u+l,d=Math.max(0,n+c-e.length);d?(o=new Uint8Array(c-u)).set(e.subarray(n+u,e.length),0):o=e.subarray(n+u,n+c);var h={unit:o,pts:a};return d||t.samples.push(h),{sample:h,length:c,missing:d}}var f=e.length-n;return(o=new Uint8Array(f)).set(e.subarray(n,e.length),0),{sample:{unit:o,pts:a},length:f,missing:-1}}var vr=null,yr=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],br=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Er=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Tr=[0,1,1,4];function Ar(t,e,n,i,r){if(!(n+24>e.length)){var o=Sr(e,n);if(o&&n+o.frameLength<=e.length){var a=i+r*(9e4*o.samplesPerFrame/o.sampleRate),s={unit:e.subarray(n,n+o.frameLength),pts:a,dts:a};return t.config=[],t.channelCount=o.channelCount,t.samplerate=o.sampleRate,t.samples.push(s),{sample:s,length:o.frameLength,missing:0}}}}function Sr(t,e){var n=t[e+1]>>3&3,i=t[e+1]>>1&3,r=t[e+2]>>4&15,o=t[e+2]>>2&3;if(1!==n&&0!==r&&15!==r&&3!==o){var a=t[e+2]>>1&1,s=t[e+3]>>6,l=1e3*yr[14*(3===n?3-i:3===i?3:4)+r-1],u=br[3*(3===n?0:2===n?1:2)+o],c=3===s?1:2,d=Er[n][i],h=Tr[i],f=8*d*h,p=Math.floor(d*l/u+a)*h;if(null===vr){var g=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);vr=g?parseInt(g[1]):0}return!!vr&&vr<=87&&2===i&&l>=224e3&&0===s&&(t[e+3]=128|t[e+3]),{sampleRate:u,channelCount:c,frameLength:p,samplesPerFrame:f}}}function wr(t,e){return!(255!==t[e]||224&~t[e+1]||!(6&t[e+1]))}function Lr(t,e){return e+1<t.length&&wr(t,e)}function xr(t,e){var n=4;return wr(t,e)&&n<=t.length-e}function Dr(t,e){if(e+1<t.length&&wr(t,e)){var n=4,i=Sr(t,e),r=n;null!=i&&i.frameLength&&(r=i.frameLength);var o=e+r;return o===t.length||Lr(t,o)}return!1}var Rr=function(t){function e(e,n){var i;return(i=t.call(this)||this).observer=void 0,i.config=void 0,i.observer=e,i.config=n,i}c(e,t);var n=e.prototype;return n.resetInitSegment=function(e,n,i,r){t.prototype.resetInitSegment.call(this,e,n,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:n,duration:r,inputTimeScale:9e4,dropped:0}},e.probe=function(t){if(!t)return!1;var e=vt(t,0),n=(null==e?void 0:e.length)||0;if(Dr(t,n))return!1;for(var i=t.length;n<i;n++)if(hr(t,n))return N.log("ADTS sync word found !"),!0;return!1},n.canParse=function(t,e){return dr(t,e)},n.appendFrame=function(t,e,n){fr(t,this.observer,e,n,t.manifestCodec);var i=mr(t,e,n,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i},e}(ir),_r=/\/emsg[-/]ID3/i,Cr=function(){function t(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}var e=t.prototype;return e.resetTimeStamp=function(){},e.resetInitSegment=function(t,e,n,i){var r=this.videoTrack=nr("video",1),o=this.audioTrack=nr("audio",1),a=this.txtTrack=nr("text",1);if(this.id3Track=nr("id3",1),this.timeOffset=0,null!=t&&t.byteLength){var s=Kt(t);if(s.video){var l=s.video,u=l.id,c=l.timescale,d=l.codec;r.id=u,r.timescale=a.timescale=c,r.codec=d}if(s.audio){var h=s.audio,f=h.id,p=h.timescale,g=h.codec;o.id=f,o.timescale=p,o.codec=g}a.id=Pt.text,r.sampleDuration=0,r.duration=o.duration=i}},e.resetContiguity=function(){this.remainderData=null},t.probe=function(t){return Gt(t)},e.demux=function(t,e){this.timeOffset=e;var n=t,i=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=ne(this.remainderData,t));var o=ee(n);this.remainderData=o.remainder,i.samples=o.valid||new Uint8Array}else i.samples=n;var a=this.extractID3Track(i,e);return r.samples=ie(e,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}},e.flush=function(){var t=this.timeOffset,e=this.videoTrack,n=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;var i=this.extractID3Track(e,this.timeOffset);return n.samples=ie(t,e),{videoTrack:e,audioTrack:nr(),id3Track:i,textTrack:nr()}},e.extractID3Track=function(t,e){var n=this.id3Track;if(t.samples.length){var i=Vt(t.samples,["emsg"]);i&&i.forEach((function(t){var i=le(t);if(_r.test(i.schemeIdUri)){var r=w(i.presentationTime)?i.presentationTime/i.timeScale:e+i.presentationTimeDelta/i.timeScale,o=4294967295===i.eventDuration?Number.POSITIVE_INFINITY:i.eventDuration/i.timeScale;o<=.001&&(o=Number.POSITIVE_INFINITY);var a=i.payload;n.samples.push({data:a,len:a.byteLength,dts:r,pts:r,type:un.emsg,duration:o})}}))}return n},e.demuxSampleAes=function(t,e,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},e.destroy=function(){},t}(),kr=function(t,e){var n=0,i=5;e+=i;for(var r=new Uint32Array(1),o=new Uint32Array(1),a=new Uint8Array(1);i>0;){a[0]=t[e];var s=Math.min(i,8),l=8-s;o[0]=4278190080>>>24+l<<l,r[0]=(a[0]&o[0])>>l,n=n?n<<s|r[0]:r[0],e+=1,i-=s}return n},Ir=function(t){function e(e){var n;return(n=t.call(this)||this).observer=void 0,n.observer=e,n}c(e,t);var n=e.prototype;return n.resetInitSegment=function(e,n,i,r){t.prototype.resetInitSegment.call(this,e,n,i,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:n,duration:r,inputTimeScale:9e4,dropped:0}},n.canParse=function(t,e){return e+64<t.length},n.appendFrame=function(t,e,n){var i=Or(t,e,n,this.basePTS,this.frameIndex);if(-1!==i)return{sample:t.samples[t.samples.length-1],length:i,missing:0}},e.probe=function(t){if(!t)return!1;var e=vt(t,0);if(!e)return!1;var n=e.length;return 11===t[n]&&119===t[n+1]&&void 0!==Et(e)&&kr(t,n)<16},e}(ir);function Or(t,e,n,i,r){if(n+8>e.length)return-1;if(11!==e[n]||119!==e[n+1])return-1;var o=e[n+4]>>6;if(o>=3)return-1;var a=[48e3,44100,32e3][o],s=63&e[n+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*s+o];if(n+l>e.length)return-1;var u=e[n+6]>>5,c=0;2===u?c+=2:(1&u&&1!==u&&(c+=2),4&u&&(c+=2));var d=(e[n+6]<<8|e[n+7])>>12-c&1,h=[2,1,2,3,3,4,4,5][u]+d,f=e[n+5]>>3,p=7&e[n+5],g=new Uint8Array([o<<6|f<<1|p>>2,(3&p)<<6|u<<3|d<<2|s>>4,s<<4&224]),m=i+r*(1536/a*9e4),v=e.subarray(n,n+l);return t.config=g,t.channelCount=h,t.samplerate=a,t.samples.push({unit:v,pts:m}),l}var Pr=function(){function t(){this.VideoSample=null}var e=t.prototype;return e.createVideoSample=function(t,e,n,i){return{key:t,frame:!1,pts:e,dts:n,units:[],debug:i,length:0}},e.getLastNalUnit=function(t){var e,n,i=this.VideoSample;if(i&&0!==i.units.length||(i=t[t.length-1]),null!=(e=i)&&e.units){var r=i.units;n=r[r.length-1]}return n},e.pushAccessUnit=function(t,e){if(t.units.length&&t.frame){if(void 0===t.pts){var n=e.samples,i=n.length;if(!i)return void e.dropped++;var r=n[i-1];t.pts=r.pts,t.dts=r.dts}e.samples.push(t)}t.debug.length&&N.log(t.pts+"/"+t.dts+":"+t.debug)},t}(),Mr=function(){function t(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}var e=t.prototype;return e.loadWord=function(){var t=this.data,e=this.bytesAvailable,n=t.byteLength-e,i=new Uint8Array(4),r=Math.min(4,e);if(0===r)throw new Error("no bytes available");i.set(t.subarray(n,n+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r},e.skipBits=function(t){var e;t=Math.min(t,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,t-=(e=t>>3)<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},e.readBits=function(t){var e=Math.min(this.bitsAvailable,t),n=this.word>>>32-e;if(t>32&&N.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(e=t-e)>0&&this.bitsAvailable?n<<e|this.readBits(e):n},e.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if(this.word&2147483648>>>t)return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},e.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.skipEG=function(){this.skipBits(1+this.skipLZ())},e.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},e.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},e.readBoolean=function(){return 1===this.readBits(1)},e.readUByte=function(){return this.readBits(8)},e.readUShort=function(){return this.readBits(16)},e.readUInt=function(){return this.readBits(32)},e.skipScalingList=function(t){for(var e=8,n=8,i=0;i<t;i++)0!==n&&(n=(e+this.readEG()+256)%256),e=0===n?e:n},e.readSPS=function(){var t,e,n,i=0,r=0,o=0,a=0,s=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),c=this.readBoolean.bind(this),d=this.skipBits.bind(this),h=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);s();var g=s();if(l(5),d(3),s(),f(),100===g||110===g||122===g||244===g||44===g||83===g||86===g||118===g||128===g){var m=u();if(3===m&&d(1),f(),f(),d(1),c())for(e=3!==m?8:12,n=0;n<e;n++)c()&&p(n<6?16:64)}f();var v=u();if(0===v)u();else if(1===v)for(d(1),h(),h(),t=u(),n=0;n<t;n++)h();f(),d(1);var y=u(),b=u(),E=l(1);0===E&&d(1),d(1),c()&&(i=u(),r=u(),o=u(),a=u());var T=[1,1];if(c()&&c())switch(s()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[s()<<8|s(),s()<<8|s()]}return{width:Math.ceil(16*(y+1)-2*i-2*r),height:(2-E)*(b+1)*16-(E?2:4)*(o+a),pixelRatio:T}},e.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}(),Nr=function(t){function e(){return t.apply(this,arguments)||this}c(e,t);var n=e.prototype;return n.parseAVCPES=function(t,e,n,i,r){var o,a=this,s=this.parseAVCNALu(t,n.data),l=this.VideoSample,u=!1;n.data=null,l&&s.length&&!t.audFound&&(this.pushAccessUnit(l,t),l=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts,"")),s.forEach((function(i){var s;switch(i.type){case 1:var c=!1;o=!0;var d,h=i.data;if(u&&h.length>4){var f=new Mr(h).readSliceType();2!==f&&4!==f&&7!==f&&9!==f||(c=!0)}c&&null!=(d=l)&&d.frame&&!l.key&&(a.pushAccessUnit(l,t),l=a.VideoSample=null),l||(l=a.VideoSample=a.createVideoSample(!0,n.pts,n.dts,"")),l.frame=!0,l.key=c;break;case 5:o=!0,null!=(s=l)&&s.frame&&!l.key&&(a.pushAccessUnit(l,t),l=a.VideoSample=null),l||(l=a.VideoSample=a.createVideoSample(!0,n.pts,n.dts,"")),l.key=!0,l.frame=!0;break;case 6:o=!0,ae(i.data,1,n.pts,e.samples);break;case 7:var p,g;o=!0,u=!0;var m=i.data,v=new Mr(m).readSPS();if(!t.sps||t.width!==v.width||t.height!==v.height||(null==(p=t.pixelRatio)?void 0:p[0])!==v.pixelRatio[0]||(null==(g=t.pixelRatio)?void 0:g[1])!==v.pixelRatio[1]){t.width=v.width,t.height=v.height,t.pixelRatio=v.pixelRatio,t.sps=[m],t.duration=r;for(var y=m.subarray(1,4),b="avc1.",E=0;E<3;E++){var T=y[E].toString(16);T.length<2&&(T="0"+T),b+=T}t.codec=b}break;case 8:o=!0,t.pps=[i.data];break;case 9:o=!0,t.audFound=!0,l&&a.pushAccessUnit(l,t),l=a.VideoSample=a.createVideoSample(!1,n.pts,n.dts,"");break;case 12:o=!0;break;default:o=!1,l&&(l.debug+="unknown NAL "+i.type+" ")}l&&o&&l.units.push(i)})),i&&l&&(this.pushAccessUnit(l,t),this.VideoSample=null)},n.parseAVCNALu=function(t,e){var n,i,r=e.byteLength,o=t.naluState||0,a=o,s=[],l=0,u=-1,c=0;for(-1===o&&(u=0,c=31&e[0],o=0,l=1);l<r;)if(n=e[l++],o)if(1!==o)if(n)if(1===n){if(i=l-o-1,u>=0){var d={data:e.subarray(u,i),type:c};s.push(d)}else{var h=this.getLastNalUnit(t.samples);h&&(a&&l<=4-a&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-a)),i>0&&(h.data=ne(h.data,e.subarray(0,i)),h.state=0))}l<r?(u=l,c=31&e[l],o=0):o=-1}else o=0;else o=3;else o=n?0:2;else o=n?0:1;if(u>=0&&o>=0){var f={data:e.subarray(u,r),type:c,state:o};s.push(f)}if(0===s.length){var p=this.getLastNalUnit(t.samples);p&&(p.data=ne(p.data,e))}return t.naluState=o,s},e}(Pr),Fr=function(){function t(t,e,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new Ji(e,{removePKCS7Padding:!1})}var e=t.prototype;return e.decryptBuffer=function(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer)},e.decryptAacSample=function(t,e,n){var i=this,r=t[e].unit;if(!(r.length<=16)){var o=r.subarray(16,r.length-r.length%16),a=o.buffer.slice(o.byteOffset,o.byteOffset+o.length);this.decryptBuffer(a).then((function(o){var a=new Uint8Array(o);r.set(a,16),i.decrypter.isSync()||i.decryptAacSamples(t,e+1,n)}))}},e.decryptAacSamples=function(t,e,n){for(;;e++){if(e>=t.length)return void n();if(!(t[e].unit.length<32||(this.decryptAacSample(t,e,n),this.decrypter.isSync())))return}},e.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,n=new Int8Array(e),i=0,r=32;r<t.length-16;r+=160,i+=16)n.set(t.subarray(r,r+16),i);return n},e.getAvcDecryptedUnit=function(t,e){for(var n=new Uint8Array(e),i=0,r=32;r<t.length-16;r+=160,i+=16)t.set(n.subarray(i,i+16),r);return t},e.decryptAvcSample=function(t,e,n,i,r){var o=this,a=se(r.data),s=this.getAvcEncryptedData(a);this.decryptBuffer(s.buffer).then((function(s){r.data=o.getAvcDecryptedUnit(a,s),o.decrypter.isSync()||o.decryptAvcSamples(t,e,n+1,i)}))},e.decryptAvcSamples=function(t,e,n,i){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,n=0){if(e>=t.length)return void i();for(var r=t[e].units;!(n>=r.length);n++){var o=r[n];if(!(o.data.length<=48||1!==o.type&&5!==o.type||(this.decryptAvcSample(t,e,n,i,o),this.decrypter.isSync())))return}}},t}(),Br=188,Ur=function(){function t(t,e,n){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=t,this.config=e,this.typeSupported=n,this.videoParser=new Nr}t.probe=function(e){var n=t.syncOffset(e);return n>0&&N.warn("MPEG2-TS detected but first sync word found @ offset "+n),-1!==n},t.syncOffset=function(t){for(var e=t.length,n=Math.min(5*Br,e-Br)+1,i=0;i<n;){for(var r=!1,o=-1,a=0,s=i;s<e;s+=Br){if(71!==t[s]||e-s!==Br&&71!==t[s+Br]){if(a)return-1;break}if(a++,-1===o&&0!==(o=s)&&(n=Math.min(o+99*Br,t.length-Br)+1),r||(r=0===jr(t,s)),r&&a>1&&(0===o&&a>2||s+Br>n))return o}i++}return-1},t.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:Pt[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===t?e:void 0}};var e=t.prototype;return e.resetInitSegment=function(e,n,i,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=t.createTrack("video"),this._audioTrack=t.createTrack("audio",r),this._id3Track=t.createTrack("id3"),this._txtTrack=t.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=n,this.videoCodec=i,this._duration=r},e.resetTimeStamp=function(){},e.resetContiguity=function(){var t=this._audioTrack,e=this._videoTrack,n=this._id3Track;t&&(t.pesData=null),e&&(e.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null},e.demux=function(e,n,i,r){var o;void 0===i&&(i=!1),void 0===r&&(r=!1),i||(this.sampleAes=null);var a=this._videoTrack,s=this._audioTrack,l=this._id3Track,u=this._txtTrack,c=a.pid,d=a.pesData,h=s.pid,f=l.pid,p=s.pesData,g=l.pesData,m=null,v=this.pmtParsed,y=this._pmtId,b=e.length;if(this.remainderData&&(b=(e=ne(this.remainderData,e)).length,this.remainderData=null),b<Br&&!r)return this.remainderData=e,{audioTrack:s,videoTrack:a,id3Track:l,textTrack:u};var E=Math.max(0,t.syncOffset(e));(b-=(b-E)%Br)<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,b,e.buffer.byteLength-b));for(var T=0,A=E;A<b;A+=Br)if(71===e[A]){var S=!!(64&e[A+1]),w=jr(e,A),L=void 0;if((48&e[A+3])>>4>1){if((L=A+5+e[A+4])===A+Br)continue}else L=A+4;switch(w){case c:S&&(d&&(o=Wr(d))&&this.videoParser.parseAVCPES(a,u,o,!1,this._duration),d={data:[],size:0}),d&&(d.data.push(e.subarray(L,A+Br)),d.size+=A+Br-L);break;case h:if(S){if(p&&(o=Wr(p)))switch(s.segmentCodec){case"aac":this.parseAACPES(s,o);break;case"mp3":this.parseMPEGPES(s,o);break;case"ac3":this.parseAC3PES(s,o)}p={data:[],size:0}}p&&(p.data.push(e.subarray(L,A+Br)),p.size+=A+Br-L);break;case f:S&&(g&&(o=Wr(g))&&this.parseID3PES(l,o),g={data:[],size:0}),g&&(g.data.push(e.subarray(L,A+Br)),g.size+=A+Br-L);break;case 0:S&&(L+=e[L]+1),y=this._pmtId=Gr(e,L);break;case y:S&&(L+=e[L]+1);var x=Vr(e,L,this.typeSupported,i,this.observer);(c=x.videoPid)>0&&(a.pid=c,a.segmentCodec=x.segmentVideoCodec),(h=x.audioPid)>0&&(s.pid=h,s.segmentCodec=x.segmentAudioCodec),(f=x.id3Pid)>0&&(l.pid=f),null===m||v||(N.warn("MPEG-TS PMT found at "+A+" after unknown PID '"+m+"'. Backtracking to sync byte @"+E+" to parse all TS packets."),m=null,A=E-188),v=this.pmtParsed=!0;break;case 17:case 8191:break;default:m=w}}else T++;T>0&&Hr(this.observer,new Error("Found "+T+" TS packet/s that do not start with 0x47")),a.pesData=d,s.pesData=p,l.pesData=g;var D={audioTrack:s,videoTrack:a,id3Track:l,textTrack:u};return r&&this.extractRemainingSamples(D),D},e.flush=function(){var t,e=this.remainderData;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t},e.extractRemainingSamples=function(t){var e,n=t.audioTrack,i=t.videoTrack,r=t.id3Track,o=t.textTrack,a=i.pesData,s=n.pesData,l=r.pesData;if(a&&(e=Wr(a))?(this.videoParser.parseAVCPES(i,o,e,!0,this._duration),i.pesData=null):i.pesData=a,s&&(e=Wr(s))){switch(n.segmentCodec){case"aac":this.parseAACPES(n,e);break;case"mp3":this.parseMPEGPES(n,e);break;case"ac3":this.parseAC3PES(n,e)}n.pesData=null}else null!=s&&s.size&&N.log("last AAC PES packet truncated,might overlap between fragments"),n.pesData=s;l&&(e=Wr(l))?(this.parseID3PES(r,e),r.pesData=null):r.pesData=l},e.demuxSampleAes=function(t,e,n){var i=this.demux(t,n,!0,!this.config.progressive),r=this.sampleAes=new Fr(this.observer,this.config,e);return this.decrypt(i,r)},e.decrypt=function(t,e){return new Promise((function(n){var i=t.audioTrack,r=t.videoTrack;i.samples&&"aac"===i.segmentCodec?e.decryptAacSamples(i.samples,0,(function(){r.samples?e.decryptAvcSamples(r.samples,0,0,(function(){n(t)})):n(t)})):r.samples&&e.decryptAvcSamples(r.samples,0,0,(function(){n(t)}))}))},e.destroy=function(){this._duration=0},e.parseAACPES=function(t,e){var n,i,r,o=0,a=this.aacOverFlow,s=e.data;if(a){this.aacOverFlow=null;var l=a.missing,u=a.sample.unit.byteLength;if(-1===l)s=ne(a.sample.unit,s);else{var c=u-l;a.sample.unit.set(s.subarray(0,l),c),t.samples.push(a.sample),o=a.missing}}for(n=o,i=s.length;n<i-1&&!cr(s,n);n++);if(n!==o){var d,h=n<i-1;if(d=h?"AAC PES did not start with ADTS header,offset:"+n:"No ADTS header found in AAC PES",Hr(this.observer,new Error(d),h),!h)return}if(fr(t,this.observer,s,n,this.audioCodec),void 0!==e.pts)r=e.pts;else{if(!a)return void N.warn("[tsdemuxer]: AAC PES unknown PTS");var f=pr(t.samplerate);r=a.sample.pts+f}for(var p,g=0;n<i;){if(n+=(p=mr(t,s,n,r,g)).length,p.missing){this.aacOverFlow=p;break}for(g++;n<i-1&&!cr(s,n);n++);}},e.parseMPEGPES=function(t,e){var n=e.data,i=n.length,r=0,o=0,a=e.pts;if(void 0!==a)for(;o<i;)if(Lr(n,o)){var s=Ar(t,n,o,a,r);if(!s)break;o+=s.length,r++}else o++;else N.warn("[tsdemuxer]: MPEG PES unknown PTS")},e.parseAC3PES=function(t,e){var n=e.data,i=e.pts;if(void 0!==i)for(var r,o=n.length,a=0,s=0;s<o&&(r=Or(t,n,s,i,a++))>0;)s+=r;else N.warn("[tsdemuxer]: AC3 PES unknown PTS")},e.parseID3PES=function(t,e){if(void 0!==e.pts){var n=u({},e,{type:this._videoTrack?un.emsg:un.audioId3,duration:Number.POSITIVE_INFINITY});t.samples.push(n)}else N.warn("[tsdemuxer]: ID3 PES unknown PTS")},t}();function jr(t,e){return((31&t[e+1])<<8)+t[e+2]}function Gr(t,e){return(31&t[e+10])<<8|t[e+11]}function Vr(t,e,n,i,r){var o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=e+3+((15&t[e+1])<<8|t[e+2])-4;for(e+=12+((15&t[e+10])<<8|t[e+11]);e<a;){var s=jr(t,e),l=(15&t[e+3])<<8|t[e+4];switch(t[e]){case 207:if(!i){Kr("ADTS AAC");break}case 15:-1===o.audioPid&&(o.audioPid=s);break;case 21:-1===o.id3Pid&&(o.id3Pid=s);break;case 219:if(!i){Kr("H.264");break}case 27:-1===o.videoPid&&(o.videoPid=s,o.segmentVideoCodec="avc");break;case 3:case 4:n.mpeg||n.mp3?-1===o.audioPid&&(o.audioPid=s,o.segmentAudioCodec="mp3"):N.log("MPEG audio found, not supported in this browser");break;case 193:if(!i){Kr("AC-3");break}case 129:n.ac3?-1===o.audioPid&&(o.audioPid=s,o.segmentAudioCodec="ac3"):N.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===o.audioPid&&l>0)for(var u=e+5,c=l;c>2;){106===t[u]&&(!0!==n.ac3?N.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=s,o.segmentAudioCodec="ac3"));var d=t[u+1]+2;u+=d,c-=d}break;case 194:case 135:return Hr(r,new Error("Unsupported EC-3 in M2TS found")),o;case 36:return Hr(r,new Error("Unsupported HEVC in M2TS found")),o}e+=l+5}return o}function Hr(t,e,n){N.warn("parsing error: "+e.message),t.emit(D.ERROR,D.ERROR,{type:R.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:e,reason:e.message})}function Kr(t){N.log(t+" with AES-128-CBC encryption found in unencrypted stream")}function Wr(t){var e,n,i,r,o,a=0,s=t.data;if(!t||0===t.size)return null;for(;s[0].length<19&&s.length>1;)s[0]=ne(s[0],s[1]),s.splice(1,1);if(1===((e=s[0])[0]<<16)+(e[1]<<8)+e[2]){if((n=(e[4]<<8)+e[5])&&n>t.size-6)return null;var l=e[7];192&l&&(r=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&l?r-(o=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)>54e5&&(N.warn(Math.round((r-o)/9e4)+"s delta between PTS and DTS, align them"),r=o):o=r);var u=(i=e[8])+9;if(t.size<=u)return null;t.size-=u;for(var c=new Uint8Array(t.size),d=0,h=s.length;d<h;d++){var f=(e=s[d]).byteLength;if(u){if(u>f){u-=f;continue}e=e.subarray(u),f-=u,u=0}c.set(e,a),a+=f}return n&&(n-=i+3),{data:c,pts:r,dts:o,len:n}}return null}var qr=function(t){function e(){return t.apply(this,arguments)||this}c(e,t);var n=e.prototype;return n.resetInitSegment=function(e,n,i,r){t.prototype.resetInitSegment.call(this,e,n,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:n,duration:r,inputTimeScale:9e4,dropped:0}},e.probe=function(t){if(!t)return!1;var e=vt(t,0),n=(null==e?void 0:e.length)||0;if(e&&11===t[n]&&119===t[n+1]&&void 0!==Et(e)&&kr(t,n)<=16)return!1;for(var i=t.length;n<i;n++)if(Dr(t,n))return N.log("MPEG Audio sync word found !"),!0;return!1},n.canParse=function(t,e){return xr(t,e)},n.appendFrame=function(t,e,n){if(null!==this.basePTS)return Ar(t,e,n,this.basePTS,this.frameIndex)},e}(ir),Yr=function(){function t(){}return t.getSilentFrame=function(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},t}(),zr=Math.pow(2,32)-1,Xr=function(){function t(){}return t.init=function(){var e;for(e in t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:n,audio:i};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=o,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,a,l,a,s),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,r))},t.box=function(t){for(var e=8,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(var o=i.length,a=o;o--;)e+=i[o].byteLength;var s=new Uint8Array(e);for(s[0]=e>>24&255,s[1]=e>>16&255,s[2]=e>>8&255,s[3]=255&e,s.set(t,4),o=0,e=8;o<a;o++)s.set(i[o],e),e+=i[o].byteLength;return s},t.hdlr=function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])},t.mdat=function(e){return t.box(t.types.mdat,e)},t.mdhd=function(e,n){n*=e;var i=Math.floor(n/(zr+1)),r=Math.floor(n%(zr+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))},t.mdia=function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))},t.mfhd=function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},t.minf=function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))},t.moof=function(e,n,i){return t.box(t.types.moof,t.mfhd(e),t.traf(i,n))},t.moov=function(e){for(var n=e.length,i=[];n--;)i[n]=t.trak(e[n]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(t.mvex(e)))},t.mvex=function(e){for(var n=e.length,i=[];n--;)i[n]=t.trex(e[n]);return t.box.apply(null,[t.types.mvex].concat(i))},t.mvhd=function(e,n){n*=e;var i=Math.floor(n/(zr+1)),r=Math.floor(n%(zr+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,o)},t.sdtp=function(e){var n,i,r=e.samples||[],o=new Uint8Array(4+r.length);for(n=0;n<r.length;n++)i=r[n].flags,o[n+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return t.box(t.types.sdtp,o)},t.stbl=function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.avc1=function(e){var n,i,r,o=[],a=[];for(n=0;n<e.sps.length;n++)r=(i=e.sps[n]).byteLength,o.push(r>>>8&255),o.push(255&r),o=o.concat(Array.prototype.slice.call(i));for(n=0;n<e.pps.length;n++)r=(i=e.pps[n]).byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(i));var s=t.box(t.types.avcC,new Uint8Array([1,o[3],o[4],o[5],255,224|e.sps.length].concat(o).concat([e.pps.length]).concat(a))),l=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))},t.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},t.audioStsd=function(t){var e=t.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0])},t.mp4a=function(e){return t.box(t.types.mp4a,t.audioStsd(e),t.box(t.types.esds,t.esds(e)))},t.mp3=function(e){return t.box(t.types[".mp3"],t.audioStsd(e))},t.ac3=function(e){return t.box(t.types["ac-3"],t.audioStsd(e),t.box(t.types.dac3,e.config))},t.stsd=function(e){return"audio"===e.type?"mp3"===e.segmentCodec&&"mp3"===e.codec?t.box(t.types.stsd,t.STSD,t.mp3(e)):"ac3"===e.segmentCodec?t.box(t.types.stsd,t.STSD,t.ac3(e)):t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))},t.tkhd=function(e){var n=e.id,i=e.duration*e.timescale,r=e.width,o=e.height,a=Math.floor(i/(zr+1)),s=Math.floor(i%(zr+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,o>>8&255,255&o,0,0]))},t.traf=function(e,n){var i=t.sdtp(e),r=e.id,o=Math.floor(n/(zr+1)),a=Math.floor(n%(zr+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,a>>24,a>>16&255,a>>8&255,255&a])),t.trun(e,i.length+16+20+8+16+8+8),i)},t.trak=function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))},t.trex=function(e){var n=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function(e,n){var i,r,o,a,s,l,u=e.samples||[],c=u.length,d=12+16*c,h=new Uint8Array(d);for(n+=8+d,h.set(["video"===e.type?1:0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),i=0;i<c;i++)o=(r=u[i]).duration,a=r.size,s=r.flags,l=r.cts,h.set([o>>>24&255,o>>>16&255,o>>>8&255,255&o,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);return t.box(t.types.trun,h)},t.initSegment=function(e){t.types||t.init();var n=t.moov(e);return ne(t.FTYP,n)},t}();Xr.types=void 0,Xr.HDLR_TYPES=void 0,Xr.STTS=void 0,Xr.STSC=void 0,Xr.STCO=void 0,Xr.STSZ=void 0,Xr.VMHD=void 0,Xr.SMHD=void 0,Xr.STSD=void 0,Xr.FTYP=void 0,Xr.DINF=void 0;var Jr=9e4;function $r(t,e,n,i){void 0===n&&(n=1),void 0===i&&(i=!1);var r=t*e*n;return i?Math.round(r):r}function Qr(t,e,n,i){return void 0===n&&(n=1),void 0===i&&(i=!1),$r(t,e,1/n,i)}function Zr(t,e){return void 0===e&&(e=!1),$r(t,1e3,1/Jr,e)}function to(t,e){return void 0===e&&(e=1),$r(t,Jr,1/e)}var eo=1e4,no=1024,io=1152,ro=1536,oo=null,ao=null,so=function(){function t(t,e,n,i){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=t,this.config=e,this.typeSupported=n,this.ISGenerated=!1,null===oo){var r=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);oo=r?parseInt(r[1]):0}if(null===ao){var o=navigator.userAgent.match(/Safari\/(\d+)/i);ao=o?parseInt(o[1]):0}}var e=t.prototype;return e.destroy=function(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null},e.resetTimeStamp=function(t){N.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},e.resetNextTimestamp=function(){N.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},e.resetInitSegment=function(){N.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0},e.getVideoStartPts=function(t){var e=!1,n=t.reduce((function(t,n){var i=n.pts-t;return i<-4294967296?(e=!0,lo(t,n.pts)):i>0?t:n.pts}),t[0].pts);return e&&N.debug("PTS rollover detected"),n},e.remux=function(t,e,n,i,r,o,a,s){var l,u,c,d,h,f,p=r,g=r,m=t.pid>-1,v=e.pid>-1,y=e.samples.length,b=t.samples.length>0,E=a&&y>0||y>1;if((!m||b)&&(!v||E)||this.ISGenerated||a){if(this.ISGenerated){var T,A,S,w,L=this.videoTrackConfig;!L||e.width===L.width&&e.height===L.height&&(null==(T=e.pixelRatio)?void 0:T[0])===(null==(A=L.pixelRatio)?void 0:A[0])&&(null==(S=e.pixelRatio)?void 0:S[1])===(null==(w=L.pixelRatio)?void 0:w[1])||this.resetInitSegment()}else c=this.generateIS(t,e,r,o);var x,D=this.isVideoContiguous,R=-1;if(E&&(R=uo(e.samples),!D&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,R>0){N.warn("[mp4-remuxer]: Dropped "+R+" out of "+y+" video samples due to a missing keyframe");var _=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(R),e.dropped+=R,x=g+=(e.samples[0].pts-_)/e.inputTimeScale}else-1===R&&(N.warn("[mp4-remuxer]: No keyframe found out of "+y+" video samples"),f=!1);if(this.ISGenerated){if(b&&E){var C=this.getVideoStartPts(e.samples),k=(lo(t.samples[0].pts,C)-C)/e.inputTimeScale;p+=Math.max(0,k),g+=Math.max(0,-k)}if(b){if(t.samplerate||(N.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),c=this.generateIS(t,e,r,o)),u=this.remuxAudio(t,p,this.isAudioContiguous,o,v||E||s===$e.AUDIO?g:void 0),E){var I=u?u.endPTS-u.startPTS:0;e.inputTimeScale||(N.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),c=this.generateIS(t,e,r,o)),l=this.remuxVideo(e,g,D,I)}}else E&&(l=this.remuxVideo(e,g,D,0));l&&(l.firstKeyFrame=R,l.independent=-1!==R,l.firstKeyFramePTS=x)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(h=co(n,r,this._initPTS,this._initDTS)),i.samples.length&&(d=ho(i,r,this._initPTS))),{audio:u,video:l,initSegment:c,independent:f,text:d,id3:h}},e.generateIS=function(t,e,n,i){var r,o,a,s=t.samples,l=e.samples,u=this.typeSupported,c={},d=this._initPTS,h=!d||i,f="audio/mp4";if(h&&(r=o=1/0),t.config&&s.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":u.mpeg?(f="audio/mpeg",t.codec=""):u.mp3&&(t.codec="mp3");break;case"ac3":t.codec="ac-3"}c.audio={id:"audio",container:f,codec:t.codec,initSegment:"mp3"===t.segmentCodec&&u.mpeg?new Uint8Array(0):Xr.initSegment([t]),metadata:{channelCount:t.channelCount}},h&&(a=t.inputTimeScale,d&&a===d.timescale?h=!1:r=o=s[0].pts-Math.round(a*n))}if(e.sps&&e.pps&&l.length){if(e.timescale=e.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:Xr.initSegment([e]),metadata:{width:e.width,height:e.height}},h)if(a=e.inputTimeScale,d&&a===d.timescale)h=!1;else{var p=this.getVideoStartPts(l),g=Math.round(a*n);o=Math.min(o,lo(l[0].dts,p)-g),r=Math.min(r,p-g)}this.videoTrackConfig={width:e.width,height:e.height,pixelRatio:e.pixelRatio}}if(Object.keys(c).length)return this.ISGenerated=!0,h?(this._initPTS={baseTime:r,timescale:a},this._initDTS={baseTime:o,timescale:a}):r=a=void 0,{tracks:c,initPTS:r,timescale:a}},e.remuxVideo=function(t,e,n,i){var r,o,a=t.inputTimeScale,s=t.samples,l=[],c=s.length,d=this._initPTS,h=this.nextAvcDts,f=8,p=this.videoSampleDuration,g=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,v=!1;if(!n||null===h){var y=e*a,b=s[0].pts-lo(s[0].dts,s[0].pts);oo&&null!==h&&Math.abs(y-b-h)<15e3?n=!0:h=y-b}for(var E=d.baseTime*a/d.timescale,T=0;T<c;T++){var A=s[T];A.pts=lo(A.pts-E,h),A.dts=lo(A.dts-E,h),A.dts<s[T>0?T-1:T].dts&&(v=!0)}v&&s.sort((function(t,e){var n=t.dts-e.dts,i=t.pts-e.pts;return n||i})),r=s[0].dts;var S=(o=s[s.length-1].dts)-r,w=S?Math.round(S/(c-1)):p||t.inputTimeScale/30;if(n){var L=r-h,x=L>w,C=L<-1;if((x||C)&&(x?N.warn("AVC: "+Zr(L,!0)+" ms ("+L+"dts) hole between fragments detected at "+e.toFixed(3)):N.warn("AVC: "+Zr(-L,!0)+" ms ("+L+"dts) overlapping between fragments detected at "+e.toFixed(3)),!C||h>=s[0].pts||oo)){r=h;var k=s[0].pts-L;if(x)s[0].dts=r,s[0].pts=k;else for(var I=0;I<s.length&&!(s[I].dts>k);I++)s[I].dts-=L,s[I].pts-=L;N.log("Video: Initial PTS/DTS adjusted: "+Zr(k,!0)+"/"+Zr(r,!0)+", delta: "+Zr(L,!0)+" ms")}}for(var O=0,P=0,M=r=Math.max(0,r),F=0;F<c;F++){for(var B=s[F],U=B.units,j=U.length,G=0,V=0;V<j;V++)G+=U[V].data.length;P+=G,O+=j,B.length=G,B.dts<M?(B.dts=M,M+=w/4|0||1):M=B.dts,g=Math.min(B.pts,g),m=Math.max(B.pts,m)}o=s[c-1].dts;var H,K=P+4*O+8;try{H=new Uint8Array(K)}catch(t){return void this.observer.emit(D.ERROR,D.ERROR,{type:R.MUX_ERROR,details:_.REMUX_ALLOC_ERROR,fatal:!1,error:t,bytes:K,reason:"fail allocating video mdat "+K})}var W=new DataView(H.buffer);W.setUint32(0,K),H.set(Xr.types.mdat,4);for(var q=!1,Y=Number.POSITIVE_INFINITY,z=Number.POSITIVE_INFINITY,X=Number.NEGATIVE_INFINITY,J=Number.NEGATIVE_INFINITY,$=0;$<c;$++){for(var Q=s[$],Z=Q.units,tt=0,et=0,nt=Z.length;et<nt;et++){var it=Z[et],rt=it.data,ot=it.data.byteLength;W.setUint32(f,ot),f+=4,H.set(rt,f),f+=ot,tt+=4+ot}var at=void 0;if($<c-1)p=s[$+1].dts-Q.dts,at=s[$+1].pts-Q.pts;else{var st=this.config,lt=$>0?Q.dts-s[$-1].dts:w;if(at=$>0?Q.pts-s[$-1].pts:w,st.stretchShortVideoTrack&&null!==this.nextAudioPts){var ut=Math.floor(st.maxBufferHole*a),ct=(i?g+i*a:this.nextAudioPts)-Q.pts;ct>ut?((p=ct-lt)<0?p=lt:q=!0,N.log("[mp4-remuxer]: It is approximately "+ct/90+" ms to the next segment; using duration "+p/90+" ms for the last video frame.")):p=lt}else p=lt}var dt=Math.round(Q.pts-Q.dts);Y=Math.min(Y,p),X=Math.max(X,p),z=Math.min(z,at),J=Math.max(J,at),l.push(new po(Q.key,p,tt,dt))}if(l.length)if(oo){if(oo<70){var ht=l[0].flags;ht.dependsOn=2,ht.isNonSync=0}}else if(ao&&J-z<X-Y&&w/X<.025&&0===l[0].cts){N.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var ft=r,pt=0,gt=l.length;pt<gt;pt++){var mt=ft+l[pt].duration,vt=ft+l[pt].cts;if(pt<gt-1){var yt=mt+l[pt+1].cts;l[pt].duration=yt-vt}else l[pt].duration=pt?l[pt-1].duration:w;l[pt].cts=0,ft=mt}}p=q||!p?w:p,this.nextAvcDts=h=o+p,this.videoSampleDuration=p,this.isVideoContiguous=!0;var bt={data1:Xr.moof(t.sequenceNumber++,r,u({},t,{samples:l})),data2:H,startPTS:g/a,endPTS:(m+p)/a,startDTS:r/a,endDTS:h/a,type:"video",hasAudio:!1,hasVideo:!0,nb:l.length,dropped:t.dropped};return t.samples=[],t.dropped=0,bt},e.getSamplesPerFrame=function(t){switch(t.segmentCodec){case"mp3":return io;case"ac3":return ro;default:return no}},e.remuxAudio=function(t,e,n,i,r){var o=t.inputTimeScale,a=o/(t.samplerate?t.samplerate:o),s=this.getSamplesPerFrame(t),l=s*a,c=this._initPTS,d="mp3"===t.segmentCodec&&this.typeSupported.mpeg,h=[],f=void 0!==r,p=t.samples,g=d?0:8,m=this.nextAudioPts||-1,v=e*o,y=c.baseTime*o/c.timescale;if(this.isAudioContiguous=n=n||p.length&&m>0&&(i&&Math.abs(v-m)<9e3||Math.abs(lo(p[0].pts-y,v)-m)<20*l),p.forEach((function(t){t.pts=lo(t.pts-y,v)})),!n||m<0){if(p=p.filter((function(t){return t.pts>=0})),!p.length)return;m=0===r?0:i&&!f?Math.max(0,v):p[0].pts}if("aac"===t.segmentCodec)for(var b=this.config.maxAudioFramesDrift,E=0,T=m;E<p.length;E++){var A=p[E],S=A.pts,w=S-T,L=Math.abs(1e3*w/o);if(w<=-b*l&&f)0===E&&(N.warn("Audio frame @ "+(S/o).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*w/o)+" ms."),this.nextAudioPts=m=T=S);else if(w>=b*l&&L<eo&&f){var x=Math.round(w/l);(T=S-x*l)<0&&(x--,T+=l),0===E&&(this.nextAudioPts=m=T),N.warn("[mp4-remuxer]: Injecting "+x+" audio frame @ "+(T/o).toFixed(3)+"s due to "+Math.round(1e3*w/o)+" ms gap.");for(var C=0;C<x;C++){var k=Math.max(T,0),I=Yr.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);I||(N.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),I=A.unit.subarray()),p.splice(E,0,{unit:I,pts:k}),T+=l,E++}}A.pts=T,T+=l}for(var O,P=null,M=null,F=0,B=p.length;B--;)F+=p[B].unit.byteLength;for(var U=0,j=p.length;U<j;U++){var G=p[U],V=G.unit,H=G.pts;if(null!==M)h[U-1].duration=Math.round((H-M)/a);else{if(n&&"aac"===t.segmentCodec&&(H=m),P=H,!(F>0))return;F+=g;try{O=new Uint8Array(F)}catch(t){return void this.observer.emit(D.ERROR,D.ERROR,{type:R.MUX_ERROR,details:_.REMUX_ALLOC_ERROR,fatal:!1,error:t,bytes:F,reason:"fail allocating audio mdat "+F})}d||(new DataView(O.buffer).setUint32(0,F),O.set(Xr.types.mdat,4))}O.set(V,g);var K=V.byteLength;g+=K,h.push(new po(!0,s,K,0)),M=H}var W=h.length;if(W){var q=h[h.length-1];this.nextAudioPts=m=M+a*q.duration;var Y=d?new Uint8Array(0):Xr.moof(t.sequenceNumber++,P/a,u({},t,{samples:h}));t.samples=[];var z=P/o,X=m/o,J={data1:Y,data2:O,startPTS:z,endPTS:X,startDTS:z,endDTS:X,type:"audio",hasAudio:!0,hasVideo:!1,nb:W};return this.isAudioContiguous=!0,J}},e.remuxEmptyAudio=function(t,e,n,i){var r=t.inputTimeScale,o=r/(t.samplerate?t.samplerate:r),a=this.nextAudioPts,s=this._initDTS,l=9e4*s.baseTime/s.timescale,u=(null!==a?a:i.startDTS*r)+l,c=i.endDTS*r+l,d=o*no,h=Math.ceil((c-u)/d),f=Yr.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(N.warn("[mp4-remuxer]: remux empty Audio"),f){for(var p=[],g=0;g<h;g++){var m=u+g*d;p.push({unit:f,pts:m,dts:m})}return t.samples=p,this.remuxAudio(t,e,n,!1)}N.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},t}();function lo(t,e){var n;if(null===e)return t;for(n=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=n;return t}function uo(t){for(var e=0;e<t.length;e++)if(t[e].key)return e;return-1}function co(t,e,n,i){var r=t.samples.length;if(r){for(var o=t.inputTimeScale,a=0;a<r;a++){var s=t.samples[a];s.pts=lo(s.pts-n.baseTime*o/n.timescale,e*o)/o,s.dts=lo(s.dts-i.baseTime*o/i.timescale,e*o)/o}var l=t.samples;return t.samples=[],{samples:l}}}function ho(t,e,n){var i=t.samples.length;if(i){for(var r=t.inputTimeScale,o=0;o<i;o++){var a=t.samples[o];a.pts=lo(a.pts-n.baseTime*r/n.timescale,e*r)/r}t.samples.sort((function(t,e){return t.pts-e.pts}));var s=t.samples;return t.samples=[],{samples:s}}}var fo,po=function(t,e,n,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=e,this.size=n,this.cts=i,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:t?2:1,isNonSync:t?0:1}},go=function(){function t(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=function(t){this.initPTS=t,this.lastEndTime=null},e.resetNextTimestamp=function(){this.lastEndTime=null},e.resetInitSegment=function(t,e,n,i){this.audioCodec=e,this.videoCodec=n,this.generateInitSegment(Xt(t,i)),this.emitInitSegment=!0},e.generateInitSegment=function(t){var e=this.audioCodec,n=this.videoCodec;if(null==t||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var i=this.initData=Kt(t);i.audio&&(e=vo(i.audio,K.AUDIO)),i.video&&(n=vo(i.video,K.VIDEO));var r={};i.audio&&i.video?r.audiovideo={container:"video/mp4",codec:e+","+n,initSegment:t,id:"main"}:i.audio?r.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:i.video?r.video={container:"video/mp4",codec:n,initSegment:t,id:"main"}:N.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=r},e.remux=function(t,e,n,i,r,o){var a,s,l=this.initPTS,u=this.lastEndTime,c={audio:void 0,video:void 0,text:i,id3:n,initSegment:void 0};w(u)||(u=this.lastEndTime=r||0);var d=e.samples;if(null==d||!d.length)return c;var h={initPTS:void 0,timescale:1},f=this.initData;if(null!=(a=f)&&a.length||(this.generateInitSegment(d),f=this.initData),null==(s=f)||!s.length)return N.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);var p=Qt(d,f),g=$t(f,d),m=null===g?r:g;(mo(l,m,r,p)||h.timescale!==l.timescale&&o)&&(h.initPTS=m-r,l&&1===l.timescale&&N.warn("Adjusting initPTS by "+(h.initPTS-l.baseTime)),this.initPTS=l={baseTime:h.initPTS,timescale:1});var v=t?m-l.baseTime/l.timescale:u,y=v+p;te(f,d,l.baseTime/l.timescale),p>0?this.lastEndTime=y:(N.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var b=!!f.audio,E=!!f.video,T="";b&&(T+="audio"),E&&(T+="video");var A={data1:d,startPTS:v,startDTS:v,endPTS:y,endDTS:y,type:T,hasAudio:b,hasVideo:E,nb:1,dropped:0};return c.audio="audio"===A.type?A:void 0,c.video="audio"!==A.type?A:void 0,c.initSegment=h,c.id3=co(n,r,l,l),i.samples.length&&(c.text=ho(i,r,l)),c},t}();function mo(t,e,n,i){if(null===t)return!0;var r=Math.max(i,1),o=e-t.baseTime/t.timescale;return Math.abs(o-n)>r}function vo(t,e){var n=null==t?void 0:t.codec;if(n&&n.length>4)return n;if(e===K.AUDIO){if("ec-3"===n||"ac-3"===n||"alac"===n)return n;if("fLaC"===n||"Opus"===n)return Oe(n,!1);var i="mp4a.40.5";return N.info('Parsed audio codec "'+n+'" or audio object type not handled. Using "'+i+'"'),i}return N.warn('Unhandled video codec "'+n+'"'),"hvc1"===n||"hev1"===n?"hvc1.1.6.L120.90":"av01"===n?"av01.0.04M.08":"avc1.42e01e"}try{fo=self.performance.now.bind(self.performance)}catch(t){N.debug("Unable to use Performance API on this environment"),fo=null==et?void 0:et.Date.now}var yo=[{demux:Cr,remux:go},{demux:Ur,remux:so},{demux:Rr,remux:so},{demux:qr,remux:so}];yo.splice(2,0,{demux:Ir,remux:so});var bo=function(){function t(t,e,n,i,r){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=n,this.vendor=i,this.id=r}var e=t.prototype;return e.configure=function(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()},e.push=function(t,e,n,i){var r=this,o=n.transmuxing;o.executeStart=fo();var a=new Uint8Array(t),s=this.currentTransmuxState,l=this.transmuxConfig;i&&(this.currentTransmuxState=i);var u=i||s,c=u.contiguous,d=u.discontinuity,h=u.trackSwitch,f=u.accurateTimeOffset,p=u.timeOffset,g=u.initSegmentChange,m=l.audioCodec,v=l.videoCodec,y=l.defaultInitPts,b=l.duration,E=l.initSegmentData,T=Eo(a,e);if(T&&"AES-128"===T.method){var A=this.getDecrypter();if(!A.isSync())return this.decryptionPromise=A.webCryptoDecrypt(a,T.key.buffer,T.iv.buffer).then((function(t){var e=r.push(t,null,n);return r.decryptionPromise=null,e})),this.decryptionPromise;var S=A.softwareDecrypt(a,T.key.buffer,T.iv.buffer);if(n.part>-1&&(S=A.flush()),!S)return o.executeEnd=fo(),To(n);a=new Uint8Array(S)}var w=this.needsProbing(d,h);if(w){var L=this.configureTransmuxer(a);if(L)return N.warn("[transmuxer] "+L.message),this.observer.emit(D.ERROR,D.ERROR,{type:R.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!1,error:L,reason:L.message}),o.executeEnd=fo(),To(n)}(d||h||g||w)&&this.resetInitSegment(E,m,v,b,e),(d||g||w)&&this.resetInitialTimestamp(y),c||this.resetContiguity();var x=this.transmux(a,T,p,f,n),C=this.currentTransmuxState;return C.contiguous=!0,C.discontinuity=!1,C.trackSwitch=!1,o.executeEnd=fo(),x},e.flush=function(t){var e=this,n=t.transmuxing;n.executeStart=fo();var i=this.decrypter,r=this.currentTransmuxState,o=this.decryptionPromise;if(o)return o.then((function(){return e.flush(t)}));var a=[],s=r.timeOffset;if(i){var l=i.flush();l&&a.push(this.push(l,null,t))}var u=this.demuxer,c=this.remuxer;if(!u||!c)return n.executeEnd=fo(),[To(t)];var d=u.flush(s);return Ao(d)?d.then((function(n){return e.flushRemux(a,n,t),a})):(this.flushRemux(a,d,t),a)},e.flushRemux=function(t,e,n){var i=e.audioTrack,r=e.videoTrack,o=e.id3Track,a=e.textTrack,s=this.currentTransmuxState,l=s.accurateTimeOffset,u=s.timeOffset;N.log("[transmuxer.ts]: Flushed fragment "+n.sn+(n.part>-1?" p: "+n.part:"")+" of level "+n.level);var c=this.remuxer.remux(i,r,o,a,u,l,!0,this.id);t.push({remuxResult:c,chunkMeta:n}),n.transmuxing.executeEnd=fo()},e.resetInitialTimestamp=function(t){var e=this.demuxer,n=this.remuxer;e&&n&&(e.resetTimeStamp(t),n.resetTimeStamp(t))},e.resetContiguity=function(){var t=this.demuxer,e=this.remuxer;t&&e&&(t.resetContiguity(),e.resetNextTimestamp())},e.resetInitSegment=function(t,e,n,i,r){var o=this.demuxer,a=this.remuxer;o&&a&&(o.resetInitSegment(t,e,n,i),a.resetInitSegment(t,e,n,r))},e.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},e.transmux=function(t,e,n,i,r){return e&&"SAMPLE-AES"===e.method?this.transmuxSampleAes(t,e,n,i,r):this.transmuxUnencrypted(t,n,i,r)},e.transmuxUnencrypted=function(t,e,n,i){var r=this.demuxer.demux(t,e,!1,!this.config.progressive),o=r.audioTrack,a=r.videoTrack,s=r.id3Track,l=r.textTrack;return{remuxResult:this.remuxer.remux(o,a,s,l,e,n,!1,this.id),chunkMeta:i}},e.transmuxSampleAes=function(t,e,n,i,r){var o=this;return this.demuxer.demuxSampleAes(t,e,n).then((function(t){return{remuxResult:o.remuxer.remux(t.audioTrack,t.videoTrack,t.id3Track,t.textTrack,n,i,!1,o.id),chunkMeta:r}}))},e.configureTransmuxer=function(t){for(var e,n=this.config,i=this.observer,r=this.typeSupported,o=this.vendor,a=0,s=yo.length;a<s;a++){var l;if(null!=(l=yo[a].demux)&&l.probe(t)){e=yo[a];break}}if(!e)return new Error("Failed to find demuxer by probing fragment data");var u=this.demuxer,c=this.remuxer,d=e.remux,h=e.demux;c&&c instanceof d||(this.remuxer=new d(i,n,r,o)),u&&u instanceof h||(this.demuxer=new h(i,n,r),this.probe=h.probe)},e.needsProbing=function(t,e){return!this.demuxer||!this.remuxer||t||e},e.getDecrypter=function(){var t=this.decrypter;return t||(t=this.decrypter=new Ji(this.config)),t},t}();function Eo(t,e){var n=null;return t.byteLength>0&&null!=(null==e?void 0:e.key)&&null!==e.iv&&null!=e.method&&(n=e),n}var To=function(t){return{remuxResult:{},chunkMeta:t}};function Ao(t){return"then"in t&&t.then instanceof Function}var So=function(t,e,n,i,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=n,this.duration=i,this.defaultInitPts=r||null},wo=function(t,e,n,i,r,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=r,this.initSegmentChange=o},Lo={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,n="~";function i(){}function r(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(t,e,i,o,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new r(i,o||t,a),l=n?n+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],s]:t._events[l].push(s):(t._events[l]=s,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),s.prototype.eventNames=function(){var t,i,r=[];if(0===this._eventsCount)return r;for(i in t=this._events)e.call(t,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},s.prototype.listeners=function(t){var e=n?n+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,o=i.length,a=new Array(o);r<o;r++)a[r]=i[r].fn;return a},s.prototype.listenerCount=function(t){var e=n?n+t:t,i=this._events[e];return i?i.fn?1:i.length:0},s.prototype.emit=function(t,e,i,r,o,a){var s=n?n+t:t;if(!this._events[s])return!1;var l,u,c=this._events[s],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,i),!0;case 4:return c.fn.call(c.context,e,i,r),!0;case 5:return c.fn.call(c.context,e,i,r,o),!0;case 6:return c.fn.call(c.context,e,i,r,o,a),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(t,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,e);break;case 3:c[u].fn.call(c[u].context,e,i);break;case 4:c[u].fn.call(c[u].context,e,i,r);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},s.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,i,r){var o=n?n+t:t;if(!this._events[o])return this;if(!e)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||r&&!s.once||i&&s.context!==i||a(this,o);else{for(var l=0,u=[],c=s.length;l<c;l++)(s[l].fn!==e||r&&!s[l].once||i&&s[l].context!==i)&&u.push(s[l]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&a(this,e)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s}(Lo);var xo=T(Lo.exports);function Do(t){var e=new xo,n=function(e,n){t.postMessage({event:e,data:n})};e.on(D.FRAG_DECRYPTED,n),e.on(D.ERROR,n);var i=function(){var t=function(t){var e=function(e){n("workerLog",{logType:t,message:e})};N[t]=e};for(var e in N)t(e)};t.addEventListener("message",(function(r){var o=r.data;switch(o.cmd){case"init":var a=JSON.parse(o.config);t.transmuxer=new bo(e,o.typeSupported,a,"",o.id),M(a.debug,o.id),i(),n("init",null);break;case"configure":t.transmuxer.configure(o.config);break;case"demux":var s=t.transmuxer.push(o.data,o.decryptdata,o.chunkMeta,o.state);Ao(s)?(t.transmuxer.async=!0,s.then((function(e){Ro(t,e)})).catch((function(t){n(D.ERROR,{type:R.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,chunkMeta:o.chunkMeta,fatal:!1,error:t,err:t,reason:"transmuxer-worker push error"})}))):(t.transmuxer.async=!1,Ro(t,s));break;case"flush":var l=o.chunkMeta,u=t.transmuxer.flush(l);Ao(u)||t.transmuxer.async?(Ao(u)||(u=Promise.resolve(u)),u.then((function(e){Co(t,e,l)})).catch((function(t){n(D.ERROR,{type:R.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,chunkMeta:o.chunkMeta,fatal:!1,error:t,err:t,reason:"transmuxer-worker flush error"})}))):Co(t,u,l)}}))}function Ro(t,e){if(ko(e.remuxResult))return!1;var n=[],i=e.remuxResult,r=i.audio,o=i.video;return r&&_o(n,r),o&&_o(n,o),t.postMessage({event:"transmuxComplete",data:e},n),!0}function _o(t,e){e.data1&&t.push(e.data1.buffer),e.data2&&t.push(e.data2.buffer)}function Co(t,e,n){e.reduce((function(e,n){return Ro(t,n)||e}),!1)||t.postMessage({event:"transmuxComplete",data:e[0]}),t.postMessage({event:"flush",data:n})}function ko(t){return!(t.audio||t.video||t.text||t.id3||t.initSegment)}function Io(){return!0}function Oo(){var t=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+e.toString()+")(true);"],{type:"text/javascript"}),n=self.URL.createObjectURL(t);return{worker:new self.Worker(n),objectURL:n}}function Po(t){var e=new self.URL(t,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}void 0!==n&&n&&Do(self);var Mo=function(){function t(t,e,n,i){var r=this;this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var o=t.config;this.hls=t,this.id=e,this.useWorker=!!o.enableWorker,this.onTransmuxComplete=n,this.onFlush=i;var a=function(t,e){(e=e||{}).frag=r.frag,e.id=r.id,t===D.ERROR&&(r.error=e.error),r.hls.trigger(t,e)};this.observer=new xo,this.observer.on(D.FRAG_DECRYPTED,a),this.observer.on(D.ERROR,a);var s=Te(o.preferManagedMediaSource)||{isTypeSupported:function(){return!1}},l={mpeg:s.isTypeSupported("audio/mpeg"),mp3:s.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:s.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&"undefined"!=typeof Worker&&(o.workerPath||Io()))try{o.workerPath?(N.log("loading Web Worker "+o.workerPath+' for "'+e+'"'),this.workerContext=Po(o.workerPath)):(N.log('injecting Web Worker for "'+e+'"'),this.workerContext=Oo()),this.onwmsg=function(t){return r.onWorkerMessage(t)};var u=this.workerContext.worker;u.addEventListener("message",this.onwmsg),u.onerror=function(t){var n=new Error(t.message+"  ("+t.filename+":"+t.lineno+")");o.enableWorker=!1,N.warn('Error in "'+e+'" Web Worker, fallback to inline'),r.hls.trigger(D.ERROR,{type:R.OTHER_ERROR,details:_.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:n})},u.postMessage({cmd:"init",typeSupported:l,vendor:"",id:e,config:JSON.stringify(o)})}catch(t){N.warn('Error setting up "'+e+'" Web Worker, fallback to inline',t),this.resetWorker(),this.error=null,this.transmuxer=new bo(this.observer,l,o,"",e)}else this.transmuxer=new bo(this.observer,l,o,"",e)}var e=t.prototype;return e.resetWorker=function(){if(this.workerContext){var t=this.workerContext,e=t.worker,n=t.objectURL;n&&self.URL.revokeObjectURL(n),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}},e.destroy=function(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},e.push=function(t,e,n,i,r,o,a,s,l,u){var c,d,h=this;l.transmuxing.start=self.performance.now();var f=this.transmuxer,p=o?o.start:r.start,g=r.decryptdata,m=this.frag,v=!(m&&r.cc===m.cc),y=!(m&&l.level===m.level),b=m?l.sn-m.sn:-1,E=this.part?l.part-this.part.index:-1,T=0===b&&l.id>1&&l.id===(null==m?void 0:m.stats.chunkCount),A=!y&&(1===b||0===b&&(1===E||T&&E<=0)),S=self.performance.now();(y||b||0===r.stats.parsing.start)&&(r.stats.parsing.start=S),!o||!E&&A||(o.stats.parsing.start=S);var w=!(m&&(null==(c=r.initSegment)?void 0:c.url)===(null==(d=m.initSegment)?void 0:d.url)),L=new wo(v,A,s,y,p,w);if(!A||v||w){N.log("[transmuxer-interface, "+r.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+"\n        discontinuity: "+v+"\n        trackSwitch: "+y+"\n        contiguous: "+A+"\n        accurateTimeOffset: "+s+"\n        timeOffset: "+p+"\n        initSegmentChange: "+w);var x=new So(n,i,e,a,u);this.configureTransmuxer(x)}if(this.frag=r,this.part=o,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:t,decryptdata:g,chunkMeta:l,state:L},t instanceof ArrayBuffer?[t]:[]);else if(f){var D=f.push(t,g,l,L);Ao(D)?(f.async=!0,D.then((function(t){h.handleTransmuxComplete(t)})).catch((function(t){h.transmuxerError(t,l,"transmuxer-interface push error")}))):(f.async=!1,this.handleTransmuxComplete(D))}},e.flush=function(t){var e=this;t.transmuxing.start=self.performance.now();var n=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:t});else if(n){var i=n.flush(t);Ao(i)||n.async?(Ao(i)||(i=Promise.resolve(i)),i.then((function(n){e.handleFlushResult(n,t)})).catch((function(n){e.transmuxerError(n,t,"transmuxer-interface flush error")}))):this.handleFlushResult(i,t)}},e.transmuxerError=function(t,e,n){this.hls&&(this.error=t,this.hls.trigger(D.ERROR,{type:R.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,chunkMeta:e,frag:this.frag||void 0,fatal:!1,error:t,err:t,reason:n}))},e.handleFlushResult=function(t,e){var n=this;t.forEach((function(t){n.handleTransmuxComplete(t)})),this.onFlush(e)},e.onWorkerMessage=function(t){var e=t.data;if(null!=e&&e.event){var n=this.hls;if(this.hls)switch(e.event){case"init":var i,r=null==(i=this.workerContext)?void 0:i.objectURL;r&&self.URL.revokeObjectURL(r);break;case"transmuxComplete":this.handleTransmuxComplete(e.data);break;case"flush":this.onFlush(e.data);break;case"workerLog":N[e.data.logType]&&N[e.data.logType](e.data.message);break;default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,n.trigger(e.event,e.data)}}else N.warn("worker message received with no "+(e?"event name":"data"))},e.configureTransmuxer=function(t){var e=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:t}):e&&e.configure(t)},e.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},t}();function No(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!Fo(t[n].attrs,e[n].attrs))return!1;return!0}function Fo(t,e,n){var i=t["STABLE-RENDITION-ID"];return i&&!n?i===e["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some((function(n){return t[n]!==e[n]}))}function Bo(t,e){return e.label.toLowerCase()===t.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(t.lang||"").toLowerCase())}var Uo=100,jo=function(t){function e(e,n,i){var r;return(r=t.call(this,e,n,i,"[audio-stream-controller]",$e.AUDIO)||this).videoBuffer=null,r.videoTrackCC=-1,r.waitingVideoCC=-1,r.bufferedTrack=null,r.switchingTrack=null,r.trackId=-1,r.waitingData=null,r.mainDetails=null,r.flushing=!1,r.bufferFlushed=!1,r.cachedTrackLoadedData=null,r._registerListeners(),r}c(e,t);var n=e.prototype;return n.onHandlerDestroying=function(){this._unregisterListeners(),t.prototype.onHandlerDestroying.call(this),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null},n._registerListeners=function(){var t=this.hls;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.LEVEL_LOADED,this.onLevelLoaded,this),t.on(D.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(D.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(D.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(D.ERROR,this.onError,this),t.on(D.BUFFER_RESET,this.onBufferReset,this),t.on(D.BUFFER_CREATED,this.onBufferCreated,this),t.on(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(D.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(D.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(D.FRAG_BUFFERED,this.onFragBuffered,this)},n._unregisterListeners=function(){var t=this.hls;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.LEVEL_LOADED,this.onLevelLoaded,this),t.off(D.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(D.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(D.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(D.ERROR,this.onError,this),t.off(D.BUFFER_RESET,this.onBufferReset,this),t.off(D.BUFFER_CREATED,this.onBufferCreated,this),t.off(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(D.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(D.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(D.FRAG_BUFFERED,this.onFragBuffered,this)},n.onInitPtsFound=function(t,e){var n=e.frag,i=e.id,r=e.initPTS,o=e.timescale;if("main"===i){var a=n.cc;this.initPTS[n.cc]={baseTime:r,timescale:o},this.log("InitPTS for cc: "+a+" found from main: "+r),this.videoTrackCC=a,this.state===Qi.WAITING_INIT_PTS&&this.tick()}},n.startLoad=function(t){if(!this.levels)return this.startPosition=t,void(this.state=Qi.STOPPED);var e=this.lastCurrentTime;this.stopLoad(),this.setInterval(Uo),e>0&&-1===t?(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e,this.state=Qi.IDLE):(this.loadedmetadata=!1,this.state=Qi.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},n.doTick=function(){switch(this.state){case Qi.IDLE:this.doTickIdle();break;case Qi.WAITING_TRACK:var e,n=this.levels,i=this.trackId,r=null==n||null==(e=n[i])?void 0:e.details;if(r){if(this.waitForCdnTuneIn(r))break;this.state=Qi.WAITING_INIT_PTS}break;case Qi.FRAG_LOADING_WAITING_RETRY:var o,a=performance.now(),s=this.retryDate;if(!s||a>=s||null!=(o=this.media)&&o.seeking){var l=this.levels,u=this.trackId;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((null==l?void 0:l[u])||null),this.state=Qi.IDLE}break;case Qi.WAITING_INIT_PTS:var c=this.waitingData;if(c){var d=c.frag,h=c.part,f=c.cache,p=c.complete;if(void 0!==this.initPTS[d.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=Qi.FRAG_LOADING;var g={frag:d,part:h,payload:f.flush(),networkDetails:null};this._handleFragmentLoadProgress(g),p&&t.prototype._handleFragmentLoadComplete.call(this,g)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+d.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var m=this.getLoadPosition(),v=_i.bufferInfo(this.mediaBuffer,m,this.config.maxBufferHole);Jn(v.end,this.config.maxFragLookUpTolerance,d)<0&&(this.log("Waiting fragment cc ("+d.cc+") @ "+d.start+" cancelled because another fragment at "+v.end+" is needed"),this.clearWaitingFragment())}}else this.state=Qi.IDLE}this.onTickEnd()},n.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Qi.IDLE)},n.resetLoadingState=function(){this.clearWaitingFragment(),t.prototype.resetLoadingState.call(this)},n.onTickEnd=function(){var t=this.media;null!=t&&t.readyState&&(this.lastCurrentTime=t.currentTime)},n.doTickIdle=function(){var t=this.hls,e=this.levels,n=this.media,i=this.trackId,r=t.config;if((n||!this.startFragRequested&&r.startFragPrefetch)&&null!=e&&e[i]){var o=e[i],a=o.details;if(!a||a.live&&this.levelLastLoaded!==o||this.waitForCdnTuneIn(a))this.state=Qi.WAITING_TRACK;else{var s=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&s&&(this.bufferFlushed=!1,this.afterBufferFlushed(s,K.AUDIO,$e.AUDIO));var l=this.getFwdBufferInfo(s,$e.AUDIO);if(null!==l){var u=this.bufferedTrack,c=this.switchingTrack;if(!c&&this._streamEnded(l,a))return t.trigger(D.BUFFER_EOS,{type:"audio"}),void(this.state=Qi.ENDED);var d=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,$e.MAIN),h=l.len,f=this.getMaxBufferLength(null==d?void 0:d.len),p=a.fragments,g=p[0].start,m=this.flushing?this.getLoadPosition():l.end;if(c&&n){var v=this.getLoadPosition();u&&!Fo(c.attrs,u.attrs)&&(m=v),a.PTSKnown&&v<g&&(l.end>g||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=g+.05)}if(!(h>=f&&!c&&m<p[p.length-1].start)){var y=this.getNextFragment(m,a),b=!1;if(y&&this.isLoopLoading(y,m)&&(b=!!y.gap,y=this.getNextFragmentLoopLoading(y,a,l,$e.MAIN,f)),y){var E=d&&y.start>d.end+a.targetduration;if(E||(null==d||!d.len)&&l.len){var T=this.getAppendedFrag(y.start,$e.MAIN);if(null===T)return;if(b||(b=!!T.gap||!!E&&0===d.len),E&&!b||b&&l.nextStart&&l.nextStart<T.end)return}this.loadFragment(y,o,m)}else this.bufferFlushed=!0}}}}},n.getMaxBufferLength=function(e){var n=t.prototype.getMaxBufferLength.call(this);return e?Math.min(Math.max(n,e),this.config.maxMaxBufferLength):n},n.onMediaDetaching=function(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,t.prototype.onMediaDetaching.call(this)},n.onAudioTracksUpdated=function(t,e){var n=e.audioTracks;this.resetTransmuxer(),this.levels=n.map((function(t){return new Ln(t)}))},n.onAudioTrackSwitching=function(t,e){var n=!!e.url;this.trackId=e.id;var i=this.fragCurrent;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),n?this.setInterval(Uo):this.resetTransmuxer(),n?(this.switchingTrack=e,this.state=Qi.IDLE,this.flushAudioIfNeeded(e)):(this.switchingTrack=null,this.bufferedTrack=e,this.state=Qi.STOPPED),this.tick()},n.onManifestLoading=function(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1},n.onLevelLoaded=function(t,e){this.mainDetails=e.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(D.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},n.onAudioTrackLoaded=function(t,e){var n;if(null!=this.mainDetails){var i=this.levels,r=e.details,o=e.id;if(i){this.log("Audio track "+o+" loaded ["+r.startSN+","+r.endSN+"]"+(r.lastPartSn?"[part-"+r.lastPartSn+"-"+r.lastPartIndex+"]":"")+",duration:"+r.totalduration);var a=i[o],s=0;if(r.live||null!=(n=a.details)&&n.live){this.checkLiveUpdate(r);var l,u=this.mainDetails;if(r.deltaUpdateFailed||!u)return;!a.details&&r.hasProgramDateTime&&u.hasProgramDateTime?(Ui(r,u),s=r.fragments[0].start):s=this.alignPlaylists(r,a.details,null==(l=this.levelLastLoaded)?void 0:l.details)}a.details=r,this.levelLastLoaded=a,this.startFragRequested||!this.mainDetails&&r.live||this.setStartPosition(this.mainDetails||r,s),this.state!==Qi.WAITING_TRACK||this.waitForCdnTuneIn(r)||(this.state=Qi.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+o)}else this.cachedTrackLoadedData=e},n._handleFragmentLoadProgress=function(t){var e,n=t.frag,i=t.part,r=t.payload,o=this.config,a=this.trackId,s=this.levels;if(s){var l=s[a];if(l){var u=l.details;if(!u)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(n.start);var c=o.defaultAudioCodec||l.audioCodec||"mp4a.40.2",d=this.transmuxer;d||(d=this.transmuxer=new Mo(this.hls,$e.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var h=this.initPTS[n.cc],f=null==(e=n.initSegment)?void 0:e.data;if(void 0!==h){var p=!1,g=i?i.index:-1,m=-1!==g,v=new Ci(n.level,n.sn,n.stats.chunkCount,r.byteLength,g,m);d.push(r,f,c,"",n,i,u.totalduration,p,v,h)}else this.log("Unknown video PTS for cc "+n.cc+", waiting for video PTS before demuxing audio frag "+n.sn+" of ["+u.startSN+" ,"+u.endSN+"],track "+a),(this.waitingData=this.waitingData||{frag:n,part:i,cache:new tr,complete:!1}).cache.push(new Uint8Array(r)),this.waitingVideoCC=this.videoTrackCC,this.state=Qi.WAITING_INIT_PTS}else this.warn("Audio track is undefined on fragment load progress")}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered")},n._handleFragmentLoadComplete=function(e){this.waitingData?this.waitingData.complete=!0:t.prototype._handleFragmentLoadComplete.call(this,e)},n.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},n.onBufferCreated=function(t,e){var n=e.tracks.audio;n&&(this.mediaBuffer=n.buffer||null),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer||null)},n.onFragBuffered=function(t,e){var n=e.frag,r=e.part;if(n.type===$e.AUDIO)if(this.fragContextChanged(n))this.warn("Fragment "+n.sn+(r?" p: "+r.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+(this.switchingTrack?this.switchingTrack.name:"false"));else{if("initSegment"!==n.sn){this.fragPrevious=n;var o=this.switchingTrack;o&&(this.bufferedTrack=o,this.switchingTrack=null,this.hls.trigger(D.AUDIO_TRACK_SWITCHED,i({},o)))}this.fragBufferedComplete(n,r)}else if(!this.loadedmetadata&&n.type===$e.MAIN){var a=this.videoBuffer||this.media;a&&_i.getBuffered(a).length&&(this.loadedmetadata=!0)}},n.onError=function(e,n){var i;if(n.fatal)this.state=Qi.ERROR;else switch(n.details){case _.FRAG_GAP:case _.FRAG_PARSING_ERROR:case _.FRAG_DECRYPT_ERROR:case _.FRAG_LOAD_ERROR:case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_ERROR:case _.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError($e.AUDIO,n);break;case _.AUDIO_TRACK_LOAD_ERROR:case _.AUDIO_TRACK_LOAD_TIMEOUT:case _.LEVEL_PARSING_ERROR:n.levelRetry||this.state!==Qi.WAITING_TRACK||(null==(i=n.context)?void 0:i.type)!==Je.AUDIO_TRACK||(this.state=Qi.IDLE);break;case _.BUFFER_APPEND_ERROR:case _.BUFFER_FULL_ERROR:if(!n.parent||"audio"!==n.parent)return;if(n.details===_.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(n)&&(this.bufferedTrack=null,t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case _.INTERNAL_EXCEPTION:this.recoverWorkerError(n)}},n.onBufferFlushing=function(t,e){e.type!==K.VIDEO&&(this.flushing=!0)},n.onBufferFlushed=function(t,e){var n=e.type;if(n!==K.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===Qi.ENDED&&(this.state=Qi.IDLE);var i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,n,$e.AUDIO),this.tick())}},n._handleTransmuxComplete=function(t){var e,n="audio",i=this.hls,r=t.remuxResult,o=t.chunkMeta,a=this.getCurrentContext(o);if(a){var s=a.frag,l=a.part,c=a.level,d=c.details,h=r.audio,f=r.text,p=r.id3,g=r.initSegment;if(!this.fragContextChanged(s)&&d){if(this.state=Qi.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=g&&g.tracks){var m=s.initSegment||s;this._bufferInitSegment(c,g.tracks,m,o),i.trigger(D.FRAG_PARSING_INIT_SEGMENT,{frag:m,id:n,tracks:g.tracks})}if(h){var v=h.startPTS,y=h.endPTS,b=h.startDTS,E=h.endDTS;l&&(l.elementaryStreams[K.AUDIO]={startPTS:v,endPTS:y,startDTS:b,endDTS:E}),s.setElementaryStreamInfo(K.AUDIO,v,y,b,E),this.bufferFragmentData(h,s,l,o)}if(null!=p&&null!=(e=p.samples)&&e.length){var T=u({id:n,frag:s,details:d},p);i.trigger(D.FRAG_PARSING_METADATA,T)}if(f){var A=u({id:n,frag:s,details:d},f);i.trigger(D.FRAG_PARSING_USERDATA,A)}}else this.fragmentTracker.removeFragment(s)}else this.resetWhenMissingContext(o)},n._bufferInitSegment=function(t,e,n,i){if(this.state===Qi.PARSING){e.video&&delete e.video;var r=e.audio;if(r){r.id="audio";var o=t.audioCodec;this.log("Init audio buffer, container:"+r.container+", codecs[level/parsed]=["+o+"/"+r.codec+"]"),o&&1===o.split(",").length&&(r.levelCodec=o),this.hls.trigger(D.BUFFER_CODECS,e);var a=r.initSegment;if(null!=a&&a.byteLength){var s={type:"audio",frag:n,part:null,chunkMeta:i,parent:n.type,data:a};this.hls.trigger(D.BUFFER_APPENDING,s)}this.tickImmediate()}}},n.loadFragment=function(e,n,i){var r,o=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||o===wi.NOT_LOADED||o===wi.PARTIAL)if("initSegment"===e.sn)this._loadInitSegment(e,n);else if(null!=(r=n.details)&&r.live&&!this.initPTS[e.cc]){this.log("Waiting for video PTS in continuity counter "+e.cc+" of live stream before loading audio fragment "+e.sn+" of level "+this.trackId),this.state=Qi.WAITING_INIT_PTS;var a=this.mainDetails;a&&a.fragments[0].start!==n.details.fragments[0].start&&Ui(n.details,a)}else this.startFragRequested=!0,t.prototype.loadFragment.call(this,e,n,i);else this.clearTrackerIfNeeded(e)},n.flushAudioIfNeeded=function(e){var n=this.media,i=this.bufferedTrack,r=null==i?void 0:i.attrs,o=e.attrs;n&&r&&(r.CHANNELS!==o.CHANNELS||i.name!==e.name||i.lang!==e.lang)&&(this.log("Switching audio track : flushing all audio"),t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)},n.completeAudioSwitch=function(t){var e=this.hls;this.flushAudioIfNeeded(t),this.bufferedTrack=t,this.switchingTrack=null,e.trigger(D.AUDIO_TRACK_SWITCHED,i({},t))},e}(Zi),Go=function(t){function e(e){var n;return(n=t.call(this,e,"[audio-track-controller]")||this).tracks=[],n.groupIds=null,n.tracksInGroup=[],n.trackId=-1,n.currentTrack=null,n.selectDefaultTrack=!0,n.registerListeners(),n}c(e,t);var n=e.prototype;return n.registerListeners=function(){var t=this.hls;t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.LEVEL_LOADING,this.onLevelLoading,this),t.on(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(D.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(D.ERROR,this.onError,this)},n.unregisterListeners=function(){var t=this.hls;t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.LEVEL_LOADING,this.onLevelLoading,this),t.off(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(D.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(D.ERROR,this.onError,this)},n.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,t.prototype.destroy.call(this)},n.onManifestLoading=function(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0},n.onManifestParsed=function(t,e){this.tracks=e.audioTracks||[]},n.onAudioTrackLoaded=function(t,e){var n=e.id,i=e.groupId,r=e.details,o=this.tracksInGroup[n];if(o&&o.groupId===i){var a=o.details;o.details=e.details,this.log("Audio track "+n+' "'+o.name+'" lang:'+o.lang+" group:"+i+" loaded ["+r.startSN+"-"+r.endSN+"]"),n===this.trackId&&this.playlistLoaded(n,e,a)}else this.warn("Audio track with id:"+n+" and group:"+i+" not found in active group "+(null==o?void 0:o.groupId))},n.onLevelLoading=function(t,e){this.switchLevel(e.level)},n.onLevelSwitching=function(t,e){this.switchLevel(e.level)},n.switchLevel=function(t){var e=this.hls.levels[t];if(e){var n=e.audioGroups||null,i=this.groupIds,r=this.currentTrack;if(!n||(null==i?void 0:i.length)!==(null==n?void 0:n.length)||null!=n&&n.some((function(t){return-1===(null==i?void 0:i.indexOf(t))}))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;var o=this.tracks.filter((function(t){return!n||-1!==n.indexOf(t.groupId)}));if(o.length)this.selectDefaultTrack&&!o.some((function(t){return t.default}))&&(this.selectDefaultTrack=!1),o.forEach((function(t,e){t.id=e}));else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=o;var a=this.hls.config.audioPreference;if(!r&&a){var s=mi(a,o,bi);if(s>-1)r=o[s];else{var l=mi(a,this.tracks);r=this.tracks[l]}}var u=this.findTrackId(r);-1===u&&r&&(u=this.findTrackId(null));var c={audioTracks:o};this.log("Updating audio tracks, "+o.length+" track(s) found in group(s): "+(null==n?void 0:n.join(","))),this.hls.trigger(D.AUDIO_TRACKS_UPDATED,c);var d=this.trackId;if(-1!==u&&-1===d)this.setAudioTrack(u);else if(o.length&&-1===d){var h,f=new Error("No audio track selected for current audio group-ID(s): "+(null==(h=this.groupIds)?void 0:h.join(","))+" track count: "+o.length);this.warn(f.message),this.hls.trigger(D.ERROR,{type:R.MEDIA_ERROR,details:_.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}else this.shouldReloadPlaylist(r)&&this.setAudioTrack(this.trackId)}},n.onError=function(t,e){!e.fatal&&e.context&&(e.context.type!==Je.AUDIO_TRACK||e.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(e.context.groupId)||(this.requestScheduled=-1,this.checkRetry(e)))},n.setAudioOption=function(t){var e=this.hls;if(e.config.audioPreference=t,t){var n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){var i=this.currentTrack;if(i&&vi(t,i,bi))return i;var r=mi(t,this.tracksInGroup,bi);if(r>-1){var o=this.tracksInGroup[r];return this.setAudioTrack(r),o}if(i){var a=e.loadLevel;-1===a&&(a=e.firstAutoLevel);var s=Ei(t,e.levels,n,a,bi);if(-1===s)return null;e.nextLoadLevel=s}if(t.channels||t.audioCodec){var l=mi(t,n);if(l>-1)return n[l]}}}return null},n.setAudioTrack=function(t){var e=this.tracksInGroup;if(t<0||t>=e.length)this.warn("Invalid audio track id: "+t);else{this.clearTimer(),this.selectDefaultTrack=!1;var n=this.currentTrack,r=e[t],o=r.details&&!r.details.live;if(!(t===this.trackId&&r===n&&o||(this.log("Switching to audio-track "+t+' "'+r.name+'" lang:'+r.lang+" group:"+r.groupId+" channels:"+r.channels),this.trackId=t,this.currentTrack=r,this.hls.trigger(D.AUDIO_TRACK_SWITCHING,i({},r)),o))){var a=this.switchParams(r.url,null==n?void 0:n.details,r.details);this.loadPlaylist(a)}}},n.findTrackId=function(t){for(var e=this.tracksInGroup,n=0;n<e.length;n++){var i=e[n];if((!this.selectDefaultTrack||i.default)&&(!t||vi(t,i,bi)))return n}if(t){for(var r=t.name,o=t.lang,a=t.assocLang,s=t.characteristics,l=t.audioCodec,u=t.channels,c=0;c<e.length;c++)if(vi({name:r,lang:o,assocLang:a,characteristics:s,audioCodec:l,channels:u},e[c],bi))return c;for(var d=0;d<e.length;d++){var h=e[d];if(Fo(t.attrs,h.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return d}for(var f=0;f<e.length;f++){var p=e[f];if(Fo(t.attrs,p.attrs,["LANGUAGE"]))return f}}return-1},n.loadPlaylist=function(e){var n=this.currentTrack;if(this.shouldLoadPlaylist(n)&&n){t.prototype.loadPlaylist.call(this);var i=n.id,r=n.groupId,o=n.url;if(e)try{o=e.addDirectives(o)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("loading audio-track playlist "+i+' "'+n.name+'" lang:'+n.lang+" group:"+r),this.clearTimer(),this.hls.trigger(D.AUDIO_TRACK_LOADING,{url:o,id:i,groupId:r,deliveryDirectives:e||null})}},s(e,[{key:"allAudioTracks",get:function(){return this.tracks}},{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}]),e}(ni),Vo=500,Ho=function(t){function e(e,n,i){var r;return(r=t.call(this,e,n,i,"[subtitle-stream-controller]",$e.SUBTITLE)||this).currentTrackId=-1,r.tracksBuffered=[],r.mainDetails=null,r._registerListeners(),r}c(e,t);var n=e.prototype;return n.onHandlerDestroying=function(){this._unregisterListeners(),t.prototype.onHandlerDestroying.call(this),this.mainDetails=null},n._registerListeners=function(){var t=this.hls;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.LEVEL_LOADED,this.onLevelLoaded,this),t.on(D.ERROR,this.onError,this),t.on(D.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(D.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(D.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(D.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(D.FRAG_BUFFERED,this.onFragBuffered,this)},n._unregisterListeners=function(){var t=this.hls;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.LEVEL_LOADED,this.onLevelLoaded,this),t.off(D.ERROR,this.onError,this),t.off(D.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(D.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(D.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(D.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(D.FRAG_BUFFERED,this.onFragBuffered,this)},n.startLoad=function(t){this.stopLoad(),this.state=Qi.IDLE,this.setInterval(Vo),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},n.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},n.onMediaDetaching=function(){this.tracksBuffered=[],t.prototype.onMediaDetaching.call(this)},n.onLevelLoaded=function(t,e){this.mainDetails=e.details},n.onSubtitleFragProcessed=function(t,e){var n=e.frag,i=e.success;if(this.fragPrevious=n,this.state=Qi.IDLE,i){var r=this.tracksBuffered[this.currentTrackId];if(r){for(var o,a=n.start,s=0;s<r.length;s++)if(a>=r[s].start&&a<=r[s].end){o=r[s];break}var l=n.start+n.duration;o?o.end=l:(o={start:a,end:l},r.push(o)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null)}}},n.onBufferFlushing=function(t,e){var n=e.startOffset,i=e.endOffset;if(0===n&&i!==Number.POSITIVE_INFINITY){var r=i-1;if(r<=0)return;e.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach((function(t){for(var e=0;e<t.length;)if(t[e].end<=r)t.shift();else{if(!(t[e].start<r))break;t[e].start=r,e++}})),this.fragmentTracker.removeFragmentsInRange(n,r,$e.SUBTITLE)}},n.onFragBuffered=function(t,e){var n;this.loadedmetadata||e.frag.type!==$e.MAIN||null!=(n=this.media)&&n.buffered.length&&(this.loadedmetadata=!0)},n.onError=function(t,e){var n=e.frag;(null==n?void 0:n.type)===$e.SUBTITLE&&(e.details===_.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Qi.STOPPED&&(this.state=Qi.IDLE))},n.onSubtitleTracksUpdated=function(t,e){var n=this,i=e.subtitleTracks;this.levels&&No(this.levels,i)?this.levels=i.map((function(t){return new Ln(t)})):(this.tracksBuffered=[],this.levels=i.map((function(t){var e=new Ln(t);return n.tracksBuffered[e.id]=[],e})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,$e.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null)},n.onSubtitleTrackSwitch=function(t,e){var n;if(this.currentTrackId=e.id,null!=(n=this.levels)&&n.length&&-1!==this.currentTrackId){var i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(Vo)}else this.clearInterval()},n.onSubtitleTrackLoaded=function(t,e){var n,i=this.currentTrackId,r=this.levels,o=e.details,a=e.id;if(r){var s=r[a];if(!(a>=r.length)&&s){this.log("Subtitle track "+a+" loaded ["+o.startSN+","+o.endSN+"]"+(o.lastPartSn?"[part-"+o.lastPartSn+"-"+o.lastPartIndex+"]":"")+",duration:"+o.totalduration),this.mediaBuffer=this.mediaBufferTimeRanges;var l=0;if(o.live||null!=(n=s.details)&&n.live){var u=this.mainDetails;if(o.deltaUpdateFailed||!u)return;var c,d=u.fragments[0];s.details?0===(l=this.alignPlaylists(o,s.details,null==(c=this.levelLastLoaded)?void 0:c.details))&&d&&Pn(o,l=d.start):o.hasProgramDateTime&&u.hasProgramDateTime?(Ui(o,u),l=o.fragments[0].start):d&&Pn(o,l=d.start)}s.details=o,this.levelLastLoaded=s,a===i&&(this.startFragRequested||!this.mainDetails&&o.live||this.setStartPosition(this.mainDetails||o,l),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===Qi.IDLE&&(zn(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),s.details=void 0)))}}else this.warn("Subtitle tracks were reset while loading level "+a)},n._handleFragmentLoadComplete=function(t){var e=this,n=t.frag,i=t.payload,r=n.decryptdata,o=this.hls;if(!this.fragContextChanged(n)&&i&&i.byteLength>0&&null!=r&&r.key&&r.iv&&"AES-128"===r.method){var a=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer).catch((function(t){throw o.trigger(D.ERROR,{type:R.MEDIA_ERROR,details:_.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:n}),t})).then((function(t){var e=performance.now();o.trigger(D.FRAG_DECRYPTED,{frag:n,payload:t,stats:{tstart:a,tdecrypt:e}})})).catch((function(t){e.warn(t.name+": "+t.message),e.state=Qi.IDLE}))}},n.doTick=function(){if(this.media){if(this.state===Qi.IDLE){var t=this.currentTrackId,e=this.levels,n=null==e?void 0:e[t];if(!n||!e.length||!n.details)return;var i=this.config,r=this.getLoadPosition(),o=_i.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,i.maxBufferHole),a=o.end,s=o.len,l=this.getFwdBufferInfo(this.media,$e.MAIN),u=n.details;if(s>this.getMaxBufferLength(null==l?void 0:l.len)+u.levelTargetDuration)return;var c=u.fragments,d=c.length,h=u.edge,f=null,p=this.fragPrevious;if(a<h){var g=i.maxFragLookUpTolerance,m=a>h-g?0:g;!(f=zn(p,c,Math.max(c[0].start,a),m))&&p&&p.start<c[0].start&&(f=c[0])}else f=c[d-1];if(!f)return;if("initSegment"!==(f=this.mapToInitFragWhenRequired(f)).sn){var v=c[f.sn-u.startSN-1];v&&v.cc===f.cc&&this.fragmentTracker.getState(v)===wi.NOT_LOADED&&(f=v)}this.fragmentTracker.getState(f)===wi.NOT_LOADED&&this.loadFragment(f,n,a)}}else this.state=Qi.IDLE},n.getMaxBufferLength=function(e){var n=t.prototype.getMaxBufferLength.call(this);return e?Math.max(n,e):n},n.loadFragment=function(e,n,i){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,n):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,e,n,i))},s(e,[{key:"mediaBufferTimeRanges",get:function(){return new Ko(this.tracksBuffered[this.currentTrackId]||[])}}]),e}(Zi),Ko=function(t){this.buffered=void 0;var e=function(e,n,i){if((n>>>=0)>i-1)throw new DOMException("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+n+") is greater than the maximum bound ("+i+")");return t[n][e]};this.buffered={get length(){return t.length},end:function(n){return e("end",n,t.length)},start:function(n){return e("start",n,t.length)}}},Wo=function(t){function e(e){var n;return(n=t.call(this,e,"[subtitle-track-controller]")||this).media=null,n.tracks=[],n.groupIds=null,n.tracksInGroup=[],n.trackId=-1,n.currentTrack=null,n.selectDefaultTrack=!0,n.queuedDefaultTrack=-1,n.asyncPollTrackChange=function(){return n.pollTrackChange(0)},n.useTextTrackPolling=!1,n.subtitlePollingInterval=-1,n._subtitleDisplay=!0,n.onTextTracksChanged=function(){if(n.useTextTrackPolling||self.clearInterval(n.subtitlePollingInterval),n.media&&n.hls.config.renderTextTracksNatively){for(var t=null,e=ln(n.media.textTracks),i=0;i<e.length;i++)if("hidden"===e[i].mode)t=e[i];else if("showing"===e[i].mode){t=e[i];break}var r=n.findTrackForTextTrack(t);n.subtitleTrack!==r&&n.setSubtitleTrack(r)}},n.registerListeners(),n}c(e,t);var n=e.prototype;return n.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,t.prototype.destroy.call(this)},n.registerListeners=function(){var t=this.hls;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.LEVEL_LOADING,this.onLevelLoading,this),t.on(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(D.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(D.ERROR,this.onError,this)},n.unregisterListeners=function(){var t=this.hls;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.LEVEL_LOADING,this.onLevelLoading,this),t.off(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(D.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(D.ERROR,this.onError,this)},n.onMediaAttached=function(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},n.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,t)},n.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),ln(this.media.textTracks).forEach((function(t){rn(t)})),this.subtitleTrack=-1,this.media=null)},n.onManifestLoading=function(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0},n.onManifestParsed=function(t,e){this.tracks=e.subtitleTracks},n.onSubtitleTrackLoaded=function(t,e){var n=e.id,i=e.groupId,r=e.details,o=this.tracksInGroup[n];if(o&&o.groupId===i){var a=o.details;o.details=e.details,this.log("Subtitle track "+n+' "'+o.name+'" lang:'+o.lang+" group:"+i+" loaded ["+r.startSN+"-"+r.endSN+"]"),n===this.trackId&&this.playlistLoaded(n,e,a)}else this.warn("Subtitle track with id:"+n+" and group:"+i+" not found in active group "+(null==o?void 0:o.groupId))},n.onLevelLoading=function(t,e){this.switchLevel(e.level)},n.onLevelSwitching=function(t,e){this.switchLevel(e.level)},n.switchLevel=function(t){var e=this.hls.levels[t];if(e){var n=e.subtitleGroups||null,i=this.groupIds,r=this.currentTrack;if(!n||(null==i?void 0:i.length)!==(null==n?void 0:n.length)||null!=n&&n.some((function(t){return-1===(null==i?void 0:i.indexOf(t))}))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;var o=this.tracks.filter((function(t){return!n||-1!==n.indexOf(t.groupId)}));if(o.length)this.selectDefaultTrack&&!o.some((function(t){return t.default}))&&(this.selectDefaultTrack=!1),o.forEach((function(t,e){t.id=e}));else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=o;var a=this.hls.config.subtitlePreference;if(!r&&a){this.selectDefaultTrack=!1;var s=mi(a,o);if(s>-1)r=o[s];else{var l=mi(a,this.tracks);r=this.tracks[l]}}var u=this.findTrackId(r);-1===u&&r&&(u=this.findTrackId(null));var c={subtitleTracks:o};this.log("Updating subtitle tracks, "+o.length+' track(s) found in "'+(null==n?void 0:n.join(","))+'" group-id'),this.hls.trigger(D.SUBTITLE_TRACKS_UPDATED,c),-1!==u&&-1===this.trackId&&this.setSubtitleTrack(u)}else this.shouldReloadPlaylist(r)&&this.setSubtitleTrack(this.trackId)}},n.findTrackId=function(t){for(var e=this.tracksInGroup,n=this.selectDefaultTrack,i=0;i<e.length;i++){var r=e[i];if((!n||r.default)&&(n||t)&&(!t||vi(r,t)))return i}if(t){for(var o=0;o<e.length;o++){var a=e[o];if(Fo(t.attrs,a.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return o}for(var s=0;s<e.length;s++){var l=e[s];if(Fo(t.attrs,l.attrs,["LANGUAGE"]))return s}}return-1},n.findTrackForTextTrack=function(t){if(t)for(var e=this.tracksInGroup,n=0;n<e.length;n++)if(Bo(e[n],t))return n;return-1},n.onError=function(t,e){!e.fatal&&e.context&&(e.context.type!==Je.SUBTITLE_TRACK||e.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(e.context.groupId)||this.checkRetry(e))},n.setSubtitleOption=function(t){if(this.hls.config.subtitlePreference=t,t){var e=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,e.length){var n=this.currentTrack;if(n&&vi(t,n))return n;var i=mi(t,this.tracksInGroup);if(i>-1){var r=this.tracksInGroup[i];return this.setSubtitleTrack(i),r}if(n)return null;var o=mi(t,e);if(o>-1)return e[o]}}return null},n.loadPlaylist=function(e){t.prototype.loadPlaylist.call(this);var n=this.currentTrack;if(this.shouldLoadPlaylist(n)&&n){var i=n.id,r=n.groupId,o=n.url;if(e)try{o=e.addDirectives(o)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Loading subtitle playlist for id "+i),this.hls.trigger(D.SUBTITLE_TRACK_LOADING,{url:o,id:i,groupId:r,deliveryDirectives:e||null})}},n.toggleTrackModes=function(){var t=this.media;if(t){var e,n=ln(t.textTracks),i=this.currentTrack;if(i&&((e=n.filter((function(t){return Bo(i,t)}))[0])||this.warn('Unable to find subtitle TextTrack with name "'+i.name+'" and language "'+i.lang+'"')),[].slice.call(n).forEach((function(t){"disabled"!==t.mode&&t!==e&&(t.mode="disabled")})),e){var r=this.subtitleDisplay?"showing":"hidden";e.mode!==r&&(e.mode=r)}}},n.setSubtitleTrack=function(t){var e=this.tracksInGroup;if(this.media)if(t<-1||t>=e.length||!w(t))this.warn("Invalid subtitle track id: "+t);else{this.clearTimer(),this.selectDefaultTrack=!1;var n=this.currentTrack,i=e[t]||null;if(this.trackId=t,this.currentTrack=i,this.toggleTrackModes(),i){var r=!!i.details&&!i.details.live;if(t!==this.trackId||i!==n||!r){this.log("Switching to subtitle-track "+t+(i?' "'+i.name+'" lang:'+i.lang+" group:"+i.groupId:""));var o=i.id,a=i.groupId,s=void 0===a?"":a,l=i.name,u=i.type,c=i.url;this.hls.trigger(D.SUBTITLE_TRACK_SWITCH,{id:o,groupId:s,name:l,type:u,url:c});var d=this.switchParams(i.url,null==n?void 0:n.details,i.details);this.loadPlaylist(d)}}else this.hls.trigger(D.SUBTITLE_TRACK_SWITCH,{id:t})}else this.queuedDefaultTrack=t},s(e,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes()}},{key:"allSubtitleTracks",get:function(){return this.tracks}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setSubtitleTrack(t)}}]),e}(ni),qo=function(){function t(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}var e=t.prototype;return e.append=function(t,e,n){var i=this.queues[e];i.push(t),1!==i.length||n||this.executeNext(e)},e.insertAbort=function(t,e){this.queues[e].unshift(t),this.executeNext(e)},e.appendBlocker=function(t){var e,n=new Promise((function(t){e=t})),i={execute:e,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(i,t),n},e.executeNext=function(t){var e=this.queues[t];if(e.length){var n=e[0];try{n.execute()}catch(e){N.warn('[buffer-operation-queue]: Exception executing "'+t+'" SourceBuffer operation: '+e),n.onError(e);var i=this.buffers[t];null!=i&&i.updating||this.shiftAndExecuteNext(t)}}},e.shiftAndExecuteNext=function(t){this.queues[t].shift(),this.executeNext(t)},e.current=function(t){return this.queues[t][0]},t}(),Yo=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,zo=function(){function t(t){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=function(t){e.hls&&e.hls.pauseBuffering()},this._onStartStreaming=function(t){e.hls&&e.hls.resumeBuffering()},this._onMediaSourceOpen=function(){var t=e.media,n=e.mediaSource;e.log("Media source opened"),t&&(t.removeEventListener("emptied",e._onMediaEmptied),e.updateMediaElementDuration(),e.hls.trigger(D.MEDIA_ATTACHED,{media:t,mediaSource:n})),n&&n.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){e.log("Media source closed")},this._onMediaSourceEnded=function(){e.log("Media source ended")},this._onMediaEmptied=function(){var t=e.mediaSrc,n=e._objectUrl;t!==n&&N.error("Media element src was set while attaching MediaSource ("+n+" > "+t+")")},this.hls=t;var n="[buffer-controller]";this.appendSource=Ae(Te(t.config.preferManagedMediaSource)),this.log=N.log.bind(N,n),this.warn=N.warn.bind(N,n),this.error=N.error.bind(N,n),this._initSourceBuffer(),this.registerListeners()}var e=t.prototype;return e.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},e.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null},e.registerListeners=function(){var t=this.hls;t.on(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.BUFFER_RESET,this.onBufferReset,this),t.on(D.BUFFER_APPENDING,this.onBufferAppending,this),t.on(D.BUFFER_CODECS,this.onBufferCodecs,this),t.on(D.BUFFER_EOS,this.onBufferEos,this),t.on(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(D.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(D.FRAG_PARSED,this.onFragParsed,this),t.on(D.FRAG_CHANGED,this.onFragChanged,this)},e.unregisterListeners=function(){var t=this.hls;t.off(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.BUFFER_RESET,this.onBufferReset,this),t.off(D.BUFFER_APPENDING,this.onBufferAppending,this),t.off(D.BUFFER_CODECS,this.onBufferCodecs,this),t.off(D.BUFFER_EOS,this.onBufferEos,this),t.off(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(D.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(D.FRAG_PARSED,this.onFragParsed,this),t.off(D.FRAG_CHANGED,this.onFragChanged,this)},e._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new qo(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null},e.onManifestLoading=function(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null},e.onManifestParsed=function(t,e){var n=2;(e.audio&&!e.video||!e.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,this.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},e.onMediaAttaching=function(t,e){var n=this.media=e.media,i=Te(this.appendSource);if(n&&i){var r,o=this.mediaSource=new i;this.log("created media source: "+(null==(r=o.constructor)?void 0:r.name)),o.addEventListener("sourceopen",this._onMediaSourceOpen),o.addEventListener("sourceended",this._onMediaSourceEnded),o.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(o.addEventListener("startstreaming",this._onStartStreaming),o.addEventListener("endstreaming",this._onEndStreaming));var a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{n.removeAttribute("src");var s=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||s&&o instanceof s,Xo(n),Jo(n,a),n.load()}catch(t){n.src=a}else n.src=a;n.addEventListener("emptied",this._onMediaEmptied)}},e.onMediaDetaching=function(){var t=this.media,e=this.mediaSource,n=this._objectUrl;if(e){if(this.log("media source detaching"),"open"===e.readyState)try{e.endOfStream()}catch(t){this.warn("onMediaDetaching: "+t.message+" while calling endOfStream")}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.removeEventListener("startstreaming",this._onStartStreaming),e.removeEventListener("endstreaming",this._onEndStreaming)),t&&(t.removeEventListener("emptied",this._onMediaEmptied),n&&self.URL.revokeObjectURL(n),this.mediaSrc===n?(t.removeAttribute("src"),this.appendSource&&Xo(t),t.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(D.MEDIA_DETACHED,void 0)},e.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach((function(e){t.resetBuffer(e)})),this._initSourceBuffer()},e.resetBuffer=function(t){var e=this.sourceBuffer[t];try{var n;e&&(this.removeBufferListeners(t),this.sourceBuffer[t]=void 0,null!=(n=this.mediaSource)&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(e))}catch(e){this.warn("onBufferReset "+t,e)}},e.onBufferCodecs=function(t,e){var n=this,i=this.getSourceBufferTypes().length,r=Object.keys(e);if(r.forEach((function(t){if(i){var r=n.tracks[t];if(r&&"function"==typeof r.buffer.changeType){var o,a=e[t],s=a.id,l=a.codec,u=a.levelCodec,c=a.container,d=a.metadata,h=Pe(r.codec,r.levelCodec),f=null==h?void 0:h.replace(Yo,"$1"),p=Pe(l,u),g=null==(o=p)?void 0:o.replace(Yo,"$1");if(p&&f!==g){"audio"===t.slice(0,5)&&(p=Oe(p,n.appendSource));var m=c+";codecs="+p;n.appendChangeType(t,m),n.log("switching codec "+h+" to "+p),n.tracks[t]={buffer:r.buffer,codec:l,container:c,levelCodec:u,metadata:d,id:s}}}}else n.pendingTracks[t]=e[t]})),!i){var o=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==o&&(this.log(o+" bufferCodec event(s) expected "+r.join(",")),this.bufferCodecEventsExpected=o),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks()}},e.appendChangeType=function(t,e){var n=this,i=this.operationQueue,r={execute:function(){var r=n.sourceBuffer[t];r&&(n.log("changing "+t+" sourceBuffer type to "+e),r.changeType(e)),i.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(e){n.warn("Failed to change "+t+" SourceBuffer type",e)}};i.append(r,t,!!this.pendingTracks[t])},e.onBufferAppending=function(t,e){var n=this,i=this.hls,r=this.operationQueue,o=this.tracks,a=e.data,s=e.type,l=e.frag,u=e.part,c=e.chunkMeta,d=c.buffering[s],h=self.performance.now();d.start=h;var f=l.stats.buffering,p=u?u.stats.buffering:null;0===f.start&&(f.start=h),p&&0===p.start&&(p.start=h);var g=o.audio,m=!1;"audio"===s&&"audio/mpeg"===(null==g?void 0:g.container)&&(m=!this.lastMpegAudioChunk||1===c.id||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);var v=l.start,y={execute:function(){if(d.executeStart=self.performance.now(),m){var t=n.sourceBuffer[s];if(t){var e=v-t.timestampOffset;Math.abs(e)>=.1&&(n.log("Updating audio SourceBuffer timestampOffset to "+v+" (delta: "+e+") sn: "+l.sn+")"),t.timestampOffset=v)}}n.appendExecutor(a,s)},onStart:function(){},onComplete:function(){var t=self.performance.now();d.executeEnd=d.end=t,0===f.first&&(f.first=t),p&&0===p.first&&(p.first=t);var e=n.sourceBuffer,i={};for(var r in e)i[r]=_i.getBuffered(e[r]);n.appendErrors[s]=0,"audio"===s||"video"===s?n.appendErrors.audiovideo=0:(n.appendErrors.audio=0,n.appendErrors.video=0),n.hls.trigger(D.BUFFER_APPENDED,{type:s,frag:l,part:u,chunkMeta:c,parent:l.type,timeRanges:i})},onError:function(t){var e={type:R.MEDIA_ERROR,parent:l.type,details:_.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:l,part:u,chunkMeta:c,error:t,err:t,fatal:!1};if(t.code===DOMException.QUOTA_EXCEEDED_ERR)e.details=_.BUFFER_FULL_ERROR;else{var r=++n.appendErrors[s];e.details=_.BUFFER_APPEND_ERROR,n.warn("Failed "+r+"/"+i.config.appendErrorMaxRetry+' times to append segment in "'+s+'" sourceBuffer'),r>=i.config.appendErrorMaxRetry&&(e.fatal=!0)}i.trigger(D.ERROR,e)}};r.append(y,s,!!this.pendingTracks[s])},e.onBufferFlushing=function(t,e){var n=this,i=this.operationQueue,r=function(t){return{execute:n.removeExecutor.bind(n,t,e.startOffset,e.endOffset),onStart:function(){},onComplete:function(){n.hls.trigger(D.BUFFER_FLUSHED,{type:t})},onError:function(e){n.warn("Failed to remove from "+t+" SourceBuffer",e)}}};e.type?i.append(r(e.type),e.type):this.getSourceBufferTypes().forEach((function(t){i.append(r(t),t)}))},e.onFragParsed=function(t,e){var n=this,i=e.frag,r=e.part,o=[],a=r?r.elementaryStreams:i.elementaryStreams;a[K.AUDIOVIDEO]?o.push("audiovideo"):(a[K.AUDIO]&&o.push("audio"),a[K.VIDEO]&&o.push("video"));var s=function(){var t=self.performance.now();i.stats.buffering.end=t,r&&(r.stats.buffering.end=t);var e=r?r.stats:i.stats;n.hls.trigger(D.FRAG_BUFFERED,{frag:i,part:r,stats:e,id:i.type})};0===o.length&&this.warn("Fragments must have at least one ElementaryStreamType set. type: "+i.type+" level: "+i.level+" sn: "+i.sn),this.blockBuffers(s,o)},e.onFragChanged=function(t,e){this.trimBuffers()},e.onBufferEos=function(t,e){var n=this;this.getSourceBufferTypes().reduce((function(t,i){var r=n.sourceBuffer[i];return!r||e.type&&e.type!==i||(r.ending=!0,r.ended||(r.ended=!0,n.log(i+" sourceBuffer now EOS"))),t&&!(r&&!r.ended)}),!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers((function(){n.getSourceBufferTypes().forEach((function(t){var e=n.sourceBuffer[t];e&&(e.ending=!1)}));var t=n.mediaSource;t&&"open"===t.readyState?(n.log("Calling mediaSource.endOfStream()"),t.endOfStream()):t&&n.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: "+t.readyState)})))},e.onLevelUpdated=function(t,e){var n=e.details;n.fragments.length&&(this.details=n,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},e.trimBuffers=function(){var t=this.hls,e=this.details,n=this.media;if(n&&null!==e&&this.getSourceBufferTypes().length){var i=t.config,r=n.currentTime,o=e.levelTargetDuration,a=e.live&&null!==i.liveBackBufferLength?i.liveBackBufferLength:i.backBufferLength;if(w(a)&&a>0){var s=Math.max(a,o),l=Math.floor(r/o)*o-s;this.flushBackBuffer(r,o,l)}if(w(i.frontBufferFlushThreshold)&&i.frontBufferFlushThreshold>0){var u=Math.max(i.maxBufferLength,i.frontBufferFlushThreshold),c=Math.max(u,o),d=Math.floor(r/o)*o+c;this.flushFrontBuffer(r,o,d)}}},e.flushBackBuffer=function(t,e,n){var i=this,r=this.details,o=this.sourceBuffer;this.getSourceBufferTypes().forEach((function(a){var s=o[a];if(s){var l=_i.getBuffered(s);if(l.length>0&&n>l.start(0)){if(i.hls.trigger(D.BACK_BUFFER_REACHED,{bufferEnd:n}),null!=r&&r.live)i.hls.trigger(D.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(s.ended&&l.end(l.length-1)-t<2*e)return void i.log("Cannot flush "+a+" back buffer while SourceBuffer is in ended state");i.hls.trigger(D.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:a})}}}))},e.flushFrontBuffer=function(t,e,n){var i=this,r=this.sourceBuffer;this.getSourceBufferTypes().forEach((function(o){var a=r[o];if(a){var s=_i.getBuffered(a),l=s.length;if(l<2)return;var u=s.start(l-1),c=s.end(l-1);if(n>u||t>=u&&t<=c)return;if(a.ended&&t-c<2*e)return void i.log("Cannot flush "+o+" front buffer while SourceBuffer is in ended state");i.hls.trigger(D.BUFFER_FLUSHING,{startOffset:u,endOffset:1/0,type:o})}}))},e.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var t=this.details,e=this.hls,n=this.media,i=this.mediaSource,r=t.fragments[0].start+t.totalduration,o=n.duration,a=w(i.duration)?i.duration:0;t.live&&e.config.liveDurationInfinity?(i.duration=1/0,this.updateSeekableRange(t)):(r>a&&r>o||!w(o))&&(this.log("Updating Media Source duration to "+r.toFixed(3)),i.duration=r)}},e.updateSeekableRange=function(t){var e=this.mediaSource,n=t.fragments;if(n.length&&t.live&&null!=e&&e.setLiveSeekableRange){var i=Math.max(0,n[0].start),r=Math.max(i,i+t.totalduration);this.log("Media Source duration is set to "+e.duration+". Setting seekable range to "+i+"-"+r+"."),e.setLiveSeekableRange(i,r)}},e.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.operationQueue,n=this.pendingTracks,i=Object.keys(n).length;if(i&&(!t||2===i||"audiovideo"in n)){this.createSourceBuffers(n),this.pendingTracks={};var r=this.getSourceBufferTypes();if(r.length)this.hls.trigger(D.BUFFER_CREATED,{tracks:this.tracks}),r.forEach((function(t){e.executeNext(t)}));else{var o=new Error("could not create source buffer for media codec(s)");this.hls.trigger(D.ERROR,{type:R.MEDIA_ERROR,details:_.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:o,reason:o.message})}}},e.createSourceBuffers=function(t){var e=this,n=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");var r=function(r){if(!n[r]){var o,a=t[r];if(!a)throw Error("source buffer exists for track "+r+", however track does not");var s=-1===(null==(o=a.levelCodec)?void 0:o.indexOf(","))?a.levelCodec:a.codec;s&&"audio"===r.slice(0,5)&&(s=Oe(s,e.appendSource));var l=a.container+";codecs="+s;e.log("creating sourceBuffer("+l+")");try{var u=n[r]=i.addSourceBuffer(l),c=r;e.addBufferListener(c,"updatestart",e._onSBUpdateStart),e.addBufferListener(c,"updateend",e._onSBUpdateEnd),e.addBufferListener(c,"error",e._onSBUpdateError),e.appendSource&&e.addBufferListener(c,"bufferedchange",(function(t,n){var i=n.removedRanges;null!=i&&i.length&&e.hls.trigger(D.BUFFER_FLUSHED,{type:r})})),e.tracks[r]={buffer:u,codec:s,container:a.container,levelCodec:a.levelCodec,metadata:a.metadata,id:a.id}}catch(t){e.error("error while trying to add sourceBuffer: "+t.message),e.hls.trigger(D.ERROR,{type:R.MEDIA_ERROR,details:_.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,sourceBufferName:r,mimeType:l})}}};for(var o in t)r(o)},e._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},e._onSBUpdateEnd=function(t){var e;if("closed"!==(null==(e=this.mediaSource)?void 0:e.readyState)){var n=this.operationQueue;n.current(t).onComplete(),n.shiftAndExecuteNext(t)}else this.resetBuffer(t)},e._onSBUpdateError=function(t,e){var n,i=new Error(t+" SourceBuffer error. MediaSource readyState: "+(null==(n=this.mediaSource)?void 0:n.readyState));this.error(""+i,e),this.hls.trigger(D.ERROR,{type:R.MEDIA_ERROR,details:_.BUFFER_APPENDING_ERROR,sourceBufferName:t,error:i,fatal:!1});var r=this.operationQueue.current(t);r&&r.onError(i)},e.removeExecutor=function(t,e,n){var i=this.media,r=this.mediaSource,o=this.operationQueue,a=this.sourceBuffer[t];if(!i||!r||!a)return this.warn("Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void o.shiftAndExecuteNext(t);var s=w(i.duration)?i.duration:1/0,l=w(r.duration)?r.duration:1/0,u=Math.max(0,e),c=Math.min(n,s,l);c>u&&(!a.ending||a.ended)?(a.ended=!1,this.log("Removing ["+u+","+c+"] from the "+t+" SourceBuffer"),a.remove(u,c)):o.shiftAndExecuteNext(t)},e.appendExecutor=function(t,e){var n=this.sourceBuffer[e];if(n)n.ended=!1,n.appendBuffer(t);else if(!this.pendingTracks[e])throw new Error("Attempting to append to the "+e+" SourceBuffer, but it does not exist")},e.blockBuffers=function(t,e){var n=this;if(void 0===e&&(e=this.getSourceBufferTypes()),!e.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(t);var i=this.operationQueue,r=e.map((function(t){return i.appendBlocker(t)}));Promise.all(r).then((function(){t(),e.forEach((function(t){var e=n.sourceBuffer[t];null!=e&&e.updating||i.shiftAndExecuteNext(t)}))}))},e.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},e.addBufferListener=function(t,e,n){var i=this.sourceBuffer[t];if(i){var r=n.bind(this,t);this.listeners[t].push({event:e,listener:r}),i.addEventListener(e,r)}},e.removeBufferListeners=function(t){var e=this.sourceBuffer[t];e&&this.listeners[t].forEach((function(t){e.removeEventListener(t.event,t.listener)}))},s(t,[{key:"mediaSrc",get:function(){var t,e=(null==(t=this.media)?void 0:t.firstChild)||this.media;return null==e?void 0:e.src}}]),t}();function Xo(t){var e=t.querySelectorAll("source");[].slice.call(e).forEach((function(e){t.removeChild(e)}))}function Jo(t,e){var n=self.document.createElement("source");n.type="video/mp4",n.src=e,t.appendChild(n)}var $o={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Qo=function(t){return String.fromCharCode($o[t]||t)},Zo=15,ta=100,ea={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},na={17:2,18:4,21:6,22:8,23:10,19:13,20:15},ia={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},ra={25:2,26:4,29:6,30:8,31:10,27:13,28:15},oa=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],aa=function(){function t(){this.time=null,this.verboseLevel=0}return t.prototype.log=function(t,e){if(this.verboseLevel>=t){var n="function"==typeof e?e():e;N.log(this.time+" ["+t+"] "+n)}},t}(),sa=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n].toString(16));return e},la=function(){function t(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}var e=t.prototype;return e.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},e.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],n=0;n<e.length;n++){var i=e[n];t.hasOwnProperty(i)&&(this[i]=t[i])}},e.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},e.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},e.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},e.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),ua=function(){function t(){this.uchar=" ",this.penState=new la}var e=t.prototype;return e.reset=function(){this.uchar=" ",this.penState.reset()},e.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},e.setPenState=function(t){this.penState.copy(t)},e.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},e.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},e.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),ca=function(){function t(t){this.chars=[],this.pos=0,this.currPenState=new la,this.cueStartTime=null,this.logger=void 0;for(var e=0;e<ta;e++)this.chars.push(new ua);this.logger=t}var e=t.prototype;return e.equals=function(t){for(var e=0;e<ta;e++)if(!this.chars[e].equals(t.chars[e]))return!1;return!0},e.copy=function(t){for(var e=0;e<ta;e++)this.chars[e].copy(t.chars[e])},e.isEmpty=function(){for(var t=!0,e=0;e<ta;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},e.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>ta&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=ta)},e.moveCursor=function(t){var e=this.pos+t;if(t>1)for(var n=this.pos+1;n<e+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(e)},e.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},e.insertChar=function(t){var e=this;t>=144&&this.backSpace();var n=Qo(t);this.pos>=ta?this.logger.log(0,(function(){return"Cannot insert "+t.toString(16)+" ("+n+") at position "+e.pos+". Skipping it!"})):(this.chars[this.pos].setChar(n,this.currPenState),this.moveCursor(1))},e.clearFromPos=function(t){var e;for(e=t;e<ta;e++)this.chars[e].reset()},e.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.getTextString=function(){for(var t=[],e=!0,n=0;n<ta;n++){var i=this.chars[n].uchar;" "!==i&&(e=!1),t.push(i)}return e?"":t.join("")},e.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},t}(),da=function(){function t(t){this.rows=[],this.currRow=Zo-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(var e=0;e<Zo;e++)this.rows.push(new ca(t));this.logger=t}var e=t.prototype;return e.reset=function(){for(var t=0;t<Zo;t++)this.rows[t].clear();this.currRow=Zo-1},e.equals=function(t){for(var e=!0,n=0;n<Zo;n++)if(!this.rows[n].equals(t.rows[n])){e=!1;break}return e},e.copy=function(t){for(var e=0;e<Zo;e++)this.rows[e].copy(t.rows[e])},e.isEmpty=function(){for(var t=!0,e=0;e<Zo;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},e.backSpace=function(){this.rows[this.currRow].backSpace()},e.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},e.insertChar=function(t){this.rows[this.currRow].insertChar(t)},e.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},e.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},e.setCursor=function(t){this.logger.log(2,"setCursor: "+t),this.rows[this.currRow].setCursor(t)},e.setPAC=function(t){this.logger.log(2,(function(){return"pacData = "+JSON.stringify(t)}));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var n=0;n<Zo;n++)this.rows[n].clear();var i=this.currRow+1-this.nrRollUpRows,r=this.lastOutputScreen;if(r){var o=r.rows[i].cueStartTime,a=this.logger.time;if(null!==o&&null!==a&&o<a)for(var s=0;s<this.nrRollUpRows;s++)this.rows[e-this.nrRollUpRows+s+1].copy(r.rows[i+s])}}this.currRow=e;var l=this.rows[this.currRow];if(null!==t.indent){var u=t.indent,c=Math.max(u-1,0);l.setCursor(t.indent),t.color=l.chars[c].penState.foreground}var d={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(d)},e.setBkgData=function(t){this.logger.log(2,(function(){return"bkgData = "+JSON.stringify(t)})),this.backSpace(),this.setPen(t),this.insertChar(32)},e.setRollUpRows=function(t){this.nrRollUpRows=t},e.rollUp=function(){var t=this;if(null!==this.nrRollUpRows){this.logger.log(1,(function(){return t.getDisplayText()}));var e=this.currRow+1-this.nrRollUpRows,n=this.rows.splice(e,1)[0];n.clear(),this.rows.splice(this.currRow,0,n),this.logger.log(2,"Rolling up")}else this.logger.log(3,"roll_up but nrRollUpRows not set yet")},e.getDisplayText=function(t){t=t||!1;for(var e=[],n="",i=-1,r=0;r<Zo;r++){var o=this.rows[r].getTextString();o&&(i=r+1,t?e.push("Row "+i+": '"+o+"'"):e.push(o.trim()))}return e.length>0&&(n=t?"["+e.join(" | ")+"]":e.join("\n")),n},e.getTextAndFormat=function(){return this.rows},t}(),ha=function(){function t(t,e,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new da(n),this.nonDisplayedMemory=new da(n),this.lastOutputScreen=new da(n),this.currRollUpRow=this.displayedMemory.rows[Zo-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}var e=t.prototype;return e.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Zo-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},e.getHandler=function(){return this.outputFilter},e.setHandler=function(t){this.outputFilter=t},e.setPAC=function(t){this.writeScreen.setPAC(t)},e.setBkgData=function(t){this.writeScreen.setBkgData(t)},e.setMode=function(t){t!==this.mode&&(this.mode=t,this.logger.log(2,(function(){return"MODE="+t})),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},e.insertChars=function(t){for(var e=this,n=0;n<t.length;n++)this.writeScreen.insertChar(t[n]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(function(){return i+": "+e.writeScreen.getDisplayText(!0)})),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(function(){return"DISPLAYED: "+e.displayedMemory.getDisplayText(!0)})),this.outputDataUpdate())},e.ccRCL=function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},e.ccBS=function(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},e.ccAOF=function(){},e.ccAON=function(){},e.ccDER=function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},e.ccRU=function(t){this.logger.log(2,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},e.ccFON=function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},e.ccRDC=function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},e.ccTR=function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")},e.ccRTD=function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")},e.ccEDM=function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.ccCR=function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},e.ccENM=function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},e.ccEOC=function(){var t=this;if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(function(){return"DISP: "+t.displayedMemory.getDisplayText()}))}this.outputDataUpdate(!0)},e.ccTO=function(t){this.logger.log(2,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},e.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var n=Math.floor(t/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=i[n]}this.logger.log(2,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},e.outputDataUpdate=function(t){void 0===t&&(t=!1);var e=this.logger.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},e.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},t}(),fa=function(){function t(t,e,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=ma(),this.logger=void 0;var i=this.logger=new aa;this.channels=[null,new ha(t,e,i),new ha(t+1,n,i)]}var e=t.prototype;return e.getHandler=function(t){return this.channels[t].getHandler()},e.setHandler=function(t,e){this.channels[t].setHandler(e)},e.addData=function(t,e){var n=this;this.logger.time=t;for(var i=function(t){var i=127&e[t],r=127&e[t+1],o=!1,a=null;if(0===i&&0===r)return 0;n.logger.log(3,(function(){return"["+sa([e[t],e[t+1]])+"] -> ("+sa([i,r])+")"}));var s=n.cmdHistory;if(i>=16&&i<=31){if(ga(i,r,s))return pa(null,null,s),n.logger.log(3,(function(){return"Repeated command ("+sa([i,r])+") is dropped"})),0;pa(i,r,n.cmdHistory),(o=n.parseCmd(i,r))||(o=n.parseMidrow(i,r)),o||(o=n.parsePAC(i,r)),o||(o=n.parseBackgroundAttributes(i,r))}else pa(null,null,s);if(!o&&(a=n.parseChars(i,r))){var l=n.currentChannel;l&&l>0?n.channels[l].insertChars(a):n.logger.log(2,"No channel found yet. TEXT-MODE?")}o||a||n.logger.log(2,(function(){return"Couldn't parse cleaned data "+sa([i,r])+" orig: "+sa([e[t],e[t+1]])}))},r=0;r<e.length;r+=2)i(r)},e.parseCmd=function(t,e){if(!((20===t||28===t||21===t||29===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=33&&e<=35))return!1;var n=20===t||21===t||23===t?1:2,i=this.channels[n];return 20===t||21===t||28===t||29===t?32===e?i.ccRCL():33===e?i.ccBS():34===e?i.ccAOF():35===e?i.ccAON():36===e?i.ccDER():37===e?i.ccRU(2):38===e?i.ccRU(3):39===e?i.ccRU(4):40===e?i.ccFON():41===e?i.ccRDC():42===e?i.ccTR():43===e?i.ccRTD():44===e?i.ccEDM():45===e?i.ccCR():46===e?i.ccENM():47===e&&i.ccEOC():i.ccTO(e-32),this.currentChannel=n,!0},e.parseMidrow=function(t,e){var n=0;if((17===t||25===t)&&e>=32&&e<=47){if((n=17===t?1:2)!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var i=this.channels[n];return!!i&&(i.ccMIDROW(e),this.logger.log(3,(function(){return"MIDROW ("+sa([t,e])+")"})),!0)}return!1},e.parsePAC=function(t,e){var n;if(!((t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127||(16===t||24===t)&&e>=64&&e<=95))return!1;var i=t<=23?1:2;n=e>=64&&e<=95?1===i?ea[t]:ia[t]:1===i?na[t]:ra[t];var r=this.channels[i];return!!r&&(r.setPAC(this.interpretPAC(n,e)),this.currentChannel=i,!0)},e.interpretPAC=function(t,e){var n,i={color:null,italics:!1,indent:null,underline:!1,row:t};return n=e>95?e-96:e-64,i.underline=!(1&~n),n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((n-16)/2),i},e.parseChars=function(t,e){var n,i,r=null,o=null;return t>=25?(n=2,o=t-8):(n=1,o=t),o>=17&&o<=19?(i=17===o?e+80:18===o?e+112:e+144,this.logger.log(2,(function(){return"Special char '"+Qo(i)+"' in channel "+n})),r=[i]):t>=32&&t<=127&&(r=0===e?[t]:[t,e]),r&&this.logger.log(3,(function(){return"Char codes =  "+sa(r).join(",")})),r},e.parseBackgroundAttributes=function(t,e){var n;if(!((16===t||24===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=45&&e<=47))return!1;var i={};16===t||24===t?(n=Math.floor((e-32)/2),i.background=oa[n],e%2==1&&(i.background=i.background+"_semi")):45===e?i.background="transparent":(i.foreground="black",47===e&&(i.underline=!0));var r=t<=23?1:2;return this.channels[r].setBkgData(i),!0},e.reset=function(){for(var t=0;t<Object.keys(this.channels).length;t++){var e=this.channels[t];e&&e.reset()}pa(null,null,this.cmdHistory)},e.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++){var n=this.channels[e];n&&n.cueSplitAtTime(t)}},t}();function pa(t,e,n){n.a=t,n.b=e}function ga(t,e,n){return n.a===t&&n.b===e}function ma(){return{a:null,b:null}}var va=function(){function t(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}var e=t.prototype;return e.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},e.newCue=function(t,e,n){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)},e.reset=function(){this.cueRanges=[],this.startTime=null},t}(),ya=function(){if(null!=et&&et.VTTCue)return self.VTTCue;var t=["","lr","rl"],e=["start","middle","end","left","right"];function n(t,e){if("string"!=typeof e)return!1;if(!Array.isArray(t))return!1;var n=e.toLowerCase();return!!~t.indexOf(n)&&n}function i(e){return n(t,e)}function r(t){return n(e,t)}function o(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var a in o)t[a]=o[a]}return t}function a(t,e,n){var a=this,s={enumerable:!0};a.hasBeenReset=!1;var l="",u=!1,c=t,d=e,h=n,f=null,p="",g=!0,m="auto",v="start",y=50,b="middle",E=50,T="middle";Object.defineProperty(a,"id",o({},s,{get:function(){return l},set:function(t){l=""+t}})),Object.defineProperty(a,"pauseOnExit",o({},s,{get:function(){return u},set:function(t){u=!!t}})),Object.defineProperty(a,"startTime",o({},s,{get:function(){return c},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");c=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"endTime",o({},s,{get:function(){return d},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");d=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"text",o({},s,{get:function(){return h},set:function(t){h=""+t,this.hasBeenReset=!0}})),Object.defineProperty(a,"region",o({},s,{get:function(){return f},set:function(t){f=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"vertical",o({},s,{get:function(){return p},set:function(t){var e=i(t);if(!1===e)throw new SyntaxError("An invalid or illegal string was specified.");p=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"snapToLines",o({},s,{get:function(){return g},set:function(t){g=!!t,this.hasBeenReset=!0}})),Object.defineProperty(a,"line",o({},s,{get:function(){return m},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"lineAlign",o({},s,{get:function(){return v},set:function(t){var e=r(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"position",o({},s,{get:function(){return y},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"positionAlign",o({},s,{get:function(){return b},set:function(t){var e=r(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"size",o({},s,{get:function(){return E},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"align",o({},s,{get:function(){return T},set:function(t){var e=r(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");T=e,this.hasBeenReset=!0}})),a.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}(),ba=function(){function t(){}return t.prototype.decode=function(t,e){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))},t}();function Ea(t){function e(t,e,n,i){return 3600*(0|t)+60*(0|e)+(0|n)+parseFloat(i||0)}var n=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?e(n[2],n[3],0,n[4]):e(n[1],n[2],n[3],n[4]):null}var Ta=function(){function t(){this.values=Object.create(null)}var e=t.prototype;return e.set=function(t,e){this.get(t)||""===e||(this.values[t]=e)},e.get=function(t,e,n){return n?this.has(t)?this.values[t]:e[n]:this.has(t)?this.values[t]:e},e.has=function(t){return t in this.values},e.alt=function(t,e,n){for(var i=0;i<n.length;++i)if(e===n[i]){this.set(t,e);break}},e.integer=function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},e.percent=function(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var n=parseFloat(e);if(n>=0&&n<=100)return this.set(t,n),!0}return!1},t}();function Aa(t,e,n,i){var r=i?t.split(i):[t];for(var o in r)if("string"==typeof r[o]){var a=r[o].split(n);2===a.length&&e(a[0],a[1])}}var Sa=new ya(0,0,""),wa="middle"===Sa.align?"middle":"center";function La(t,e,n){var i=t;function r(){var e=Ea(t);if(null===e)throw new Error("Malformed timestamp: "+i);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function o(t,e){var i=new Ta;Aa(t,(function(t,e){var r;switch(t){case"region":for(var o=n.length-1;o>=0;o--)if(n[o].id===e){i.set(t,n[o].region);break}break;case"vertical":i.alt(t,e,["rl","lr"]);break;case"line":r=e.split(","),i.integer(t,r[0]),i.percent(t,r[0])&&i.set("snapToLines",!1),i.alt(t,r[0],["auto"]),2===r.length&&i.alt("lineAlign",r[1],["start",wa,"end"]);break;case"position":r=e.split(","),i.percent(t,r[0]),2===r.length&&i.alt("positionAlign",r[1],["start",wa,"end","line-left","line-right","auto"]);break;case"size":i.percent(t,e);break;case"align":i.alt(t,e,["start",wa,"end","left","right"])}}),/:/,/\s/),e.region=i.get("region",null),e.vertical=i.get("vertical","");var r=i.get("line","auto");"auto"===r&&-1===Sa.line&&(r=-1),e.line=r,e.lineAlign=i.get("lineAlign","start"),e.snapToLines=i.get("snapToLines",!0),e.size=i.get("size",100),e.align=i.get("align",wa);var o=i.get("position","auto");"auto"===o&&50===Sa.position&&(o="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=o}function a(){t=t.replace(/^\s+/,"")}if(a(),e.startTime=r(),a(),"--\x3e"!==t.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);t=t.slice(3),a(),e.endTime=r(),a(),o(t,e)}function xa(t){return t.replace(/<br(?: \/)?>/gi,"\n")}var Da=function(){function t(){this.state="INITIAL",this.buffer="",this.decoder=new ba,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var e=t.prototype;return e.parse=function(t){var e=this;function n(){var t=e.buffer,n=0;for(t=xa(t);n<t.length&&"\r"!==t[n]&&"\n"!==t[n];)++n;var i=t.slice(0,n);return"\r"===t[n]&&++n,"\n"===t[n]&&++n,e.buffer=t.slice(n),i}function i(t){Aa(t,(function(t,e){}),/:/)}t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));try{var r="";if("INITIAL"===e.state){if(!/\r\n|\n/.test(e.buffer))return this;var o=(r=n()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==o||!o[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var a=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(a?a=!1:r=n(),e.state){case"HEADER":/:/.test(r)?i(r):r||(e.state="ID");continue;case"NOTE":r||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){e.state="NOTE";break}if(!r)continue;if(e.cue=new ya(0,0,""),e.state="CUE",-1===r.indexOf("--\x3e")){e.cue.id=r;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{La(r,e.cue,e.regionList)}catch(t){e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var s=-1!==r.indexOf("--\x3e");if(!r||s&&(a=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(null===e.cue)continue;e.cue.text&&(e.cue.text+="\n"),e.cue.text+=r;continue;case"BADCUE":r||(e.state="ID")}}}catch(t){"CUETEXT"===e.state&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state="INITIAL"===e.state?"BADWEBVTT":"BADCUE"}return this},e.flush=function(){var t=this;try{if((t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state||"BADWEBVTT"===t.state)throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this},t}(),Ra=/\r\n|\n\r|\n|\r/g,_a=function(t,e,n){return void 0===n&&(n=0),t.slice(n,n+e.length)===e},Ca=function(t){var e=parseInt(t.slice(-3)),n=parseInt(t.slice(-6,-4)),i=parseInt(t.slice(-9,-7)),r=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!(w(e)&&w(n)&&w(i)&&w(r)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t);return e+=1e3*n,e+=6e4*i,e+=36e5*r},ka=function(t){for(var e=5381,n=t.length;n;)e=33*e^t.charCodeAt(--n);return(e>>>0).toString()};function Ia(t,e,n){return ka(t.toString())+ka(e.toString())+ka(n)}var Oa=function(t,e,n){var i=t[e],r=t[i.prevCC];if(!r||!r.new&&i.new)return t.ccOffset=t.presentationOffset=i.start,void(i.new=!1);for(;null!=(o=r)&&o.new;){var o;t.ccOffset+=i.start-r.start,i.new=!1,r=t[(i=r).prevCC]}t.presentationOffset=n};function Pa(t,e,n,i,r,o,a){var s,l=new Da,u=_t(new Uint8Array(t)).trim().replace(Ra,"\n").split("\n"),c=[],d=e?to(e.baseTime,e.timescale):0,h="00:00.000",f=0,p=0,g=!0;l.oncue=function(t){var o=n[i],a=n.ccOffset,l=(f-d)/9e4;if(null!=o&&o.new&&(void 0!==p?a=n.ccOffset=o.start:Oa(n,i,l)),l){if(!e)return void(s=new Error("Missing initPTS for VTT MPEGTS"));a=l-n.presentationOffset}var u=t.endTime-t.startTime,h=lo(9e4*(t.startTime+a-p),9e4*r)/9e4;t.startTime=Math.max(h,0),t.endTime=Math.max(h+u,0);var g=t.text.trim();t.text=decodeURIComponent(encodeURIComponent(g)),t.id||(t.id=Ia(t.startTime,t.endTime,g)),t.endTime>0&&c.push(t)},l.onparsingerror=function(t){s=t},l.onflush=function(){s?a(s):o(c)},u.forEach((function(t){if(g){if(_a(t,"X-TIMESTAMP-MAP=")){g=!1,t.slice(16).split(",").forEach((function(t){_a(t,"LOCAL:")?h=t.slice(6):_a(t,"MPEGTS:")&&(f=parseInt(t.slice(7)))}));try{p=Ca(h)/1e3}catch(t){s=t}return}""===t&&(g=!1)}l.parse(t+"\n")})),l.flush()}var Ma="stpp.ttml.im1t",Na=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Fa=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Ba={left:"start",center:"center",right:"end",start:"start",end:"end"};function Ua(t,e,n,i){var r=Vt(new Uint8Array(t),["mdat"]);if(0!==r.length){var o=r.map((function(t){return _t(t)})),a=Qr(e.baseTime,1,e.timescale);try{o.forEach((function(t){return n(ja(t,a))}))}catch(t){i(t)}}else i(new Error("Could not parse IMSC1 mdat"))}function ja(t,e){var n=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");var i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},r=Object.keys(i).reduce((function(t,e){return t[e]=n.getAttribute("ttp:"+e)||i[e],t}),{}),o="preserve"!==n.getAttribute("xml:space"),a=Va(Ga(n,"styling","style")),s=Va(Ga(n,"layout","region")),l=Ga(n,"body","[begin]");return[].map.call(l,(function(t){var n=Ha(t,o);if(!n||!t.hasAttribute("begin"))return null;var i=Ya(t.getAttribute("begin"),r),l=Ya(t.getAttribute("dur"),r),c=Ya(t.getAttribute("end"),r);if(null===i)throw qa(t);if(null===c){if(null===l)throw qa(t);c=i+l}var d=new ya(i-e,c-e,n);d.id=Ia(d.startTime,d.endTime,d.text);var h=Ka(s[t.getAttribute("region")],a[t.getAttribute("style")],a),f=h.textAlign;if(f){var p=Ba[f];p&&(d.lineAlign=p),d.align=f}return u(d,h),d})).filter((function(t){return null!==t}))}function Ga(t,e,n){var i=t.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(n)):[]}function Va(t){return t.reduce((function(t,e){var n=e.getAttribute("xml:id");return n&&(t[n]=e),t}),{})}function Ha(t,e){return[].slice.call(t.childNodes).reduce((function(t,n,i){var r;return"br"===n.nodeName&&i?t+"\n":null!=(r=n.childNodes)&&r.length?Ha(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent}),"")}function Ka(t,e,n){var i="http://www.w3.org/ns/ttml#styling",r=null,o=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=t&&t.hasAttribute("style")?t.getAttribute("style"):null;return a&&n.hasOwnProperty(a)&&(r=n[a]),o.reduce((function(n,o){var a=Wa(e,i,o)||Wa(t,i,o)||Wa(r,i,o);return a&&(n[o]=a),n}),{})}function Wa(t,e,n){return t&&t.hasAttributeNS(e,n)?t.getAttributeNS(e,n):null}function qa(t){return new Error("Could not parse ttml timestamp "+t)}function Ya(t,e){if(!t)return null;var n=Ea(t);return null===n&&(Na.test(t)?n=za(t,e):Fa.test(t)&&(n=Xa(t,e))),n}function za(t,e){var n=Na.exec(t),i=(0|n[4])+(0|n[5])/e.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+i/e.frameRate}function Xa(t,e){var n=Fa.exec(t),i=Number(n[1]);switch(n[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}var Ja=function(){function t(t){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=ts(),this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},t.on(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(D.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(D.FRAG_LOADING,this.onFragLoading,this),t.on(D.FRAG_LOADED,this.onFragLoaded,this),t.on(D.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(D.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(D.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(D.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(D.BUFFER_FLUSHING,this.onBufferFlushing,this)}var e=t.prototype;return e.destroy=function(){var t=this.hls;t.off(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(D.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(D.FRAG_LOADING,this.onFragLoading,this),t.off(D.FRAG_LOADED,this.onFragLoaded,this),t.off(D.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(D.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(D.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(D.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(D.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0},e.initCea608Parsers=function(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){var t=new va(this,"textTrack1"),e=new va(this,"textTrack2"),n=new va(this,"textTrack3"),i=new va(this,"textTrack4");this.cea608Parser1=new fa(1,t,e),this.cea608Parser2=new fa(3,n,i)}},e.addCues=function(t,e,n,i,r){for(var o=!1,a=r.length;a--;){var s=r[a],l=Za(s[0],s[1],e,n);if(l>=0&&(s[0]=Math.min(s[0],e),s[1]=Math.max(s[1],n),o=!0,l/(n-e)>.5))return}if(o||r.push([e,n]),this.config.renderTextTracksNatively){var u=this.captionsTracks[t];this.Cues.newCue(u,e,n,i)}else{var c=this.Cues.newCue(null,e,n,i);this.hls.trigger(D.CUES_PARSED,{type:"captions",cues:c,track:t})}},e.onInitPtsFound=function(t,e){var n=this,i=e.frag,r=e.id,o=e.initPTS,a=e.timescale,s=this.unparsedVttFrags;"main"===r&&(this.initPTS[i.cc]={baseTime:o,timescale:a}),s.length&&(this.unparsedVttFrags=[],s.forEach((function(t){n.onFragLoaded(D.FRAG_LOADED,t)})))},e.getExistingTrack=function(t,e){var n=this.media;if(n)for(var i=0;i<n.textTracks.length;i++){var r=n.textTracks[i];if(Qa(r,{name:t,lang:e,attrs:{}}))return r}return null},e.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},e.createNativeTrack=function(t){if(!this.captionsTracks[t]){var e=this.captionsProperties,n=this.captionsTracks,i=this.media,r=e[t],o=r.label,a=r.languageCode,s=this.getExistingTrack(o,a);if(s)n[t]=s,rn(n[t]),en(n[t],i);else{var l=this.createTextTrack("captions",o,a);l&&(l[t]=!0,n[t]=l)}}},e.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var e=this.captionsProperties[t];if(e){var n={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=n,this.hls.trigger(D.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}}},e.createTextTrack=function(t,e,n){var i=this.media;if(i)return i.addTextTrack(t,e,n)},e.onMediaAttaching=function(t,e){this.media=e.media,this._cleanTracks()},e.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach((function(e){rn(t[e]),delete t[e]})),this.nonNativeCaptionsTracks={}},e.onManifestLoading=function(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=ts(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},e._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var n=0;n<e.length;n++)rn(e[n])}},e.onSubtitleTracksUpdated=function(t,e){var n=this,i=e.subtitleTracks||[],r=i.some((function(t){return t.textCodec===Ma}));if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(No(this.tracks,i))return void(this.tracks=i);if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){var o=this.media,a=o?ln(o.textTracks):null;if(this.tracks.forEach((function(t,e){var i;if(a){for(var r=null,o=0;o<a.length;o++)if(a[o]&&Qa(a[o],t)){r=a[o],a[o]=null;break}r&&(i=r)}if(i)rn(i);else{var s=$a(t);(i=n.createTextTrack(s,t.name,t.lang))&&(i.mode="disabled")}i&&n.textTracks.push(i)})),null!=a&&a.length){var s=a.filter((function(t){return null!==t})).map((function(t){return t.label}));s.length&&N.warn("Media element contains unused subtitle tracks: "+s.join(", ")+". Replace media element for each source to clear TextTracks and captions menu.")}}else if(this.tracks.length){var l=this.tracks.map((function(t){return{label:t.name,kind:t.type.toLowerCase(),default:t.default,subtitleTrack:t}}));this.hls.trigger(D.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}},e.onManifestLoaded=function(t,e){var n=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach((function(t){var e=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);if(e){var i="textTrack"+e[1],r=n.captionsProperties[i];r&&(r.label=t.name,t.lang&&(r.languageCode=t.lang),r.media=t)}}))},e.closedCaptionsForLevel=function(t){var e=this.hls.levels[t.level];return null==e?void 0:e.attrs["CLOSED-CAPTIONS"]},e.onFragLoading=function(t,e){if(this.enabled&&e.frag.type===$e.MAIN){var n,i,r=this.cea608Parser1,o=this.cea608Parser2,a=this.lastSn,s=e.frag,l=s.cc,u=s.sn,c=null!=(n=null==(i=e.part)?void 0:i.index)?n:-1;r&&o&&(u!==a+1||u===a&&c!==this.lastPartIndex+1||l!==this.lastCc)&&(r.reset(),o.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=c}},e.onFragLoaded=function(t,e){var n=e.frag,i=e.payload;if(n.type===$e.SUBTITLE)if(i.byteLength){var r=n.decryptdata,o="stats"in e;if(null==r||!r.encrypted||o){var a=this.tracks[n.level],s=this.vttCCs;s[n.cc]||(s[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),a&&a.textCodec===Ma?this._parseIMSC1(n,i):this._parseVTTs(e)}}else this.hls.trigger(D.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})},e._parseIMSC1=function(t,e){var n=this,i=this.hls;Ua(e,this.initPTS[t.cc],(function(e){n._appendCues(e,t.level),i.trigger(D.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(function(e){N.log("Failed to parse IMSC1: "+e),i.trigger(D.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:e})}))},e._parseVTTs=function(t){var e,n=this,i=t.frag,r=t.payload,o=this.initPTS,a=this.unparsedVttFrags,s=o.length-1;if(o[i.cc]||-1!==s){var l=this.hls;Pa(null!=(e=i.initSegment)&&e.data?ne(i.initSegment.data,new Uint8Array(r)):r,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,(function(t){n._appendCues(t,i.level),l.trigger(D.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})}),(function(e){var o="Missing initPTS for VTT MPEGTS"===e.message;o?a.push(t):n._fallbackToIMSC1(i,r),N.log("Failed to parse VTT cue: "+e),o&&s>i.cc||l.trigger(D.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:e})}))}else a.push(t)},e._fallbackToIMSC1=function(t,e){var n=this,i=this.tracks[t.level];i.textCodec||Ua(e,this.initPTS[t.cc],(function(){i.textCodec=Ma,n._parseIMSC1(t,e)}),(function(){i.textCodec="wvtt"}))},e._appendCues=function(t,e){var n=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[e];if(!i||"disabled"===i.mode)return;t.forEach((function(t){return nn(i,t)}))}else{var r=this.tracks[e];if(!r)return;var o=r.default?"default":"subtitles"+e;n.trigger(D.CUES_PARSED,{type:"subtitles",cues:t,track:o})}},e.onFragDecrypted=function(t,e){e.frag.type===$e.SUBTITLE&&this.onFragLoaded(D.FRAG_LOADED,e)},e.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},e.onFragParsingUserdata=function(t,e){this.initCea608Parsers();var n=this.cea608Parser1,i=this.cea608Parser2;if(this.enabled&&n&&i){var r=e.frag,o=e.samples;if(r.type!==$e.MAIN||"NONE"!==this.closedCaptionsForLevel(r))for(var a=0;a<o.length;a++){var s=o[a].bytes;if(s){var l=this.extractCea608Data(s);n.addData(o[a].pts,l[0]),i.addData(o[a].pts,l[1])}}}},e.onBufferFlushing=function(t,e){var n=e.startOffset,i=e.endOffset,r=e.endOffsetSubtitles,o=e.type,a=this.media;if(a&&!(a.currentTime<i)){if(!o||"video"===o){var s=this.captionsTracks;Object.keys(s).forEach((function(t){return on(s[t],n,i)}))}if(this.config.renderTextTracksNatively&&0===n&&void 0!==r){var l=this.textTracks;Object.keys(l).forEach((function(t){return on(l[t],n,r)}))}}},e.extractCea608Data=function(t){for(var e=[[],[]],n=31&t[0],i=2,r=0;r<n;r++){var o=t[i++],a=127&t[i++],s=127&t[i++];if((0!==a||0!==s)&&4&o){var l=3&o;0!==l&&1!==l||(e[l].push(a),e[l].push(s))}}return e},t}();function $a(t){return t.characteristics&&/transcribes-spoken-dialog/gi.test(t.characteristics)&&/describes-music-and-sound/gi.test(t.characteristics)?"captions":"subtitles"}function Qa(t,e){return!!t&&t.kind===$a(e)&&Bo(e,t)}function Za(t,e,n,i){return Math.min(e,i)-Math.max(t,n)}function ts(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}var es=function(){function t(t){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var e=t.prototype;return e.setStreamController=function(t){this.streamController=t},e.destroy=function(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},e.registerListeners=function(){var t=this.hls;t.on(D.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(D.BUFFER_CODECS,this.onBufferCodecs,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this)},e.unregisterListener=function(){var t=this.hls;t.off(D.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(D.BUFFER_CODECS,this.onBufferCodecs,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this)},e.onFpsDropLevelCapping=function(t,e){var n=this.hls.levels[e.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})},e.onMediaAttaching=function(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()},e.onManifestParsed=function(t,e){var n=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,n.config.capLevelToPlayerSize&&e.video&&this.startCapping()},e.onLevelsUpdated=function(t,e){this.timer&&w(this.autoLevelCapping)&&this.detectPlayerSize()},e.onBufferCodecs=function(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},e.onMediaDetaching=function(){this.stopCapping()},e.detectPlayerSize=function(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);var t=this.hls.levels;if(t.length){var e=this.hls,n=this.getMaxLevel(t.length-1);n!==this.autoLevelCapping&&N.log("Setting autoLevelCapping to "+n+": "+t[n].height+"p@"+t[n].bitrate+" for media "+this.mediaWidth+"x"+this.mediaHeight),e.autoLevelCapping=n,e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},e.getMaxLevel=function(e){var n=this,i=this.hls.levels;if(!i.length)return-1;var r=i.filter((function(t,i){return n.isLevelAllowed(t)&&i<=e}));return this.clientRect=null,t.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)},e.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},e.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},e.getDimensions=function(){if(this.clientRect)return this.clientRect;var t=this.media,e={width:0,height:0};if(t){var n=t.getBoundingClientRect();e.width=n.width,e.height=n.height,e.width||e.height||(e.width=n.right-n.left||t.width||0,e.height=n.bottom-n.top||t.height||0)}return this.clientRect=e,e},e.isLevelAllowed=function(t){return!this.restrictedLevels.some((function(e){return t.bitrate===e.bitrate&&t.width===e.width&&t.height===e.height}))},t.getMaxLevelByMediaSize=function(t,e,n){if(null==t||!t.length)return-1;for(var i=function(t,e){return!e||t.width!==e.width||t.height!==e.height},r=t.length-1,o=Math.max(e,n),a=0;a<t.length;a+=1){var s=t[a];if((s.width>=o||s.height>=o)&&i(s,t[a+1])){r=a;break}}return r},s(t,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch(t){}return t}}]),t}(),ns=function(){function t(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}var e=t.prototype;return e.setStreamController=function(t){this.streamController=t},e.registerListeners=function(){this.hls.on(D.MEDIA_ATTACHING,this.onMediaAttaching,this)},e.unregisterListeners=function(){this.hls.off(D.MEDIA_ATTACHING,this.onMediaAttaching,this)},e.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},e.onMediaAttaching=function(t,e){var n=this.hls.config;if(n.capLevelOnFPSDrop){var i=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=i,i&&"function"==typeof i.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}},e.checkFPS=function(t,e,n){var i=performance.now();if(e){if(this.lastTime){var r=i-this.lastTime,o=n-this.lastDroppedFrames,a=e-this.lastDecodedFrames,s=1e3*o/r,l=this.hls;if(l.trigger(D.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:n}),s>0&&o>l.config.fpsDroppedMonitoringThreshold*a){var u=l.currentLevel;N.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=u)&&(u-=1,l.trigger(D.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:l.currentLevel}),l.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=e}},e.checkFPSInterval=function(){var t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},t}(),is="[eme]",rs=function(){function t(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=t.CDMCleanupPromise?[t.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=N.debug.bind(N,is),this.log=N.log.bind(N,is),this.warn=N.warn.bind(N,is),this.error=N.error.bind(N,is),this.hls=e,this.config=e.config,this.registerListeners()}var e=t.prototype;return e.destroy=function(){this.unregisterListeners(),this.onMediaDetached();var t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null},e.registerListeners=function(){this.hls.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(D.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(D.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(D.MANIFEST_LOADED,this.onManifestLoaded,this)},e.unregisterListeners=function(){this.hls.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(D.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(D.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(D.MANIFEST_LOADED,this.onManifestLoaded,this)},e.getLicenseServerUrl=function(t){var e=this.config,n=e.drmSystems,i=e.widevineLicenseUrl,r=n[t];if(r)return r.licenseUrl;if(t===nt.WIDEVINE&&i)return i;throw new Error('no license server URL configured for key-system "'+t+'"')},e.getServerCertificateUrl=function(t){var e=this.config.drmSystems[t];if(e)return e.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+t+'"]')},e.attemptKeySystemAccess=function(t){var e=this,n=this.hls.levels,i=function(t,e,n){return!!t&&n.indexOf(t)===e},r=n.map((function(t){return t.audioCodec})).filter(i),o=n.map((function(t){return t.videoCodec})).filter(i);return r.length+o.length===0&&o.push("avc1.42e01e"),new Promise((function(n,i){!function t(a){var s=a.shift();e.getMediaKeysPromise(s,r,o).then((function(t){return n({keySystem:s,mediaKeys:t})})).catch((function(e){a.length?t(a):i(e instanceof us?e:new us({type:R.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_ACCESS,error:e,fatal:!0},e.message))}))}(t)}))},e.requestMediaKeySystemAccess=function(t,e){var n=this.config.requestMediaKeySystemAccessFunc;if("function"!=typeof n){var i="Configured requestMediaKeySystemAccess is not a function "+n;return null===ct&&"http:"===self.location.protocol&&(i="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(i))}return n(t,e)},e.getMediaKeysPromise=function(t,e,n){var i=this,r=dt(t,e,n,this.config.drmSystemOptions),o=this.keySystemAccessPromises[t],a=null==o?void 0:o.keySystemAccess;if(!a){this.log('Requesting encrypted media "'+t+'" key-system access with config: '+JSON.stringify(r)),a=this.requestMediaKeySystemAccess(t,r);var s=this.keySystemAccessPromises[t]={keySystemAccess:a};return a.catch((function(e){i.log('Failed to obtain access to key-system "'+t+'": '+e)})),a.then((function(e){i.log('Access for key-system "'+e.keySystem+'" obtained');var n=i.fetchServerCertificate(t);return i.log('Create media-keys for "'+t+'"'),s.mediaKeys=e.createMediaKeys().then((function(e){return i.log('Media-keys created for "'+t+'"'),n.then((function(n){return n?i.setMediaKeysServerCertificate(e,t,n):e}))})),s.mediaKeys.catch((function(e){i.error('Failed to create media-keys for "'+t+'"}: '+e)})),s.mediaKeys}))}return a.then((function(){return o.mediaKeys}))},e.createMediaKeySessionContext=function(t){var e=t.decryptdata,n=t.keySystem,i=t.mediaKeys;this.log('Creating key-system session "'+n+'" keyId: '+kt.hexDump(e.keyId||[]));var r=i.createSession(),o={decryptdata:e,keySystem:n,mediaKeys:i,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(o),o},e.renewKeySession=function(t){var e=t.decryptdata;if(e.pssh){var n=this.createMediaKeySessionContext(t),i=this.getKeyIdString(e),r="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(n,r,e.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)},e.getKeyIdString=function(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(null===t.keyId)throw new Error("keyId is null");return kt.hexDump(t.keyId)},e.updateKeySession=function(t,e){var n,i=t.mediaKeysSession;return this.log('Updating key-session "'+i.sessionId+'" for keyID '+kt.hexDump((null==(n=t.decryptdata)?void 0:n.keyId)||[])+"\n      } (data length: "+(e?e.byteLength:e)+")"),i.update(e)},e.selectKeySystemFormat=function(t){var e=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+t.sn+" "+t.type+": "+t.level+") key formats "+e.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise},e.getKeyFormatPromise=function(t){var e=this;return new Promise((function(n,i){var r=lt(e.config),o=t.map(rt).filter((function(t){return!!t&&-1!==r.indexOf(t)}));return e.getKeySystemSelectionPromise(o).then((function(t){var e=t.keySystem,r=st(e);r?n(r):i(new Error('Unable to find format for key-system "'+e+'"'))})).catch(i)}))},e.loadKey=function(t){var e=this,n=t.keyInfo.decryptdata,i=this.getKeyIdString(n),r="(keyId: "+i+' format: "'+n.keyFormat+'" method: '+n.method+" uri: "+n.uri+")";this.log("Starting session for key "+r);var o=this.keyIdToKeySessionPromise[i];return o||(o=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(n).then((function(i){var o=i.keySystem,a=i.mediaKeys;return e.throwIfDestroyed(),e.log("Handle encrypted media sn: "+t.frag.sn+" "+t.frag.type+": "+t.frag.level+" using key "+r),e.attemptSetMediaKeys(o,a).then((function(){e.throwIfDestroyed();var t=e.createMediaKeySessionContext({keySystem:o,mediaKeys:a,decryptdata:n}),i="cenc";return e.generateRequestWithPreferredKeySession(t,i,n.pssh,"playlist-key")}))}))).catch((function(t){return e.handleError(t)})),o},e.throwIfDestroyed=function(t){if(!this.hls)throw new Error("invalid state")},e.handleError=function(t){this.hls&&(this.error(t.message),t instanceof us?this.hls.trigger(D.ERROR,t.data):this.hls.trigger(D.ERROR,{type:R.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))},e.getKeySystemForKeyPromise=function(t){var e=this.getKeyIdString(t),n=this.keyIdToKeySessionPromise[e];if(!n){var i=rt(t.keyFormat),r=i?[i]:lt(this.config);return this.attemptKeySystemAccess(r)}return n},e.getKeySystemSelectionPromise=function(t){if(t.length||(t=lt(this.config)),0===t.length)throw new us({type:R.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(t)},e._onMediaEncrypted=function(t){var e=this,n=t.initDataType,i=t.initData;if(this.debug('"'+t.type+'" event: init data type: "'+n+'"'),null!==i){var r,o;if("sinf"===n&&this.config.drmSystems[nt.FAIRPLAY]){var a=Mt(new Uint8Array(i));try{var s=J(JSON.parse(a).sinf),l=Jt(new Uint8Array(s));if(!l)return;r=l.subarray(8,24),o=nt.FAIRPLAY}catch(t){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{var u=de(i);if(null===u)return;0===u.version&&u.systemId===ot.WIDEVINE&&u.data&&(r=u.data.subarray(8,24)),o=at(u.systemId)}if(o&&r){for(var c,d=kt.hexDump(r),h=this.keyIdToKeySessionPromise,f=this.mediaKeySessions,p=h[d],g=function(){var t=f[m],o=t.decryptdata;if(o.pssh||!o.keyId)return 0;var a=kt.hexDump(o.keyId);return d===a||-1!==o.uri.replace(/-/g,"").indexOf(d)?(p=h[a],delete h[a],o.pssh=new Uint8Array(i),o.keyId=r,p=h[d]=p.then((function(){return e.generateRequestWithPreferredKeySession(t,n,i,"encrypted-event-key-match")})),1):void 0},m=0;m<f.length&&(0===(c=g())||1!==c);m++);p||(p=h[d]=this.getKeySystemSelectionPromise([o]).then((function(t){var o,a=t.keySystem,s=t.mediaKeys;e.throwIfDestroyed();var l=new fe("ISO-23001-7",d,null!=(o=st(a))?o:"");return l.pssh=new Uint8Array(i),l.keyId=r,e.attemptSetMediaKeys(a,s).then((function(){e.throwIfDestroyed();var t=e.createMediaKeySessionContext({decryptdata:l,keySystem:a,mediaKeys:s});return e.generateRequestWithPreferredKeySession(t,n,i,"encrypted-event-no-match")}))}))),p.catch((function(t){return e.handleError(t)}))}}},e._onWaitingForKey=function(t){this.log('"'+t.type+'" event')},e.attemptSetMediaKeys=function(t,e){var n=this,i=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+t+'"');var r=Promise.all(i).then((function(){if(!n.media)throw new Error("Attempted to set mediaKeys without media element attached");return n.media.setMediaKeys(e)}));return this.setMediaKeysQueue.push(r),r.then((function(){n.log('Media-keys set for "'+t+'"'),i.push(r),n.setMediaKeysQueue=n.setMediaKeysQueue.filter((function(t){return-1===i.indexOf(t)}))}))},e.generateRequestWithPreferredKeySession=function(t,e,n,i){var r,o,a=this,s=null==(r=this.config.drmSystems)||null==(o=r[t.keySystem])?void 0:o.generateRequest;if(s)try{var l=s.call(this.hls,e,n,t);if(!l)throw new Error("Invalid response from configured generateRequest filter");e=l.initDataType,n=t.decryptdata.pssh=l.initData?new Uint8Array(l.initData):null}catch(t){var u;if(this.warn(t.message),null!=(u=this.hls)&&u.config.debug)throw t}if(null===n)return this.log('Skipping key-session request for "'+i+'" (no initData)'),Promise.resolve(t);var c=this.getKeyIdString(t.decryptdata);this.log('Generating key-session request for "'+i+'": '+c+" (init data type: "+e+" length: "+(n?n.byteLength:null)+")");var d=new xo,h=t._onmessage=function(e){var n=t.mediaKeysSession;if(n){var i=e.messageType,r=e.message;a.log('"'+i+'" message event for session "'+n.sessionId+'" message size: '+r.byteLength),"license-request"===i||"license-renewal"===i?a.renewLicense(t,r).catch((function(t){a.handleError(t),d.emit("error",t)})):"license-release"===i?t.keySystem===nt.FAIRPLAY&&(a.updateKeySession(t,tt("acknowledged")),a.removeSession(t)):a.warn('unhandled media key message type "'+i+'"')}else d.emit("error",new Error("invalid state"))},f=t._onkeystatuseschange=function(e){if(t.mediaKeysSession){a.onKeyStatusChange(t);var n=t.keyStatus;d.emit("keyStatus",n),"expired"===n&&(a.warn(t.keySystem+" expired for key "+c),a.renewKeySession(t))}else d.emit("error",new Error("invalid state"))};t.mediaKeysSession.addEventListener("message",h),t.mediaKeysSession.addEventListener("keystatuseschange",f);var p=new Promise((function(t,e){d.on("error",e),d.on("keyStatus",(function(n){n.startsWith("usable")?t():"output-restricted"===n?e(new us({type:R.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===n?e(new us({type:R.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+n+'"')):"expired"===n?e(new Error("key expired while generating request")):a.warn('unhandled key status change "'+n+'"')}))}));return t.mediaKeysSession.generateRequest(e,n).then((function(){var e;a.log('Request generated for key-session "'+(null==(e=t.mediaKeysSession)?void 0:e.sessionId)+'" keyId: '+c)})).catch((function(t){throw new us({type:R.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_SESSION,error:t,fatal:!1},"Error generating key-session request: "+t)})).then((function(){return p})).catch((function(e){throw d.removeAllListeners(),a.removeSession(t),e})).then((function(){return d.removeAllListeners(),t}))},e.onKeyStatusChange=function(t){var e=this;t.mediaKeysSession.keyStatuses.forEach((function(n,i){e.log('key status change "'+n+'" for keyStatuses keyId: '+kt.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))+" session keyId: "+kt.hexDump(new Uint8Array(t.decryptdata.keyId||[]))+" uri: "+t.decryptdata.uri),t.keyStatus=n}))},e.fetchServerCertificate=function(t){var e=this.config,n=new(0,e.loader)(e),r=this.getServerCertificateUrl(t);return r?(this.log('Fetching server certificate for "'+t+'"'),new Promise((function(o,a){var s={responseType:"arraybuffer",url:r},l=e.certLoadPolicy.default,u={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:function(t,e,n,i){o(t.data)},onError:function(e,n,o,l){a(new us({type:R.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:i({url:s.url,data:void 0},e)},'"'+t+'" certificate request failed ('+r+"). Status: "+e.code+" ("+e.text+")"))},onTimeout:function(e,n,i){a(new us({type:R.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:{url:s.url,data:void 0}},'"'+t+'" certificate request timed out ('+r+")"))},onAbort:function(t,e,n){a(new Error("aborted"))}};n.load(s,u,c)}))):Promise.resolve()},e.setMediaKeysServerCertificate=function(t,e,n){var i=this;return new Promise((function(r,o){t.setServerCertificate(n).then((function(o){i.log("setServerCertificate "+(o?"success":"not supported by CDM")+" ("+(null==n?void 0:n.byteLength)+') on "'+e+'"'),r(t)})).catch((function(t){o(new us({type:R.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:t,fatal:!0},t.message))}))}))},e.renewLicense=function(t,e){var n=this;return this.requestLicense(t,new Uint8Array(e)).then((function(e){return n.updateKeySession(t,new Uint8Array(e)).catch((function(t){throw new us({type:R.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:t,fatal:!0},t.message)}))}))},e.unpackPlayReadyKeyMessage=function(t,e){var n=String.fromCharCode.apply(null,new Uint16Array(e.buffer));if(!n.includes("PlayReadyKeyMessage"))return t.setRequestHeader("Content-Type","text/xml; charset=utf-8"),e;var i=(new DOMParser).parseFromString(n,"application/xml"),r=i.querySelectorAll("HttpHeader");if(r.length>0)for(var o,a=0,s=r.length;a<s;a++){var l,u,c=null==(l=(o=r[a]).querySelector("name"))?void 0:l.textContent,d=null==(u=o.querySelector("value"))?void 0:u.textContent;c&&d&&t.setRequestHeader(c,d)}var h=i.querySelector("Challenge"),f=null==h?void 0:h.textContent;if(!f)throw new Error("Cannot find <Challenge> in key message");return tt(atob(f))},e.setupLicenseXHR=function(t,e,n,i){var r=this,o=this.config.licenseXhrSetup;return o?Promise.resolve().then((function(){if(!n.decryptdata)throw new Error("Key removed");return o.call(r.hls,t,e,n,i)})).catch((function(a){if(!n.decryptdata)throw a;return t.open("POST",e,!0),o.call(r.hls,t,e,n,i)})).then((function(n){return t.readyState||t.open("POST",e,!0),{xhr:t,licenseChallenge:n||i}})):(t.open("POST",e,!0),Promise.resolve({xhr:t,licenseChallenge:i}))},e.requestLicense=function(t,e){var n=this,i=this.config.keyLoadPolicy.default;return new Promise((function(r,o){var a=n.getLicenseServerUrl(t.keySystem);n.log("Sending license request to URL: "+a);var s=new XMLHttpRequest;s.responseType="arraybuffer",s.onreadystatechange=function(){if(!n.hls||!t.mediaKeysSession)return o(new Error("invalid state"));if(4===s.readyState)if(200===s.status){n._requestLicenseFailureCount=0;var l=s.response;n.log("License received "+(l instanceof ArrayBuffer?l.byteLength:l));var u=n.config.licenseResponseCallback;if(u)try{l=u.call(n.hls,s,a,t)}catch(t){n.error(t)}r(l)}else{var c=i.errorRetry,d=c?c.maxNumRetry:0;if(n._requestLicenseFailureCount++,n._requestLicenseFailureCount>d||s.status>=400&&s.status<500)o(new us({type:R.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:s,response:{url:a,data:void 0,code:s.status,text:s.statusText}},"License Request XHR failed ("+a+"). Status: "+s.status+" ("+s.statusText+")"));else{var h=d-n._requestLicenseFailureCount+1;n.warn("Retrying license request, "+h+" attempts left"),n.requestLicense(t,e).then(r,o)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=s,n.setupLicenseXHR(s,a,t,e).then((function(e){var i=e.xhr,r=e.licenseChallenge;t.keySystem==nt.PLAYREADY&&(r=n.unpackPlayReadyKeyMessage(i,r)),i.send(r)}))}))},e.onMediaAttached=function(t,e){if(this.config.emeEnabled){var n=e.media;this.media=n,n.addEventListener("encrypted",this.onMediaEncrypted),n.addEventListener("waitingforkey",this.onWaitingForKey)}},e.onMediaDetached=function(){var e=this,n=this.media,i=this.mediaKeySessions;n&&(n.removeEventListener("encrypted",this.onMediaEncrypted),n.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},fe.clearKeyUriToKeyIdMap();var r=i.length;t.CDMCleanupPromise=Promise.all(i.map((function(t){return e.removeSession(t)})).concat(null==n?void 0:n.setMediaKeys(null).catch((function(t){e.log("Could not clear media keys: "+t)})))).then((function(){r&&(e.log("finished closing key sessions and clearing media keys"),i.length=0)})).catch((function(t){e.log("Could not close sessions and clear media keys: "+t)}))},e.onManifestLoading=function(){this.keyFormatPromise=null},e.onManifestLoaded=function(t,e){var n=e.sessionKeys;if(n&&this.config.emeEnabled&&!this.keyFormatPromise){var i=n.reduce((function(t,e){return-1===t.indexOf(e.keyFormat)&&t.push(e.keyFormat),t}),[]);this.log("Selecting key-system from session-keys "+i.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(i)}},e.removeSession=function(t){var e=this,n=t.mediaKeysSession,i=t.licenseXhr;if(n){this.log("Remove licenses and keys and close session "+n.sessionId),t._onmessage&&(n.removeEventListener("message",t._onmessage),t._onmessage=void 0),t._onkeystatuseschange&&(n.removeEventListener("keystatuseschange",t._onkeystatuseschange),t._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;var r=this.mediaKeySessions.indexOf(t);return r>-1&&this.mediaKeySessions.splice(r,1),n.remove().catch((function(t){e.log("Could not remove session: "+t)})).then((function(){return n.close()})).catch((function(t){e.log("Could not close session: "+t)}))}},t}();rs.CDMCleanupPromise=void 0;var os,as,ss,ls,us=function(t){function e(e,n){var i;return(i=t.call(this,n)||this).data=void 0,e.error||(e.error=new Error(n)),i.data=e,e.err=e.error,i}return c(e,t),e}(m(Error));(function(t){t.MANIFEST="m",t.AUDIO="a",t.VIDEO="v",t.MUXED="av",t.INIT="i",t.CAPTION="c",t.TIMED_TEXT="tt",t.KEY="k",t.OTHER="o"})(os||(os={})),function(t){t.DASH="d",t.HLS="h",t.SMOOTH="s",t.OTHER="o"}(as||(as={})),function(t){t.OBJECT="CMCD-Object",t.REQUEST="CMCD-Request",t.SESSION="CMCD-Session",t.STATUS="CMCD-Status"}(ss||(ss={}));var cs=((ls={})[ss.OBJECT]=["br","d","ot","tb"],ls[ss.REQUEST]=["bl","dl","mtp","nor","nrr","su"],ls[ss.SESSION]=["cid","pr","sf","sid","st","v"],ls[ss.STATUS]=["bs","rtp"],ls),ds=function t(e,n){this.value=void 0,this.params=void 0,Array.isArray(e)&&(e=e.map((function(e){return e instanceof t?e:new t(e)}))),this.value=e,this.params=n},hs=function(t){this.description=void 0,this.description=t},fs="Dict";function ps(t){return Array.isArray(t)?JSON.stringify(t):t instanceof Map?"Map{}":t instanceof Set?"Set{}":"object"==typeof t?JSON.stringify(t):String(t)}function gs(t,e,n,i){return new Error("failed to "+t+' "'+ps(e)+'" as '+n,{cause:i})}var ms="Bare Item",vs="Boolean",ys="Byte Sequence",bs="Decimal",Es="Integer";function Ts(t){return t<-999999999999999||999999999999999<t}var As=/[\x00-\x1f\x7f]+/,Ss="Token",ws="Key";function Ls(t,e,n){return gs("serialize",t,e,n)}function xs(t){if("boolean"!=typeof t)throw Ls(t,vs);return t?"?1":"?0"}function Ds(t){return btoa(String.fromCharCode.apply(String,t))}function Rs(t){if(!1===ArrayBuffer.isView(t))throw Ls(t,ys);return":"+Ds(t)+":"}function _s(t){if(Ts(t))throw Ls(t,Es);return t.toString()}function Cs(t){return"@"+_s(t.getTime()/1e3)}function ks(t,e){if(t<0)return-ks(-t,e);var n=Math.pow(10,e);if(Math.abs(t*n%1-.5)<Number.EPSILON){var i=Math.floor(t*n);return(i%2==0?i:i+1)/n}return Math.round(t*n)/n}function Is(t){var e=ks(t,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Ls(t,bs);var n=e.toString();return n.includes(".")?n:n+".0"}var Os="String";function Ps(t){if(As.test(t))throw Ls(t,Os);return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function Ms(t){return t.description||t.toString().slice(7,-1)}function Ns(t){var e=Ms(t);if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e))throw Ls(e,Ss);return e}function Fs(t){switch(typeof t){case"number":if(!w(t))throw Ls(t,ms);return Number.isInteger(t)?_s(t):Is(t);case"string":return Ps(t);case"symbol":return Ns(t);case"boolean":return xs(t);case"object":if(t instanceof Date)return Cs(t);if(t instanceof Uint8Array)return Rs(t);if(t instanceof hs)return Ns(t);default:throw Ls(t,ms)}}function Bs(t){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(t))throw Ls(t,ws);return t}function Us(t){return null==t?"":Object.entries(t).map((function(t){var e=t[0],n=t[1];return!0===n?";"+Bs(e):";"+Bs(e)+"="+Fs(n)})).join("")}function js(t){return t instanceof ds?""+Fs(t.value)+Us(t.params):Fs(t)}function Gs(t){return"("+t.value.map(js).join(" ")+")"+Us(t.params)}function Vs(t,e){var n;if(void 0===e&&(e={whitespace:!0}),"object"!=typeof t)throw Ls(t,fs);var i=t instanceof Map?t.entries():Object.entries(t),r=null!=(n=e)&&n.whitespace?" ":"";return Array.from(i).map((function(t){var e=t[0],n=t[1];n instanceof ds==0&&(n=new ds(n));var i=Bs(e);return!0===n.value?i+=Us(n.params):(i+="=",Array.isArray(n.value)?i+=Gs(n):i+=js(n)),i})).join(","+r)}function Hs(t,e){return Vs(t,e)}var Ks=function(t){return"ot"===t||"sf"===t||"st"===t},Ws=function(t){return"number"==typeof t?w(t):null!=t&&""!==t&&!1!==t};function qs(t,e){var n=new URL(t),i=new URL(e);if(n.origin!==i.origin)return t;for(var r=n.pathname.split("/").slice(1),o=i.pathname.split("/").slice(1,-1);r[0]===o[0];)r.shift(),o.shift();for(;o.length;)o.shift(),r.unshift("..");return r.join("/")}function Ys(){try{return crypto.randomUUID()}catch(i){try{var t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)}catch(t){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==t?e:3&e|8).toString(16)}))}}}var zs=function(t){return Math.round(t)},Xs=function(t){return 100*zs(t/100)},Js={br:zs,d:zs,bl:Xs,dl:Xs,mtp:Xs,nor:function(t,e){return null!=e&&e.baseUrl&&(t=qs(t,e.baseUrl)),encodeURIComponent(t)},rtp:Xs,tb:zs};function $s(t,e){var n={};if(null==t||"object"!=typeof t)return n;var i=Object.keys(t).sort(),r=u({},Js,null==e?void 0:e.formatters),o=null==e?void 0:e.filter;return i.forEach((function(i){if(null==o||!o(i)){var a=t[i],s=r[i];s&&(a=s(a,e)),"v"===i&&1===a||"pr"==i&&1===a||Ws(a)&&(Ks(i)&&"string"==typeof a&&(a=new hs(a)),n[i]=a)}})),n}function Qs(t,e){return void 0===e&&(e={}),t?Hs($s(t,e),u({whitespace:!1},e)):""}function Zs(t,e){var n;if(void 0===e&&(e={}),!t)return{};var i=Object.entries(t),r=Object.entries(cs).concat(Object.entries((null==(n=e)?void 0:n.customHeaderMap)||{})),o=i.reduce((function(t,e){var n,i=e[0],o=e[1],a=(null==(n=r.find((function(t){return t[1].includes(i)})))?void 0:n[0])||ss.REQUEST;return null!=t[a]||(t[a]={}),t[a][i]=o,t}),{});return Object.entries(o).reduce((function(t,n){var i=n[0],r=n[1];return t[i]=Qs(r,e),t}),{})}function tl(t,e,n){return u(t,Zs(e,n))}var el="CMCD";function nl(t,e){if(void 0===e&&(e={}),!t)return"";var n=Qs(t,e);return el+"="+encodeURIComponent(n)}var il=/CMCD=[^&#]+/;function rl(t,e,n){var i=nl(e,n);if(!i)return t;if(il.test(t))return t.replace(il,i);var r=t.includes("?")?"&":"?";return""+t+r+i}var ol=function(){function t(t){var e=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){e.initialized&&(e.starved=!0),e.buffering=!0},this.onPlaying=function(){e.initialized||(e.initialized=!0),e.buffering=!1},this.applyPlaylistData=function(t){try{e.apply(t,{ot:os.MANIFEST,su:!e.initialized})}catch(t){N.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=function(t){try{var n=t.frag,i=e.hls.levels[n.level],r=e.getObjectType(n),o={d:1e3*n.duration,ot:r};r!==os.VIDEO&&r!==os.AUDIO&&r!=os.MUXED||(o.br=i.bitrate/1e3,o.tb=e.getTopBandwidth(r)/1e3,o.bl=e.getBufferLength(r)),e.apply(t,o)}catch(t){N.warn("Could not generate segment CMCD data.",t)}},this.hls=t;var n=this.config=t.config,i=n.cmcd;null!=i&&(n.pLoader=this.createPlaylistLoader(),n.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||Ys(),this.cid=i.contentId,this.useHeaders=!0===i.useHeaders,this.includeKeys=i.includeKeys,this.registerListeners())}var e=t.prototype;return e.registerListeners=function(){var t=this.hls;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHED,this.onMediaDetached,this),t.on(D.BUFFER_CREATED,this.onBufferCreated,this)},e.unregisterListeners=function(){var t=this.hls;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHED,this.onMediaDetached,this),t.off(D.BUFFER_CREATED,this.onBufferCreated,this)},e.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null},e.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},e.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},e.onBufferCreated=function(t,e){var n,i;this.audioBuffer=null==(n=e.tracks.audio)?void 0:n.buffer,this.videoBuffer=null==(i=e.tracks.video)?void 0:i.buffer},e.createData=function(){var t;return{v:1,sf:as.HLS,sid:this.sid,cid:this.cid,pr:null==(t=this.media)?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},e.apply=function(t,e){void 0===e&&(e={}),u(e,this.createData());var n=e.ot===os.INIT||e.ot===os.VIDEO||e.ot===os.MUXED;this.starved&&n&&(e.bs=!0,e.su=!0,this.starved=!1),null==e.su&&(e.su=this.buffering);var i=this.includeKeys;i&&(e=Object.keys(e).reduce((function(t,n){return i.includes(n)&&(t[n]=e[n]),t}),{})),this.useHeaders?(t.headers||(t.headers={}),tl(t.headers,e)):t.url=rl(t.url,e)},e.getObjectType=function(t){var e=t.type;return"subtitle"===e?os.TIMED_TEXT:"initSegment"===t.sn?os.INIT:"audio"===e?os.AUDIO:"main"===e?this.hls.audioTracks.length?os.VIDEO:os.MUXED:void 0},e.getTopBandwidth=function(t){var e,n=0,i=this.hls;if(t===os.AUDIO)e=i.audioTracks;else{var r=i.maxAutoLevel,o=r>-1?r+1:i.levels.length;e=i.levels.slice(0,o)}for(var a,s=E(e);!(a=s()).done;){var l=a.value;l.bitrate>n&&(n=l.bitrate)}return n>0?n:NaN},e.getBufferLength=function(t){var e=this.hls.media,n=t===os.AUDIO?this.audioBuffer:this.videoBuffer;return n&&e?1e3*_i.bufferInfo(n,e.currentTime,this.config.maxBufferHole).len:NaN},e.createPlaylistLoader=function(){var t=this.config.pLoader,e=this.applyPlaylistData,n=t||this.config.loader;return function(){function t(t){this.loader=void 0,this.loader=new n(t)}var i=t.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(t,n,i){e(t),this.loader.load(t,n,i)},s(t,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),t}()},e.createFragmentLoader=function(){var t=this.config.fLoader,e=this.applyFragmentData,n=t||this.config.loader;return function(){function t(t){this.loader=void 0,this.loader=new n(t)}var i=t.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(t,n,i){e(t),this.loader.load(t,n,i)},s(t,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),t}()},t}(),al=3e5,sl=function(){function t(t){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.log=N.log.bind(N,"[content-steering]:"),this.registerListeners()}var e=t.prototype;return e.registerListeners=function(){var t=this.hls;t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t&&(t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.ERROR,this.onError,this))},e.startLoad=function(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){var t=1e3*this.timeToLoad-(performance.now()-this.updated);if(t>0)return void this.scheduleRefresh(this.uri,t)}this.loadSteeringManifest(this.uri)}},e.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()},e.clearTimeout=function(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)},e.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},e.removeLevel=function(t){var e=this.levels;e&&(this.levels=e.filter((function(e){return e!==t})))},e.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},e.onManifestLoaded=function(t,e){var n=e.contentSteering;null!==n&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())},e.onManifestParsed=function(t,e){this.audioTracks=e.audioTracks,this.subtitleTracks=e.subtitleTracks},e.onError=function(t,e){var n=e.errorAction;if((null==n?void 0:n.action)===Zn.SendAlternateToPenaltyBox&&n.flags===ti.MoveAllAlternatesMatchingHost){var i=this.levels,r=this.pathwayPriority,o=this.pathwayId;if(e.context){var a=e.context,s=a.groupId,l=a.pathwayId,u=a.type;s&&i?o=this.getPathwayForGroupId(s,u,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!r&&i&&(r=i.reduce((function(t,e){return-1===t.indexOf(e.pathwayId)&&t.push(e.pathwayId),t}),[])),r&&r.length>1&&(this.updatePathwayPriority(r),n.resolved=this.pathwayId!==o),n.resolved||N.warn("Could not resolve "+e.details+' ("'+e.error.message+'") with content-steering for Pathway: '+o+" levels: "+(i?i.length:i)+" priorities: "+JSON.stringify(r)+" penalized: "+JSON.stringify(this.penalizedPathways))}},e.filterParsedLevels=function(t){this.levels=t;var e=this.getLevelsForPathway(this.pathwayId);if(0===e.length){var n=t[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+n+'"'),e=this.getLevelsForPathway(n),this.pathwayId=n}return e.length!==t.length?(this.log("Found "+e.length+"/"+t.length+' levels in Pathway "'+this.pathwayId+'"'),e):t},e.getLevelsForPathway=function(t){return null===this.levels?[]:this.levels.filter((function(e){return t===e.pathwayId}))},e.updatePathwayPriority=function(t){var e;this.pathwayPriority=t;var n=this.penalizedPathways,i=performance.now();Object.keys(n).forEach((function(t){i-n[t]>al&&delete n[t]}));for(var r=0;r<t.length;r++){var o=t[r];if(!(o in n)){if(o===this.pathwayId)return;var a=this.hls.nextLoadLevel,s=this.hls.levels[a];if((e=this.getLevelsForPathway(o)).length>0){this.log('Setting Pathway to "'+o+'"'),this.pathwayId=o,Un(e),this.hls.trigger(D.LEVELS_UPDATED,{levels:e});var l=this.hls.levels[a];s&&l&&this.levels&&(l.attrs["STABLE-VARIANT-ID"]!==s.attrs["STABLE-VARIANT-ID"]&&l.bitrate!==s.bitrate&&this.log("Unstable Pathways change from bitrate "+s.bitrate+" to "+l.bitrate),this.hls.nextLoadLevel=a);break}}}},e.getPathwayForGroupId=function(t,e,n){for(var i=this.getLevelsForPathway(n).concat(this.levels||[]),r=0;r<i.length;r++)if(e===Je.AUDIO_TRACK&&i[r].hasAudioGroup(t)||e===Je.SUBTITLE_TRACK&&i[r].hasSubtitleGroup(t))return i[r].pathwayId;return n},e.clonePathways=function(t){var e=this,n=this.levels;if(n){var i={},r={};t.forEach((function(t){var o=t.ID,a=t["BASE-ID"],s=t["URI-REPLACEMENT"];if(!n.some((function(t){return t.pathwayId===o}))){var l=e.getLevelsForPathway(a).map((function(t){var e=new U(t.attrs);e["PATHWAY-ID"]=o;var n=e.AUDIO&&e.AUDIO+"_clone_"+o,a=e.SUBTITLES&&e.SUBTITLES+"_clone_"+o;n&&(i[e.AUDIO]=n,e.AUDIO=n),a&&(r[e.SUBTITLES]=a,e.SUBTITLES=a);var l=ul(t.uri,e["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",s),u=new Ln({attrs:e,audioCodec:t.audioCodec,bitrate:t.bitrate,height:t.height,name:t.name,url:l,videoCodec:t.videoCodec,width:t.width});if(t.audioGroups)for(var c=1;c<t.audioGroups.length;c++)u.addGroupId("audio",t.audioGroups[c]+"_clone_"+o);if(t.subtitleGroups)for(var d=1;d<t.subtitleGroups.length;d++)u.addGroupId("text",t.subtitleGroups[d]+"_clone_"+o);return u}));n.push.apply(n,l),ll(e.audioTracks,i,s,o),ll(e.subtitleTracks,r,s,o)}}))}},e.loadSteeringManifest=function(t){var e,n=this,i=this.hls.config,r=i.loader;this.loader&&this.loader.destroy(),this.loader=new r(i);try{e=new self.URL(t)}catch(e){return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: "+t)}if("data:"!==e.protocol){var o=0|(this.hls.bandwidthEstimate||i.abrEwmaDefaultEstimate);e.searchParams.set("_HLS_pathway",this.pathwayId),e.searchParams.set("_HLS_throughput",""+o)}var a={responseType:"json",url:e.href},s=i.steeringManifestLoadPolicy.default,l=s.errorRetry||s.timeoutRetry||{},u={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},c={onSuccess:function(t,i,r,o){n.log('Loaded steering manifest: "'+e+'"');var a=t.data;if(1===a.VERSION){n.updated=performance.now(),n.timeToLoad=a.TTL;var s=a["RELOAD-URI"],l=a["PATHWAY-CLONES"],u=a["PATHWAY-PRIORITY"];if(s)try{n.uri=new self.URL(s,e).href}catch(t){return n.enabled=!1,void n.log("Failed to parse Steering Manifest RELOAD-URI: "+s)}n.scheduleRefresh(n.uri||r.url),l&&n.clonePathways(l);var c={steeringManifest:a,url:e.toString()};n.hls.trigger(D.STEERING_MANIFEST_LOADED,c),u&&n.updatePathwayPriority(u)}else n.log("Steering VERSION "+a.VERSION+" not supported!")},onError:function(t,e,i,r){if(n.log("Error loading steering manifest: "+t.code+" "+t.text+" ("+e.url+")"),n.stopLoad(),410===t.code)return n.enabled=!1,void n.log("Steering manifest "+e.url+" no longer available");var o=1e3*n.timeToLoad;if(429!==t.code)n.scheduleRefresh(n.uri||e.url,o);else{var a=n.loader;if("function"==typeof(null==a?void 0:a.getResponseHeader)){var s=a.getResponseHeader("Retry-After");s&&(o=1e3*parseFloat(s))}n.log("Steering manifest "+e.url+" rate limited")}},onTimeout:function(t,e,i){n.log("Timeout loading steering manifest ("+e.url+")"),n.scheduleRefresh(n.uri||e.url)}};this.log("Requesting steering manifest: "+e),this.loader.load(a,u,c)},e.scheduleRefresh=function(t,e){var n=this;void 0===e&&(e=1e3*this.timeToLoad),this.clearTimeout(),this.reloadTimer=self.setTimeout((function(){var e,i=null==(e=n.hls)?void 0:e.media;!i||i.ended?n.scheduleRefresh(t,1e3*n.timeToLoad):n.loadSteeringManifest(t)}),e)},t}();function ll(t,e,n,i){t&&Object.keys(e).forEach((function(r){var o=t.filter((function(t){return t.groupId===r})).map((function(t){var o=u({},t);return o.details=void 0,o.attrs=new U(o.attrs),o.url=o.attrs.URI=ul(t.url,t.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),o.groupId=o.attrs["GROUP-ID"]=e[r],o.attrs["PATHWAY-ID"]=i,o}));t.push.apply(t,o)}))}function ul(t,e,n,i){var r,o=i.HOST,a=i.PARAMS,s=i[n];e&&(r=null==s?void 0:s[e])&&(t=r);var l=new self.URL(t);return o&&!r&&(l.host=o),a&&Object.keys(a).sort().forEach((function(t){t&&l.searchParams.set(t,a[t])})),l.href}var cl=/^age:\s*[\d.]+\s*$/im,dl=function(){function t(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new H,this.retryDelay=0}var e=t.prototype;return e.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null},e.abortInternal=function(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))},e.abort=function(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},e.load=function(t,e,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=n,this.loadInternal()},e.loadInternal=function(){var t=this,e=this.config,n=this.context;if(e&&n){var i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;var o=this.xhrSetup;o?Promise.resolve().then((function(){if(t.loader===i&&!t.stats.aborted)return o(i,n.url)})).catch((function(e){if(t.loader===i&&!t.stats.aborted)return i.open("GET",n.url,!0),o(i,n.url)})).then((function(){t.loader!==i||t.stats.aborted||t.openAndSendXhr(i,n,e)})).catch((function(e){t.callbacks.onError({code:i.status,text:e.message},n,i,r)})):this.openAndSendXhr(i,n,e)}},e.openAndSendXhr=function(t,e,n){t.readyState||t.open("GET",e.url,!0);var i=e.headers,r=n.loadPolicy,o=r.maxTimeToFirstByteMs,a=r.maxLoadTimeMs;if(i)for(var s in i)t.setRequestHeader(s,i[s]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),n.timeout=o&&w(o)?o:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),t.send()},e.readystatechange=function(){var t=this.context,e=this.loader,n=this.stats;if(t&&e){var i=e.readyState,r=this.config;if(!n.aborted&&i>=2&&(0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),4===i)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;var o=e.status,a="text"!==e.responseType;if(o>=200&&o<300&&(a&&e.response||null!==e.responseText)){n.loading.end=Math.max(self.performance.now(),n.loading.first);var s=a?e.response:e.responseText,l="arraybuffer"===e.responseType?s.byteLength:s.length;if(n.loaded=n.total=l,n.bwEstimate=8e3*n.total/(n.loading.end-n.loading.first),!this.callbacks)return;var u=this.callbacks.onProgress;if(u&&u(n,t,s,e),!this.callbacks)return;var c={url:e.responseURL,data:s,code:o};this.callbacks.onSuccess(c,n,t,e)}else{var d=r.loadPolicy.errorRetry;Kn(d,n.retry,!1,{url:t.url,data:void 0,code:o})?this.retry(d):(N.error(o+" while loading "+t.url),this.callbacks.onError({code:o,text:e.statusText},t,e,n))}}}},e.loadtimeout=function(){if(this.config){var t=this.config.loadPolicy.timeoutRetry;if(Kn(t,this.stats.retry,!0))this.retry(t);else{var e;N.warn("timeout while loading "+(null==(e=this.context)?void 0:e.url));var n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}},e.retry=function(t){var e=this.context,n=this.stats;this.retryDelay=Vn(t,n.retry),n.retry++,N.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+(null==e?void 0:e.url)+", retrying "+n.retry+"/"+t.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},e.loadprogress=function(t){var e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)},e.getCacheAge=function(){var t=null;if(this.loader&&cl.test(this.loader.getAllResponseHeaders())){var e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t},e.getResponseHeader=function(t){return this.loader&&new RegExp("^"+t+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(t):null},t}();function hl(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(t){}return!1}var fl=/(\d+)-(\d+)\/(\d+)/,pl=function(){function t(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||yl,this.controller=new self.AbortController,this.stats=new H}var e=t.prototype;return e.destroy=function(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null},e.abortInternal=function(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())},e.abort=function(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(t,e,n){var i=this,r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();var o=gl(t,this.controller.signal),a=n.onProgress,s="arraybuffer"===t.responseType,l=s?"byteLength":"length",u=e.loadPolicy,c=u.maxTimeToFirstByteMs,d=u.maxLoadTimeMs;this.context=t,this.config=e,this.callbacks=n,this.request=this.fetchSetup(t,o),self.clearTimeout(this.requestTimeout),e.timeout=c&&w(c)?c:d,this.requestTimeout=self.setTimeout((function(){i.abortInternal(),n.onTimeout(r,t,i.response)}),e.timeout),self.fetch(this.request).then((function(o){i.response=i.loader=o;var l=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(i.requestTimeout),e.timeout=d,i.requestTimeout=self.setTimeout((function(){i.abortInternal(),n.onTimeout(r,t,i.response)}),d-(l-r.loading.start)),!o.ok){var u=o.status,c=o.statusText;throw new El(c||"fetch, bad network response",u,o)}return r.loading.first=l,r.total=vl(o.headers)||r.total,a&&w(e.highWaterMark)?i.loadProgressively(o,r,t,e.highWaterMark,a):s?o.arrayBuffer():"json"===t.responseType?o.json():o.text()})).then((function(o){var s=i.response;if(!s)throw new Error("loader destroyed");self.clearTimeout(i.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);var u=o[l];u&&(r.loaded=r.total=u);var c={url:s.url,data:o,code:s.status};a&&!w(e.highWaterMark)&&a(r,t,o,s),n.onSuccess(c,r,t,s)})).catch((function(e){if(self.clearTimeout(i.requestTimeout),!r.aborted){var o=e&&e.code||0,a=e?e.message:null;n.onError({code:o,text:a},t,e?e.details:null,r)}}))},e.getCacheAge=function(){var t=null;if(this.response){var e=this.response.headers.get("age");t=e?parseFloat(e):null}return t},e.getResponseHeader=function(t){return this.response?this.response.headers.get(t):null},e.loadProgressively=function(t,e,n,i,r){void 0===i&&(i=0);var o=new tr,a=t.body.getReader();return function s(){return a.read().then((function(a){if(a.done)return o.dataLength&&r(e,n,o.flush(),t),Promise.resolve(new ArrayBuffer(0));var l=a.value,u=l.length;return e.loaded+=u,u<i||o.dataLength?(o.push(l),o.dataLength>=i&&r(e,n,o.flush(),t)):r(e,n,l,t),s()})).catch((function(){return Promise.reject()}))}()},t}();function gl(t,e){var n={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(u({},t.headers))};return t.rangeEnd&&n.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)),n}function ml(t){var e=fl.exec(t);if(e)return parseInt(e[2])-parseInt(e[1])+1}function vl(t){var e=t.get("Content-Range");if(e){var n=ml(e);if(w(n))return n}var i=t.get("Content-Length");if(i)return parseInt(i)}function yl(t,e){return new self.Request(t.url,e)}var bl,El=function(t){function e(e,n,i){var r;return(r=t.call(this,e)||this).code=void 0,r.details=void 0,r.code=n,r.details=i,r}return c(e,t),e}(m(Error)),Tl=/\s/,Al={newCue:function(t,e,n,i){for(var r,o,a,s,l,u=[],c=self.VTTCue||self.TextTrackCue,d=0;d<i.rows.length;d++)if(a=!0,s=0,l="",!(r=i.rows[d]).isEmpty()){for(var h,f=0;f<r.chars.length;f++)Tl.test(r.chars[f].uchar)&&a?s++:(l+=r.chars[f].uchar,a=!1);r.cueStartTime=e,e===n&&(n+=1e-4),s>=16?s--:s++;var p=xa(l.trim()),g=Ia(e,n,p);null!=t&&null!=(h=t.cues)&&h.getCueById(g)||((o=new c(e,n,p)).id=g,o.line=d+1,o.align="left",o.position=10+Math.min(80,10*Math.floor(8*s/32)),u.push(o))}return t&&u.length&&(u.sort((function(t,e){return"auto"===t.line||"auto"===e.line?0:t.line>8&&e.line>8?e.line-t.line:t.line-e.line})),u.forEach((function(e){return nn(t,e)}))),u}},Sl=i(i({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:dl,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Ai,bufferController:zo,capLevelController:es,errorController:ei,fpsController:ns,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:ct,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},wl()),{},{subtitleStreamController:Ho,subtitleTrackController:Wo,timelineController:Ja,audioStreamController:jo,audioTrackController:Go,emeController:rs,cmcdController:ol,contentSteeringController:sl});function wl(){return{cueHandler:Al,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Ll(t,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==e.liveMaxLatencyDurationCount&&(void 0===e.liveSyncDurationCount||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(void 0===e.liveSyncDuration||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var n=xl(t),r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((function(t){var i=("level"===t?"playlist":t)+"LoadPolicy",o=void 0===e[i],a=[];r.forEach((function(r){var s=t+"Loading"+r,l=e[s];if(void 0!==l&&o){a.push(s);var u=n[i].default;switch(e[i]={default:u},r){case"TimeOut":u.maxLoadTimeMs=l,u.maxTimeToFirstByteMs=l;break;case"MaxRetry":u.errorRetry.maxNumRetry=l,u.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":u.errorRetry.retryDelayMs=l,u.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":u.errorRetry.maxRetryDelayMs=l,u.timeoutRetry.maxRetryDelayMs=l}}})),a.length&&N.warn('hls.js config: "'+a.join('", "')+'" setting(s) are deprecated, use "'+i+'": '+JSON.stringify(e[i]))})),i(i({},n),e)}function xl(t){return t&&"object"==typeof t?Array.isArray(t)?t.map(xl):Object.keys(t).reduce((function(e,n){return e[n]=xl(t[n]),e}),{}):t}function Dl(t){var e=t.loader;e!==pl&&e!==dl?(N.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1):hl()&&(t.loader=pl,t.progressive=!0,t.enableSoftwareAES=!0,N.log("[config]: Progressive streaming enabled, using FetchLoader"))}var Rl=function(t){function e(e,n){var i;return(i=t.call(this,e,"[level-controller]")||this)._levels=[],i._firstLevel=-1,i._maxAutoLevel=-1,i._startLevel=void 0,i.currentLevel=null,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.steering=void 0,i.onParsedComplete=void 0,i.steering=n,i._registerListeners(),i}c(e,t);var n=e.prototype;return n._registerListeners=function(){var t=this.hls;t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(D.LEVEL_LOADED,this.onLevelLoaded,this),t.on(D.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(D.FRAG_BUFFERED,this.onFragBuffered,this),t.on(D.ERROR,this.onError,this)},n._unregisterListeners=function(){var t=this.hls;t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(D.LEVEL_LOADED,this.onLevelLoaded,this),t.off(D.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(D.FRAG_BUFFERED,this.onFragBuffered,this),t.off(D.ERROR,this.onError,this)},n.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),t.prototype.destroy.call(this)},n.stopLoad=function(){this._levels.forEach((function(t){t.loadError=0,t.fragmentError=0})),t.prototype.stopLoad.call(this)},n.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1},n.onManifestLoading=function(t,e){this.resetLevels()},n.onManifestLoaded=function(t,e){var n=this.hls.config.preferManagedMediaSource,i=[],r={},o={},a=!1,s=!1,l=!1;e.levels.forEach((function(t){var e,u,c=t.attrs,d=t.audioCodec,h=t.videoCodec;-1!==(null==(e=d)?void 0:e.indexOf("mp4a.40.34"))&&(bl||(bl=/chrome|firefox/i.test(navigator.userAgent)),bl&&(t.audioCodec=d=void 0)),d&&(t.audioCodec=d=Oe(d,n)),0===(null==(u=h)?void 0:u.indexOf("avc1"))&&(h=t.videoCodec=Me(h));var f=t.width,p=t.height,g=t.unknownCodecs;if(a||(a=!(!f||!p)),s||(s=!!h),l||(l=!!d),!(null!=g&&g.length||d&&!Le(d,"audio",n)||h&&!Le(h,"video",n))){var m=c.CODECS,v=c["FRAME-RATE"],y=c["HDCP-LEVEL"],b=c["PATHWAY-ID"],E=c.RESOLUTION,T=c["VIDEO-RANGE"],A=(b||".")+"-"+t.bitrate+"-"+E+"-"+v+"-"+m+"-"+T+"-"+y;if(r[A])if(r[A].uri===t.url||t.attrs["PATHWAY-ID"])r[A].addGroupId("audio",c.AUDIO),r[A].addGroupId("text",c.SUBTITLES);else{var S=o[A]+=1;t.attrs["PATHWAY-ID"]=new Array(S+1).join(".");var w=new Ln(t);r[A]=w,i.push(w)}else{var L=new Ln(t);r[A]=L,o[A]=1,i.push(L)}}})),this.filterAndSortMediaOptions(i,e,a,s,l)},n.filterAndSortMediaOptions=function(t,e,n,i,r){var o=this,a=[],s=[],l=t;if((n||i)&&r&&(l=l.filter((function(t){var e=t.videoCodec,n=t.videoRange,i=t.width,r=t.height;return(!!e||!(!i||!r))&&Tn(n)}))),0!==l.length){if(e.audioTracks){var u=this.hls.config.preferManagedMediaSource;_l(a=e.audioTracks.filter((function(t){return!t.audioCodec||Le(t.audioCodec,"audio",u)})))}e.subtitles&&_l(s=e.subtitles);var c=l.slice(0);l.sort((function(t,e){if(t.attrs["HDCP-LEVEL"]!==e.attrs["HDCP-LEVEL"])return(t.attrs["HDCP-LEVEL"]||"")>(e.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&t.height!==e.height)return t.height-e.height;if(t.frameRate!==e.frameRate)return t.frameRate-e.frameRate;if(t.videoRange!==e.videoRange)return En.indexOf(t.videoRange)-En.indexOf(e.videoRange);if(t.videoCodec!==e.videoCodec){var i=Re(t.videoCodec),r=Re(e.videoCodec);if(i!==r)return r-i}if(t.uri===e.uri&&t.codecSet!==e.codecSet){var o=_e(t.codecSet),a=_e(e.codecSet);if(o!==a)return a-o}return t.averageBitrate!==e.averageBitrate?t.averageBitrate-e.averageBitrate:0}));var d=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l)).length!==c.length)for(var h=0;h<c.length;h++)if(c[h].pathwayId===l[0].pathwayId){d=c[h];break}this._levels=l;for(var f=0;f<l.length;f++)if(l[f]===d){var p;this._firstLevel=f;var g=d.bitrate,m=this.hls.bandwidthEstimate;if(this.log("manifest loaded, "+l.length+" level(s) found, first bitrate: "+g),void 0===(null==(p=this.hls.userConfig)?void 0:p.abrEwmaDefaultEstimate)){var v=Math.min(g,this.hls.config.abrEwmaDefaultEstimateMax);v>m&&m===Sl.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=v)}break}var y=r&&!i,b={levels:l,audioTracks:a,subtitleTracks:s,sessionData:e.sessionData,sessionKeys:e.sessionKeys,firstLevel:this._firstLevel,stats:e.stats,audio:r,video:i,altAudio:!y&&a.some((function(t){return!!t.url}))};this.hls.trigger(D.MANIFEST_PARSED,b),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else Promise.resolve().then((function(){if(o.hls){e.levels.length&&o.warn("One or more CODECS in variant not supported: "+JSON.stringify(e.levels[0].attrs));var t=new Error("no level with compatible codecs found in manifest");o.hls.trigger(D.ERROR,{type:R.MEDIA_ERROR,details:_.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,error:t,reason:t.message})}}))},n.onError=function(t,e){!e.fatal&&e.context&&e.context.type===Je.LEVEL&&e.context.level===this.level&&this.checkRetry(e)},n.onFragBuffered=function(t,e){var n=e.frag;if(void 0!==n&&n.type===$e.MAIN){var i=n.elementaryStreams;if(!Object.keys(i).some((function(t){return!!i[t]})))return;var r=this._levels[n.level];null!=r&&r.loadError&&(this.log("Resetting level error count of "+r.loadError+" on frag buffered"),r.loadError=0)}},n.onLevelLoaded=function(t,e){var n,i,r=e.level,o=e.details,a=this._levels[r];if(!a)return this.warn("Invalid level index "+r),void(null!=(i=e.deliveryDirectives)&&i.skip&&(o.deltaUpdateFailed=!0));r===this.currentLevelIndex?(0===a.fragmentError&&(a.loadError=0),this.playlistLoaded(r,e,a.details)):null!=(n=e.deliveryDirectives)&&n.skip&&(o.deltaUpdateFailed=!0)},n.loadPlaylist=function(e){t.prototype.loadPlaylist.call(this);var n=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){var r=i.uri;if(e)try{r=e.addDirectives(r)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}var o=i.attrs["PATHWAY-ID"];this.log("Loading level index "+n+(void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:"")+" with"+(o?" Pathway "+o:"")+" "+r),this.clearTimer(),this.hls.trigger(D.LEVEL_LOADING,{url:r,level:n,pathwayId:i.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}},n.removeLevel=function(t){var e,n=this,i=this._levels.filter((function(e,i){return i!==t||(n.steering&&n.steering.removeLevel(e),e===n.currentLevel&&(n.currentLevel=null,n.currentLevelIndex=-1,e.details&&e.details.fragments.forEach((function(t){return t.level=-1}))),!1)}));Un(i),this._levels=i,this.currentLevelIndex>-1&&null!=(e=this.currentLevel)&&e.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(D.LEVELS_UPDATED,{levels:i})},n.onLevelsUpdated=function(t,e){var n=e.levels;this._levels=n},n.checkMaxAutoUpdated=function(){var t=this.hls,e=t.autoLevelCapping,n=t.maxAutoLevel,i=t.maxHdcpLevel;this._maxAutoLevel!==n&&(this._maxAutoLevel=n,this.hls.trigger(D.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:n,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))},s(e,[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;if(0!==e.length){if(t<0||t>=e.length){var n=new Error("invalid level idx"),i=t<0;if(this.hls.trigger(D.ERROR,{type:R.OTHER_ERROR,details:_.LEVEL_SWITCH_ERROR,level:t,fatal:i,error:n,reason:n.message}),i)return;t=Math.min(t,e.length-1)}var r=this.currentLevelIndex,o=this.currentLevel,a=o?o.attrs["PATHWAY-ID"]:void 0,s=e[t],l=s.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=s,r!==t||!s.details||!o||a!==l){this.log("Switching to level "+t+" ("+(s.height?s.height+"p ":"")+(s.videoRange?s.videoRange+" ":"")+(s.codecSet?s.codecSet+" ":"")+"@"+s.bitrate+")"+(l?" with Pathway "+l:"")+" from level "+r+(a?" with Pathway "+a:""));var u={level:t,attrs:s.attrs,details:s.details,bitrate:s.bitrate,averageBitrate:s.averageBitrate,maxBitrate:s.maxBitrate,realBitrate:s.realBitrate,width:s.width,height:s.height,codecSet:s.codecSet,audioCodec:s.audioCodec,videoCodec:s.videoCodec,audioGroups:s.audioGroups,subtitleGroups:s.subtitleGroups,loaded:s.loaded,loadError:s.loadError,fragmentError:s.fragmentError,name:s.name,id:s.id,uri:s.uri,url:s.url,urlId:0,audioGroupIds:s.audioGroupIds,textGroupIds:s.textGroupIds};this.hls.trigger(D.LEVEL_SWITCHING,u);var c=s.details;if(!c||c.live){var d=this.switchParams(s.uri,null==o?void 0:o.details,c);this.loadPlaylist(d)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this.hls.firstAutoLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}]),e}(ni);function _l(t){var e={};t.forEach((function(t){var n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++}))}var Cl=function(){function t(t){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=t}var e=t.prototype;return e.abort=function(t){for(var e in this.keyUriToKeyInfo){var n=this.keyUriToKeyInfo[e].loader;if(n){var i;if(t&&t!==(null==(i=n.context)?void 0:i.frag.type))return;n.abort()}}},e.detach=function(){for(var t in this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[t]}},e.destroy=function(){for(var t in this.detach(),this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[t].loader;e&&e.destroy()}this.keyUriToKeyInfo={}},e.createKeyLoadError=function(t,e,n,i,r){return void 0===e&&(e=_.KEY_LOAD_ERROR),new Ki({type:R.NETWORK_ERROR,details:e,fatal:!1,frag:t,response:r,error:n,networkDetails:i})},e.loadClear=function(t,e){var n=this;if(this.emeController&&this.config.emeEnabled)for(var i=t.sn,r=t.cc,o=function(){var t=e[a];if(r<=t.cc&&("initSegment"===i||"initSegment"===t.sn||i<t.sn))return n.emeController.selectKeySystemFormat(t).then((function(e){t.setKeyFormat(e)})),1},a=0;a<e.length&&!o();a++);},e.load=function(t){var e=this;return!t.decryptdata&&t.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(t).then((function(n){return e.loadInternal(t,n)})):this.loadInternal(t)},e.loadInternal=function(t,e){var n,i;e&&t.setKeyFormat(e);var r=t.decryptdata;if(!r){var o=new Error(e?"Expected frag.decryptdata to be defined after setting format "+e:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(t,_.KEY_LOAD_ERROR,o))}var a=r.uri;if(!a)return Promise.reject(this.createKeyLoadError(t,_.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+a+'"')));var s,l=this.keyUriToKeyInfo[a];if(null!=(n=l)&&n.decryptdata.key)return r.key=l.decryptdata.key,Promise.resolve({frag:t,keyInfo:l});if(null!=(i=l)&&i.keyLoadPromise)switch(null==(s=l.mediaKeySessionContext)?void 0:s.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return l.keyLoadPromise.then((function(e){return r.key=e.keyInfo.decryptdata.key,{frag:t,keyInfo:l}}))}switch(l=this.keyUriToKeyInfo[a]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===r.keyFormat?this.loadKeyHTTP(l,t):this.loadKeyEME(l,t);case"AES-128":return this.loadKeyHTTP(l,t);default:return Promise.reject(this.createKeyLoadError(t,_.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+r.method+'"')))}},e.loadKeyEME=function(t,e){var n={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){var i=this.emeController.loadKey(n);if(i)return(t.keyLoadPromise=i.then((function(e){return t.mediaKeySessionContext=e,n}))).catch((function(e){throw t.keyLoadPromise=null,e}))}return Promise.resolve(n)},e.loadKeyHTTP=function(t,e){var n=this,r=this.config,o=new(0,r.loader)(r);return e.keyLoader=t.loader=o,t.keyLoadPromise=new Promise((function(a,s){var l={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},u=r.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:function(t,e,i,r){var o=i.frag,l=i.keyInfo,u=i.url;if(!o.decryptdata||l!==n.keyUriToKeyInfo[u])return s(n.createKeyLoadError(o,_.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),r));l.decryptdata.key=o.decryptdata.key=new Uint8Array(t.data),o.keyLoader=null,l.loader=null,a({frag:o,keyInfo:l})},onError:function(t,r,o,a){n.resetLoader(r),s(n.createKeyLoadError(e,_.KEY_LOAD_ERROR,new Error("HTTP Error "+t.code+" loading key "+t.text),o,i({url:l.url,data:void 0},t)))},onTimeout:function(t,i,r){n.resetLoader(i),s(n.createKeyLoadError(e,_.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),r))},onAbort:function(t,i,r){n.resetLoader(i),s(n.createKeyLoadError(e,_.INTERNAL_ABORTED,new Error("key loading aborted"),r))}};o.load(l,c,d)}))},e.resetLoader=function(t){var e=t.frag,n=t.keyInfo,i=t.url,r=n.loader;e.keyLoader===r&&(e.keyLoader=null,n.loader=null),delete this.keyUriToKeyInfo[i],r&&r.destroy()},t}();function kl(){return self.SourceBuffer||self.WebKitSourceBuffer}function Il(){if(!Te())return!1;var t=kl();return!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove}function Ol(){if(!Il())return!1;var t=Te();return"function"==typeof(null==t?void 0:t.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some((function(e){return t.isTypeSupported(De(e,"video"))}))||["mp4a.40.2","fLaC"].some((function(e){return t.isTypeSupported(De(e,"audio"))})))}function Pl(){var t,e=kl();return"function"==typeof(null==e||null==(t=e.prototype)?void 0:t.changeType)}var Ml=250,Nl=2,Fl=.1,Bl=.05,Ul=function(){function t(t,e,n,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=n,this.hls=i}var e=t.prototype;return e.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},e.poll=function(t,e){var n=this.config,i=this.media,r=this.stalled;if(null!==i){var o=i.currentTime,a=i.seeking,s=this.seeking&&!a,l=!this.seeking&&a;if(this.seeking=a,o===t)if(l||s)this.stalled=null;else if(i.paused&&!a||i.ended||0===i.playbackRate||!_i.getBuffered(i).length)this.nudgeRetry=0;else{var u=_i.bufferInfo(i,o,0),c=u.nextStart||0;if(a){var d=u.len>Nl,h=!c||e&&e.start<=o||c-o>Nl&&!this.fragmentTracker.getPartialFragment(o);if(d||h)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var f;if(!(u.len>0||c))return;var p=Math.max(c,u.start||0)-o,g=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,m=(null==g||null==(f=g.details)?void 0:f.live)?2*g.details.targetduration:Nl,v=this.fragmentTracker.getPartialFragment(o);if(p>0&&(p<=m||v))return void(i.paused||this._trySkipBufferHole(v))}var y=self.performance.now();if(null!==r){var b=y-r;if(a||!(b>=Ml)||(this._reportStall(u),this.media)){var E=_i.bufferInfo(i,o,n.maxBufferHole);this._tryFixBufferStall(E,b)}}else this.stalled=y}else if(this.moved=!0,a||(this.nudgeRetry=0),null!==r){if(this.stallReported){var T=self.performance.now()-r;N.warn("playback not stuck anymore @"+o+", after "+Math.round(T)+"ms"),this.stallReported=!1}this.stalled=null}}},e._tryFixBufferStall=function(t,e){var n=this.config,i=this.fragmentTracker,r=this.media;if(null!==r){var o=r.currentTime,a=i.getPartialFragment(o);if(a&&(this._trySkipBufferHole(a)||!this.media))return;(t.len>n.maxBufferHole||t.nextStart&&t.nextStart-o<n.maxBufferHole)&&e>1e3*n.highBufferWatchdogPeriod&&(N.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},e._reportStall=function(t){var e=this.hls,n=this.media;if(!this.stallReported&&n){this.stallReported=!0;var i=new Error("Playback stalling at @"+n.currentTime+" due to low buffer ("+JSON.stringify(t)+")");N.warn(i.message),e.trigger(D.ERROR,{type:R.MEDIA_ERROR,details:_.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:t.len})}},e._trySkipBufferHole=function(t){var e=this.config,n=this.hls,i=this.media;if(null===i)return 0;var r=i.currentTime,o=_i.bufferInfo(i,r,0),a=r<o.start?o.start:o.nextStart;if(a){var s=o.len<=e.maxBufferHole,l=o.len>0&&o.len<1&&i.readyState<3,u=a-r;if(u>0&&(s||l)){if(u>e.maxBufferHole){var c=this.fragmentTracker,d=!1;if(0===r){var h=c.getAppendedFrag(0,$e.MAIN);h&&a<h.end&&(d=!0)}if(!d){var f=t||c.getAppendedFrag(r,$e.MAIN);if(f){for(var p=!1,g=f.end;g<a;){var m=c.getPartialFragment(g);if(!m){p=!0;break}g+=m.duration}if(p)return 0}}}var v=Math.max(a+Bl,r+Fl);if(N.warn("skipping hole, adjusting currentTime from "+r+" to "+v),this.moved=!0,this.stalled=null,i.currentTime=v,t&&!t.gap){var y=new Error("fragment loaded with buffer holes, seeking from "+r+" to "+v);n.trigger(D.ERROR,{type:R.MEDIA_ERROR,details:_.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:y,reason:y.message,frag:t})}return v}}return 0},e._tryNudgeBuffer=function(){var t=this.config,e=this.hls,n=this.media,i=this.nudgeRetry;if(null!==n){var r=n.currentTime;if(this.nudgeRetry++,i<t.nudgeMaxRetry){var o=r+(i+1)*t.nudgeOffset,a=new Error("Nudging 'currentTime' from "+r+" to "+o);N.warn(a.message),n.currentTime=o,e.trigger(D.ERROR,{type:R.MEDIA_ERROR,details:_.BUFFER_NUDGE_ON_STALL,error:a,fatal:!1})}else{var s=new Error("Playhead still not moving while enough data buffered @"+r+" after "+t.nudgeMaxRetry+" nudges");N.error(s.message),e.trigger(D.ERROR,{type:R.MEDIA_ERROR,details:_.BUFFER_STALLED_ERROR,error:s,fatal:!0})}}},t}(),jl=100,Gl=function(t){function e(e,n,i){var r;return(r=t.call(this,e,n,i,"[stream-controller]",$e.MAIN)||this).audioCodecSwap=!1,r.gapController=null,r.level=-1,r._forceStartLoad=!1,r.altAudio=!1,r.audioOnly=!1,r.fragPlaying=null,r.onvplaying=null,r.onvseeked=null,r.fragLastKbps=0,r.couldBacktrack=!1,r.backtrackFragment=null,r.audioCodecSwitch=!1,r.videoBuffer=null,r._registerListeners(),r}c(e,t);var n=e.prototype;return n._registerListeners=function(){var t=this.hls;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.LEVEL_LOADING,this.onLevelLoading,this),t.on(D.LEVEL_LOADED,this.onLevelLoaded,this),t.on(D.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(D.ERROR,this.onError,this),t.on(D.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(D.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(D.BUFFER_CREATED,this.onBufferCreated,this),t.on(D.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(D.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(D.FRAG_BUFFERED,this.onFragBuffered,this)},n._unregisterListeners=function(){var t=this.hls;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.LEVEL_LOADED,this.onLevelLoaded,this),t.off(D.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(D.ERROR,this.onError,this),t.off(D.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(D.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(D.BUFFER_CREATED,this.onBufferCreated,this),t.off(D.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(D.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(D.FRAG_BUFFERED,this.onFragBuffered,this)},n.onHandlerDestroying=function(){this._unregisterListeners(),t.prototype.onHandlerDestroying.call(this)},n.startLoad=function(t){if(this.levels){var e=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(jl),this.level=-1,!this.startFragRequested){var i=n.startLevel;-1===i&&(n.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=n.firstAutoLevel),n.nextLoadLevel=i,this.level=n.loadLevel,this.loadedmetadata=!1}e>0&&-1===t&&(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=Qi.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=Qi.STOPPED},n.stopLoad=function(){this._forceStartLoad=!1,t.prototype.stopLoad.call(this)},n.doTick=function(){switch(this.state){case Qi.WAITING_LEVEL:var t=this.levels,e=this.level,n=null==t?void 0:t[e],i=null==n?void 0:n.details;if(i&&(!i.live||this.levelLastLoaded===n)){if(this.waitForCdnTuneIn(i))break;this.state=Qi.IDLE;break}if(this.hls.nextLoadLevel!==this.level){this.state=Qi.IDLE;break}break;case Qi.FRAG_LOADING_WAITING_RETRY:var r,o=self.performance.now(),a=this.retryDate;if(!a||o>=a||null!=(r=this.media)&&r.seeking){var s=this.levels,l=this.level,u=null==s?void 0:s[l];this.resetStartWhenNotLoaded(u||null),this.state=Qi.IDLE}}this.state===Qi.IDLE&&this.doTickIdle(),this.onTickEnd()},n.onTickEnd=function(){t.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},n.doTickIdle=function(){var t=this.hls,e=this.levelLastLoaded,n=this.levels,i=this.media;if(null!==e&&(i||!this.startFragRequested&&t.config.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)){var r=t.nextLoadLevel;if(null!=n&&n[r]){var o=n[r],a=this.getMainFwdBufferInfo();if(null!==a){var s=this.getLevelDetails();if(s&&this._streamEnded(a,s)){var l={};return this.altAudio&&(l.type="video"),this.hls.trigger(D.BUFFER_EOS,l),void(this.state=Qi.ENDED)}t.loadLevel!==r&&-1===t.manualLevel&&this.log("Adapting to level "+r+" from level "+this.level),this.level=t.nextLoadLevel=r;var u=o.details;if(!u||this.state===Qi.WAITING_LEVEL||u.live&&this.levelLastLoaded!==o)return this.level=r,void(this.state=Qi.WAITING_LEVEL);var c=a.len,d=this.getMaxBufferLength(o.maxBitrate);if(!(c>=d)){this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);var h=this.backtrackFragment?this.backtrackFragment.start:a.end,f=this.getNextFragment(h,u);if(this.couldBacktrack&&!this.fragPrevious&&f&&"initSegment"!==f.sn&&this.fragmentTracker.getState(f)!==wi.OK){var p,g=(null!=(p=this.backtrackFragment)?p:f).sn-u.startSN,m=u.fragments[g-1];m&&f.cc===m.cc&&(f=m,this.fragmentTracker.removeFragment(m))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,h)){if(!f.gap){var v=this.audioOnly&&!this.altAudio?K.AUDIO:K.VIDEO,y=(v===K.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;y&&this.afterBufferFlushed(y,v,$e.MAIN)}f=this.getNextFragmentLoopLoading(f,u,a,$e.MAIN,d)}f&&(!f.initSegment||f.initSegment.data||this.bitrateTest||(f=f.initSegment),this.loadFragment(f,o,h))}}}}},n.loadFragment=function(e,n,i){var r=this.fragmentTracker.getState(e);this.fragCurrent=e,r===wi.NOT_LOADED||r===wi.PARTIAL?"initSegment"===e.sn?this._loadInitSegment(e,n):this.bitrateTest?(this.log("Fragment "+e.sn+" of level "+e.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(e,n)):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,e,n,i)):this.clearTrackerIfNeeded(e)},n.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,$e.MAIN)},n.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},n.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},n.nextLevelSwitch=function(){var t=this.levels,e=this.media;if(null!=e&&e.readyState){var n,i=this.getAppendedFrag(e.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);var r=this.getLevelDetails();if(null!=r&&r.live){var o=this.getMainFwdBufferInfo();if(!o||o.len<2*r.targetduration)return}if(!e.paused&&t){var a=t[this.hls.nextLoadLevel],s=this.fragLastKbps;n=s&&this.fragCurrent?this.fragCurrent.duration*a.maxBitrate/(1e3*s)+1:0}else n=0;var l=this.getBufferedFrag(e.currentTime+n);if(l){var u=this.followingBufferedFrag(l);if(u){this.abortCurrentFrag();var c=u.maxStartPTS?u.maxStartPTS:u.start,d=u.duration,h=Math.max(l.end,c+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,d*(this.couldBacktrack?.5:.125)),d*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(h,Number.POSITIVE_INFINITY)}}}},n.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case Qi.KEY_LOADING:case Qi.FRAG_LOADING:case Qi.FRAG_LOADING_WAITING_RETRY:case Qi.PARSING:case Qi.PARSED:this.state=Qi.IDLE}this.nextLoadPosition=this.getLoadPosition()},n.flushMainBuffer=function(e,n){t.prototype.flushMainBuffer.call(this,e,n,this.altAudio?"video":null)},n.onMediaAttached=function(e,n){t.prototype.onMediaAttached.call(this,e,n);var i=n.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new Ul(this.config,i,this.fragmentTracker,this.hls)},n.onMediaDetaching=function(){var e=this.media;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),t.prototype.onMediaDetaching.call(this)},n.onMediaPlaying=function(){this.tick()},n.onMediaSeeked=function(){var t=this.media,e=t?t.currentTime:null;w(e)&&this.log("Media seeked to "+e.toFixed(3));var n=this.getMainFwdBufferInfo();null!==n&&0!==n.len?this.tick():this.warn('Main forward buffer length on "seeked" event '+(n?n.len:"empty")+")")},n.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(D.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1},n.onManifestParsed=function(t,e){var n=!1,i=!1;e.levels.forEach((function(t){var e=t.audioCodec;e&&(n=n||-1!==e.indexOf("mp4a.40.2"),i=i||-1!==e.indexOf("mp4a.40.5"))})),this.audioCodecSwitch=n&&i&&!Pl(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1},n.onLevelLoading=function(t,e){var n=this.levels;if(n&&this.state===Qi.IDLE){var i=n[e.level];(!i.details||i.details.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(i.details))&&(this.state=Qi.WAITING_LEVEL)}},n.onLevelLoaded=function(t,e){var n,i=this.levels,r=e.level,o=e.details,a=o.totalduration;if(i){this.log("Level "+r+" loaded ["+o.startSN+","+o.endSN+"]"+(o.lastPartSn?"[part-"+o.lastPartSn+"-"+o.lastPartIndex+"]":"")+", cc ["+o.startCC+", "+o.endCC+"] duration:"+a);var s=i[r],l=this.fragCurrent;!l||this.state!==Qi.FRAG_LOADING&&this.state!==Qi.FRAG_LOADING_WAITING_RETRY||l.level!==e.level&&l.loader&&this.abortCurrentFrag();var u=0;if(o.live||null!=(n=s.details)&&n.live){var c;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;u=this.alignPlaylists(o,s.details,null==(c=this.levelLastLoaded)?void 0:c.details)}if(s.details=o,this.levelLastLoaded=s,this.hls.trigger(D.LEVEL_UPDATED,{details:o,level:r}),this.state===Qi.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=Qi.IDLE}this.startFragRequested?o.live&&this.synchronizeToLiveEdge(o):this.setStartPosition(o,u),this.tick()}else this.warn("Levels were reset while loading level "+r)},n._handleFragmentLoadProgress=function(t){var e,n=t.frag,i=t.part,r=t.payload,o=this.levels;if(o){var a=o[n.level],s=a.details;if(!s)return this.warn("Dropping fragment "+n.sn+" of level "+n.level+" after level details were reset"),void this.fragmentTracker.removeFragment(n);var l=a.videoCodec,u=s.PTSKnown||!s.live,c=null==(e=n.initSegment)?void 0:e.data,d=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new Mo(this.hls,$e.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=i?i.index:-1,p=-1!==f,g=new Ci(n.level,n.sn,n.stats.chunkCount,r.byteLength,f,p),m=this.initPTS[n.cc];h.push(r,c,d,l,n,i,s.totalduration,u,g,m)}else this.warn("Levels were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered")},n.onAudioTrackSwitching=function(t,e){var n=this.altAudio;if(!e.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i&&(this.log("Switching to main audio track, cancel main fragment load"),i.abortRequests(),this.fragmentTracker.removeFragment(i)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var r=this.hls;n&&(r.trigger(D.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),r.trigger(D.AUDIO_TRACK_SWITCHED,e)}},n.onAudioTrackSwitched=function(t,e){var n=e.id,i=!!this.hls.audioTracks[n].url;if(i){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=i,this.tick()},n.onBufferCreated=function(t,e){var n,i,r=e.tracks,o=!1;for(var a in r){var s=r[a];if("main"===s.id){if(i=a,n=s,"video"===a){var l=r[a];l&&(this.videoBuffer=l.buffer)}}else o=!0}o&&n?(this.log("Alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media},n.onFragBuffered=function(t,e){var n=e.frag,i=e.part;if(!n||n.type===$e.MAIN){if(this.fragContextChanged(n))return this.warn("Fragment "+n.sn+(i?" p: "+i.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===Qi.PARSED&&(this.state=Qi.IDLE));var r=i?i.stats:n.stats;this.fragLastKbps=Math.round(8*r.total/(r.buffering.end-r.loading.first)),"initSegment"!==n.sn&&(this.fragPrevious=n),this.fragBufferedComplete(n,i)}},n.onError=function(t,e){var n;if(e.fatal)this.state=Qi.ERROR;else switch(e.details){case _.FRAG_GAP:case _.FRAG_PARSING_ERROR:case _.FRAG_DECRYPT_ERROR:case _.FRAG_LOAD_ERROR:case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_ERROR:case _.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError($e.MAIN,e);break;case _.LEVEL_LOAD_ERROR:case _.LEVEL_LOAD_TIMEOUT:case _.LEVEL_PARSING_ERROR:e.levelRetry||this.state!==Qi.WAITING_LEVEL||(null==(n=e.context)?void 0:n.type)!==Je.LEVEL||(this.state=Qi.IDLE);break;case _.BUFFER_APPEND_ERROR:case _.BUFFER_FULL_ERROR:if(!e.parent||"main"!==e.parent)return;if(e.details===_.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(e)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case _.INTERNAL_EXCEPTION:this.recoverWorkerError(e)}},n.checkBuffer=function(){var t=this.media,e=this.gapController;if(t&&e&&t.readyState){if(this.loadedmetadata||!_i.getBuffered(t).length){var n=this.state!==Qi.IDLE?this.fragCurrent:null;e.poll(this.lastCurrentTime,n)}this.lastCurrentTime=t.currentTime}},n.onFragLoadEmergencyAborted=function(){this.state=Qi.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},n.onBufferFlushed=function(t,e){var n=e.type;if(n!==K.AUDIO||this.audioOnly&&!this.altAudio){var i=(n===K.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(i,n,$e.MAIN),this.tick()}},n.onLevelsUpdated=function(t,e){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=e.levels},n.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},n.seekToStartPos=function(){var t=this.media;if(t){var e=t.currentTime,n=this.startPosition;if(n>=0&&e<n){if(t.seeking)return void this.log("could not seek to "+n+", already seeking at "+e);var i=_i.getBuffered(t),r=(i.length?i.start(0):0)-n;r>0&&(r<this.config.maxBufferHole||r<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+r+" to match buffer start"),n+=r,this.startPosition=n),this.log("seek to target start position "+n+" from current time "+e),t.currentTime=n}}},n._getAudioCodec=function(t){var e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),e},n._loadBitrateTestFrag=function(t,e){var n=this;t.bitrateTest=!0,this._doFragLoad(t,e).then((function(i){var r=n.hls;if(i&&!n.fragContextChanged(t)){e.fragmentError=0,n.state=Qi.IDLE,n.startFragRequested=!1,n.bitrateTest=!1;var o=t.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),r.trigger(D.FRAG_LOADED,i),t.bitrateTest=!1}}))},n._handleTransmuxComplete=function(t){var e,n="main",i=this.hls,r=t.remuxResult,o=t.chunkMeta,a=this.getCurrentContext(o);if(a){var s=a.frag,l=a.part,u=a.level,c=r.video,d=r.text,h=r.id3,f=r.initSegment,p=u.details,g=this.altAudio?void 0:r.audio;if(this.fragContextChanged(s))this.fragmentTracker.removeFragment(s);else{if(this.state=Qi.PARSING,f){if(null!=f&&f.tracks){var m=s.initSegment||s;this._bufferInitSegment(u,f.tracks,m,o),i.trigger(D.FRAG_PARSING_INIT_SEGMENT,{frag:m,id:n,tracks:f.tracks})}var v=f.initPTS,y=f.timescale;w(v)&&(this.initPTS[s.cc]={baseTime:v,timescale:y},i.trigger(D.INIT_PTS_FOUND,{frag:s,id:n,initPTS:v,timescale:y}))}if(c&&p&&"initSegment"!==s.sn){var b=p.fragments[s.sn-1-p.startSN],E=s.sn===p.startSN,T=!b||s.cc>b.cc;if(!1!==r.independent){var A=c.startPTS,S=c.endPTS,L=c.startDTS,x=c.endDTS;if(l)l.elementaryStreams[c.type]={startPTS:A,endPTS:S,startDTS:L,endDTS:x};else if(c.firstKeyFrame&&c.independent&&1===o.id&&!T&&(this.couldBacktrack=!0),c.dropped&&c.independent){var R=this.getMainFwdBufferInfo(),_=(R?R.end:this.getLoadPosition())+this.config.maxBufferHole,C=c.firstKeyFramePTS?c.firstKeyFramePTS:A;if(!E&&_<C-this.config.maxBufferHole&&!T)return void this.backtrack(s);T&&(s.gap=!0),s.setElementaryStreamInfo(c.type,s.start,S,s.start,x,!0)}else E&&A>Nl&&(s.gap=!0);s.setElementaryStreamInfo(c.type,A,S,L,x),this.backtrackFragment&&(this.backtrackFragment=s),this.bufferFragmentData(c,s,l,o,E||T)}else{if(!E&&!T)return void this.backtrack(s);s.gap=!0}}if(g){var k=g.startPTS,I=g.endPTS,O=g.startDTS,P=g.endDTS;l&&(l.elementaryStreams[K.AUDIO]={startPTS:k,endPTS:I,startDTS:O,endDTS:P}),s.setElementaryStreamInfo(K.AUDIO,k,I,O,P),this.bufferFragmentData(g,s,l,o)}if(p&&null!=h&&null!=(e=h.samples)&&e.length){var M={id:n,frag:s,details:p,samples:h.samples};i.trigger(D.FRAG_PARSING_METADATA,M)}if(p&&d){var N={id:n,frag:s,details:p,samples:d.samples};i.trigger(D.FRAG_PARSING_USERDATA,N)}}}else this.resetWhenMissingContext(o)},n._bufferInitSegment=function(t,e,n,i){var r=this;if(this.state===Qi.PARSING){this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&delete e.audio;var o=e.audio,a=e.video,s=e.audiovideo;if(o){var l=t.audioCodec,u=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){l&&(l=-1!==l.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");var c=o.metadata;c&&"channelCount"in c&&1!==(c.channelCount||1)&&-1===u.indexOf("firefox")&&(l="mp4a.40.5")}l&&-1!==l.indexOf("mp4a.40.5")&&-1!==u.indexOf("android")&&"audio/mpeg"!==o.container&&(l="mp4a.40.2",this.log("Android: force audio codec to "+l)),t.audioCodec&&t.audioCodec!==l&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+l+'"'),o.levelCodec=l,o.id="main",this.log("Init audio buffer, container:"+o.container+", codecs[selected/level/parsed]=["+(l||"")+"/"+(t.audioCodec||"")+"/"+o.codec+"]")}a&&(a.levelCodec=t.videoCodec,a.id="main",this.log("Init video buffer, container:"+a.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+a.codec+"]")),s&&this.log("Init audiovideo buffer, container:"+s.container+", codecs[level/parsed]=["+t.codecs+"/"+s.codec+"]"),this.hls.trigger(D.BUFFER_CODECS,e),Object.keys(e).forEach((function(t){var o=e[t].initSegment;null!=o&&o.byteLength&&r.hls.trigger(D.BUFFER_APPENDING,{type:t,data:o,frag:n,part:null,chunkMeta:i,parent:n.type})})),this.tickImmediate()}},n.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,$e.MAIN)},n.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=Qi.IDLE},n.checkFragmentChanged=function(){var t=this.media,e=null;if(t&&t.readyState>1&&!1===t.seeking){var n=t.currentTime;if(_i.isBuffered(t,n)?e=this.getAppendedFrag(n):_i.isBuffered(t,n+.1)&&(e=this.getAppendedFrag(n+.1)),e){this.backtrackFragment=null;var i=this.fragPlaying,r=e.level;i&&e.sn===i.sn&&i.level===r||(this.fragPlaying=e,this.hls.trigger(D.FRAG_CHANGED,{frag:e}),i&&i.level===r||this.hls.trigger(D.LEVEL_SWITCHED,{level:r}))}}},s(e,[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var e=t.currentTime,n=this.currentFrag;if(n&&w(e)&&w(n.programDateTime)){var i=n.programDateTime+1e3*(e-n.start);return new Date(i)}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),e}(Zi),Vl=function(){function t(e){void 0===e&&(e={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new xo,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,M(e.debug||!1,"Hls instance");var n=this.config=Ll(t.DefaultConfig,e);this.userConfig=e,n.progressive&&Dl(n);var i=n.abrController,r=n.bufferController,o=n.capLevelController,a=n.errorController,s=n.fpsController,l=new a(this),u=this.abrController=new i(this),c=this.bufferController=new r(this),d=this.capLevelController=new o(this),h=new s(this),f=new tn(this),p=new mn(this),g=n.contentSteeringController,m=g?new g(this):null,v=this.levelController=new Rl(this,m),y=new Li(this),b=new Cl(this.config),E=this.streamController=new Gl(this,y,b);d.setStreamController(E),h.setStreamController(E);var T=[f,v,E];m&&T.splice(1,0,m),this.networkControllers=T;var A=[u,c,d,h,p,y];this.audioTrackController=this.createController(n.audioTrackController,T);var S=n.audioStreamController;S&&T.push(new S(this,y,b)),this.subtitleTrackController=this.createController(n.subtitleTrackController,T);var w=n.subtitleStreamController;w&&T.push(new w(this,y,b)),this.createController(n.timelineController,A),b.emeController=this.emeController=this.createController(n.emeController,A),this.cmcdController=this.createController(n.cmcdController,A),this.latencyController=this.createController(vn,A),this.coreComponents=A,T.push(l);var L=l.onErrorOut;"function"==typeof L&&this.on(D.ERROR,L,l)}t.isMSESupported=function(){return Il()},t.isSupported=function(){return Ol()},t.getMediaSource=function(){return Te()};var e=t.prototype;return e.createController=function(t,e){if(t){var n=new t(this);return e&&e.push(n),n}return null},e.on=function(t,e,n){void 0===n&&(n=this),this._emitter.on(t,e,n)},e.once=function(t,e,n){void 0===n&&(n=this),this._emitter.once(t,e,n)},e.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},e.off=function(t,e,n,i){void 0===n&&(n=this),this._emitter.off(t,e,n,i)},e.listeners=function(t){return this._emitter.listeners(t)},e.emit=function(t,e,n){return this._emitter.emit(t,e,n)},e.trigger=function(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(e){if(N.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),!this.triggeringException){this.triggeringException=!0;var n=t===D.ERROR;this.trigger(D.ERROR,{type:R.OTHER_ERROR,details:_.INTERNAL_EXCEPTION,fatal:n,event:t,error:e}),this.triggeringException=!1}}return!1},e.listenerCount=function(t){return this._emitter.listenerCount(t)},e.destroy=function(){N.log("destroy"),this.trigger(D.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(t){return t.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(t){return t.destroy()})),this.coreComponents.length=0;var t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null},e.attachMedia=function(t){N.log("attachMedia"),this._media=t,this.trigger(D.MEDIA_ATTACHING,{media:t})},e.detachMedia=function(){N.log("detachMedia"),this.trigger(D.MEDIA_DETACHING,void 0),this._media=null},e.loadSource=function(t){this.stopLoad();var e=this.media,n=this.url,i=this.url=S.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,N.log("loadSource:"+i),e&&n&&(n!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(D.MANIFEST_LOADING,{url:t})},e.startLoad=function(t){void 0===t&&(t=-1),N.log("startLoad("+t+")"),this.started=!0,this.networkControllers.forEach((function(e){e.startLoad(t)}))},e.stopLoad=function(){N.log("stopLoad"),this.started=!1,this.networkControllers.forEach((function(t){t.stopLoad()}))},e.resumeBuffering=function(){this.started&&this.networkControllers.forEach((function(t){"fragmentLoader"in t&&t.startLoad(-1)}))},e.pauseBuffering=function(){this.networkControllers.forEach((function(t){"fragmentLoader"in t&&t.stopLoad()}))},e.swapAudioCodec=function(){N.log("swapAudioCodec"),this.streamController.swapAudioCodec()},e.recoverMediaError=function(){N.log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},e.removeLevel=function(t){this.levelController.removeLevel(t)},e.setAudioOption=function(t){var e;return null==(e=this.audioTrackController)?void 0:e.setAudioOption(t)},e.setSubtitleOption=function(t){var e;return null==(e=this.subtitleTrackController)||e.setSubtitleOption(t),null},s(t,[{key:"levels",get:function(){var t=this.levelController.levels;return t||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){N.log("set currentLevel:"+t),this.levelController.manualLevel=t,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){N.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){N.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){N.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){var t=this.levelController.startLevel;return-1===t&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:t},set:function(t){N.log("set startLevel:"+t),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){var e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(N.log("set autoLevelCapping:"+t),this._autoLevelCapping=t,this.levelController.checkMaxAutoUpdated())}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN},set:function(t){this.abrController.resetEstimator(t)}},{key:"ttfbEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(t){bn(t)&&this._maxHdcpLevel!==t&&(this._maxHdcpLevel=t,this.levelController.checkMaxAutoUpdated())}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,e=this.config.minAutoBitrate;if(!t)return 0;for(var n=t.length,i=0;i<n;i++)if(t[i].maxBitrate>=e)return i;return 0}},{key:"maxAutoLevel",get:function(){var t,e=this.levels,n=this.autoLevelCapping,i=this.maxHdcpLevel;if(t=-1===n&&null!=e&&e.length?e.length-1:n,i)for(var r=t;r--;){var o=e[r].attrs["HDCP-LEVEL"];if(o&&o<=i)return r}return t}},{key:"firstAutoLevel",get:function(){return this.abrController.firstAutoLevel}},{key:"nextAutoLevel",get:function(){return this.abrController.nextAutoLevel},set:function(t){this.abrController.nextAutoLevel=t}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"allAudioTracks",get:function(){var t=this.audioTrackController;return t?t.allAudioTracks:[]}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"allSubtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.allSubtitleTracks:[]}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.5.13"}},{key:"Events",get:function(){return D}},{key:"ErrorTypes",get:function(){return R}},{key:"ErrorDetails",get:function(){return _}},{key:"DefaultConfig",get:function(){return t.defaultConfig?t.defaultConfig:Sl},set:function(e){t.defaultConfig=e}}]),t}();return Vl.defaultConfig=void 0,Vl}()}(!1)},229:()=>{},606:t=>{var e,n,i=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(e===setTimeout)return setTimeout(t,0);if((e===r||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(n){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:r}catch(t){e=r}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(t){n=o}}();var s,l=[],u=!1,c=-1;function d(){u&&s&&(u=!1,s.length?l=s.concat(l):c=-1,l.length&&h())}function h(){if(!u){var t=a(d);u=!0;for(var e=l.length;e;){for(s=l,l=[];++c<e;)s&&s[c].run();c=-1,e=l.length}s=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{return n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function p(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];l.push(new f(t,e)),1!==l.length||u||a(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},352:function(t,e,n){var i,r;(function(){}).call(this),function(){null==window.Set&&(window.Set=function(){function t(){this.clear()}return t.prototype.clear=function(){return this.values=[]},t.prototype.has=function(t){return-1!==this.values.indexOf(t)},t.prototype.add=function(t){return this.has(t)||this.values.push(t),this},t.prototype.delete=function(t){var e;return-1!==(e=this.values.indexOf(t))&&(this.values.splice(e,1),!0)},t.prototype.forEach=function(){var t;return(t=this.values).forEach.apply(t,arguments)},t}())}.call(this),function(e){function n(){}function i(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],u(t,this)}function r(t,e){for(;3===t._state;)t=t._value;return 0===t._state?void t._deferreds.push(e):(t._handled=!0,void d((function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var i;try{i=n(t._value)}catch(t){return void a(e.promise,t)}o(e.promise,i)}else(1===t._state?o:a)(e.promise,t._value)})))}function o(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof i)return t._state=3,t._value=e,void s(t);if("function"==typeof n)return void u(function(t,e){return function(){t.apply(e,arguments)}}(n,e),t)}t._state=1,t._value=e,s(t)}catch(e){a(t,e)}}function a(t,e){t._state=2,t._value=e,s(t)}function s(t){2===t._state&&0===t._deferreds.length&&setTimeout((function(){t._handled||h(t._value)}),1);for(var e=0,n=t._deferreds.length;n>e;e++)r(t,t._deferreds[e]);t._deferreds=null}function l(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function u(t,e){var n=!1;try{t((function(t){n||(n=!0,o(e,t))}),(function(t){n||(n=!0,a(e,t))}))}catch(t){if(n)return;n=!0,a(e,t)}}var c=setTimeout,d="function"==typeof setImmediate&&setImmediate||function(t){c(t,1)},h=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};i.prototype.catch=function(t){return this.then(null,t)},i.prototype.then=function(t,e){var o=new i(n);return r(this,new l(t,e,o)),o},i.all=function(t){var e=Array.prototype.slice.call(t);return new i((function(t,n){function i(o,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,(function(t){i(o,t)}),n)}e[o]=a,0==--r&&t(e)}catch(t){n(t)}}if(0===e.length)return t([]);for(var r=e.length,o=0;o<e.length;o++)i(o,e[o])}))},i.resolve=function(t){return t&&"object"==typeof t&&t.constructor===i?t:new i((function(e){e(t)}))},i.reject=function(t){return new i((function(e,n){n(t)}))},i.race=function(t){return new i((function(e,n){for(var i=0,r=t.length;r>i;i++)t[i].then(e,n)}))},i._setImmediateFn=function(t){d=t},i._setUnhandledRejectionFn=function(t){h=t},t.exports?t.exports=i:e.Promise||(e.Promise=i)}(this),function(){var t="object"==typeof window.customElements,e="function"==typeof document.registerElement;t||e||("undefined"==typeof WeakMap&&function(){var t=Object.defineProperty,e=Date.now()%1e9,n=function(){this.name="__st"+(1e9*Math.random()>>>0)+e+++"__"};n.prototype={set:function(e,n){var i=e[this.name];return i&&i[0]===e?i[1]=n:t(e,this.name,{value:[e,n],writable:!0}),this},get:function(t){var e;return(e=t[this.name])&&e[0]===t?e[1]:void 0},delete:function(t){var e=t[this.name];return!(!e||e[0]!==t)&&(e[0]=e[1]=void 0,!0)},has:function(t){var e=t[this.name];return!!e&&e[0]===t}},window.WeakMap=n}(),function(t){function e(t){v.push(t),m||(m=!0,c(n))}function n(){m=!1;var t=v;v=[],t.sort((function(t,e){return t.uid_-e.uid_}));var e=!1;t.forEach((function(t){var n=t.takeRecords();(function(t){t.nodes_.forEach((function(e){var n=d.get(e);n&&n.forEach((function(e){e.observer===t&&e.removeTransientObservers()}))}))})(t),n.length&&(t.callback_(n,t),e=!0)})),e&&n()}function i(t,e){for(var n=t;n;n=n.parentNode){var i=d.get(n);if(i)for(var r=0;r<i.length;r++){var o=i[r],a=o.options;if(n===t||a.subtree){var s=e(a);s&&o.enqueue(s)}}}}function r(t){this.callback_=t,this.nodes_=[],this.records_=[],this.uid_=++y}function o(t,e){this.type=t,this.target=e,this.addedNodes=[],this.removedNodes=[],this.previousSibling=null,this.nextSibling=null,this.attributeName=null,this.attributeNamespace=null,this.oldValue=null}function a(t,e){return p=new o(t,e)}function s(t){return g||(g=function(t){var e=new o(t.type,t.target);return e.addedNodes=t.addedNodes.slice(),e.removedNodes=t.removedNodes.slice(),e.previousSibling=t.previousSibling,e.nextSibling=t.nextSibling,e.attributeName=t.attributeName,e.attributeNamespace=t.attributeNamespace,e.oldValue=t.oldValue,e}(p),g.oldValue=t,g)}function l(t,e){return t===e?t:g&&function(t){return t===g||t===p}(t)?g:null}function u(t,e,n){this.observer=t,this.target=e,this.options=n,this.transientObservedNodes=[]}if(!t.JsMutationObserver){var c,d=new WeakMap;if(/Trident|Edge/.test(navigator.userAgent))c=setTimeout;else if(window.setImmediate)c=window.setImmediate;else{var h=[],f=String(Math.random());window.addEventListener("message",(function(t){if(t.data===f){var e=h;h=[],e.forEach((function(t){t()}))}})),c=function(t){h.push(t),window.postMessage(f,"*")}}var p,g,m=!1,v=[],y=0;r.prototype={observe:function(t,e){if(t=function(t){return window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.wrapIfNeeded(t)||t}(t),!e.childList&&!e.attributes&&!e.characterData||e.attributeOldValue&&!e.attributes||e.attributeFilter&&e.attributeFilter.length&&!e.attributes||e.characterDataOldValue&&!e.characterData)throw new SyntaxError;var n=d.get(t);n||d.set(t,n=[]);for(var i,r=0;r<n.length;r++)if(n[r].observer===this){(i=n[r]).removeListeners(),i.options=e;break}i||(i=new u(this,t,e),n.push(i),this.nodes_.push(t)),i.addListeners()},disconnect:function(){this.nodes_.forEach((function(t){for(var e=d.get(t),n=0;n<e.length;n++){var i=e[n];if(i.observer===this){i.removeListeners(),e.splice(n,1);break}}}),this),this.records_=[]},takeRecords:function(){var t=this.records_;return this.records_=[],t}},u.prototype={enqueue:function(t){var n=this.observer.records_,i=n.length;if(n.length>0){var r=l(n[i-1],t);if(r)return void(n[i-1]=r)}else e(this.observer);n[i]=t},addListeners:function(){this.addListeners_(this.target)},addListeners_:function(t){var e=this.options;e.attributes&&t.addEventListener("DOMAttrModified",this,!0),e.characterData&&t.addEventListener("DOMCharacterDataModified",this,!0),e.childList&&t.addEventListener("DOMNodeInserted",this,!0),(e.childList||e.subtree)&&t.addEventListener("DOMNodeRemoved",this,!0)},removeListeners:function(){this.removeListeners_(this.target)},removeListeners_:function(t){var e=this.options;e.attributes&&t.removeEventListener("DOMAttrModified",this,!0),e.characterData&&t.removeEventListener("DOMCharacterDataModified",this,!0),e.childList&&t.removeEventListener("DOMNodeInserted",this,!0),(e.childList||e.subtree)&&t.removeEventListener("DOMNodeRemoved",this,!0)},addTransientObserver:function(t){if(t!==this.target){this.addListeners_(t),this.transientObservedNodes.push(t);var e=d.get(t);e||d.set(t,e=[]),e.push(this)}},removeTransientObservers:function(){var t=this.transientObservedNodes;this.transientObservedNodes=[],t.forEach((function(t){this.removeListeners_(t);for(var e=d.get(t),n=0;n<e.length;n++)if(e[n]===this){e.splice(n,1);break}}),this)},handleEvent:function(t){switch(t.stopImmediatePropagation(),t.type){case"DOMAttrModified":var e=t.attrName,n=t.relatedNode.namespaceURI,r=t.target;(l=new a("attributes",r)).attributeName=e,l.attributeNamespace=n;var o=t.attrChange===MutationEvent.ADDITION?null:t.prevValue;i(r,(function(t){return!t.attributes||t.attributeFilter&&t.attributeFilter.length&&-1===t.attributeFilter.indexOf(e)&&-1===t.attributeFilter.indexOf(n)?void 0:t.attributeOldValue?s(o):l}));break;case"DOMCharacterDataModified":var l=a("characterData",r=t.target);o=t.prevValue;i(r,(function(t){return t.characterData?t.characterDataOldValue?s(o):l:void 0}));break;case"DOMNodeRemoved":this.addTransientObserver(t.target);case"DOMNodeInserted":var u,c,d=t.target;"DOMNodeInserted"===t.type?(u=[d],c=[]):(u=[],c=[d]);var h=d.previousSibling,f=d.nextSibling;(l=a("childList",t.target.parentNode)).addedNodes=u,l.removedNodes=c,l.previousSibling=h,l.nextSibling=f,i(t.relatedNode,(function(t){return t.childList?l:void 0}))}p=g=void 0}},t.JsMutationObserver=r,t.MutationObserver||(t.MutationObserver=r,r._isPolyfilled=!0)}}(self),function(){"use strict";if(!window.performance||!window.performance.now){var t=Date.now();window.performance={now:function(){return Date.now()-t}}}window.requestAnimationFrame||(window.requestAnimationFrame=function(){var t=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame;return t?function(e){return t((function(){e(performance.now())}))}:function(t){return window.setTimeout(t,1e3/60)}}()),window.cancelAnimationFrame||(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)});var e=function(){var t=document.createEvent("Event");return t.initEvent("foo",!0,!0),t.preventDefault(),t.defaultPrevented}();if(!e){var n=Event.prototype.preventDefault;Event.prototype.preventDefault=function(){this.cancelable&&(n.call(this),Object.defineProperty(this,"defaultPrevented",{get:function(){return!0},configurable:!0}))}}var i=/Trident/.test(navigator.userAgent);if((!window.CustomEvent||i&&"function"!=typeof window.CustomEvent)&&(window.CustomEvent=function(t,e){e=e||{};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,Boolean(e.bubbles),Boolean(e.cancelable),e.detail),n},window.CustomEvent.prototype=window.Event.prototype),!window.Event||i&&"function"!=typeof window.Event){var r=window.Event;window.Event=function(t,e){e=e||{};var n=document.createEvent("Event");return n.initEvent(t,Boolean(e.bubbles),Boolean(e.cancelable)),n},window.Event.prototype=r.prototype}}(window.WebComponents),window.CustomElements=window.CustomElements||{flags:{}},function(t){var e=t.flags,n=[];t.addModule=function(t){n.push(t)},t.initializeModules=function(){n.forEach((function(e){e(t)}))},t.hasNative=Boolean(document.registerElement),t.isIE=/Trident/.test(navigator.userAgent),t.useNative=!e.register&&t.hasNative&&!window.ShadowDOMPolyfill&&(!window.HTMLImports||window.HTMLImports.useNative)}(window.CustomElements),window.CustomElements.addModule((function(t){function e(t,e){n(t,(function(t){return!!e(t)||void i(t,e)})),i(t,e)}function n(t,e,i){var r=t.firstElementChild;if(!r)for(r=t.firstChild;r&&r.nodeType!==Node.ELEMENT_NODE;)r=r.nextSibling;for(;r;)!0!==e(r,i)&&n(r,e,i),r=r.nextElementSibling;return null}function i(t,n){for(var i=t.shadowRoot;i;)e(i,n),i=i.olderShadowRoot}function r(t,e,n){if(t=window.wrap(t),!(n.indexOf(t)>=0)){n.push(t);for(var i,a=t.querySelectorAll("link[rel="+o+"]"),s=0,l=a.length;l>s&&(i=a[s]);s++)i.import&&r(i.import,e,n);e(t)}}var o=window.HTMLImports?window.HTMLImports.IMPORT_LINK_TYPE:"none";t.forDocumentTree=function(t,e){r(t,e,[])},t.forSubtree=e})),window.CustomElements.addModule((function(t){function e(t,e){return n(t,e)||i(t,e)}function n(e,n){return!!t.upgrade(e,n)||void(n&&a(e))}function i(t,e){p(t,(function(t){return!!n(t,e)||void 0}))}function r(t){y.push(t),v||(v=!0,setTimeout(o))}function o(){v=!1;for(var t,e=y,n=0,i=e.length;i>n&&(t=e[n]);n++)t();y=[]}function a(t){m?r((function(){s(t)})):s(t)}function s(t){t.__upgraded__&&!t.__attached&&(t.__attached=!0,t.attachedCallback&&t.attachedCallback())}function l(t){m?r((function(){u(t)})):u(t)}function u(t){t.__upgraded__&&t.__attached&&(t.__attached=!1,t.detachedCallback&&t.detachedCallback())}function c(t,n){if(f.dom){var i=n[0];if(i&&"childList"===i.type&&i.addedNodes&&i.addedNodes){for(var r=i.addedNodes[0];r&&r!==document&&!r.host;)r=r.parentNode;var o=r&&(r.URL||r._URL||r.host&&r.host.localName)||"";o=o.split("/?").shift().split("/").pop()}console.group("mutations (%d) [%s]",n.length,o||"")}var a=function(t){for(var e=t,n=window.wrap(document);e;){if(e==n)return!0;e=e.parentNode||e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&e.host}}(t);n.forEach((function(t){"childList"===t.type&&(b(t.addedNodes,(function(t){t.localName&&e(t,a)})),b(t.removedNodes,(function(t){t.localName&&function(t){l(t),p(t,(function(t){l(t)}))}(t)})))})),f.dom&&console.groupEnd()}function d(t){if(!t.__observer){var e=new MutationObserver(c.bind(this,t));e.observe(t,{childList:!0,subtree:!0}),t.__observer=e}}function h(t){t=window.wrap(t),f.dom&&console.group("upgradeDocument: ",t.baseURI.split("/").pop()),e(t,t===window.wrap(document)),d(t),f.dom&&console.groupEnd()}var f=t.flags,p=t.forSubtree,g=t.forDocumentTree,m=window.MutationObserver._isPolyfilled&&f["throttle-attached"];t.hasPolyfillMutations=m,t.hasThrottledAttached=m;var v=!1,y=[],b=Array.prototype.forEach.call.bind(Array.prototype.forEach),E=Element.prototype.createShadowRoot;E&&(Element.prototype.createShadowRoot=function(){var t=E.call(this);return window.CustomElements.watchShadow(this),t}),t.watchShadow=function(t){if(t.shadowRoot&&!t.shadowRoot.__watched){f.dom&&console.log("watching shadow-root for: ",t.localName);for(var e=t.shadowRoot;e;)d(e),e=e.olderShadowRoot}},t.upgradeDocumentTree=function(t){g(t,h)},t.upgradeDocument=h,t.upgradeSubtree=i,t.upgradeAll=e,t.attached=a,t.takeRecords=function(t){for((t=window.wrap(t))||(t=window.wrap(document));t.parentNode;)t=t.parentNode;var e=t.__observer;e&&(c(t,e.takeRecords()),o())}})),window.CustomElements.addModule((function(t){function e(e,r,o){return i.upgrade&&console.group("upgrade:",e.localName),r.is&&e.setAttribute("is",r.is),n(e,r),e.__upgraded__=!0,function(t){t.createdCallback&&t.createdCallback()}(e),o&&t.attached(e),t.upgradeSubtree(e,o),i.upgrade&&console.groupEnd(),e}function n(t,e){Object.__proto__||function(t,e,n){for(var i={},r=e;r!==n&&r!==HTMLElement.prototype;){for(var o,a=Object.getOwnPropertyNames(r),s=0;o=a[s];s++)i[o]||(Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(r,o)),i[o]=1);r=Object.getPrototypeOf(r)}}(t,e.prototype,e.native),t.__proto__=e.prototype}var i=t.flags;t.upgrade=function(n,i){if("template"===n.localName&&window.HTMLTemplateElement&&HTMLTemplateElement.decorate&&HTMLTemplateElement.decorate(n),!n.__upgraded__&&n.nodeType===Node.ELEMENT_NODE){var r=n.getAttribute("is"),o=t.getRegisteredDefinition(n.localName)||t.getRegisteredDefinition(r);if(o&&(r&&o.tag==n.localName||!r&&!o.extends))return e(n,o,i)}},t.upgradeWithDefinition=e,t.implementPrototype=n})),window.CustomElements.addModule((function(t){function e(t){if(!t.setAttribute._polyfilled){var e=t.setAttribute;t.setAttribute=function(t,i){n.call(this,t,i,e)};var i=t.removeAttribute;t.removeAttribute=function(t){n.call(this,t,null,i)},t.setAttribute._polyfilled=!0}}function n(t,e,n){t=t.toLowerCase();var i=this.getAttribute(t);n.apply(this,arguments);var r=this.getAttribute(t);this.attributeChangedCallback&&r!==i&&this.attributeChangedCallback(t,i,r)}function i(t){var e=r(t);return e?i(e.extends).concat([e]):[]}function r(t){return t?g[t.toLowerCase()]:void 0}function o(t){return function(){return function(t){return d(v(t.tag),t)}(t)}}function a(t,e){t&&(t=t.toLowerCase()),e&&(e=e.toLowerCase());var n,i=r(e||t);if(i){if(t==i.tag&&e==i.is)return new i.ctor;if(!e&&!i.is)return new i.ctor}return e?((n=a(t)).setAttribute("is",e),n):(n=v(t),t.indexOf("-")>=0&&h(n,HTMLElement),n)}function s(t,e){var n=t[e];t[e]=function(){var t=n.apply(this,arguments);return c(t),t}}var l,u=(t.isIE,t.upgradeDocumentTree),c=t.upgradeAll,d=t.upgradeWithDefinition,h=t.implementPrototype,f=t.useNative,p=["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"],g={},m="http://www.w3.org/1999/xhtml",v=document.createElement.bind(document),y=document.createElementNS.bind(document);l=Object.__proto__||f?function(t,e){return t instanceof e}:function(t,e){if(t instanceof e)return!0;for(var n=t;n;){if(n===e.prototype)return!0;n=n.__proto__}return!1},s(Node.prototype,"cloneNode"),s(document,"importNode"),document.registerElement=function(n,a){var s=a||{};if(!n)throw new Error("document.registerElement: first argument `name` must not be empty");if(n.indexOf("-")<0)throw new Error("document.registerElement: first argument ('name') must contain a dash ('-'). Argument provided was '"+String(n)+"'.");if(function(t){for(var e=0;e<p.length;e++)if(t===p[e])return!0}(n))throw new Error("Failed to execute 'registerElement' on 'Document': Registration failed for type '"+String(n)+"'. The type name is invalid.");if(r(n))throw new Error("DuplicateDefinitionError: a type with name '"+String(n)+"' is already registered");return s.prototype||(s.prototype=Object.create(HTMLElement.prototype)),s.__name=n.toLowerCase(),s.extends&&(s.extends=s.extends.toLowerCase()),s.lifecycle=s.lifecycle||{},s.ancestry=i(s.extends),function(t){for(var e,n=t.extends,i=0;e=t.ancestry[i];i++)n=e.is&&e.tag;t.tag=n||t.__name,n&&(t.is=t.__name)}(s),function(t){if(!Object.__proto__){var e=HTMLElement.prototype;if(t.is){var n=document.createElement(t.tag);e=Object.getPrototypeOf(n)}for(var i,r=t.prototype,o=!1;r;)r==e&&(o=!0),(i=Object.getPrototypeOf(r))&&(r.__proto__=i),r=i;o||console.warn(t.tag+" prototype not found in prototype chain for "+t.is),t.native=e}}(s),e(s.prototype),function(t,e){g[t]=e}(s.__name,s),s.ctor=o(s),s.ctor.prototype=s.prototype,s.prototype.constructor=s.ctor,t.ready&&u(document),s.ctor},document.createElement=a,document.createElementNS=function(t,e,n){return t===m?a(e,n):y(t,e)},t.registry=g,t.instanceof=l,t.reservedTagList=p,t.getRegisteredDefinition=r,document.register=document.registerElement})),function(t){function e(){o(window.wrap(document)),window.CustomElements.ready=!0,(window.requestAnimationFrame||function(t){setTimeout(t,16)})((function(){setTimeout((function(){window.CustomElements.readyTime=Date.now(),window.HTMLImports&&(window.CustomElements.elapsed=window.CustomElements.readyTime-window.HTMLImports.readyTime),document.dispatchEvent(new CustomEvent("WebComponentsReady",{bubbles:!0}))}))}))}var n=t.useNative,i=t.initializeModules;if(t.isIE,n){var r=function(){};t.watchShadow=r,t.upgrade=r,t.upgradeAll=r,t.upgradeDocumentTree=r,t.upgradeSubtree=r,t.takeRecords=r,t.instanceof=function(t,e){return t instanceof e}}else i();var o=t.upgradeDocumentTree,a=t.upgradeDocument;if(window.wrap||(window.ShadowDOMPolyfill?(window.wrap=window.ShadowDOMPolyfill.wrapIfNeeded,window.unwrap=window.ShadowDOMPolyfill.unwrapIfNeeded):window.wrap=window.unwrap=function(t){return t}),window.HTMLImports&&(window.HTMLImports.__importsParsingHook=function(t){t.import&&a(wrap(t.import))}),"complete"===document.readyState||t.flags.eager)e();else if("interactive"!==document.readyState||window.attachEvent||window.HTMLImports&&!window.HTMLImports.ready){var s=window.HTMLImports&&!window.HTMLImports.ready?"HTMLImportsLoaded":"DOMContentLoaded";window.addEventListener(s,e)}else e()}(window.CustomElements))}.call(this),function(){}.call(this),function(){(function(){(function(){this.Trix={VERSION:"1.3.2",ZERO_WIDTH_SPACE:"\ufeff",NON_BREAKING_SPACE:" ",OBJECT_REPLACEMENT_CHARACTER:"￼",browser:{composesExistingText:/Android.*Chrome/.test(navigator.userAgent),forcesObjectResizing:/Trident.*rv:11/.test(navigator.userAgent),supportsInputEvents:function(){var t,e,n;if("undefined"==typeof InputEvent)return!1;for(t=0,e=(n=["data","getTargetRanges","inputType"]).length;e>t;t++)if(!(n[t]in InputEvent.prototype))return!1;return!0}()},config:{}}}).call(this)}).call(this);var o=this.Trix;(function(){(function(){o.BasicObject=function(){function t(){}var e,n,i;return t.proxyMethod=function(t){var i,r,o,a,s;return o=n(t),i=o.name,a=o.toMethod,s=o.toProperty,r=o.optional,this.prototype[i]=function(){var t,n;return t=null!=a?r?"function"==typeof this[a]?this[a]():void 0:this[a]():null!=s?this[s]:void 0,r?null!=(n=null!=t?t[i]:void 0)?e.call(n,t,arguments):void 0:(n=t[i],e.call(n,t,arguments))}},n=function(t){var e,n;if(!(n=t.match(i)))throw new Error("can't parse @proxyMethod expression: "+t);return e={name:n[4]},null!=n[2]?e.toMethod=n[1]:e.toProperty=n[1],null!=n[3]&&(e.optional=!0),e},e=Function.prototype.apply,i=/^(.+?)(\(\))?(\?)?\.(.+?)$/,t}()}).call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;o.Object=function(e){function n(){this.id=++i}var i;return t(n,e),i=0,n.fromJSONString=function(t){return this.fromJSON(JSON.parse(t))},n.prototype.hasSameConstructorAs=function(t){return this.constructor===(null!=t?t.constructor:void 0)},n.prototype.isEqualTo=function(t){return this===t},n.prototype.inspect=function(){var t,e,n;return t=function(){var t,i,r;for(e in r=[],i=null!=(t=this.contentsForInspection())?t:{})n=i[e],r.push(e+"="+n);return r}.call(this),"#<"+this.constructor.name+":"+this.id+(t.length?" "+t.join(", "):"")+">"},n.prototype.contentsForInspection=function(){},n.prototype.toJSONString=function(){return JSON.stringify(this)},n.prototype.toUTF16String=function(){return o.UTF16String.box(this)},n.prototype.getCacheKey=function(){return this.id.toString()},n}(o.BasicObject)}.call(this),function(){o.extend=function(t){var e,n;for(e in t)n=t[e],this[e]=n;return this}}.call(this),function(){o.extend({defer:function(t){return setTimeout(t,1)}})}.call(this),function(){var t,e;o.extend({normalizeSpaces:function(t){return t.replace(RegExp(""+o.ZERO_WIDTH_SPACE,"g"),"").replace(RegExp(""+o.NON_BREAKING_SPACE,"g")," ")},normalizeNewlines:function(t){return t.replace(/\r\n/g,"\n")},breakableWhitespacePattern:RegExp("[^\\S"+o.NON_BREAKING_SPACE+"]"),squishBreakableWhitespace:function(t){return t.replace(RegExp(""+o.breakableWhitespacePattern.source,"g")," ").replace(/\ {2,}/g," ")},summarizeStringChange:function(t,n){var i,r,a,s;return t=o.UTF16String.box(t),(n=o.UTF16String.box(n)).length<t.length?(s=(r=e(t,n))[0],i=r[1]):(i=(a=e(n,t))[0],s=a[1]),{added:i,removed:s}}}),e=function(e,n){var i,r,a,s,l;return e.isEqualTo(n)?["",""]:(a=(s=(r=t(e,n)).utf16String.length)?(l=r.offset,i=e.codepoints.slice(0,l).concat(e.codepoints.slice(l+s)),t(n,o.UTF16String.fromCodepoints(i))):t(n,e),[r.utf16String.toString(),a.utf16String.toString()])},t=function(t,e){var n,i,r;for(n=0,i=t.length,r=e.length;i>n&&t.charAt(n).isEqualTo(e.charAt(n));)n++;for(;i>n+1&&t.charAt(i-1).isEqualTo(e.charAt(r-1));)i--,r--;return{utf16String:t.slice(n,i),offset:n}}}.call(this),function(){o.extend({copyObject:function(t){var e,n,i;for(e in null==t&&(t={}),n={},t)i=t[e],n[e]=i;return n},objectsAreEqual:function(t,e){var n;if(null==t&&(t={}),null==e&&(e={}),Object.keys(t).length!==Object.keys(e).length)return!1;for(n in t)if(t[n]!==e[n])return!1;return!0}})}.call(this),function(){var t=[].slice;o.extend({arraysAreEqual:function(t,e){var n,i,r;if(null==t&&(t=[]),null==e&&(e=[]),t.length!==e.length)return!1;for(i=n=0,r=t.length;r>n;i=++n)if(t[i]!==e[i])return!1;return!0},arrayStartsWith:function(t,e){return null==t&&(t=[]),null==e&&(e=[]),o.arraysAreEqual(t.slice(0,e.length),e)},spliceArray:function(){var e,n,i;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],(i=n.slice(0)).splice.apply(i,e),i},summarizeArrayChange:function(t,e){var n,i,r,o,a,s,l,u,c,d,h;for(null==t&&(t=[]),null==e&&(e=[]),n=[],d=[],r=new Set,o=0,l=t.length;l>o;o++)h=t[o],r.add(h);for(i=new Set,a=0,u=e.length;u>a;a++)h=e[a],i.add(h),r.has(h)||n.push(h);for(s=0,c=t.length;c>s;s++)h=t[s],i.has(h)||d.push(h);return{added:n,removed:d}}})}.call(this),function(){var t,e,n,i;t=null,e=null,i=null,n=null,o.extend({getAllAttributeNames:function(){return null!=t?t:t=o.getTextAttributeNames().concat(o.getBlockAttributeNames())},getBlockConfig:function(t){return o.config.blockAttributes[t]},getBlockAttributeNames:function(){return null!=e?e:e=Object.keys(o.config.blockAttributes)},getTextConfig:function(t){return o.config.textAttributes[t]},getTextAttributeNames:function(){return null!=i?i:i=Object.keys(o.config.textAttributes)},getListAttributeNames:function(){var t,e;return null!=n?n:n=function(){var n,i;for(t in i=[],n=o.config.blockAttributes)null!=(e=n[t].listAttribute)&&i.push(e);return i}()}})}.call(this),function(){var t,e,n,i,r,a=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};t=document.documentElement,e=null!=(n=null!=(i=null!=(r=t.matchesSelector)?r:t.webkitMatchesSelector)?i:t.msMatchesSelector)?n:t.mozMatchesSelector,o.extend({handleEvent:function(e,n){var i,r,a,s,l,u,c,d,h,f,p;return l=(c=null!=n?n:{}).onElement,s=c.matchingSelector,p=c.withCallback,a=c.inPhase,u=c.preventDefault,h=c.times,i=null!=l?l:t,d=s,f="capturing"===a,r=function(t){var e;return null!=h&&0==--h&&r.destroy(),null!=(e=o.findClosestElementFromNode(t.target,{matchingSelector:d}))&&(null!=p&&p.call(e,t,e),u)?t.preventDefault():void 0},r.destroy=function(){return i.removeEventListener(e,r,f)},i.addEventListener(e,r,f),r},handleEventOnce:function(t,e){return null==e&&(e={}),e.times=1,o.handleEvent(t,e)},triggerEvent:function(e,n){var i,r,a,s,l,u,c;return u=(c=null!=n?n:{}).onElement,r=c.bubbles,a=c.cancelable,i=c.attributes,s=null!=u?u:t,r=!1!==r,a=!1!==a,(l=document.createEvent("Events")).initEvent(e,r,a),null!=i&&o.extend.call(l,i),s.dispatchEvent(l)},elementMatchesSelector:function(t,n){return 1===(null!=t?t.nodeType:void 0)?e.call(t,n):void 0},findClosestElementFromNode:function(t,e){var n,i,r;for(n=(i=null!=e?e:{}).matchingSelector,r=i.untilNode;null!=t&&t.nodeType!==Node.ELEMENT_NODE;)t=t.parentNode;if(null!=t){if(null==n)return t;if(t.closest&&null==r)return t.closest(n);for(;t&&t!==r;){if(o.elementMatchesSelector(t,n))return t;t=t.parentNode}}},findInnerElement:function(t){for(;null!=t?t.firstElementChild:void 0;)t=t.firstElementChild;return t},innerElementIsActive:function(t){return document.activeElement!==t&&o.elementContainsNode(t,document.activeElement)},elementContainsNode:function(t,e){if(t&&e)for(;e;){if(e===t)return!0;e=e.parentNode}},findNodeFromContainerAndOffset:function(t,e){var n;if(t)return t.nodeType===Node.TEXT_NODE?t:0===e?null!=(n=t.firstChild)?n:t:t.childNodes.item(e-1)},findElementFromContainerAndOffset:function(t,e){var n;return n=o.findNodeFromContainerAndOffset(t,e),o.findClosestElementFromNode(n)},findChildIndexOfNode:function(t){var e;if(null!=t?t.parentNode:void 0){for(e=0;t=t.previousSibling;)e++;return e}},removeNode:function(t){var e;return null!=t&&null!=(e=t.parentNode)?e.removeChild(t):void 0},walkTree:function(t,e){var n,i,r,o,a;return i=(r=null!=e?e:{}).onlyNodesOfType,o=r.usingFilter,n=r.expandEntityReferences,a=function(){switch(i){case"element":return NodeFilter.SHOW_ELEMENT;case"text":return NodeFilter.SHOW_TEXT;case"comment":return NodeFilter.SHOW_COMMENT;default:return NodeFilter.SHOW_ALL}}(),document.createTreeWalker(t,a,null!=o?o:null,!0===n)},tagName:function(t){var e;return null!=t&&null!=(e=t.tagName)?e.toLowerCase():void 0},makeElement:function(t,e){var n,i,r,o,a,s,l,u,c,d,h,f,p,g;if(null==e&&(e={}),"object"==typeof t?t=(e=t).tagName:e={attributes:e},r=document.createElement(t),null!=e.editable&&(null==e.attributes&&(e.attributes={}),e.attributes.contenteditable=e.editable),e.attributes)for(s in c=e.attributes)g=c[s],r.setAttribute(s,g);if(e.style)for(s in d=e.style)g=d[s],r.style[s]=g;if(e.data)for(s in h=e.data)g=h[s],r.dataset[s]=g;if(e.className)for(o=0,l=(f=e.className.split(" ")).length;l>o;o++)i=f[o],r.classList.add(i);if(e.textContent&&(r.textContent=e.textContent),e.childNodes)for(a=0,u=(p=[].concat(e.childNodes)).length;u>a;a++)n=p[a],r.appendChild(n);return r},getBlockTagNames:function(){var t,e;return null!=o.blockTagNames?o.blockTagNames:o.blockTagNames=function(){var n,i;for(t in i=[],n=o.config.blockAttributes)(e=n[t].tagName)&&i.push(e);return i}()},nodeIsBlockContainer:function(t){return o.nodeIsBlockStartComment(null!=t?t.firstChild:void 0)},nodeProbablyIsBlockContainer:function(t){var e,n;return e=o.tagName(t),a.call(o.getBlockTagNames(),e)>=0&&(n=o.tagName(t.firstChild),a.call(o.getBlockTagNames(),n)<0)},nodeIsBlockStart:function(t,e){return(null!=e?e:{strict:!0}).strict?o.nodeIsBlockStartComment(t):o.nodeIsBlockStartComment(t)||!o.nodeIsBlockStartComment(t.firstChild)&&o.nodeProbablyIsBlockContainer(t)},nodeIsBlockStartComment:function(t){return o.nodeIsCommentNode(t)&&"block"===(null!=t?t.data:void 0)},nodeIsCommentNode:function(t){return(null!=t?t.nodeType:void 0)===Node.COMMENT_NODE},nodeIsCursorTarget:function(t,e){var n;return n=(null!=e?e:{}).name,t?o.nodeIsTextNode(t)?t.data===o.ZERO_WIDTH_SPACE?!n||t.parentNode.dataset.trixCursorTarget===n:void 0:o.nodeIsCursorTarget(t.firstChild):void 0},nodeIsAttachmentElement:function(t){return o.elementMatchesSelector(t,o.AttachmentView.attachmentSelector)},nodeIsEmptyTextNode:function(t){return o.nodeIsTextNode(t)&&""===(null!=t?t.data:void 0)},nodeIsTextNode:function(t){return(null!=t?t.nodeType:void 0)===Node.TEXT_NODE}})}.call(this),function(){var t,e,n,i,r;t=o.copyObject,i=o.objectsAreEqual,o.extend({normalizeRange:n=function(t){var n;if(null!=t)return Array.isArray(t)||(t=[t,t]),[e(t[0]),e(null!=(n=t[1])?n:t[0])]},rangeIsCollapsed:function(t){var e,i,o;if(null!=t)return o=(i=n(t))[0],e=i[1],r(o,e)},rangesAreEqual:function(t,e){var i,o,a,s,l,u;if(null!=t&&null!=e)return o=(a=n(t))[0],i=a[1],u=(s=n(e))[0],l=s[1],r(o,u)&&r(i,l)}}),e=function(e){return"number"==typeof e?e:t(e)},r=function(t,e){return"number"==typeof t?t===e:i(t,e)}}.call(this),function(){var t,e,n,i,r,a,s;o.registerElement=function(t,e){var n,o;return null==e&&(e={}),t=t.toLowerCase(),e=s(e),(n=(o=a(e)).defaultCSS)&&(delete o.defaultCSS,i(n,t)),r(t,o)},i=function(t,e){return n(e).textContent=t.replace(/%t/g,e)},n=function(e){var n,i;return(n=document.createElement("style")).setAttribute("type","text/css"),n.setAttribute("data-tag-name",e.toLowerCase()),(i=t())&&n.setAttribute("nonce",i),document.head.insertBefore(n,document.head.firstChild),n},t=function(){var t;return(t=e("trix-csp-nonce")||e("csp-nonce"))?t.getAttribute("content"):void 0},e=function(t){return document.head.querySelector("meta[name="+t+"]")},a=function(t){var e,n,i;for(e in n={},t)i=t[e],n[e]="function"==typeof i?{value:i}:i;return n},s=function(){var t;return t=function(t){var e,n,i,r,o;for(e={},n=0,r=(o=["initialize","connect","disconnect"]).length;r>n;n++)e[i=o[n]]=t[i],delete t[i];return e},window.customElements?function(e){var n,i,r,o,a;return a=t(e),r=a.initialize,n=a.connect,i=a.disconnect,r&&(o=n,n=function(){return this.initialized||(this.initialized=!0,r.call(this)),null!=o?o.call(this):void 0}),n&&(e.connectedCallback=n),i&&(e.disconnectedCallback=i),e}:function(e){var n,i,r,o;return r=(o=t(e)).initialize,n=o.connect,i=o.disconnect,r&&(e.createdCallback=r),n&&(e.attachedCallback=n),i&&(e.detachedCallback=i),e}}(),r=window.customElements?function(t,e){var n;return n=function(){return"object"==typeof Reflect?Reflect.construct(HTMLElement,[],n):HTMLElement.apply(this)},Object.setPrototypeOf(n.prototype,HTMLElement.prototype),Object.setPrototypeOf(n,HTMLElement),Object.defineProperties(n.prototype,e),window.customElements.define(t,n),n}:function(t,e){var n,i;return i=Object.create(HTMLElement.prototype,e),n=document.registerElement(t,{prototype:i}),Object.defineProperty(i,"constructor",{value:n}),n}}.call(this),function(){var t,e;o.extend({getDOMSelection:function(){var t;return(t=window.getSelection()).rangeCount>0?t:void 0},getDOMRange:function(){var e,n;return(e=null!=(n=o.getDOMSelection())?n.getRangeAt(0):void 0)&&!t(e)?e:void 0},setDOMRange:function(t){var e;return(e=window.getSelection()).removeAllRanges(),e.addRange(t),o.selectionChangeObserver.update()}}),t=function(t){return e(t.startContainer)||e(t.endContainer)},e=function(t){return!Object.getPrototypeOf(t)}}.call(this),function(){var t;t={"application/x-trix-feature-detection":"test"},o.extend({dataTransferIsPlainText:function(t){var e,n,i;return i=t.getData("text/plain"),n=t.getData("text/html"),i&&n?(e=(new DOMParser).parseFromString(n,"text/html").body).textContent===i?!e.querySelector("*"):void 0:null!=i?i.length:void 0},dataTransferIsWritable:function(e){var n,i;if(null!=(null!=e?e.setData:void 0)){for(n in t)if(i=t[n],!function(){try{return e.setData(n,i),e.getData(n)===i}catch(t){}}())return;return!0}},keyEventIsKeyboardCommand:/Mac|^iP/.test(navigator.platform)?function(t){return t.metaKey}:function(t){return t.ctrlKey}})}.call(this),function(){o.extend({RTL_PATTERN:/[\u05BE\u05C0\u05C3\u05D0-\u05EA\u05F0-\u05F4\u061B\u061F\u0621-\u063A\u0640-\u064A\u066D\u0671-\u06B7\u06BA-\u06BE\u06C0-\u06CE\u06D0-\u06D5\u06E5\u06E6\u200F\u202B\u202E\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE72\uFE74\uFE76-\uFEFC]/,getDirection:function(){var t,e,n,i;return e=o.makeElement("input",{dir:"auto",name:"x",dirName:"x.dir"}),(t=o.makeElement("form")).appendChild(e),n=function(){try{return new FormData(t).has(e.dirName)}catch(t){}}(),i=function(){try{return e.matches(":dir(ltr),:dir(rtl)")}catch(t){}}(),n?function(n){return e.value=n,new FormData(t).get(e.dirName)}:i?function(t){return e.value=t,e.matches(":dir(rtl)")?"rtl":"ltr"}:function(t){var e;return e=t.trim().charAt(0),o.RTL_PATTERN.test(e)?"rtl":"ltr"}}()})}.call(this),function(){}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;t=o.arraysAreEqual,o.Hash=function(n){function i(t){null==t&&(t={}),this.values=a(t),i.__super__.constructor.apply(this,arguments)}var r,a,s,l,u;return e(i,n),i.fromCommonAttributesOfObjects=function(t){var e,n,i,o,a,s;if(null==t&&(t=[]),!t.length)return new this;for(i=(e=r(t[0])).getKeys(),n=0,o=(s=t.slice(1)).length;o>n;n++)a=s[n],i=e.getKeysCommonToHash(r(a)),e=e.slice(i);return e},i.box=function(t){return r(t)},i.prototype.add=function(t,e){return this.merge(l(t,e))},i.prototype.remove=function(t){return new o.Hash(a(this.values,t))},i.prototype.get=function(t){return this.values[t]},i.prototype.has=function(t){return t in this.values},i.prototype.merge=function(t){return new o.Hash(s(this.values,u(t)))},i.prototype.slice=function(t){var e,n,i,r;for(r={},e=0,i=t.length;i>e;e++)n=t[e],this.has(n)&&(r[n]=this.values[n]);return new o.Hash(r)},i.prototype.getKeys=function(){return Object.keys(this.values)},i.prototype.getKeysCommonToHash=function(t){var e,n,i,o,a;for(t=r(t),a=[],e=0,i=(o=this.getKeys()).length;i>e;e++)n=o[e],this.values[n]===t.values[n]&&a.push(n);return a},i.prototype.isEqualTo=function(e){return t(this.toArray(),r(e).toArray())},i.prototype.isEmpty=function(){return 0===this.getKeys().length},i.prototype.toArray=function(){var t,e,n;return(null!=this.array?this.array:this.array=function(){var i;for(t in e=[],i=this.values)n=i[t],e.push(t,n);return e}.call(this)).slice(0)},i.prototype.toObject=function(){return a(this.values)},i.prototype.toJSON=function(){return this.toObject()},i.prototype.contentsForInspection=function(){return{values:JSON.stringify(this.values)}},l=function(t,e){var n;return(n={})[t]=e,n},s=function(t,e){var n,i,r;for(n in i=a(t),e)r=e[n],i[n]=r;return i},a=function(t,e){var n,i,r,o,a;for(o={},n=0,r=(a=Object.keys(t).sort()).length;r>n;n++)(i=a[n])!==e&&(o[i]=t[i]);return o},r=function(t){return t instanceof o.Hash?t:new o.Hash(t)},u=function(t){return t instanceof o.Hash?t.values:t},i}(o.Object)}.call(this),function(){o.ObjectGroup=function(){function t(t,e){var n,i;this.objects=null!=t?t:[],i=e.depth,(n=e.asTree)&&(this.depth=i,this.objects=this.constructor.groupObjects(this.objects,{asTree:n,depth:this.depth+1}))}return t.groupObjects=function(t,e){var n,i,r,o,a,s,l,u,c;for(null==t&&(t=[]),r=(c=null!=e?e:{}).depth,(n=c.asTree)&&null==r&&(r=0),u=[],a=0,s=t.length;s>a;a++){if(l=t[a],o){if(("function"==typeof l.canBeGrouped?l.canBeGrouped(r):void 0)&&("function"==typeof(i=o[o.length-1]).canBeGroupedWith?i.canBeGroupedWith(l,r):void 0)){o.push(l);continue}u.push(new this(o,{depth:r,asTree:n})),o=null}("function"==typeof l.canBeGrouped?l.canBeGrouped(r):void 0)?o=[l]:u.push(l)}return o&&u.push(new this(o,{depth:r,asTree:n})),u},t.prototype.getObjects=function(){return this.objects},t.prototype.getDepth=function(){return this.depth},t.prototype.getCacheKey=function(){var t,e,n,i,r;for(e=["objectGroup"],t=0,n=(r=this.getObjects()).length;n>t;t++)i=r[t],e.push(i.getCacheKey());return e.join("/")},t}()}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;o.ObjectMap=function(e){function n(t){var e,n,i,r,o;for(null==t&&(t=[]),this.objects={},i=0,r=t.length;r>i;i++)o=t[i],n=JSON.stringify(o),null==(e=this.objects)[n]&&(e[n]=o)}return t(n,e),n.prototype.find=function(t){var e;return e=JSON.stringify(t),this.objects[e]},n}(o.BasicObject)}.call(this),function(){o.ElementStore=function(){function t(t){this.reset(t)}var e;return t.prototype.add=function(t){var n;return n=e(t),this.elements[n]=t},t.prototype.remove=function(t){var n,i;return n=e(t),(i=this.elements[n])?(delete this.elements[n],i):void 0},t.prototype.reset=function(t){var e,n,i;for(null==t&&(t=[]),this.elements={},n=0,i=t.length;i>n;n++)e=t[n],this.add(e);return t},e=function(t){return t.dataset.trixStoreKey},t}()}.call(this),function(){}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;o.Operation=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.isPerforming=function(){return!0===this.performing},n.prototype.hasPerformed=function(){return!0===this.performed},n.prototype.hasSucceeded=function(){return this.performed&&this.succeeded},n.prototype.hasFailed=function(){return this.performed&&!this.succeeded},n.prototype.getPromise=function(){return null!=this.promise?this.promise:this.promise=new Promise(function(t){return function(e,n){return t.performing=!0,t.perform((function(i,r){return t.succeeded=i,t.performing=!1,t.performed=!0,t.succeeded?e(r):n(r)}))}}(this))},n.prototype.perform=function(t){return t(!1)},n.prototype.release=function(){var t;return null!=(t=this.promise)&&"function"==typeof t.cancel&&t.cancel(),this.promise=null,this.performing=null,this.performed=null,this.succeeded=null},n.proxyMethod("getPromise().then"),n.proxyMethod("getPromise().catch"),n}(o.BasicObject)}.call(this),function(){var t,e,n,i,r,a={}.hasOwnProperty;o.UTF16String=function(t){function e(t,e){this.ucs2String=t,this.codepoints=e,this.length=this.codepoints.length,this.ucs2Length=this.ucs2String.length}return function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,t),e.box=function(t){return null==t&&(t=""),t instanceof this?t:this.fromUCS2String(null!=t?t.toString():void 0)},e.fromUCS2String=function(t){return new this(t,i(t))},e.fromCodepoints=function(t){return new this(r(t),t)},e.prototype.offsetToUCS2Offset=function(t){return r(this.codepoints.slice(0,Math.max(0,t))).length},e.prototype.offsetFromUCS2Offset=function(t){return i(this.ucs2String.slice(0,Math.max(0,t))).length},e.prototype.slice=function(){var t;return this.constructor.fromCodepoints((t=this.codepoints).slice.apply(t,arguments))},e.prototype.charAt=function(t){return this.slice(t,t+1)},e.prototype.isEqualTo=function(t){return this.constructor.box(t).ucs2String===this.ucs2String},e.prototype.toJSON=function(){return this.ucs2String},e.prototype.getCacheKey=function(){return this.ucs2String},e.prototype.toString=function(){return this.ucs2String},e}(o.BasicObject),t=1===("function"==typeof Array.from?Array.from("👼").length:void 0),e=null!=("function"==typeof" ".codePointAt?" ".codePointAt(0):void 0),n=" 👼"===("function"==typeof String.fromCodePoint?String.fromCodePoint(32,128124):void 0),i=t&&e?function(t){return Array.from(t).map((function(t){return t.codePointAt(0)}))}:function(t){var e,n,i,r,o;for(r=[],e=0,i=t.length;i>e;)(o=t.charCodeAt(e++))>=55296&&56319>=o&&i>e&&(56320==(64512&(n=t.charCodeAt(e++)))?o=((1023&o)<<10)+(1023&n)+65536:e--),r.push(o);return r},r=n?function(t){return String.fromCodePoint.apply(String,t)}:function(t){var e,n,i;return e=function(){var e,r,o;for(o=[],e=0,r=t.length;r>e;e++)i=t[e],n="",i>65535&&(i-=65536,n+=String.fromCharCode(i>>>10&1023|55296),i=56320|1023&i),o.push(n+String.fromCharCode(i));return o}(),e.join("")}}.call(this),function(){}.call(this),function(){}.call(this),function(){o.config.lang={attachFiles:"Attach Files",bold:"Bold",bullets:"Bullets",byte:"Byte",bytes:"Bytes",captionPlaceholder:"Add a caption…",code:"Code",heading1:"Heading",indent:"Increase Level",italic:"Italic",link:"Link",numbers:"Numbers",outdent:"Decrease Level",quote:"Quote",redo:"Redo",remove:"Remove",strike:"Strikethrough",undo:"Undo",unlink:"Unlink",url:"URL",urlPlaceholder:"Enter a URL…",GB:"GB",KB:"KB",MB:"MB",PB:"PB",TB:"TB"}}.call(this),function(){o.config.css={attachment:"attachment",attachmentCaption:"attachment__caption",attachmentCaptionEditor:"attachment__caption-editor",attachmentMetadata:"attachment__metadata",attachmentMetadataContainer:"attachment__metadata-container",attachmentName:"attachment__name",attachmentProgress:"attachment__progress",attachmentSize:"attachment__size",attachmentToolbar:"attachment__toolbar",attachmentGallery:"attachment-gallery"}}.call(this),function(){var t;o.config.blockAttributes=t={default:{tagName:"div",parse:!1},quote:{tagName:"blockquote",nestable:!0},heading1:{tagName:"h1",terminal:!0,breakOnReturn:!0,group:!1},code:{tagName:"pre",terminal:!0,text:{plaintext:!0}},bulletList:{tagName:"ul",parse:!1},bullet:{tagName:"li",listAttribute:"bulletList",group:!1,nestable:!0,test:function(e){return o.tagName(e.parentNode)===t[this.listAttribute].tagName}},numberList:{tagName:"ol",parse:!1},number:{tagName:"li",listAttribute:"numberList",group:!1,nestable:!0,test:function(e){return o.tagName(e.parentNode)===t[this.listAttribute].tagName}},attachmentGallery:{tagName:"div",exclusive:!0,terminal:!0,parse:!1,group:!1}}}.call(this),function(){var t,e;t=o.config.lang,e=[t.bytes,t.KB,t.MB,t.GB,t.TB,t.PB],o.config.fileSize={prefix:"IEC",precision:2,formatter:function(n){var i,r;switch(n){case 0:return"0 "+t.bytes;case 1:return"1 "+t.byte;default:return i=function(){switch(this.prefix){case"SI":return 1e3;case"IEC":return 1024}}.call(this),r=Math.floor(Math.log(n)/Math.log(i)),(n/Math.pow(i,r)).toFixed(this.precision).replace(/0*$/,"").replace(/\.$/,"")+" "+e[r]}}}}.call(this),function(){o.config.textAttributes={bold:{tagName:"strong",inheritable:!0,parser:function(t){var e;return"bold"===(e=window.getComputedStyle(t)).fontWeight||e.fontWeight>=600}},italic:{tagName:"em",inheritable:!0,parser:function(t){return"italic"===window.getComputedStyle(t).fontStyle}},href:{groupTagName:"a",parser:function(t){var e,n;return n="a:not("+o.AttachmentView.attachmentSelector+")",(e=o.findClosestElementFromNode(t,{matchingSelector:n}))?e.getAttribute("href"):void 0}},strike:{tagName:"del",inheritable:!0},frozen:{style:{backgroundColor:"highlight"}}}}.call(this),function(){var t,e,n,i;i=["contenteditable","data-trix-id","data-trix-store-key","data-trix-mutable","data-trix-placeholder","tabindex"],n="["+(e="data-trix-serialized-attributes")+"]",t=new RegExp("\x3c!--block--\x3e","g"),o.extend({serializers:{"application/json":function(t){var e;if(t instanceof o.Document)e=t;else{if(!(t instanceof HTMLElement))throw new Error("unserializable object");e=o.Document.fromHTML(t.innerHTML)}return e.toSerializableDocument().toJSONString()},"text/html":function(r){var a,s,l,u,c,d,h,f,p,g,m,v,y,b,E,T,A;if(r instanceof o.Document)u=o.DocumentView.render(r);else{if(!(r instanceof HTMLElement))throw new Error("unserializable object");u=r.cloneNode(!0)}for(c=0,p=(b=u.querySelectorAll("[data-trix-serialize=false]")).length;p>c;c++)l=b[c],o.removeNode(l);for(d=0,g=i.length;g>d;d++)for(a=i[d],h=0,m=(E=u.querySelectorAll("["+a+"]")).length;m>h;h++)(l=E[h]).removeAttribute(a);for(f=0,v=(T=u.querySelectorAll(n)).length;v>f;f++){l=T[f];try{for(y in s=JSON.parse(l.getAttribute(e)),l.removeAttribute(e),s)A=s[y],l.setAttribute(y,A)}catch(t){}}return u.innerHTML.replace(t,"")}},deserializers:{"application/json":function(t){return o.Document.fromJSONString(t)},"text/html":function(t){return o.Document.fromHTML(t)}},serializeToContentType:function(t,e){var n;if(n=o.serializers[e])return n(t);throw new Error("unknown content type: "+e)},deserializeFromContentType:function(t,e){var n;if(n=o.deserializers[e])return n(t);throw new Error("unknown content type: "+e)}})}.call(this),function(){var t;t=o.config.lang,o.config.toolbar={getDefaultHTML:function(){return'<div class="trix-button-row">\n  <span class="trix-button-group trix-button-group--text-tools" data-trix-button-group="text-tools">\n    <button type="button" class="trix-button trix-button--icon trix-button--icon-bold" data-trix-attribute="bold" data-trix-key="b" title="'+t.bold+'" tabindex="-1">'+t.bold+'</button>\n    <button type="button" class="trix-button trix-button--icon trix-button--icon-italic" data-trix-attribute="italic" data-trix-key="i" title="'+t.italic+'" tabindex="-1">'+t.italic+'</button>\n    <button type="button" class="trix-button trix-button--icon trix-button--icon-strike" data-trix-attribute="strike" title="'+t.strike+'" tabindex="-1">'+t.strike+'</button>\n    <button type="button" class="trix-button trix-button--icon trix-button--icon-link" data-trix-attribute="href" data-trix-action="link" data-trix-key="k" title="'+t.link+'" tabindex="-1">'+t.link+'</button>\n  </span>\n\n  <span class="trix-button-group trix-button-group--block-tools" data-trix-button-group="block-tools">\n    <button type="button" class="trix-button trix-button--icon trix-button--icon-heading-1" data-trix-attribute="heading1" title="'+t.heading1+'" tabindex="-1">'+t.heading1+'</button>\n    <button type="button" class="trix-button trix-button--icon trix-button--icon-quote" data-trix-attribute="quote" title="'+t.quote+'" tabindex="-1">'+t.quote+'</button>\n    <button type="button" class="trix-button trix-button--icon trix-button--icon-code" data-trix-attribute="code" title="'+t.code+'" tabindex="-1">'+t.code+'</button>\n    <button type="button" class="trix-button trix-button--icon trix-button--icon-bullet-list" data-trix-attribute="bullet" title="'+t.bullets+'" tabindex="-1">'+t.bullets+'</button>\n    <button type="button" class="trix-button trix-button--icon trix-button--icon-number-list" data-trix-attribute="number" title="'+t.numbers+'" tabindex="-1">'+t.numbers+'</button>\n    <button type="button" class="trix-button trix-button--icon trix-button--icon-decrease-nesting-level" data-trix-action="decreaseNestingLevel" title="'+t.outdent+'" tabindex="-1">'+t.outdent+'</button>\n    <button type="button" class="trix-button trix-button--icon trix-button--icon-increase-nesting-level" data-trix-action="increaseNestingLevel" title="'+t.indent+'" tabindex="-1">'+t.indent+'</button>\n  </span>\n\n  <span class="trix-button-group trix-button-group--file-tools" data-trix-button-group="file-tools">\n    <button type="button" class="trix-button trix-button--icon trix-button--icon-attach" data-trix-action="attachFiles" title="'+t.attachFiles+'" tabindex="-1">'+t.attachFiles+'</button>\n  </span>\n\n  <span class="trix-button-group-spacer"></span>\n\n  <span class="trix-button-group trix-button-group--history-tools" data-trix-button-group="history-tools">\n    <button type="button" class="trix-button trix-button--icon trix-button--icon-undo" data-trix-action="undo" data-trix-key="z" title="'+t.undo+'" tabindex="-1">'+t.undo+'</button>\n    <button type="button" class="trix-button trix-button--icon trix-button--icon-redo" data-trix-action="redo" data-trix-key="shift+z" title="'+t.redo+'" tabindex="-1">'+t.redo+'</button>\n  </span>\n</div>\n\n<div class="trix-dialogs" data-trix-dialogs>\n  <div class="trix-dialog trix-dialog--link" data-trix-dialog="href" data-trix-dialog-attribute="href">\n    <div class="trix-dialog__link-fields">\n      <input type="url" name="href" class="trix-input trix-input--dialog" placeholder="'+t.urlPlaceholder+'" aria-label="'+t.url+'" required data-trix-input>\n      <div class="trix-button-group">\n        <input type="button" class="trix-button trix-button--dialog" value="'+t.link+'" data-trix-method="setAttribute">\n        <input type="button" class="trix-button trix-button--dialog" value="'+t.unlink+'" data-trix-method="removeAttribute">\n      </div>\n    </div>\n  </div>\n</div>'}}}.call(this),function(){o.config.undoInterval=5e3}.call(this),function(){o.config.attachments={preview:{presentation:"gallery",caption:{name:!0,size:!0}},file:{caption:{size:!0}}}}.call(this),function(){o.config.keyNames={8:"backspace",9:"tab",13:"return",27:"escape",37:"left",39:"right",46:"delete",68:"d",72:"h",79:"o"}}.call(this),function(){o.config.input={level2Enabled:!0,getLevel:function(){return this.level2Enabled&&o.browser.supportsInputEvents?2:0},pickFiles:function(t){var e;return(e=o.makeElement("input",{type:"file",multiple:!0,hidden:!0,id:this.fileInputId})).addEventListener("change",(function(){return t(e.files),o.removeNode(e)})),o.removeNode(document.getElementById(this.fileInputId)),document.body.appendChild(e),e.click()},fileInputId:"trix-file-input-"+Date.now().toString(16)}}.call(this),function(){}.call(this),function(){o.registerElement("trix-toolbar",{defaultCSS:"%t {\n  display: block;\n}\n\n%t {\n  white-space: nowrap;\n}\n\n%t [data-trix-dialog] {\n  display: none;\n}\n\n%t [data-trix-dialog][data-trix-active] {\n  display: block;\n}\n\n%t [data-trix-dialog] [data-trix-validate]:invalid {\n  background-color: #ffdddd;\n}",initialize:function(){return""===this.innerHTML?this.innerHTML=o.config.toolbar.getDefaultHTML():void 0}})}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty,n=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};o.ObjectView=function(e){function i(t,e){this.object=t,this.options=null!=e?e:{},this.childViews=[],this.rootView=this}return t(i,e),i.prototype.getNodes=function(){var t,e,n,i,r;for(null==this.nodes&&(this.nodes=this.createNodes()),r=[],t=0,e=(i=this.nodes).length;e>t;t++)n=i[t],r.push(n.cloneNode(!0));return r},i.prototype.invalidate=function(){var t;return this.nodes=null,this.childViews=[],null!=(t=this.parentView)?t.invalidate():void 0},i.prototype.invalidateViewForObject=function(t){var e;return null!=(e=this.findViewForObject(t))?e.invalidate():void 0},i.prototype.findOrCreateCachedChildView=function(t,e){var n;return(n=this.getCachedViewForObject(e))?this.recordChildView(n):(n=this.createChildView.apply(this,arguments),this.cacheViewForObject(n,e)),n},i.prototype.createChildView=function(t,e,n){var i;return null==n&&(n={}),e instanceof o.ObjectGroup&&(n.viewClass=t,t=o.ObjectGroupView),i=new t(e,n),this.recordChildView(i)},i.prototype.recordChildView=function(t){return t.parentView=this,t.rootView=this.rootView,this.childViews.push(t),t},i.prototype.getAllChildViews=function(){var t,e,n,i,r;for(r=[],e=0,n=(i=this.childViews).length;n>e;e++)t=i[e],r.push(t),r=r.concat(t.getAllChildViews());return r},i.prototype.findElement=function(){return this.findElementForObject(this.object)},i.prototype.findElementForObject=function(t){var e;return(e=null!=t?t.id:void 0)?this.rootView.element.querySelector("[data-trix-id='"+e+"']"):void 0},i.prototype.findViewForObject=function(t){var e,n,i,r;for(e=0,n=(i=this.getAllChildViews()).length;n>e;e++)if((r=i[e]).object===t)return r},i.prototype.getViewCache=function(){return this.rootView!==this?this.rootView.getViewCache():this.isViewCachingEnabled()?null!=this.viewCache?this.viewCache:this.viewCache={}:void 0},i.prototype.isViewCachingEnabled=function(){return!1!==this.shouldCacheViews},i.prototype.enableViewCaching=function(){return this.shouldCacheViews=!0},i.prototype.disableViewCaching=function(){return this.shouldCacheViews=!1},i.prototype.getCachedViewForObject=function(t){var e;return null!=(e=this.getViewCache())?e[t.getCacheKey()]:void 0},i.prototype.cacheViewForObject=function(t,e){var n;return null!=(n=this.getViewCache())?n[e.getCacheKey()]=t:void 0},i.prototype.garbageCollectCachedViews=function(){var t,e,i,r,o,a;if(t=this.getViewCache()){for(e in a=this.getAllChildViews().concat(this),i=function(){var t,e,n;for(n=[],t=0,e=a.length;e>t;t++)o=a[t],n.push(o.object.getCacheKey());return n}(),r=[],t)n.call(i,e)<0&&r.push(delete t[e]);return r}},i}(o.BasicObject)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;o.ObjectGroupView=function(e){function n(){n.__super__.constructor.apply(this,arguments),this.objectGroup=this.object,this.viewClass=this.options.viewClass,delete this.options.viewClass}return t(n,e),n.prototype.getChildViews=function(){var t,e,n,i;if(!this.childViews.length)for(t=0,e=(i=this.objectGroup.getObjects()).length;e>t;t++)n=i[t],this.findOrCreateCachedChildView(this.viewClass,n,this.options);return this.childViews},n.prototype.createNodes=function(){var t,e,n,i,r,o,a,s;for(t=this.createContainerElement(),e=0,i=(a=this.getChildViews()).length;i>e;e++)for(n=0,r=(s=a[e].getNodes()).length;r>n;n++)o=s[n],t.appendChild(o);return[t]},n.prototype.createContainerElement=function(t){return null==t&&(t=this.objectGroup.getDepth()),this.getChildViews()[0].createContainerElement(t)},n}(o.ObjectView)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;o.Controller=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n}(o.BasicObject)}.call(this),function(){var t,e,n,i,r,a,s=function(t,e){function n(){this.constructor=t}for(var i in e)l.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty,u=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};t=o.findClosestElementFromNode,n=o.nodeIsEmptyTextNode,e=o.nodeIsBlockStartComment,i=o.normalizeSpaces,r=o.summarizeStringChange,a=o.tagName,o.MutationObserver=function(o){function l(t){this.element=t,this.didMutate=function(t,e){return function(){return t.apply(e,arguments)}}(this.didMutate,this),this.observer=new window.MutationObserver(this.didMutate),this.start()}var c,d,h,f;return s(l,o),h="["+(d="data-trix-mutable")+"]",f={attributes:!0,childList:!0,characterData:!0,characterDataOldValue:!0,subtree:!0},l.prototype.start=function(){return this.reset(),this.observer.observe(this.element,f)},l.prototype.stop=function(){return this.observer.disconnect()},l.prototype.didMutate=function(t){var e,n;return(e=this.mutations).push.apply(e,this.findSignificantMutations(t)),this.mutations.length?(null!=(n=this.delegate)&&"function"==typeof n.elementDidMutate&&n.elementDidMutate(this.getMutationSummary()),this.reset()):void 0},l.prototype.reset=function(){return this.mutations=[]},l.prototype.findSignificantMutations=function(t){var e,n,i,r;for(r=[],e=0,n=t.length;n>e;e++)i=t[e],this.mutationIsSignificant(i)&&r.push(i);return r},l.prototype.mutationIsSignificant=function(t){var e,n,i,r;if(this.nodeIsMutable(t.target))return!1;for(e=0,n=(r=this.nodesModifiedByMutation(t)).length;n>e;e++)if(i=r[e],this.nodeIsSignificant(i))return!0;return!1},l.prototype.nodeIsSignificant=function(t){return t!==this.element&&!this.nodeIsMutable(t)&&!n(t)},l.prototype.nodeIsMutable=function(e){return t(e,{matchingSelector:h})},l.prototype.nodesModifiedByMutation=function(t){var e;switch(e=[],t.type){case"attributes":t.attributeName!==d&&e.push(t.target);break;case"characterData":e.push(t.target.parentNode),e.push(t.target);break;case"childList":e.push.apply(e,t.addedNodes),e.push.apply(e,t.removedNodes)}return e},l.prototype.getMutationSummary=function(){return this.getTextMutationSummary()},l.prototype.getTextMutationSummary=function(){var t,e,n,i,r,o,a,s,l,c,d;for(n=(s=this.getTextChangesFromCharacterData()).additions,r=s.deletions,o=0,a=(l=(d=this.getTextChangesFromChildList()).additions).length;a>o;o++)e=l[o],u.call(n,e)<0&&n.push(e);return r.push.apply(r,d.deletions),c={},(t=n.join(""))&&(c.textAdded=t),(i=r.join(""))&&(c.textDeleted=i),c},l.prototype.getMutationsByType=function(t){var e,n,i,r,o;for(o=[],e=0,n=(r=this.mutations).length;n>e;e++)(i=r[e]).type===t&&o.push(i);return o},l.prototype.getTextChangesFromChildList=function(){var t,n,r,o,a,s,l,u,d,h;for(t=[],l=[],n=0,o=(s=this.getMutationsByType("childList")).length;o>n;n++)a=s[n],t.push.apply(t,a.addedNodes),l.push.apply(l,a.removedNodes);return 0===t.length&&1===l.length&&e(l[0])?(d=[],h=["\n"]):(d=c(t),h=c(l)),{additions:function(){var t,e,n;for(n=[],r=t=0,e=d.length;e>t;r=++t)(u=d[r])!==h[r]&&n.push(i(u));return n}(),deletions:function(){var t,e,n;for(n=[],r=t=0,e=h.length;e>t;r=++t)(u=h[r])!==d[r]&&n.push(i(u));return n}()}},l.prototype.getTextChangesFromCharacterData=function(){var t,e,n,o,a,s,l,u;return(e=this.getMutationsByType("characterData")).length&&(u=e[0],n=e[e.length-1],a=i(u.oldValue),o=i(n.target.data),t=(s=r(a,o)).added,l=s.removed),{additions:t?[t]:[],deletions:l?[l]:[]}},c=function(t){var e,n,i,r;for(null==t&&(t=[]),r=[],e=0,n=t.length;n>e;e++)switch(i=t[e],i.nodeType){case Node.TEXT_NODE:r.push(i.data);break;case Node.ELEMENT_NODE:"br"===a(i)?r.push("\n"):r.push.apply(r,c(i.childNodes))}return r},l}(o.BasicObject)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;o.FileVerificationOperation=function(e){function n(t){this.file=t}return t(n,e),n.prototype.perform=function(t){var e;return(e=new FileReader).onerror=function(){return t(!1)},e.onload=function(n){return function(){e.onerror=null;try{e.abort()}catch(t){}return t(!0,n.file)}}(this),e.readAsArrayBuffer(this.file)},n}(o.Operation)}.call(this),function(){var t,e,n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;t=o.handleEvent,e=o.innerElementIsActive,o.InputController=function(i){function r(e){var n;for(n in this.element=e,this.mutationObserver=new o.MutationObserver(this.element),this.mutationObserver.delegate=this,this.events)t(n,{onElement:this.element,withCallback:this.handlerFor(n)})}return n(r,i),r.prototype.events={},r.prototype.elementDidMutate=function(){},r.prototype.editorWillSyncDocumentView=function(){return this.mutationObserver.stop()},r.prototype.editorDidSyncDocumentView=function(){return this.mutationObserver.start()},r.prototype.requestRender=function(){var t;return null!=(t=this.delegate)&&"function"==typeof t.inputControllerDidRequestRender?t.inputControllerDidRequestRender():void 0},r.prototype.requestReparse=function(){var t;return null!=(t=this.delegate)&&"function"==typeof t.inputControllerDidRequestReparse&&t.inputControllerDidRequestReparse(),this.requestRender()},r.prototype.attachFiles=function(t){var e,n;return n=function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(new o.FileVerificationOperation(e));return r}(),Promise.all(n).then(function(t){return function(e){return t.handleInput((function(){var t,n;return null!=(t=this.delegate)&&t.inputControllerWillAttachFiles(),null!=(n=this.responder)&&n.insertFiles(e),this.requestRender()}))}}(this))},r.prototype.handlerFor=function(t){return function(n){return function(i){return i.defaultPrevented?void 0:n.handleInput((function(){return e(this.element)?void 0:(this.eventName=t,this.events[t].call(this,i))}))}}(this)},r.prototype.handleInput=function(t){var e,n;try{return null!=(e=this.delegate)&&e.inputControllerWillHandleInput(),t.call(this)}finally{null!=(n=this.delegate)&&n.inputControllerDidHandleInput()}},r.prototype.createLinkHTML=function(t,e){var n;return(n=document.createElement("a")).href=t,n.textContent=null!=e?e:t,n.outerHTML},r}(o.BasicObject)}.call(this),function(){var t,e,n,i,r,a,s,l,u,c,d,h,f=function(t,e){function n(){this.constructor=t}for(var i in e)p.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty,g=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};u=o.makeElement,c=o.objectsAreEqual,o.tagName,e=o.browser,s=o.keyEventIsKeyboardCommand,i=o.dataTransferIsWritable,n=o.dataTransferIsPlainText,l=o.config.keyNames,o.Level0InputController=function(e){function a(){a.__super__.constructor.apply(this,arguments),this.resetInputSummary()}var p;return f(a,e),p=0,a.prototype.setInputSummary=function(t){var e,n;for(e in null==t&&(t={}),this.inputSummary.eventName=this.eventName,t)n=t[e],this.inputSummary[e]=n;return this.inputSummary},a.prototype.resetInputSummary=function(){return this.inputSummary={}},a.prototype.reset=function(){return this.resetInputSummary(),o.selectionChangeObserver.reset()},a.prototype.elementDidMutate=function(t){var e;return this.isComposing()?null!=(e=this.delegate)&&"function"==typeof e.inputControllerDidAllowUnhandledInput?e.inputControllerDidAllowUnhandledInput():void 0:this.handleInput((function(){return this.mutationIsSignificant(t)&&(this.mutationIsExpected(t)?this.requestRender():this.requestReparse()),this.reset()}))},a.prototype.mutationIsExpected=function(t){var e,n,i,r,o,a,s,l,u;return a=t.textAdded,s=t.textDeleted,!!this.inputSummary.preferDocument||(e=null!=a?a===this.inputSummary.textAdded:!this.inputSummary.textAdded,n=null!=s?this.inputSummary.didDelete:!this.inputSummary.didDelete,u="\n"===s&&!n,!!(((l=("\n"===a||" \n"===a)&&!e)&&!u||u&&!l)&&(r=this.getSelectedRange())&&(i=l?a.replace(/\n$/,"").length||-1:(null!=a?a.length:void 0)||1,null!=(o=this.responder)?o.positionIsBlockBreak(r[1]+i):void 0))||e&&n)},a.prototype.mutationIsSignificant=function(t){var e,n,i;return i=Object.keys(t).length>0,e=""===(null!=(n=this.compositionInput)?n.getEndData():void 0),i||!e},a.prototype.events={keydown:function(t){var e,n,i,r,a,u,c,d,h;if(this.isComposing()||this.resetInputSummary(),this.inputSummary.didInput=!0,r=l[t.keyCode]){for(n=this.keys,i=0,u=(d=["ctrl","alt","shift","meta"]).length;u>i;i++)t[(c=d[i])+"Key"]&&("ctrl"===c&&(c="control"),n=null!=n?n[c]:void 0);null!=(null!=n?n[r]:void 0)&&(this.setInputSummary({keyName:r}),o.selectionChangeObserver.reset(),n[r].call(this,t))}return s(t)&&(e=String.fromCharCode(t.keyCode).toLowerCase())&&(a=function(){var e,n,i,r;for(r=[],e=0,n=(i=["alt","shift"]).length;n>e;e++)t[(c=i[e])+"Key"]&&r.push(c);return r}(),a.push(e),null!=(h=this.delegate)?h.inputControllerDidReceiveKeyboardCommand(a):void 0)?t.preventDefault():void 0},keypress:function(t){var e,n,i;if(null==this.inputSummary.eventName&&!t.metaKey&&(!t.ctrlKey||t.altKey))return(i=h(t))?(null!=(e=this.delegate)&&e.inputControllerWillPerformTyping(),null!=(n=this.responder)&&n.insertString(i),this.setInputSummary({textAdded:i,didDelete:this.selectionIsExpanded()})):void 0},textInput:function(t){var e,n,i,r;return e=t.data,(r=this.inputSummary.textAdded)&&r!==e&&r.toUpperCase()===e?(n=this.getSelectedRange(),this.setSelectedRange([n[0],n[1]+r.length]),null!=(i=this.responder)&&i.insertString(e),this.setInputSummary({textAdded:e}),this.setSelectedRange(n)):void 0},dragenter:function(t){return t.preventDefault()},dragstart:function(t){var e;return t.target,this.serializeSelectionToDataTransfer(t.dataTransfer),this.draggedRange=this.getSelectedRange(),null!=(e=this.delegate)&&"function"==typeof e.inputControllerDidStartDrag?e.inputControllerDidStartDrag():void 0},dragover:function(t){var e,n;return!this.draggedRange&&!this.canAcceptDataTransfer(t.dataTransfer)||(t.preventDefault(),e={x:t.clientX,y:t.clientY},c(e,this.draggingPoint))?void 0:(this.draggingPoint=e,null!=(n=this.delegate)&&"function"==typeof n.inputControllerDidReceiveDragOverPoint?n.inputControllerDidReceiveDragOverPoint(this.draggingPoint):void 0)},dragend:function(){var t;return null!=(t=this.delegate)&&"function"==typeof t.inputControllerDidCancelDrag&&t.inputControllerDidCancelDrag(),this.draggedRange=null,this.draggingPoint=null},drop:function(t){var e,n,i,r,a,s,l,u,c;return t.preventDefault(),i=null!=(a=t.dataTransfer)?a.files:void 0,r={x:t.clientX,y:t.clientY},null!=(s=this.responder)&&s.setLocationRangeFromPointRange(r),(null!=i?i.length:void 0)?this.attachFiles(i):this.draggedRange?(null!=(l=this.delegate)&&l.inputControllerWillMoveText(),null!=(u=this.responder)&&u.moveTextFromRange(this.draggedRange),this.draggedRange=null,this.requestRender()):(n=t.dataTransfer.getData("application/x-trix-document"))&&(e=o.Document.fromJSONString(n),null!=(c=this.responder)&&c.insertDocument(e),this.requestRender()),this.draggedRange=null,this.draggingPoint=null},cut:function(t){var e,n;return(null!=(e=this.responder)?e.selectionIsExpanded():void 0)&&(this.serializeSelectionToDataTransfer(t.clipboardData)&&t.preventDefault(),null!=(n=this.delegate)&&n.inputControllerWillCutText(),this.deleteInDirection("backward"),t.defaultPrevented)?this.requestRender():void 0},copy:function(t){var e;return(null!=(e=this.responder)?e.selectionIsExpanded():void 0)&&this.serializeSelectionToDataTransfer(t.clipboardData)?t.preventDefault():void 0},paste:function(t){var e,i,a,s,l,u,c,h,f,m,v,y,b,E,T,A,S,w,L,x,D,R,_;return e=null!=(h=t.clipboardData)?h:t.testClipboardData,c={clipboard:e},null==e||d(t)?void this.getPastedHTMLUsingHiddenElement(function(t){return function(e){var n,i,r;return c.type="text/html",c.html=e,null!=(n=t.delegate)&&n.inputControllerWillPaste(c),null!=(i=t.responder)&&i.insertHTML(c.html),t.requestRender(),null!=(r=t.delegate)?r.inputControllerDidPaste(c):void 0}}(this)):((s=e.getData("URL"))?(c.type="text/html",_=(u=e.getData("public.url-name"))?o.squishBreakableWhitespace(u).trim():s,c.html=this.createLinkHTML(s,_),null!=(f=this.delegate)&&f.inputControllerWillPaste(c),this.setInputSummary({textAdded:_,didDelete:this.selectionIsExpanded()}),null!=(T=this.responder)&&T.insertHTML(c.html),this.requestRender(),null!=(A=this.delegate)&&A.inputControllerDidPaste(c)):n(e)?(c.type="text/plain",c.string=e.getData("text/plain"),null!=(S=this.delegate)&&S.inputControllerWillPaste(c),this.setInputSummary({textAdded:c.string,didDelete:this.selectionIsExpanded()}),null!=(w=this.responder)&&w.insertString(c.string),this.requestRender(),null!=(L=this.delegate)&&L.inputControllerDidPaste(c)):(l=e.getData("text/html"))?(c.type="text/html",c.html=l,null!=(x=this.delegate)&&x.inputControllerWillPaste(c),null!=(D=this.responder)&&D.insertHTML(c.html),this.requestRender(),null!=(R=this.delegate)&&R.inputControllerDidPaste(c)):g.call(e.types,"Files")>=0&&(a=null!=(m=e.items)&&null!=(v=m[0])&&"function"==typeof v.getAsFile?v.getAsFile():void 0)&&(!a.name&&(i=r(a))&&(a.name="pasted-file-"+ ++p+"."+i),c.type="File",c.file=a,null!=(y=this.delegate)&&y.inputControllerWillAttachFiles(),null!=(b=this.responder)&&b.insertFile(c.file),this.requestRender(),null!=(E=this.delegate)&&E.inputControllerDidPaste(c)),t.preventDefault())},compositionstart:function(t){return this.getCompositionInput().start(t.data)},compositionupdate:function(t){return this.getCompositionInput().update(t.data)},compositionend:function(t){return this.getCompositionInput().end(t.data)},beforeinput:function(){return this.inputSummary.didInput=!0},input:function(t){return this.inputSummary.didInput=!0,t.stopPropagation()}},a.prototype.keys={backspace:function(t){var e;return null!=(e=this.delegate)&&e.inputControllerWillPerformTyping(),this.deleteInDirection("backward",t)},delete:function(t){var e;return null!=(e=this.delegate)&&e.inputControllerWillPerformTyping(),this.deleteInDirection("forward",t)},return:function(){var t,e;return this.setInputSummary({preferDocument:!0}),null!=(t=this.delegate)&&t.inputControllerWillPerformTyping(),null!=(e=this.responder)?e.insertLineBreak():void 0},tab:function(t){var e,n;return(null!=(e=this.responder)?e.canIncreaseNestingLevel():void 0)?(null!=(n=this.responder)&&n.increaseNestingLevel(),this.requestRender(),t.preventDefault()):void 0},left:function(t){var e;return this.selectionIsInCursorTarget()?(t.preventDefault(),null!=(e=this.responder)?e.moveCursorInDirection("backward"):void 0):void 0},right:function(t){var e;return this.selectionIsInCursorTarget()?(t.preventDefault(),null!=(e=this.responder)?e.moveCursorInDirection("forward"):void 0):void 0},control:{d:function(t){var e;return null!=(e=this.delegate)&&e.inputControllerWillPerformTyping(),this.deleteInDirection("forward",t)},h:function(t){var e;return null!=(e=this.delegate)&&e.inputControllerWillPerformTyping(),this.deleteInDirection("backward",t)},o:function(t){var e,n;return t.preventDefault(),null!=(e=this.delegate)&&e.inputControllerWillPerformTyping(),null!=(n=this.responder)&&n.insertString("\n",{updatePosition:!1}),this.requestRender()}},shift:{return:function(t){var e,n;return null!=(e=this.delegate)&&e.inputControllerWillPerformTyping(),null!=(n=this.responder)&&n.insertString("\n"),this.requestRender(),t.preventDefault()},tab:function(t){var e,n;return(null!=(e=this.responder)?e.canDecreaseNestingLevel():void 0)?(null!=(n=this.responder)&&n.decreaseNestingLevel(),this.requestRender(),t.preventDefault()):void 0},left:function(t){return this.selectionIsInCursorTarget()?(t.preventDefault(),this.expandSelectionInDirection("backward")):void 0},right:function(t){return this.selectionIsInCursorTarget()?(t.preventDefault(),this.expandSelectionInDirection("forward")):void 0}},alt:{backspace:function(){var t;return this.setInputSummary({preferDocument:!1}),null!=(t=this.delegate)?t.inputControllerWillPerformTyping():void 0}},meta:{backspace:function(){var t;return this.setInputSummary({preferDocument:!1}),null!=(t=this.delegate)?t.inputControllerWillPerformTyping():void 0}}},a.prototype.getCompositionInput=function(){return this.isComposing()?this.compositionInput:this.compositionInput=new t(this)},a.prototype.isComposing=function(){return null!=this.compositionInput&&!this.compositionInput.isEnded()},a.prototype.deleteInDirection=function(t,e){var n;return!1!==(null!=(n=this.responder)?n.deleteInDirection(t):void 0)?this.setInputSummary({didDelete:!0}):e?(e.preventDefault(),this.requestRender()):void 0},a.prototype.serializeSelectionToDataTransfer=function(t){var e,n;if(i(t))return e=null!=(n=this.responder)?n.getSelectedDocument().toSerializableDocument():void 0,t.setData("application/x-trix-document",JSON.stringify(e)),t.setData("text/html",o.DocumentView.render(e).innerHTML),t.setData("text/plain",e.toString().replace(/\n$/,"")),!0},a.prototype.canAcceptDataTransfer=function(t){var e,n,i,r,o;for(o={},e=0,n=(r=null!=(i=null!=t?t.types:void 0)?i:[]).length;n>e;e++)o[r[e]]=!0;return o.Files||o["application/x-trix-document"]||o["text/html"]||o["text/plain"]},a.prototype.getPastedHTMLUsingHiddenElement=function(t){var e,n,i;return n=this.getSelectedRange(),i={position:"absolute",left:window.pageXOffset+"px",top:window.pageYOffset+"px",opacity:0},e=u({style:i,tagName:"div",editable:!0}),document.body.appendChild(e),e.focus(),requestAnimationFrame(function(i){return function(){var r;return r=e.innerHTML,o.removeNode(e),i.setSelectedRange(n),t(r)}}(this))},a.proxyMethod("responder?.getSelectedRange"),a.proxyMethod("responder?.setSelectedRange"),a.proxyMethod("responder?.expandSelectionInDirection"),a.proxyMethod("responder?.selectionIsInCursorTarget"),a.proxyMethod("responder?.selectionIsExpanded"),a}(o.InputController),r=function(t){var e,n;return null!=(e=t.type)&&null!=(n=e.match(/\/(\w+)$/))?n[1]:void 0},a=null!=("function"==typeof" ".codePointAt?" ".codePointAt(0):void 0),h=function(t){var e;return t.key&&a&&t.key.codePointAt(0)===t.keyCode?t.key:(null===t.which?e=t.keyCode:0!==t.which&&0!==t.charCode&&(e=t.charCode),null!=e&&"escape"!==l[e]?o.UTF16String.fromCodepoints([e]).toString():void 0)},d=function(t){var e,n,i,r,o,a,s,l,u;if(s=t.clipboardData){if(g.call(s.types,"text/html")>=0){for(i=0,a=(l=s.types).length;a>i;i++)if(u=l[i],e=/^CorePasteboardFlavorType/.test(u),n=/^dyn\./.test(u)&&s.getData(u),e||n)return!0;return!1}return r=g.call(s.types,"com.apple.webarchive")>=0,o=g.call(s.types,"com.apple.flat-rtfd")>=0,r||o}},t=function(t){function n(t){var e;this.inputController=t,e=this.inputController,this.responder=e.responder,this.delegate=e.delegate,this.inputSummary=e.inputSummary,this.data={}}return f(n,t),n.prototype.start=function(t){var e,n;return this.data.start=t,this.isSignificant()?("keypress"===this.inputSummary.eventName&&this.inputSummary.textAdded&&null!=(e=this.responder)&&e.deleteInDirection("left"),this.selectionIsExpanded()||(this.insertPlaceholder(),this.requestRender()),this.range=null!=(n=this.responder)?n.getSelectedRange():void 0):void 0},n.prototype.update=function(t){var e;return this.data.update=t,this.isSignificant()&&(e=this.selectPlaceholder())?(this.forgetPlaceholder(),this.range=e):void 0},n.prototype.end=function(t){var e,n,i,r;return this.data.end=t,this.isSignificant()?(this.forgetPlaceholder(),this.canApplyToDocument()?(this.setInputSummary({preferDocument:!0,didInput:!1}),null!=(e=this.delegate)&&e.inputControllerWillPerformTyping(),null!=(n=this.responder)&&n.setSelectedRange(this.range),null!=(i=this.responder)&&i.insertString(this.data.end),null!=(r=this.responder)?r.setSelectedRange(this.range[0]+this.data.end.length):void 0):null!=this.data.start||null!=this.data.update?(this.requestReparse(),this.inputController.reset()):void 0):this.inputController.reset()},n.prototype.getEndData=function(){return this.data.end},n.prototype.isEnded=function(){return null!=this.getEndData()},n.prototype.isSignificant=function(){return!e.composesExistingText||this.inputSummary.didInput},n.prototype.canApplyToDocument=function(){var t,e;return 0===(null!=(t=this.data.start)?t.length:void 0)&&(null!=(e=this.data.end)?e.length:void 0)>0&&null!=this.range},n.proxyMethod("inputController.setInputSummary"),n.proxyMethod("inputController.requestRender"),n.proxyMethod("inputController.requestReparse"),n.proxyMethod("responder?.selectionIsExpanded"),n.proxyMethod("responder?.insertPlaceholder"),n.proxyMethod("responder?.selectPlaceholder"),n.proxyMethod("responder?.forgetPlaceholder"),n}(o.BasicObject)}.call(this),function(){var t,e,n,i=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty,a=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};t=o.dataTransferIsPlainText,e=o.keyEventIsKeyboardCommand,n=o.objectsAreEqual,o.Level2InputController=function(r){function s(){return this.render=function(t,e){return function(){return t.apply(e,arguments)}}(this.render,this),s.__super__.constructor.apply(this,arguments)}var l,u,c,d,h,f;return i(s,r),s.prototype.elementDidMutate=function(){var t;return this.scheduledRender?this.composing&&null!=(t=this.delegate)&&"function"==typeof t.inputControllerDidAllowUnhandledInput?t.inputControllerDidAllowUnhandledInput():void 0:this.reparse()},s.prototype.scheduleRender=function(){return null!=this.scheduledRender?this.scheduledRender:this.scheduledRender=requestAnimationFrame(this.render)},s.prototype.render=function(){var t;return cancelAnimationFrame(this.scheduledRender),this.scheduledRender=null,this.composing||null!=(t=this.delegate)&&t.render(),"function"==typeof this.afterRender&&this.afterRender(),this.afterRender=null},s.prototype.reparse=function(){var t;return null!=(t=this.delegate)?t.reparse():void 0},s.prototype.events={keydown:function(t){var n,i,r,o;if(e(t)){if(n=u(t),null!=(o=this.delegate)?o.inputControllerDidReceiveKeyboardCommand(n):void 0)return t.preventDefault()}else if(r=t.key,t.altKey&&(r+="+Alt"),t.shiftKey&&(r+="+Shift"),i=this.keys[r])return this.withEvent(t,i)},paste:function(t){var e,n,i,r,o,a,s,l,u;return c(t)?(t.preventDefault(),this.attachFiles(t.clipboardData.files)):d(t)?(t.preventDefault(),n={type:"text/plain",string:t.clipboardData.getData("text/plain")},null!=(i=this.delegate)&&i.inputControllerWillPaste(n),null!=(r=this.responder)&&r.insertString(n.string),this.render(),null!=(o=this.delegate)?o.inputControllerDidPaste(n):void 0):(e=null!=(a=t.clipboardData)?a.getData("URL"):void 0)?(t.preventDefault(),n={type:"text/html",html:this.createLinkHTML(e)},null!=(s=this.delegate)&&s.inputControllerWillPaste(n),null!=(l=this.responder)&&l.insertHTML(n.html),this.render(),null!=(u=this.delegate)?u.inputControllerDidPaste(n):void 0):void 0},beforeinput:function(t){var e;return(e=this.inputTypes[t.inputType])?(this.withEvent(t,e),this.scheduleRender()):void 0},input:function(){return o.selectionChangeObserver.reset()},dragstart:function(t){var e,n;return(null!=(e=this.responder)?e.selectionContainsAttachments():void 0)?(t.dataTransfer.setData("application/x-trix-dragging",!0),this.dragging={range:null!=(n=this.responder)?n.getSelectedRange():void 0,point:h(t)}):void 0},dragenter:function(t){return l(t)?t.preventDefault():void 0},dragover:function(t){var e,i;if(this.dragging){if(t.preventDefault(),e=h(t),!n(e,this.dragging.point))return this.dragging.point=e,null!=(i=this.responder)?i.setLocationRangeFromPointRange(e):void 0}else if(l(t))return t.preventDefault()},drop:function(t){var e,n,i,r;return this.dragging?(t.preventDefault(),null!=(n=this.delegate)&&n.inputControllerWillMoveText(),null!=(i=this.responder)&&i.moveTextFromRange(this.dragging.range),this.dragging=null,this.scheduleRender()):l(t)?(t.preventDefault(),e=h(t),null!=(r=this.responder)&&r.setLocationRangeFromPointRange(e),this.attachFiles(t.dataTransfer.files)):void 0},dragend:function(){var t;return this.dragging?(null!=(t=this.responder)&&t.setSelectedRange(this.dragging.range),this.dragging=null):void 0},compositionend:function(){return this.composing?(this.composing=!1,this.scheduleRender()):void 0}},s.prototype.keys={ArrowLeft:function(){var t,e;return(null!=(t=this.responder)?t.shouldManageMovingCursorInDirection("backward"):void 0)?(this.event.preventDefault(),null!=(e=this.responder)?e.moveCursorInDirection("backward"):void 0):void 0},ArrowRight:function(){var t,e;return(null!=(t=this.responder)?t.shouldManageMovingCursorInDirection("forward"):void 0)?(this.event.preventDefault(),null!=(e=this.responder)?e.moveCursorInDirection("forward"):void 0):void 0},Backspace:function(){var t,e,n;return(null!=(t=this.responder)?t.shouldManageDeletingInDirection("backward"):void 0)?(this.event.preventDefault(),null!=(e=this.delegate)&&e.inputControllerWillPerformTyping(),null!=(n=this.responder)&&n.deleteInDirection("backward"),this.render()):void 0},Tab:function(){var t,e;return(null!=(t=this.responder)?t.canIncreaseNestingLevel():void 0)?(this.event.preventDefault(),null!=(e=this.responder)&&e.increaseNestingLevel(),this.render()):void 0},"Tab+Shift":function(){var t,e;return(null!=(t=this.responder)?t.canDecreaseNestingLevel():void 0)?(this.event.preventDefault(),null!=(e=this.responder)&&e.decreaseNestingLevel(),this.render()):void 0}},s.prototype.inputTypes={deleteByComposition:function(){return this.deleteInDirection("backward",{recordUndoEntry:!1})},deleteByCut:function(){return this.deleteInDirection("backward")},deleteByDrag:function(){return this.event.preventDefault(),this.withTargetDOMRange((function(){var t;return this.deleteByDragRange=null!=(t=this.responder)?t.getSelectedRange():void 0}))},deleteCompositionText:function(){return this.deleteInDirection("backward",{recordUndoEntry:!1})},deleteContent:function(){return this.deleteInDirection("backward")},deleteContentBackward:function(){return this.deleteInDirection("backward")},deleteContentForward:function(){return this.deleteInDirection("forward")},deleteEntireSoftLine:function(){return this.deleteInDirection("forward")},deleteHardLineBackward:function(){return this.deleteInDirection("backward")},deleteHardLineForward:function(){return this.deleteInDirection("forward")},deleteSoftLineBackward:function(){return this.deleteInDirection("backward")},deleteSoftLineForward:function(){return this.deleteInDirection("forward")},deleteWordBackward:function(){return this.deleteInDirection("backward")},deleteWordForward:function(){return this.deleteInDirection("forward")},formatBackColor:function(){return this.activateAttributeIfSupported("backgroundColor",this.event.data)},formatBold:function(){return this.toggleAttributeIfSupported("bold")},formatFontColor:function(){return this.activateAttributeIfSupported("color",this.event.data)},formatFontName:function(){return this.activateAttributeIfSupported("font",this.event.data)},formatIndent:function(){var t;return(null!=(t=this.responder)?t.canIncreaseNestingLevel():void 0)?this.withTargetDOMRange((function(){var t;return null!=(t=this.responder)?t.increaseNestingLevel():void 0})):void 0},formatItalic:function(){return this.toggleAttributeIfSupported("italic")},formatJustifyCenter:function(){return this.toggleAttributeIfSupported("justifyCenter")},formatJustifyFull:function(){return this.toggleAttributeIfSupported("justifyFull")},formatJustifyLeft:function(){return this.toggleAttributeIfSupported("justifyLeft")},formatJustifyRight:function(){return this.toggleAttributeIfSupported("justifyRight")},formatOutdent:function(){var t;return(null!=(t=this.responder)?t.canDecreaseNestingLevel():void 0)?this.withTargetDOMRange((function(){var t;return null!=(t=this.responder)?t.decreaseNestingLevel():void 0})):void 0},formatRemove:function(){return this.withTargetDOMRange((function(){var t,e,n,i;for(t in i=[],null!=(e=this.responder)?e.getCurrentAttributes():void 0)i.push(null!=(n=this.responder)?n.removeCurrentAttribute(t):void 0);return i}))},formatSetBlockTextDirection:function(){return this.activateAttributeIfSupported("blockDir",this.event.data)},formatSetInlineTextDirection:function(){return this.activateAttributeIfSupported("textDir",this.event.data)},formatStrikeThrough:function(){return this.toggleAttributeIfSupported("strike")},formatSubscript:function(){return this.toggleAttributeIfSupported("sub")},formatSuperscript:function(){return this.toggleAttributeIfSupported("sup")},formatUnderline:function(){return this.toggleAttributeIfSupported("underline")},historyRedo:function(){var t;return null!=(t=this.delegate)?t.inputControllerWillPerformRedo():void 0},historyUndo:function(){var t;return null!=(t=this.delegate)?t.inputControllerWillPerformUndo():void 0},insertCompositionText:function(){return this.composing=!0,this.insertString(this.event.data)},insertFromComposition:function(){return this.composing=!1,this.insertString(this.event.data)},insertFromDrop:function(){var t,e;return(t=this.deleteByDragRange)?(this.deleteByDragRange=null,null!=(e=this.delegate)&&e.inputControllerWillMoveText(),this.withTargetDOMRange((function(){var e;return null!=(e=this.responder)?e.moveTextFromRange(t):void 0}))):void 0},insertFromPaste:function(){var e,n,i,r,a,s,l,u,c,d,h;return e=this.event.dataTransfer,a={dataTransfer:e},(n=e.getData("URL"))?(this.event.preventDefault(),a.type="text/html",h=(r=e.getData("public.url-name"))?o.squishBreakableWhitespace(r).trim():n,a.html=this.createLinkHTML(n,h),null!=(s=this.delegate)&&s.inputControllerWillPaste(a),this.withTargetDOMRange((function(){var t;return null!=(t=this.responder)?t.insertHTML(a.html):void 0})),this.afterRender=function(t){return function(){var e;return null!=(e=t.delegate)?e.inputControllerDidPaste(a):void 0}}(this)):t(e)?(a.type="text/plain",a.string=e.getData("text/plain"),null!=(l=this.delegate)&&l.inputControllerWillPaste(a),this.withTargetDOMRange((function(){var t;return null!=(t=this.responder)?t.insertString(a.string):void 0})),this.afterRender=function(t){return function(){var e;return null!=(e=t.delegate)?e.inputControllerDidPaste(a):void 0}}(this)):(i=e.getData("text/html"))?(this.event.preventDefault(),a.type="text/html",a.html=i,null!=(u=this.delegate)&&u.inputControllerWillPaste(a),this.withTargetDOMRange((function(){var t;return null!=(t=this.responder)?t.insertHTML(a.html):void 0})),this.afterRender=function(t){return function(){var e;return null!=(e=t.delegate)?e.inputControllerDidPaste(a):void 0}}(this)):(null!=(c=e.files)?c.length:void 0)?(a.type="File",a.file=e.files[0],null!=(d=this.delegate)&&d.inputControllerWillPaste(a),this.withTargetDOMRange((function(){var t;return null!=(t=this.responder)?t.insertFile(a.file):void 0})),this.afterRender=function(t){return function(){var e;return null!=(e=t.delegate)?e.inputControllerDidPaste(a):void 0}}(this)):void 0},insertFromYank:function(){return this.insertString(this.event.data)},insertLineBreak:function(){return this.insertString("\n")},insertLink:function(){return this.activateAttributeIfSupported("href",this.event.data)},insertOrderedList:function(){return this.toggleAttributeIfSupported("number")},insertParagraph:function(){var t;return null!=(t=this.delegate)&&t.inputControllerWillPerformTyping(),this.withTargetDOMRange((function(){var t;return null!=(t=this.responder)?t.insertLineBreak():void 0}))},insertReplacementText:function(){return this.insertString(this.event.dataTransfer.getData("text/plain"),{updatePosition:!1})},insertText:function(){var t,e;return this.insertString(null!=(t=this.event.data)?t:null!=(e=this.event.dataTransfer)?e.getData("text/plain"):void 0)},insertTranspose:function(){return this.insertString(this.event.data)},insertUnorderedList:function(){return this.toggleAttributeIfSupported("bullet")}},s.prototype.insertString=function(t,e){var n;return null==t&&(t=""),null!=(n=this.delegate)&&n.inputControllerWillPerformTyping(),this.withTargetDOMRange((function(){var n;return null!=(n=this.responder)?n.insertString(t,e):void 0}))},s.prototype.toggleAttributeIfSupported=function(t){var e;return a.call(o.getAllAttributeNames(),t)>=0?(null!=(e=this.delegate)&&e.inputControllerWillPerformFormatting(t),this.withTargetDOMRange((function(){var e;return null!=(e=this.responder)?e.toggleCurrentAttribute(t):void 0}))):void 0},s.prototype.activateAttributeIfSupported=function(t,e){var n;return a.call(o.getAllAttributeNames(),t)>=0?(null!=(n=this.delegate)&&n.inputControllerWillPerformFormatting(t),this.withTargetDOMRange((function(){var n;return null!=(n=this.responder)?n.setCurrentAttribute(t,e):void 0}))):void 0},s.prototype.deleteInDirection=function(t,e){var n,i,r;return(null!=e?e:{recordUndoEntry:!0}).recordUndoEntry&&null!=(r=this.delegate)&&r.inputControllerWillPerformTyping(),i=function(e){return function(){var n;return null!=(n=e.responder)?n.deleteInDirection(t):void 0}}(this),(n=this.getTargetDOMRange({minLength:2}))?this.withTargetDOMRange(n,i):i()},s.prototype.withTargetDOMRange=function(t,e){var n;return"function"==typeof t&&(e=t,t=this.getTargetDOMRange()),t?null!=(n=this.responder)?n.withTargetDOMRange(t,e.bind(this)):void 0:(o.selectionChangeObserver.reset(),e.call(this))},s.prototype.getTargetDOMRange=function(t){var e,n,i,r;return i=(null!=t?t:{minLength:0}).minLength,(r="function"==typeof(e=this.event).getTargetRanges?e.getTargetRanges():void 0)&&r.length&&(n=f(r[0]),0===i||n.toString().length>=i)?n:void 0},f=function(t){var e;return(e=document.createRange()).setStart(t.startContainer,t.startOffset),e.setEnd(t.endContainer,t.endOffset),e},s.prototype.withEvent=function(t,e){var n;this.event=t;try{n=e.call(this)}finally{this.event=null}return n},l=function(t){var e,n;return a.call(null!=(e=null!=(n=t.dataTransfer)?n.types:void 0)?e:[],"Files")>=0},c=function(t){var e;return(e=t.clipboardData)?a.call(e.types,"Files")>=0&&1===e.types.length&&e.files.length>=1:void 0},d=function(t){var e;return(e=t.clipboardData)?a.call(e.types,"text/plain")>=0&&1===e.types.length:void 0},u=function(t){var e;return e=[],t.altKey&&e.push("alt"),t.shiftKey&&e.push("shift"),e.push(t.key),e},h=function(t){return{x:t.clientX,y:t.clientY}},s}(o.InputController)}.call(this),function(){var t,e,n,i,r,a,s,l,u=function(t,e){return function(){return t.apply(e,arguments)}},c=function(t,e){function n(){this.constructor=t}for(var i in e)d.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d={}.hasOwnProperty;e=o.defer,n=o.handleEvent,a=o.makeElement,l=o.tagName,s=o.config,r=s.lang,t=s.css,i=s.keyNames,o.AttachmentEditorController=function(s){function d(t,e,n,i){this.attachmentPiece=t,this.element=e,this.container=n,this.options=null!=i?i:{},this.didBlurCaption=u(this.didBlurCaption,this),this.didChangeCaption=u(this.didChangeCaption,this),this.didInputCaption=u(this.didInputCaption,this),this.didKeyDownCaption=u(this.didKeyDownCaption,this),this.didClickActionButton=u(this.didClickActionButton,this),this.didClickToolbar=u(this.didClickToolbar,this),this.attachment=this.attachmentPiece.attachment,"a"===l(this.element)&&(this.element=this.element.firstChild),this.install()}var h;return c(d,s),h=function(t){return function(){var e;return(e=t.apply(this,arguments)).do(),null==this.undos&&(this.undos=[]),this.undos.push(e.undo)}},d.prototype.install=function(){return this.makeElementMutable(),this.addToolbar(),this.attachment.isPreviewable()?this.installCaptionEditor():void 0},d.prototype.uninstall=function(){var t,e;for(this.savePendingCaption();e=this.undos.pop();)e();return null!=(t=this.delegate)?t.didUninstallAttachmentEditor(this):void 0},d.prototype.savePendingCaption=function(){var t,e,n;return null!=this.pendingCaption?(t=this.pendingCaption,this.pendingCaption=null,t?null!=(e=this.delegate)&&"function"==typeof e.attachmentEditorDidRequestUpdatingAttributesForAttachment?e.attachmentEditorDidRequestUpdatingAttributesForAttachment({caption:t},this.attachment):void 0:null!=(n=this.delegate)&&"function"==typeof n.attachmentEditorDidRequestRemovingAttributeForAttachment?n.attachmentEditorDidRequestRemovingAttributeForAttachment("caption",this.attachment):void 0):void 0},d.prototype.makeElementMutable=h((function(){return{do:function(t){return function(){return t.element.dataset.trixMutable=!0}}(this),undo:function(t){return function(){return delete t.element.dataset.trixMutable}}(this)}})),d.prototype.addToolbar=h((function(){var e;return e=a({tagName:"div",className:t.attachmentToolbar,data:{trixMutable:!0},childNodes:a({tagName:"div",className:"trix-button-row",childNodes:a({tagName:"span",className:"trix-button-group trix-button-group--actions",childNodes:a({tagName:"button",className:"trix-button trix-button--remove",textContent:r.remove,attributes:{title:r.remove},data:{trixAction:"remove"}})})})}),this.attachment.isPreviewable()&&e.appendChild(a({tagName:"div",className:t.attachmentMetadataContainer,childNodes:a({tagName:"span",className:t.attachmentMetadata,childNodes:[a({tagName:"span",className:t.attachmentName,textContent:this.attachment.getFilename(),attributes:{title:this.attachment.getFilename()}}),a({tagName:"span",className:t.attachmentSize,textContent:this.attachment.getFormattedFilesize()})]})})),n("click",{onElement:e,withCallback:this.didClickToolbar}),n("click",{onElement:e,matchingSelector:"[data-trix-action]",withCallback:this.didClickActionButton}),{do:function(t){return function(){return t.element.appendChild(e)}}(this),undo:function(){return o.removeNode(e)}}})),d.prototype.installCaptionEditor=h((function(){var i,s,l,u,c;return(u=a({tagName:"textarea",className:t.attachmentCaptionEditor,attributes:{placeholder:r.captionPlaceholder},data:{trixMutable:!0}})).value=this.attachmentPiece.getCaption(),(c=u.cloneNode()).classList.add("trix-autoresize-clone"),c.tabIndex=-1,i=function(){return c.value=u.value,u.style.height=c.scrollHeight+"px"},n("input",{onElement:u,withCallback:i}),n("input",{onElement:u,withCallback:this.didInputCaption}),n("keydown",{onElement:u,withCallback:this.didKeyDownCaption}),n("change",{onElement:u,withCallback:this.didChangeCaption}),n("blur",{onElement:u,withCallback:this.didBlurCaption}),l=this.element.querySelector("figcaption"),s=l.cloneNode(),{do:function(n){return function(){return l.style.display="none",s.appendChild(u),s.appendChild(c),s.classList.add(t.attachmentCaption+"--editing"),l.parentElement.insertBefore(s,l),i(),n.options.editCaption?e((function(){return u.focus()})):void 0}}(this),undo:function(){return o.removeNode(s),l.style.display=null}}})),d.prototype.didClickToolbar=function(t){return t.preventDefault(),t.stopPropagation()},d.prototype.didClickActionButton=function(t){var e;if("remove"===t.target.getAttribute("data-trix-action"))return null!=(e=this.delegate)?e.attachmentEditorDidRequestRemovalOfAttachment(this.attachment):void 0},d.prototype.didKeyDownCaption=function(t){var e;return"return"===i[t.keyCode]?(t.preventDefault(),this.savePendingCaption(),null!=(e=this.delegate)&&"function"==typeof e.attachmentEditorDidRequestDeselectingAttachment?e.attachmentEditorDidRequestDeselectingAttachment(this.attachment):void 0):void 0},d.prototype.didInputCaption=function(t){return this.pendingCaption=t.target.value.replace(/\s/g," ").trim()},d.prototype.didChangeCaption=function(){return this.savePendingCaption()},d.prototype.didBlurCaption=function(){return this.savePendingCaption()},d}(o.BasicObject)}.call(this),function(){var t,e,n,i=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;n=o.makeElement,t=o.config.css,o.AttachmentView=function(r){function a(){a.__super__.constructor.apply(this,arguments),this.attachment=this.object,this.attachment.uploadProgressDelegate=this,this.attachmentPiece=this.options.piece}var s;return i(a,r),a.attachmentSelector="[data-trix-attachment]",a.prototype.createContentNodes=function(){return[]},a.prototype.createNodes=function(){var e,i,r,o,a,l,u;if(e=o=n({tagName:"figure",className:this.getClassName(),data:this.getData(),editable:!1}),(i=this.getHref())&&(o=n({tagName:"a",editable:!1,attributes:{href:i,tabindex:-1}}),e.appendChild(o)),this.attachment.hasContent())o.innerHTML=this.attachment.getContent();else for(r=0,a=(u=this.createContentNodes()).length;a>r;r++)l=u[r],o.appendChild(l);return o.appendChild(this.createCaptionElement()),this.attachment.isPending()&&(this.progressElement=n({tagName:"progress",attributes:{class:t.attachmentProgress,value:this.attachment.getUploadProgress(),max:100},data:{trixMutable:!0,trixStoreKey:["progressElement",this.attachment.id].join("/")}}),e.appendChild(this.progressElement)),[s("left"),e,s("right")]},a.prototype.createCaptionElement=function(){var e,i,r,o,a,s,l;return r=n({tagName:"figcaption",className:t.attachmentCaption}),(e=this.attachmentPiece.getCaption())?(r.classList.add(t.attachmentCaption+"--edited"),r.textContent=e):((i=this.getCaptionConfig()).name&&(o=this.attachment.getFilename()),i.size&&(s=this.attachment.getFormattedFilesize()),o&&(a=n({tagName:"span",className:t.attachmentName,textContent:o}),r.appendChild(a)),s&&(o&&r.appendChild(document.createTextNode(" ")),l=n({tagName:"span",className:t.attachmentSize,textContent:s}),r.appendChild(l))),r},a.prototype.getClassName=function(){var e,n;return n=[t.attachment,t.attachment+"--"+this.attachment.getType()],(e=this.attachment.getExtension())&&n.push(t.attachment+"--"+e),n.join(" ")},a.prototype.getData=function(){var t,e;return e={trixAttachment:JSON.stringify(this.attachment),trixContentType:this.attachment.getContentType(),trixId:this.attachment.id},(t=this.attachmentPiece.attributes).isEmpty()||(e.trixAttributes=JSON.stringify(t)),this.attachment.isPending()&&(e.trixSerialize=!1),e},a.prototype.getHref=function(){return e(this.attachment.getContent(),"a")?void 0:this.attachment.getHref()},a.prototype.getCaptionConfig=function(){var t,e,n;return n=this.attachment.getType(),t=o.copyObject(null!=(e=o.config.attachments[n])?e.caption:void 0),"file"===n&&(t.name=!0),t},a.prototype.findProgressElement=function(){var t;return null!=(t=this.findElement())?t.querySelector("progress"):void 0},s=function(t){return n({tagName:"span",textContent:o.ZERO_WIDTH_SPACE,data:{trixCursorTarget:t,trixSerialize:!1}})},a.prototype.attachmentDidChangeUploadProgress=function(){var t,e;return e=this.attachment.getUploadProgress(),null!=(t=this.findProgressElement())?t.value=e:void 0},a}(o.ObjectView),e=function(t,e){var i;return(i=n("div")).innerHTML=null!=t?t:"",i.querySelector(e)}}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;t=o.makeElement,o.PreviewableAttachmentView=function(n){function i(){i.__super__.constructor.apply(this,arguments),this.attachment.previewDelegate=this}return e(i,n),i.prototype.createContentNodes=function(){return this.image=t({tagName:"img",attributes:{src:""},data:{trixMutable:!0}}),this.refresh(this.image),[this.image]},i.prototype.createCaptionElement=function(){var t;return(t=i.__super__.createCaptionElement.apply(this,arguments)).textContent||t.setAttribute("data-trix-placeholder",o.config.lang.captionPlaceholder),t},i.prototype.refresh=function(t){var e;return null==t&&(t=null!=(e=this.findElement())?e.querySelector("img"):void 0),t?this.updateAttributesForImage(t):void 0},i.prototype.updateAttributesForImage=function(t){var e,n,i,r,o,a;return o=this.attachment.getURL(),n=this.attachment.getPreviewURL(),t.src=n||o,n===o?t.removeAttribute("data-trix-serialized-attributes"):(i=JSON.stringify({src:o}),t.setAttribute("data-trix-serialized-attributes",i)),a=this.attachment.getWidth(),e=this.attachment.getHeight(),null!=a&&(t.width=a),null!=e&&(t.height=e),r=["imageElement",this.attachment.id,t.src,t.width,t.height].join("/"),t.dataset.trixStoreKey=r},i.prototype.attachmentDidChangeAttributes=function(){return this.refresh(this.image),this.refresh()},i}(o.AttachmentView)}.call(this),function(){var t,e,n,i=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;n=o.makeElement,t=o.findInnerElement,e=o.getTextConfig,o.PieceView=function(r){function a(){var t;a.__super__.constructor.apply(this,arguments),this.piece=this.object,this.attributes=this.piece.getAttributes(),t=this.options,this.textConfig=t.textConfig,this.context=t.context,this.piece.attachment?this.attachment=this.piece.attachment:this.string=this.piece.toString()}var s;return i(a,r),a.prototype.createNodes=function(){var e,n,i,r,o,a;if(a=this.attachment?this.createAttachmentNodes():this.createStringNodes(),e=this.createElement()){for(i=t(e),n=0,r=a.length;r>n;n++)o=a[n],i.appendChild(o);a=[e]}return a},a.prototype.createAttachmentNodes=function(){var t;return t=this.attachment.isPreviewable()?o.PreviewableAttachmentView:o.AttachmentView,this.createChildView(t,this.piece.attachment,{piece:this.piece}).getNodes()},a.prototype.createStringNodes=function(){var t,e,i,r,o,a,s,l,u;if(null!=(s=this.textConfig)?s.plaintext:void 0)return[document.createTextNode(this.string)];for(a=[],i=e=0,r=(l=this.string.split("\n")).length;r>e;i=++e)u=l[i],i>0&&(t=n("br"),a.push(t)),u.length&&(o=document.createTextNode(this.preserveSpaces(u)),a.push(o));return a},a.prototype.createElement=function(){var t,i,r,o,a,s,l,u,c;for(o in u={},s=this.attributes)if(c=s[o],(t=e(o))&&(t.tagName&&(a=n(t.tagName),r?(r.appendChild(a),r=a):i=r=a),t.styleProperty&&(u[t.styleProperty]=c),t.style))for(o in l=t.style)c=l[o],u[o]=c;if(Object.keys(u).length)for(o in null==i&&(i=n("span")),u)c=u[o],i.style[o]=c;return i},a.prototype.createContainerElement=function(){var t,i,r,o,a;for(r in o=this.attributes)if(a=o[r],(i=e(r))&&i.groupTagName)return(t={})[r]=a,n(i.groupTagName,t)},s=o.NON_BREAKING_SPACE,a.prototype.preserveSpaces=function(t){return this.context.isLast&&(t=t.replace(/\ $/,s)),t=t.replace(/(\S)\ {3}(\S)/g,"$1 "+s+" $2").replace(/\ {2}/g,s+" ").replace(/\ {2}/g," "+s),(this.context.isFirst||this.context.followsWhitespace)&&(t=t.replace(/^\ /,s)),t},a}(o.ObjectView)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;o.TextView=function(e){function n(){n.__super__.constructor.apply(this,arguments),this.text=this.object,this.textConfig=this.options.textConfig}var i;return t(n,e),n.prototype.createNodes=function(){var t,e,n,r,a,s,l,u,c,d;for(s=[],r=(u=o.ObjectGroup.groupObjects(this.getPieces())).length-1,n=e=0,a=u.length;a>e;n=++e)l=u[n],t={},0===n&&(t.isFirst=!0),n===r&&(t.isLast=!0),i(c)&&(t.followsWhitespace=!0),d=this.findOrCreateCachedChildView(o.PieceView,l,{textConfig:this.textConfig,context:t}),s.push.apply(s,d.getNodes()),c=l;return s},n.prototype.getPieces=function(){var t,e,n,i,r;for(r=[],t=0,e=(i=this.text.getPieces()).length;e>t;t++)(n=i[t]).hasAttribute("blockBreak")||r.push(n);return r},i=function(t){return/\s$/.test(null!=t?t.toString():void 0)},n}(o.ObjectView)}.call(this),function(){var t,e,n,i=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;n=o.makeElement,e=o.getBlockConfig,t=o.config.css,o.BlockView=function(r){function a(){a.__super__.constructor.apply(this,arguments),this.block=this.object,this.attributes=this.block.getAttributes()}return i(a,r),a.prototype.createNodes=function(){var t,i,r,a,s,l,u,c,d,h;if(l=[document.createComment("block")],this.block.isEmpty()?l.push(n("br")):(d=null!=(u=e(this.block.getLastAttribute()))?u.text:void 0,h=this.findOrCreateCachedChildView(o.TextView,this.block.text,{textConfig:d}),l.push.apply(l,h.getNodes()),this.shouldAddExtraNewlineElement()&&l.push(n("br"))),this.attributes.length)return l;for(c=o.config.blockAttributes.default.tagName,this.block.isRTL()&&(t={dir:"rtl"}),i=n({tagName:c,attributes:t}),r=0,a=l.length;a>r;r++)s=l[r],i.appendChild(s);return[i]},a.prototype.createContainerElement=function(i){var r,o,a,s,l;return r=this.attributes[i],l=e(r).tagName,0===i&&this.block.isRTL()&&(o={dir:"rtl"}),"attachmentGallery"===r&&(s=this.block.getBlockBreakPosition(),a=t.attachmentGallery+" "+t.attachmentGallery+"--"+s),n({tagName:l,className:a,attributes:o})},a.prototype.shouldAddExtraNewlineElement=function(){return/\n\n$/.test(this.block.toString())},a}(o.ObjectView)}.call(this),function(){var t,e,n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;t=o.defer,e=o.makeElement,o.DocumentView=function(i){function r(){r.__super__.constructor.apply(this,arguments),this.element=this.options.element,this.elementStore=new o.ElementStore,this.setDocument(this.object)}var a,s,l;return n(r,i),r.render=function(t){var n,i;return(i=new this(t,{element:n=e("div")})).render(),i.sync(),n},r.prototype.setDocument=function(t){return t.isEqualTo(this.document)?void 0:this.document=this.object=t},r.prototype.render=function(){var t,n,i,r,a,s,l;if(this.childViews=[],this.shadowElement=e("div"),!this.document.isEmpty()){for(s=[],t=0,n=(a=o.ObjectGroup.groupObjects(this.document.getBlocks(),{asTree:!0})).length;n>t;t++)r=a[t],l=this.findOrCreateCachedChildView(o.BlockView,r),s.push(function(){var t,e,n,r;for(r=[],t=0,e=(n=l.getNodes()).length;e>t;t++)i=n[t],r.push(this.shadowElement.appendChild(i));return r}.call(this));return s}},r.prototype.isSynced=function(){return a(this.shadowElement,this.element)},r.prototype.sync=function(){var t;for(t=this.createDocumentFragmentForSync();this.element.lastChild;)this.element.removeChild(this.element.lastChild);return this.element.appendChild(t),this.didSync()},r.prototype.didSync=function(){return this.elementStore.reset(s(this.element)),t(function(t){return function(){return t.garbageCollectCachedViews()}}(this))},r.prototype.createDocumentFragmentForSync=function(){var t,e,n,i,r,o,a,l,u,c;for(e=document.createDocumentFragment(),n=0,r=(l=this.shadowElement.childNodes).length;r>n;n++)a=l[n],e.appendChild(a.cloneNode(!0));for(i=0,o=(u=s(e)).length;o>i;i++)t=u[i],(c=this.elementStore.remove(t))&&t.parentNode.replaceChild(c,t);return e},s=function(t){return t.querySelectorAll("[data-trix-store-key]")},a=function(t,e){return l(t.innerHTML)===l(e.innerHTML)},l=function(t){return t.replace(/&nbsp;/g," ")},r}(o.ObjectView)}.call(this),function(){var t,e,n,i,r,a=function(t,e){return function(){return t.apply(e,arguments)}},s=function(t,e){function n(){this.constructor=t}for(var i in e)l.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;n=o.findClosestElementFromNode,i=o.handleEvent,r=o.innerElementIsActive,e=o.defer,t=o.AttachmentView.attachmentSelector,o.CompositionController=function(l){function u(e,n){this.element=e,this.composition=n,this.didClickAttachment=a(this.didClickAttachment,this),this.didBlur=a(this.didBlur,this),this.didFocus=a(this.didFocus,this),this.documentView=new o.DocumentView(this.composition.document,{element:this.element}),i("focus",{onElement:this.element,withCallback:this.didFocus}),i("blur",{onElement:this.element,withCallback:this.didBlur}),i("click",{onElement:this.element,matchingSelector:"a[contenteditable=false]",preventDefault:!0}),i("mousedown",{onElement:this.element,matchingSelector:t,withCallback:this.didClickAttachment}),i("click",{onElement:this.element,matchingSelector:"a"+t,preventDefault:!0})}return s(u,l),u.prototype.didFocus=function(){var t,e,n;return t=function(t){return function(){var e;return t.focused?void 0:(t.focused=!0,null!=(e=t.delegate)&&"function"==typeof e.compositionControllerDidFocus?e.compositionControllerDidFocus():void 0)}}(this),null!=(e=null!=(n=this.blurPromise)?n.then(t):void 0)?e:t()},u.prototype.didBlur=function(){return this.blurPromise=new Promise(function(t){return function(n){return e((function(){var e;return r(t.element)||(t.focused=null,null!=(e=t.delegate)&&"function"==typeof e.compositionControllerDidBlur&&e.compositionControllerDidBlur()),t.blurPromise=null,n()}))}}(this))},u.prototype.didClickAttachment=function(t,e){var i,r,o;return i=this.findAttachmentForElement(e),r=null!=n(t.target,{matchingSelector:"figcaption"}),null!=(o=this.delegate)&&"function"==typeof o.compositionControllerDidSelectAttachment?o.compositionControllerDidSelectAttachment(i,{editCaption:r}):void 0},u.prototype.getSerializableElement=function(){return this.isEditingAttachment()?this.documentView.shadowElement:this.element},u.prototype.render=function(){var t,e,n;return this.revision!==this.composition.revision&&(this.documentView.setDocument(this.composition.document),this.documentView.render(),this.revision=this.composition.revision),this.canSyncDocumentView()&&!this.documentView.isSynced()&&(null!=(t=this.delegate)&&"function"==typeof t.compositionControllerWillSyncDocumentView&&t.compositionControllerWillSyncDocumentView(),this.documentView.sync(),null!=(e=this.delegate)&&"function"==typeof e.compositionControllerDidSyncDocumentView&&e.compositionControllerDidSyncDocumentView()),null!=(n=this.delegate)&&"function"==typeof n.compositionControllerDidRender?n.compositionControllerDidRender():void 0},u.prototype.rerenderViewForObject=function(t){return this.invalidateViewForObject(t),this.render()},u.prototype.invalidateViewForObject=function(t){return this.documentView.invalidateViewForObject(t)},u.prototype.isViewCachingEnabled=function(){return this.documentView.isViewCachingEnabled()},u.prototype.enableViewCaching=function(){return this.documentView.enableViewCaching()},u.prototype.disableViewCaching=function(){return this.documentView.disableViewCaching()},u.prototype.refreshViewCache=function(){return this.documentView.garbageCollectCachedViews()},u.prototype.isEditingAttachment=function(){return null!=this.attachmentEditor},u.prototype.installAttachmentEditorForAttachment=function(t,e){var n,i,r;if((null!=(r=this.attachmentEditor)?r.attachment:void 0)!==t&&(i=this.documentView.findElementForObject(t)))return this.uninstallAttachmentEditor(),n=this.composition.document.getAttachmentPieceForAttachment(t),this.attachmentEditor=new o.AttachmentEditorController(n,i,this.element,e),this.attachmentEditor.delegate=this},u.prototype.uninstallAttachmentEditor=function(){var t;return null!=(t=this.attachmentEditor)?t.uninstall():void 0},u.prototype.didUninstallAttachmentEditor=function(){return this.attachmentEditor=null,this.render()},u.prototype.attachmentEditorDidRequestUpdatingAttributesForAttachment=function(t,e){var n;return null!=(n=this.delegate)&&"function"==typeof n.compositionControllerWillUpdateAttachment&&n.compositionControllerWillUpdateAttachment(e),this.composition.updateAttributesForAttachment(t,e)},u.prototype.attachmentEditorDidRequestRemovingAttributeForAttachment=function(t,e){var n;return null!=(n=this.delegate)&&"function"==typeof n.compositionControllerWillUpdateAttachment&&n.compositionControllerWillUpdateAttachment(e),this.composition.removeAttributeForAttachment(t,e)},u.prototype.attachmentEditorDidRequestRemovalOfAttachment=function(t){var e;return null!=(e=this.delegate)&&"function"==typeof e.compositionControllerDidRequestRemovalOfAttachment?e.compositionControllerDidRequestRemovalOfAttachment(t):void 0},u.prototype.attachmentEditorDidRequestDeselectingAttachment=function(t){var e;return null!=(e=this.delegate)&&"function"==typeof e.compositionControllerDidRequestDeselectingAttachment?e.compositionControllerDidRequestDeselectingAttachment(t):void 0},u.prototype.canSyncDocumentView=function(){return!this.isEditingAttachment()},u.prototype.findAttachmentForElement=function(t){return this.composition.document.getAttachmentById(parseInt(t.dataset.trixId,10))},u}(o.BasicObject)}.call(this),function(){var t,e,n,i=function(t,e){return function(){return t.apply(e,arguments)}},r=function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;e=o.handleEvent,n=o.triggerEvent,t=o.findClosestElementFromNode,o.ToolbarController=function(o){function a(t){this.element=t,this.didKeyDownDialogInput=i(this.didKeyDownDialogInput,this),this.didClickDialogButton=i(this.didClickDialogButton,this),this.didClickAttributeButton=i(this.didClickAttributeButton,this),this.didClickActionButton=i(this.didClickActionButton,this),this.attributes={},this.actions={},this.resetDialogInputs(),e("mousedown",{onElement:this.element,matchingSelector:s,withCallback:this.didClickActionButton}),e("mousedown",{onElement:this.element,matchingSelector:u,withCallback:this.didClickAttributeButton}),e("click",{onElement:this.element,matchingSelector:v,preventDefault:!0}),e("click",{onElement:this.element,matchingSelector:c,withCallback:this.didClickDialogButton}),e("keydown",{onElement:this.element,matchingSelector:d,withCallback:this.didKeyDownDialogInput})}var s,l,u,c,d,h,f,p,g,m,v;return r(a,o),v=(u="[data-trix-attribute]")+", "+(s="[data-trix-action]"),l=(h="[data-trix-dialog]")+"[data-trix-active]",c=h+" [data-trix-method]",d=h+" [data-trix-input]",a.prototype.didClickActionButton=function(t,e){var n,i,r;return null!=(i=this.delegate)&&i.toolbarDidClickButton(),t.preventDefault(),n=f(e),this.getDialog(n)?this.toggleDialog(n):null!=(r=this.delegate)?r.toolbarDidInvokeAction(n):void 0},a.prototype.didClickAttributeButton=function(t,e){var n,i,r;return null!=(i=this.delegate)&&i.toolbarDidClickButton(),t.preventDefault(),n=p(e),this.getDialog(n)?this.toggleDialog(n):null!=(r=this.delegate)&&r.toolbarDidToggleAttribute(n),this.refreshAttributeButtons()},a.prototype.didClickDialogButton=function(e,n){var i;return i=t(n,{matchingSelector:h}),this[n.getAttribute("data-trix-method")].call(this,i)},a.prototype.didKeyDownDialogInput=function(t,e){var n,i;return 13===t.keyCode&&(t.preventDefault(),n=e.getAttribute("name"),i=this.getDialog(n),this.setAttribute(i)),27===t.keyCode?(t.preventDefault(),this.hideDialog()):void 0},a.prototype.updateActions=function(t){return this.actions=t,this.refreshActionButtons()},a.prototype.refreshActionButtons=function(){return this.eachActionButton(function(t){return function(e,n){return e.disabled=!1===t.actions[n]}}(this))},a.prototype.eachActionButton=function(t){var e,n,i,r,o;for(o=[],n=0,i=(r=this.element.querySelectorAll(s)).length;i>n;n++)e=r[n],o.push(t(e,f(e)));return o},a.prototype.updateAttributes=function(t){return this.attributes=t,this.refreshAttributeButtons()},a.prototype.refreshAttributeButtons=function(){return this.eachAttributeButton(function(t){return function(e,n){return e.disabled=!1===t.attributes[n],t.attributes[n]||t.dialogIsVisible(n)?(e.setAttribute("data-trix-active",""),e.classList.add("trix-active")):(e.removeAttribute("data-trix-active"),e.classList.remove("trix-active"))}}(this))},a.prototype.eachAttributeButton=function(t){var e,n,i,r,o;for(o=[],n=0,i=(r=this.element.querySelectorAll(u)).length;i>n;n++)e=r[n],o.push(t(e,p(e)));return o},a.prototype.applyKeyboardCommand=function(t){var e,i,r,o,a,s;for(o=JSON.stringify(t.sort()),r=0,a=(s=this.element.querySelectorAll("[data-trix-key]")).length;a>r;r++)if(i=(e=s[r]).getAttribute("data-trix-key").split("+"),JSON.stringify(i.sort())===o)return n("mousedown",{onElement:e}),!0;return!1},a.prototype.dialogIsVisible=function(t){var e;return(e=this.getDialog(t))?e.hasAttribute("data-trix-active"):void 0},a.prototype.toggleDialog=function(t){return this.dialogIsVisible(t)?this.hideDialog():this.showDialog(t)},a.prototype.showDialog=function(t){var e,n,i,r,o,a,s,l,u;for(this.hideDialog(),null!=(a=this.delegate)&&a.toolbarWillShowDialog(),(n=this.getDialog(t)).setAttribute("data-trix-active",""),n.classList.add("trix-active"),i=0,o=(s=n.querySelectorAll("input[disabled]")).length;o>i;i++)s[i].removeAttribute("disabled");return(e=p(n))&&(r=m(n,t))&&(r.value=null!=(l=this.attributes[e])?l:"",r.select()),null!=(u=this.delegate)?u.toolbarDidShowDialog(t):void 0},a.prototype.setAttribute=function(t){var e,n,i;return e=p(t),(n=m(t,e)).willValidate&&!n.checkValidity()?(n.setAttribute("data-trix-validate",""),n.classList.add("trix-validate"),n.focus()):(null!=(i=this.delegate)&&i.toolbarDidUpdateAttribute(e,n.value),this.hideDialog())},a.prototype.removeAttribute=function(t){var e,n;return e=p(t),null!=(n=this.delegate)&&n.toolbarDidRemoveAttribute(e),this.hideDialog()},a.prototype.hideDialog=function(){var t,e;return(t=this.element.querySelector(l))?(t.removeAttribute("data-trix-active"),t.classList.remove("trix-active"),this.resetDialogInputs(),null!=(e=this.delegate)?e.toolbarDidHideDialog(g(t)):void 0):void 0},a.prototype.resetDialogInputs=function(){var t,e,n,i,r;for(r=[],t=0,n=(i=this.element.querySelectorAll(d)).length;n>t;t++)(e=i[t]).setAttribute("disabled","disabled"),e.removeAttribute("data-trix-validate"),r.push(e.classList.remove("trix-validate"));return r},a.prototype.getDialog=function(t){return this.element.querySelector("[data-trix-dialog="+t+"]")},m=function(t,e){return null==e&&(e=p(t)),t.querySelector("[data-trix-input][name='"+e+"']")},f=function(t){return t.getAttribute("data-trix-action")},p=function(t){var e;return null!=(e=t.getAttribute("data-trix-attribute"))?e:t.getAttribute("data-trix-dialog-attribute")},g=function(t){return t.getAttribute("data-trix-dialog")},a}(o.BasicObject)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;o.ImagePreloadOperation=function(e){function n(t){this.url=t}return t(n,e),n.prototype.perform=function(t){var e;return(e=new Image).onload=function(n){return function(){return e.width=n.width=e.naturalWidth,e.height=n.height=e.naturalHeight,t(!0,e)}}(this),e.onerror=function(){return t(!1)},e.src=this.url},n}(o.Operation)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;o.Attachment=function(e){function n(t){null==t&&(t={}),this.releaseFile=function(t,e){return function(){return t.apply(e,arguments)}}(this.releaseFile,this),n.__super__.constructor.apply(this,arguments),this.attributes=o.Hash.box(t),this.didChangeAttributes()}return t(n,e),n.previewablePattern=/^image(\/(gif|png|jpe?g)|$)/,n.attachmentForFile=function(t){var e;return(e=new this(this.attributesForFile(t))).setFile(t),e},n.attributesForFile=function(t){return new o.Hash({filename:t.name,filesize:t.size,contentType:t.type})},n.fromJSON=function(t){return new this(t)},n.prototype.getAttribute=function(t){return this.attributes.get(t)},n.prototype.hasAttribute=function(t){return this.attributes.has(t)},n.prototype.getAttributes=function(){return this.attributes.toObject()},n.prototype.setAttributes=function(t){var e,n,i;return null==t&&(t={}),e=this.attributes.merge(t),this.attributes.isEqualTo(e)?void 0:(this.attributes=e,this.didChangeAttributes(),null!=(n=this.previewDelegate)&&"function"==typeof n.attachmentDidChangeAttributes&&n.attachmentDidChangeAttributes(this),null!=(i=this.delegate)&&"function"==typeof i.attachmentDidChangeAttributes?i.attachmentDidChangeAttributes(this):void 0)},n.prototype.didChangeAttributes=function(){return this.isPreviewable()?this.preloadURL():void 0},n.prototype.isPending=function(){return null!=this.file&&!(this.getURL()||this.getHref())},n.prototype.isPreviewable=function(){return this.attributes.has("previewable")?this.attributes.get("previewable"):this.constructor.previewablePattern.test(this.getContentType())},n.prototype.getType=function(){return this.hasContent()?"content":this.isPreviewable()?"preview":"file"},n.prototype.getURL=function(){return this.attributes.get("url")},n.prototype.getHref=function(){return this.attributes.get("href")},n.prototype.getFilename=function(){var t;return null!=(t=this.attributes.get("filename"))?t:""},n.prototype.getFilesize=function(){return this.attributes.get("filesize")},n.prototype.getFormattedFilesize=function(){var t;return"number"==typeof(t=this.attributes.get("filesize"))?o.config.fileSize.formatter(t):""},n.prototype.getExtension=function(){var t;return null!=(t=this.getFilename().match(/\.(\w+)$/))?t[1].toLowerCase():void 0},n.prototype.getContentType=function(){return this.attributes.get("contentType")},n.prototype.hasContent=function(){return this.attributes.has("content")},n.prototype.getContent=function(){return this.attributes.get("content")},n.prototype.getWidth=function(){return this.attributes.get("width")},n.prototype.getHeight=function(){return this.attributes.get("height")},n.prototype.getFile=function(){return this.file},n.prototype.setFile=function(t){return this.file=t,this.isPreviewable()?this.preloadFile():void 0},n.prototype.releaseFile=function(){return this.releasePreloadedFile(),this.file=null},n.prototype.getUploadProgress=function(){var t;return null!=(t=this.uploadProgress)?t:0},n.prototype.setUploadProgress=function(t){var e;return this.uploadProgress!==t?(this.uploadProgress=t,null!=(e=this.uploadProgressDelegate)&&"function"==typeof e.attachmentDidChangeUploadProgress?e.attachmentDidChangeUploadProgress(this):void 0):void 0},n.prototype.toJSON=function(){return this.getAttributes()},n.prototype.getCacheKey=function(){return[n.__super__.getCacheKey.apply(this,arguments),this.attributes.getCacheKey(),this.getPreviewURL()].join("/")},n.prototype.getPreviewURL=function(){return this.previewURL||this.preloadingURL},n.prototype.setPreviewURL=function(t){var e,n;return t!==this.getPreviewURL()?(this.previewURL=t,null!=(e=this.previewDelegate)&&"function"==typeof e.attachmentDidChangeAttributes&&e.attachmentDidChangeAttributes(this),null!=(n=this.delegate)&&"function"==typeof n.attachmentDidChangePreviewURL?n.attachmentDidChangePreviewURL(this):void 0):void 0},n.prototype.preloadURL=function(){return this.preload(this.getURL(),this.releaseFile)},n.prototype.preloadFile=function(){return this.file?(this.fileObjectURL=URL.createObjectURL(this.file),this.preload(this.fileObjectURL)):void 0},n.prototype.releasePreloadedFile=function(){return this.fileObjectURL?(URL.revokeObjectURL(this.fileObjectURL),this.fileObjectURL=null):void 0},n.prototype.preload=function(t,e){return t&&t!==this.getPreviewURL()?(this.preloadingURL=t,new o.ImagePreloadOperation(t).then(function(n){return function(i){var r,o;return o=i.width,r=i.height,n.getWidth()&&n.getHeight()||n.setAttributes({width:o,height:r}),n.preloadingURL=null,n.setPreviewURL(t),"function"==typeof e?e():void 0}}(this)).catch(function(t){return function(){return t.preloadingURL=null,"function"==typeof e?e():void 0}}(this))):void 0},n}(o.Object)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;o.Piece=function(e){function n(t,e){null==e&&(e={}),n.__super__.constructor.apply(this,arguments),this.attributes=o.Hash.box(e)}return t(n,e),n.types={},n.registerType=function(t,e){return e.type=t,this.types[t]=e},n.fromJSON=function(t){var e;return(e=this.types[t.type])?e.fromJSON(t):void 0},n.prototype.copyWithAttributes=function(t){return new this.constructor(this.getValue(),t)},n.prototype.copyWithAdditionalAttributes=function(t){return this.copyWithAttributes(this.attributes.merge(t))},n.prototype.copyWithoutAttribute=function(t){return this.copyWithAttributes(this.attributes.remove(t))},n.prototype.copy=function(){return this.copyWithAttributes(this.attributes)},n.prototype.getAttribute=function(t){return this.attributes.get(t)},n.prototype.getAttributesHash=function(){return this.attributes},n.prototype.getAttributes=function(){return this.attributes.toObject()},n.prototype.getCommonAttributes=function(){var t,e,n;return(n=pieceList.getPieceAtIndex(0))?(t=n.attributes,e=t.getKeys(),pieceList.eachPiece((function(n){return e=t.getKeysCommonToHash(n.attributes),t=t.slice(e)})),t.toObject()):{}},n.prototype.hasAttribute=function(t){return this.attributes.has(t)},n.prototype.hasSameStringValueAsPiece=function(t){return null!=t&&this.toString()===t.toString()},n.prototype.hasSameAttributesAsPiece=function(t){return null!=t&&(this.attributes===t.attributes||this.attributes.isEqualTo(t.attributes))},n.prototype.isBlockBreak=function(){return!1},n.prototype.isEqualTo=function(t){return n.__super__.isEqualTo.apply(this,arguments)||this.hasSameConstructorAs(t)&&this.hasSameStringValueAsPiece(t)&&this.hasSameAttributesAsPiece(t)},n.prototype.isEmpty=function(){return 0===this.length},n.prototype.isSerializable=function(){return!0},n.prototype.toJSON=function(){return{type:this.constructor.type,attributes:this.getAttributes()}},n.prototype.contentsForInspection=function(){return{type:this.constructor.type,attributes:this.attributes.inspect()}},n.prototype.canBeGrouped=function(){return this.hasAttribute("href")},n.prototype.canBeGroupedWith=function(t){return this.getAttribute("href")===t.getAttribute("href")},n.prototype.getLength=function(){return this.length},n.prototype.canBeConsolidatedWith=function(){return!1},n}(o.Object)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;o.Piece.registerType("attachment",o.AttachmentPiece=function(e){function n(t){this.attachment=t,n.__super__.constructor.apply(this,arguments),this.length=1,this.ensureAttachmentExclusivelyHasAttribute("href"),this.attachment.hasContent()||this.removeProhibitedAttributes()}return t(n,e),n.fromJSON=function(t){return new this(o.Attachment.fromJSON(t.attachment),t.attributes)},n.permittedAttributes=["caption","presentation"],n.prototype.ensureAttachmentExclusivelyHasAttribute=function(t){return this.hasAttribute(t)?(this.attachment.hasAttribute(t)||this.attachment.setAttributes(this.attributes.slice(t)),this.attributes=this.attributes.remove(t)):void 0},n.prototype.removeProhibitedAttributes=function(){var t;return(t=this.attributes.slice(this.constructor.permittedAttributes)).isEqualTo(this.attributes)?void 0:this.attributes=t},n.prototype.getValue=function(){return this.attachment},n.prototype.isSerializable=function(){return!this.attachment.isPending()},n.prototype.getCaption=function(){var t;return null!=(t=this.attributes.get("caption"))?t:""},n.prototype.isEqualTo=function(t){var e;return n.__super__.isEqualTo.apply(this,arguments)&&this.attachment.id===(null!=t&&null!=(e=t.attachment)?e.id:void 0)},n.prototype.toString=function(){return o.OBJECT_REPLACEMENT_CHARACTER},n.prototype.toJSON=function(){var t;return(t=n.__super__.toJSON.apply(this,arguments)).attachment=this.attachment,t},n.prototype.getCacheKey=function(){return[n.__super__.getCacheKey.apply(this,arguments),this.attachment.getCacheKey()].join("/")},n.prototype.toConsole=function(){return JSON.stringify(this.toString())},n}(o.Piece))}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty;t=o.normalizeNewlines,o.Piece.registerType("string",o.StringPiece=function(n){function i(e){i.__super__.constructor.apply(this,arguments),this.string=t(e),this.length=this.string.length}return e(i,n),i.fromJSON=function(t){return new this(t.string,t.attributes)},i.prototype.getValue=function(){return this.string},i.prototype.toString=function(){return this.string.toString()},i.prototype.isBlockBreak=function(){return"\n"===this.toString()&&!0===this.getAttribute("blockBreak")},i.prototype.toJSON=function(){var t;return(t=i.__super__.toJSON.apply(this,arguments)).string=this.string,t},i.prototype.canBeConsolidatedWith=function(t){return null!=t&&this.hasSameConstructorAs(t)&&this.hasSameAttributesAsPiece(t)},i.prototype.consolidateWith=function(t){return new this.constructor(this.toString()+t.toString(),this.attributes)},i.prototype.splitAtOffset=function(t){var e,n;return 0===t?(e=null,n=this):t===this.length?(e=this,n=null):(e=new this.constructor(this.string.slice(0,t),this.attributes),n=new this.constructor(this.string.slice(t),this.attributes)),[e,n]},i.prototype.toConsole=function(){var t;return(t=this.string).length>15&&(t=t.slice(0,14)+"…"),JSON.stringify(t.toString())},i}(o.Piece))}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},n={}.hasOwnProperty,i=[].slice;t=o.spliceArray,o.SplittableList=function(n){function r(t){null==t&&(t=[]),r.__super__.constructor.apply(this,arguments),this.objects=t.slice(0),this.length=this.objects.length}var o,a,s;return e(r,n),r.box=function(t){return t instanceof this?t:new this(t)},r.prototype.indexOf=function(t){return this.objects.indexOf(t)},r.prototype.splice=function(){var e;return e=1<=arguments.length?i.call(arguments,0):[],new this.constructor(t.apply(null,[this.objects].concat(i.call(e))))},r.prototype.eachObject=function(t){var e,n,i,r,o,a;for(a=[],n=e=0,i=(o=this.objects).length;i>e;n=++e)r=o[n],a.push(t(r,n));return a},r.prototype.insertObjectAtIndex=function(t,e){return this.splice(e,0,t)},r.prototype.insertSplittableListAtIndex=function(t,e){return this.splice.apply(this,[e,0].concat(i.call(t.objects)))},r.prototype.insertSplittableListAtPosition=function(t,e){var n,i,r;return i=(r=this.splitObjectAtPosition(e))[0],n=r[1],new this.constructor(i).insertSplittableListAtIndex(t,n)},r.prototype.editObjectAtIndex=function(t,e){return this.replaceObjectAtIndex(e(this.objects[t]),t)},r.prototype.replaceObjectAtIndex=function(t,e){return this.splice(e,1,t)},r.prototype.removeObjectAtIndex=function(t){return this.splice(t,1)},r.prototype.getObjectAtIndex=function(t){return this.objects[t]},r.prototype.getSplittableListInRange=function(t){var e,n,i,r;return n=(i=this.splitObjectsAtRange(t))[0],e=i[1],r=i[2],new this.constructor(n.slice(e,r+1))},r.prototype.selectSplittableList=function(t){var e,n;return n=function(){var n,i,r,o;for(o=[],n=0,i=(r=this.objects).length;i>n;n++)e=r[n],t(e)&&o.push(e);return o}.call(this),new this.constructor(n)},r.prototype.removeObjectsInRange=function(t){var e,n,i,r;return n=(i=this.splitObjectsAtRange(t))[0],e=i[1],r=i[2],new this.constructor(n).splice(e,r-e+1)},r.prototype.transformObjectsInRange=function(t,e){var n,i,r,o,a,s,l;return a=this.splitObjectsAtRange(t),o=a[0],i=a[1],s=a[2],l=function(){var t,a,l;for(l=[],n=t=0,a=o.length;a>t;n=++t)r=o[n],l.push(n>=i&&s>=n?e(r):r);return l}(),new this.constructor(l)},r.prototype.splitObjectsAtRange=function(t){var e,n,i,r,a;return n=(r=this.splitObjectAtPosition(s(t)))[0],e=r[1],i=r[2],[n=(a=new this.constructor(n).splitObjectAtPosition(o(t)+i))[0],e,a[1]-1]},r.prototype.getObjectAtPosition=function(t){var e,n;return e=(n=this.findIndexAndOffsetAtPosition(t)).index,n.offset,this.objects[e]},r.prototype.splitObjectAtPosition=function(t){var e,n,i,r,o,a,s,l,u;return e=(o=this.findIndexAndOffsetAtPosition(t)).index,r=o.offset,i=this.objects.slice(0),null!=e?0===r?(l=e,u=0):(n=(a=this.getObjectAtIndex(e).splitAtOffset(r))[0],s=a[1],i.splice(e,1,n,s),l=e+1,u=n.getLength()-r):(l=i.length,u=0),[i,l,u]},r.prototype.consolidate=function(){var t,e,n,i,r,o;for(i=[],r=this.objects[0],t=0,e=(o=this.objects.slice(1)).length;e>t;t++)n=o[t],("function"==typeof r.canBeConsolidatedWith?r.canBeConsolidatedWith(n):void 0)?r=r.consolidateWith(n):(i.push(r),r=n);return null!=r&&i.push(r),new this.constructor(i)},r.prototype.consolidateFromIndexToIndex=function(t,e){var n,r;return r=this.objects.slice(0).slice(t,e+1),n=new this.constructor(r).consolidate().toArray(),this.splice.apply(this,[t,r.length].concat(i.call(n)))},r.prototype.findIndexAndOffsetAtPosition=function(t){var e,n,i,r,o,a;for(e=0,i=n=0,r=(a=this.objects).length;r>n;i=++n){if(o=e+a[i].getLength(),t>=e&&o>t)return{index:i,offset:t-e};e=o}return{index:null,offset:null}},r.prototype.findPositionAtIndexAndOffset=function(t,e){var n,i,r,o,a,s;for(a=0,n=i=0,r=(s=this.objects).length;r>i;n=++i)if(o=s[n],t>n)a+=o.getLength();else if(n===t){a+=e;break}return a},r.prototype.getEndPosition=function(){var t,e;return null!=this.endPosition?this.endPosition:this.endPosition=function(){var n,i,r;for(e=0,n=0,i=(r=this.objects).length;i>n;n++)t=r[n],e+=t.getLength();return e}.call(this)},r.prototype.toString=function(){return this.objects.join("")},r.prototype.toArray=function(){return this.objects.slice(0)},r.prototype.toJSON=function(){return this.toArray()},r.prototype.isEqualTo=function(t){return r.__super__.isEqualTo.apply(this,arguments)||a(this.objects,null!=t?t.objects:void 0)},a=function(t,e){var n,i,r,o,a;if(null==e&&(e=[]),t.length!==e.length)return!1;for(a=!0,i=n=0,r=t.length;r>n;i=++n)o=t[i],a&&!o.isEqualTo(e[i])&&(a=!1);return a},r.prototype.contentsForInspection=function(){var t;return{objects:"["+function(){var e,n,i,r;for(r=[],e=0,n=(i=this.objects).length;n>e;e++)t=i[e],r.push(t.inspect());return r}.call(this).join(", ")+"]"}},s=function(t){return t[0]},o=function(t){return t[1]},r}(o.Object)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;o.Text=function(e){function n(t){var e;null==t&&(t=[]),n.__super__.constructor.apply(this,arguments),this.pieceList=new o.SplittableList(function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)(e=t[n]).isEmpty()||r.push(e);return r}())}return t(n,e),n.textForAttachmentWithAttributes=function(t,e){return new this([new o.AttachmentPiece(t,e)])},n.textForStringWithAttributes=function(t,e){return new this([new o.StringPiece(t,e)])},n.fromJSON=function(t){var e;return new this(function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(o.Piece.fromJSON(e));return r}())},n.prototype.copy=function(){return this.copyWithPieceList(this.pieceList)},n.prototype.copyWithPieceList=function(t){return new this.constructor(t.consolidate().toArray())},n.prototype.copyUsingObjectMap=function(t){var e,n;return n=function(){var n,i,r,o,a;for(a=[],n=0,i=(r=this.getPieces()).length;i>n;n++)e=r[n],a.push(null!=(o=t.find(e))?o:e);return a}.call(this),new this.constructor(n)},n.prototype.appendText=function(t){return this.insertTextAtPosition(t,this.getLength())},n.prototype.insertTextAtPosition=function(t,e){return this.copyWithPieceList(this.pieceList.insertSplittableListAtPosition(t.pieceList,e))},n.prototype.removeTextAtRange=function(t){return this.copyWithPieceList(this.pieceList.removeObjectsInRange(t))},n.prototype.replaceTextAtRange=function(t,e){return this.removeTextAtRange(e).insertTextAtPosition(t,e[0])},n.prototype.moveTextFromRangeToPosition=function(t,e){var n,i;if(!(t[0]<=e&&e<=t[1]))return n=(i=this.getTextAtRange(t)).getLength(),t[0]<e&&(e-=n),this.removeTextAtRange(t).insertTextAtPosition(i,e)},n.prototype.addAttributeAtRange=function(t,e,n){var i;return(i={})[t]=e,this.addAttributesAtRange(i,n)},n.prototype.addAttributesAtRange=function(t,e){return this.copyWithPieceList(this.pieceList.transformObjectsInRange(e,(function(e){return e.copyWithAdditionalAttributes(t)})))},n.prototype.removeAttributeAtRange=function(t,e){return this.copyWithPieceList(this.pieceList.transformObjectsInRange(e,(function(e){return e.copyWithoutAttribute(t)})))},n.prototype.setAttributesAtRange=function(t,e){return this.copyWithPieceList(this.pieceList.transformObjectsInRange(e,(function(e){return e.copyWithAttributes(t)})))},n.prototype.getAttributesAtPosition=function(t){var e,n;return null!=(e=null!=(n=this.pieceList.getObjectAtPosition(t))?n.getAttributes():void 0)?e:{}},n.prototype.getCommonAttributes=function(){var t,e;return t=function(){var t,n,i,r;for(r=[],t=0,n=(i=this.pieceList.toArray()).length;n>t;t++)e=i[t],r.push(e.getAttributes());return r}.call(this),o.Hash.fromCommonAttributesOfObjects(t).toObject()},n.prototype.getCommonAttributesAtRange=function(t){var e;return null!=(e=this.getTextAtRange(t).getCommonAttributes())?e:{}},n.prototype.getExpandedRangeForAttributeAtOffset=function(t,e){var n,i,r;for(n=r=e,i=this.getLength();n>0&&this.getCommonAttributesAtRange([n-1,r])[t];)n--;for(;i>r&&this.getCommonAttributesAtRange([e,r+1])[t];)r++;return[n,r]},n.prototype.getTextAtRange=function(t){return this.copyWithPieceList(this.pieceList.getSplittableListInRange(t))},n.prototype.getStringAtRange=function(t){return this.pieceList.getSplittableListInRange(t).toString()},n.prototype.getStringAtPosition=function(t){return this.getStringAtRange([t,t+1])},n.prototype.startsWithString=function(t){return this.getStringAtRange([0,t.length])===t},n.prototype.endsWithString=function(t){var e;return e=this.getLength(),this.getStringAtRange([e-t.length,e])===t},n.prototype.getAttachmentPieces=function(){var t,e,n,i,r;for(r=[],t=0,e=(i=this.pieceList.toArray()).length;e>t;t++)null!=(n=i[t]).attachment&&r.push(n);return r},n.prototype.getAttachments=function(){var t,e,n,i,r;for(r=[],t=0,e=(i=this.getAttachmentPieces()).length;e>t;t++)n=i[t],r.push(n.attachment);return r},n.prototype.getAttachmentAndPositionById=function(t){var e,n,i,r,o,a;for(r=0,e=0,n=(o=this.pieceList.toArray()).length;n>e;e++){if((null!=(a=(i=o[e]).attachment)?a.id:void 0)===t)return{attachment:i.attachment,position:r};r+=i.length}return{attachment:null,position:null}},n.prototype.getAttachmentById=function(t){var e,n;return e=(n=this.getAttachmentAndPositionById(t)).attachment,n.position,e},n.prototype.getRangeOfAttachment=function(t){var e,n;return t=(n=this.getAttachmentAndPositionById(t.id)).attachment,e=n.position,null!=t?[e,e+1]:void 0},n.prototype.updateAttributesForAttachment=function(t,e){var n;return(n=this.getRangeOfAttachment(e))?this.addAttributesAtRange(t,n):this},n.prototype.getLength=function(){return this.pieceList.getEndPosition()},n.prototype.isEmpty=function(){return 0===this.getLength()},n.prototype.isEqualTo=function(t){var e;return n.__super__.isEqualTo.apply(this,arguments)||(null!=t&&null!=(e=t.pieceList)?e.isEqualTo(this.pieceList):void 0)},n.prototype.isBlockBreak=function(){return 1===this.getLength()&&this.pieceList.getObjectAtIndex(0).isBlockBreak()},n.prototype.eachPiece=function(t){return this.pieceList.eachObject(t)},n.prototype.getPieces=function(){return this.pieceList.toArray()},n.prototype.getPieceAtPosition=function(t){return this.pieceList.getObjectAtPosition(t)},n.prototype.contentsForInspection=function(){return{pieceList:this.pieceList.inspect()}},n.prototype.toSerializableText=function(){var t;return t=this.pieceList.selectSplittableList((function(t){return t.isSerializable()})),this.copyWithPieceList(t)},n.prototype.toString=function(){return this.pieceList.toString()},n.prototype.toJSON=function(){return this.pieceList.toJSON()},n.prototype.toConsole=function(){var t;return JSON.stringify(function(){var e,n,i,r;for(r=[],e=0,n=(i=this.pieceList.toArray()).length;n>e;e++)t=i[e],r.push(JSON.parse(t.toConsole()));return r}.call(this))},n.prototype.getDirection=function(){return o.getDirection(this.toString())},n.prototype.isRTL=function(){return"rtl"===this.getDirection()},n}(o.Object)}.call(this),function(){var t,e,n,i,r=function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty,s=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},l=[].slice;t=o.arraysAreEqual,i=o.spliceArray,e=o.getBlockConfig,o.getBlockAttributeNames,n=o.getListAttributeNames,o.Block=function(a){function u(t,e){null==t&&(t=new o.Text),null==e&&(e=[]),u.__super__.constructor.apply(this,arguments),this.text=d(t),this.attributes=e}var c,d,h,f,p,g,m,v,y;return r(u,a),u.fromJSON=function(t){return new this(o.Text.fromJSON(t.text),t.attributes)},u.prototype.isEmpty=function(){return this.text.isBlockBreak()},u.prototype.isEqualTo=function(e){return u.__super__.isEqualTo.apply(this,arguments)||this.text.isEqualTo(null!=e?e.text:void 0)&&t(this.attributes,null!=e?e.attributes:void 0)},u.prototype.copyWithText=function(t){return new this.constructor(t,this.attributes)},u.prototype.copyWithoutText=function(){return this.copyWithText(null)},u.prototype.copyWithAttributes=function(t){return new this.constructor(this.text,t)},u.prototype.copyWithoutAttributes=function(){return this.copyWithAttributes(null)},u.prototype.copyUsingObjectMap=function(t){var e;return this.copyWithText((e=t.find(this.text))?e:this.text.copyUsingObjectMap(t))},u.prototype.addAttribute=function(t){var e;return e=this.attributes.concat(f(t)),this.copyWithAttributes(e)},u.prototype.removeAttribute=function(t){var n,i;return i=e(t).listAttribute,n=g(g(this.attributes,t),i),this.copyWithAttributes(n)},u.prototype.removeLastAttribute=function(){return this.removeAttribute(this.getLastAttribute())},u.prototype.getLastAttribute=function(){return p(this.attributes)},u.prototype.getAttributes=function(){return this.attributes.slice(0)},u.prototype.getAttributeLevel=function(){return this.attributes.length},u.prototype.getAttributeAtLevel=function(t){return this.attributes[t-1]},u.prototype.hasAttribute=function(t){return s.call(this.attributes,t)>=0},u.prototype.hasAttributes=function(){return this.getAttributeLevel()>0},u.prototype.getLastNestableAttribute=function(){return p(this.getNestableAttributes())},u.prototype.getNestableAttributes=function(){var t,n,i,r,o;for(o=[],n=0,i=(r=this.attributes).length;i>n;n++)t=r[n],e(t).nestable&&o.push(t);return o},u.prototype.getNestingLevel=function(){return this.getNestableAttributes().length},u.prototype.decreaseNestingLevel=function(){var t;return(t=this.getLastNestableAttribute())?this.removeAttribute(t):this},u.prototype.increaseNestingLevel=function(){var t,e,n;return(t=this.getLastNestableAttribute())?(n=this.attributes.lastIndexOf(t),e=i.apply(null,[this.attributes,n+1,0].concat(l.call(f(t)))),this.copyWithAttributes(e)):this},u.prototype.getListItemAttributes=function(){var t,n,i,r,o;for(o=[],n=0,i=(r=this.attributes).length;i>n;n++)t=r[n],e(t).listAttribute&&o.push(t);return o},u.prototype.isListItem=function(){var t;return null!=(t=e(this.getLastAttribute()))?t.listAttribute:void 0},u.prototype.isTerminalBlock=function(){var t;return null!=(t=e(this.getLastAttribute()))?t.terminal:void 0},u.prototype.breaksOnReturn=function(){var t;return null!=(t=e(this.getLastAttribute()))?t.breakOnReturn:void 0},u.prototype.findLineBreakInDirectionFromPosition=function(t,e){var n,i;return i=this.toString(),-1!==(n=function(){switch(t){case"forward":return i.indexOf("\n",e);case"backward":return i.slice(0,e).lastIndexOf("\n")}}())?n:void 0},u.prototype.contentsForInspection=function(){return{text:this.text.inspect(),attributes:this.attributes}},u.prototype.toString=function(){return this.text.toString()},u.prototype.toJSON=function(){return{text:this.text,attributes:this.attributes}},u.prototype.getDirection=function(){return this.text.getDirection()},u.prototype.isRTL=function(){return this.text.isRTL()},u.prototype.getLength=function(){return this.text.getLength()},u.prototype.canBeConsolidatedWith=function(t){return!this.hasAttributes()&&!t.hasAttributes()&&this.getDirection()===t.getDirection()},u.prototype.consolidateWith=function(t){var e,n;return e=o.Text.textForStringWithAttributes("\n"),n=this.getTextWithoutBlockBreak().appendText(e),this.copyWithText(n.appendText(t.text))},u.prototype.splitAtOffset=function(t){var e,n;return 0===t?(e=null,n=this):t===this.getLength()?(e=this,n=null):(e=this.copyWithText(this.text.getTextAtRange([0,t])),n=this.copyWithText(this.text.getTextAtRange([t,this.getLength()]))),[e,n]},u.prototype.getBlockBreakPosition=function(){return this.text.getLength()-1},u.prototype.getTextWithoutBlockBreak=function(){return m(this.text)?this.text.getTextAtRange([0,this.getBlockBreakPosition()]):this.text.copy()},u.prototype.canBeGrouped=function(t){return this.attributes[t]},u.prototype.canBeGroupedWith=function(t,i){var r,o,a,l;return o=(a=t.getAttributes())[i],!((r=this.attributes[i])!==o||!1===e(r).group&&(l=a[i+1],s.call(n(),l)<0)||this.getDirection()!==t.getDirection()&&!t.isEmpty())},d=function(t){return t=y(t),c(t)},y=function(t){var e,n,i,r,a,s;return r=!1,s=t.getPieces(),n=2<=s.length?l.call(s,0,e=s.length-1):(e=0,[]),null==(i=s[e++])?t:(n=function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)(a=n[t]).isBlockBreak()?(r=!0,i.push(v(a))):i.push(a);return i}(),r?new o.Text(l.call(n).concat([i])):t)},h=o.Text.textForStringWithAttributes("\n",{blockBreak:!0}),c=function(t){return m(t)?t:t.appendText(h)},m=function(t){var e;return 0!==(e=t.getLength())&&t.getTextAtRange([e-1,e]).isBlockBreak()},v=function(t){return t.copyWithoutAttribute("blockBreak")},f=function(t){var n;return null!=(n=e(t).listAttribute)?[n,t]:[t]},p=function(t){return t.slice(-1)[0]},g=function(t,e){var n;return-1===(n=t.lastIndexOf(e))?t:i(t,n,1)},u}(o.Object)}.call(this),function(){var t,e,n,i=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty,a=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},s=[].slice;e=o.tagName,n=o.walkTree,t=o.nodeIsAttachmentElement,o.HTMLSanitizer=function(r){function l(t,e){var n;n=null!=e?e:{},this.allowedAttributes=n.allowedAttributes,this.forbiddenProtocols=n.forbiddenProtocols,this.forbiddenElements=n.forbiddenElements,null==this.allowedAttributes&&(this.allowedAttributes=u),null==this.forbiddenProtocols&&(this.forbiddenProtocols=d),null==this.forbiddenElements&&(this.forbiddenElements=c),this.body=h(t)}var u,c,d,h;return i(l,r),u="style href src width height class".split(" "),d="javascript:".split(" "),c="script iframe noscript".split(" "),l.sanitize=function(t,e){var n;return(n=new this(t,e)).sanitize(),n},l.prototype.sanitize=function(){return this.sanitizeElements(),this.normalizeListElementNesting()},l.prototype.getHTML=function(){return this.body.innerHTML},l.prototype.getBody=function(){return this.body},l.prototype.sanitizeElements=function(){var t,e,i,r,a;for(a=n(this.body),r=[];a.nextNode();)switch(i=a.currentNode,i.nodeType){case Node.ELEMENT_NODE:this.elementIsRemovable(i)?r.push(i):this.sanitizeElement(i);break;case Node.COMMENT_NODE:r.push(i)}for(t=0,e=r.length;e>t;t++)i=r[t],o.removeNode(i);return this.body},l.prototype.sanitizeElement=function(t){var e,n,i,r,o;for(t.hasAttribute("href")&&(r=t.protocol,a.call(this.forbiddenProtocols,r)>=0&&t.removeAttribute("href")),e=0,n=(o=s.call(t.attributes)).length;n>e;e++)i=o[e].name,a.call(this.allowedAttributes,i)>=0||0===i.indexOf("data-trix")||t.removeAttribute(i);return t},l.prototype.normalizeListElementNesting=function(){var t,n,i,r,o;for(t=0,n=(o=s.call(this.body.querySelectorAll("ul,ol"))).length;n>t;t++)(r=(i=o[t]).previousElementSibling)&&"li"===e(r)&&r.appendChild(i);return this.body},l.prototype.elementIsRemovable=function(t){return(null!=t?t.nodeType:void 0)===Node.ELEMENT_NODE?this.elementIsForbidden(t)||this.elementIsntSerializable(t):void 0},l.prototype.elementIsForbidden=function(t){var n;return n=e(t),a.call(this.forbiddenElements,n)>=0},l.prototype.elementIsntSerializable=function(e){return"false"===e.getAttribute("data-trix-serialize")&&!t(e)},h=function(t){var e,n,i,r,o;for(null==t&&(t=""),t=t.replace(/<\/html[^>]*>[^]*$/i,"</html>"),(e=document.implementation.createHTMLDocument("")).documentElement.innerHTML=t,i=0,r=(o=e.head.querySelectorAll("style")).length;r>i;i++)n=o[i],e.body.appendChild(n);return e.body},l}(o.BasicObject)}.call(this),function(){var t,e,n,i,r,a,s,l,u,c,d,h=function(t,e){function n(){this.constructor=t}for(var i in e)f.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty,p=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};t=o.arraysAreEqual,a=o.makeElement,c=o.tagName,r=o.getBlockTagNames,d=o.walkTree,i=o.findClosestElementFromNode,n=o.elementContainsNode,s=o.nodeIsAttachmentElement,l=o.normalizeSpaces,e=o.breakableWhitespacePattern,u=o.squishBreakableWhitespace,o.HTMLParser=function(f){function g(t,e){this.html=t,this.referenceElement=(null!=e?e:{}).referenceElement,this.blocks=[],this.blockElements=[],this.processedElements=[]}var m,v,y,b,E,T,A,S,w,L,x,D;return h(g,f),g.parse=function(t,e){var n;return(n=new this(t,e)).parse(),n},g.prototype.getDocument=function(){return o.Document.fromJSON(this.blocks)},g.prototype.parse=function(){var t,e;try{for(this.createHiddenContainer(),t=o.HTMLSanitizer.sanitize(this.html).getHTML(),this.containerElement.innerHTML=t,e=d(this.containerElement,{usingFilter:A});e.nextNode();)this.processNode(e.currentNode);return this.translateBlockElementMarginsToNewlines()}finally{this.removeHiddenContainer()}},g.prototype.createHiddenContainer=function(){return this.referenceElement?(this.containerElement=this.referenceElement.cloneNode(!1),this.containerElement.removeAttribute("id"),this.containerElement.setAttribute("data-trix-internal",""),this.containerElement.style.display="none",this.referenceElement.parentNode.insertBefore(this.containerElement,this.referenceElement.nextSibling)):(this.containerElement=a({tagName:"div",style:{display:"none"}}),document.body.appendChild(this.containerElement))},g.prototype.removeHiddenContainer=function(){return o.removeNode(this.containerElement)},A=function(t){return"style"===c(t)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},g.prototype.processNode=function(t){switch(t.nodeType){case Node.TEXT_NODE:if(!this.isInsignificantTextNode(t))return this.appendBlockForTextNode(t),this.processTextNode(t);break;case Node.ELEMENT_NODE:return this.appendBlockForElement(t),this.processElement(t)}},g.prototype.appendBlockForTextNode=function(e){var n,i,r;return(i=e.parentNode)===this.currentBlockElement&&this.isBlockElement(e.previousSibling)?this.appendStringWithAttributes("\n"):i!==this.containerElement&&!this.isBlockElement(i)||(n=this.getBlockAttributes(i),t(n,null!=(r=this.currentBlock)?r.attributes:void 0))?void 0:(this.currentBlock=this.appendBlockForAttributesWithElement(n,i),this.currentBlockElement=i)},g.prototype.appendBlockForElement=function(e){var i,r,o,a;if(o=this.isBlockElement(e),r=n(this.currentBlockElement,e),o&&!this.isBlockElement(e.firstChild)){if((!this.isInsignificantTextNode(e.firstChild)||!this.isBlockElement(e.firstElementChild))&&(i=this.getBlockAttributes(e),e.firstChild))return r&&t(i,this.currentBlock.attributes)?this.appendStringWithAttributes("\n"):(this.currentBlock=this.appendBlockForAttributesWithElement(i,e),this.currentBlockElement=e)}else if(this.currentBlockElement&&!r&&!o)return(a=this.findParentBlockElement(e))?this.appendBlockForElement(a):(this.currentBlock=this.appendEmptyBlock(),this.currentBlockElement=null)},g.prototype.findParentBlockElement=function(t){var e;for(e=t.parentElement;e&&e!==this.containerElement;){if(this.isBlockElement(e)&&p.call(this.blockElements,e)>=0)return e;e=e.parentElement}return null},g.prototype.processTextNode=function(t){var e,n;return n=t.data,v(t.parentNode)||(n=u(n),x(null!=(e=t.previousSibling)?e.textContent:void 0)&&(n=E(n))),this.appendStringWithAttributes(n,this.getTextAttributes(t.parentNode))},g.prototype.processElement=function(t){var e,n,i,r,o;if(s(t))return e=S(t,"attachment"),Object.keys(e).length&&(r=this.getTextAttributes(t),this.appendAttachmentWithAttributes(e,r),t.innerHTML=""),this.processedElements.push(t);switch(c(t)){case"br":return this.isExtraBR(t)||this.isBlockElement(t.nextSibling)||this.appendStringWithAttributes("\n",this.getTextAttributes(t)),this.processedElements.push(t);case"img":for(n in e={url:t.getAttribute("src"),contentType:"image"},i=b(t))o=i[n],e[n]=o;return this.appendAttachmentWithAttributes(e,this.getTextAttributes(t)),this.processedElements.push(t);case"tr":if(t.parentNode.firstChild!==t)return this.appendStringWithAttributes("\n");break;case"td":if(t.parentNode.firstChild!==t)return this.appendStringWithAttributes(" | ")}},g.prototype.appendBlockForAttributesWithElement=function(t,e){var n;return this.blockElements.push(e),n=m(t),this.blocks.push(n),n},g.prototype.appendEmptyBlock=function(){return this.appendBlockForAttributesWithElement([],null)},g.prototype.appendStringWithAttributes=function(t,e){return this.appendPiece(L(t,e))},g.prototype.appendAttachmentWithAttributes=function(t,e){return this.appendPiece(w(t,e))},g.prototype.appendPiece=function(t){return 0===this.blocks.length&&this.appendEmptyBlock(),this.blocks[this.blocks.length-1].text.push(t)},g.prototype.appendStringToTextAtIndex=function(t,e){var n,i;return"string"===(null!=(n=(i=this.blocks[e].text)[i.length-1])?n.type:void 0)?n.string+=t:i.push(L(t))},g.prototype.prependStringToTextAtIndex=function(t,e){var n,i;return"string"===(null!=(n=(i=this.blocks[e].text)[0])?n.type:void 0)?n.string=t+n.string:i.unshift(L(t))},L=function(t,e){return null==e&&(e={}),{string:t=l(t),attributes:e,type:"string"}},w=function(t,e){return null==e&&(e={}),{attachment:t,attributes:e,type:"attachment"}},m=function(t){return null==t&&(t={}),{text:[],attributes:t}},g.prototype.getTextAttributes=function(t){var e,n,r,a,l,u,c,d,h,f,p,g;for(e in r={},h=o.config.textAttributes)if((l=h[e]).tagName&&i(t,{matchingSelector:l.tagName,untilNode:this.containerElement}))r[e]=!0;else if(l.parser){if(g=l.parser(t)){for(n=!1,u=0,d=(f=this.findBlockElementAncestors(t)).length;d>u;u++)if(a=f[u],l.parser(a)===g){n=!0;break}n||(r[e]=g)}}else l.styleProperty&&(g=t.style[l.styleProperty])&&(r[e]=g);if(s(t))for(c in p=S(t,"attributes"))g=p[c],r[c]=g;return r},g.prototype.getBlockAttributes=function(t){var e,n,i,r;for(n=[];t&&t!==this.containerElement;){for(e in r=o.config.blockAttributes)!1!==(i=r[e]).parse&&c(t)===i.tagName&&(("function"==typeof i.test?i.test(t):void 0)||!i.test)&&(n.push(e),i.listAttribute&&n.push(i.listAttribute));t=t.parentNode}return n.reverse()},g.prototype.findBlockElementAncestors=function(t){var e,n;for(e=[];t&&t!==this.containerElement;)n=c(t),p.call(r(),n)>=0&&e.push(t),t=t.parentNode;return e},S=function(t,e){var n;try{return"text/html"===(n=JSON.parse(t.getAttribute("data-trix-"+e))).contentType&&n.content&&(n.content=HTMLSanitizer.sanitize(n.content).getHTML()),n}catch(t){return{}}},b=function(t){var e,n,i;return i=t.getAttribute("width"),n=t.getAttribute("height"),e={},i&&(e.width=parseInt(i,10)),n&&(e.height=parseInt(n,10)),e},g.prototype.isBlockElement=function(t){var e;if((null!=t?t.nodeType:void 0)===Node.ELEMENT_NODE&&!s(t)&&!i(t,{matchingSelector:"td",untilNode:this.containerElement}))return e=c(t),p.call(r(),e)>=0||"block"===window.getComputedStyle(t).display},g.prototype.isInsignificantTextNode=function(t){var e,n,i;if((null!=t?t.nodeType:void 0)===Node.TEXT_NODE&&D(t.data)&&(n=t.parentNode,i=t.previousSibling,e=t.nextSibling,(!T(n.previousSibling)||this.isBlockElement(n.previousSibling))&&!v(n)))return!i||this.isBlockElement(i)||!e||this.isBlockElement(e)},g.prototype.isExtraBR=function(t){return"br"===c(t)&&this.isBlockElement(t.parentNode)&&t.parentNode.lastChild===t},v=function(t){var e;return"pre"===(e=window.getComputedStyle(t).whiteSpace)||"pre-wrap"===e||"pre-line"===e},T=function(t){return t&&!x(t.textContent)},g.prototype.translateBlockElementMarginsToNewlines=function(){var t,e,n,i,r,o,a;for(t=this.getMarginOfDefaultBlockElement(),a=[],n=e=0,i=(o=this.blocks).length;i>e;n=++e)o[n],(r=this.getMarginOfBlockElementAtIndex(n))&&(r.top>2*t.top&&this.prependStringToTextAtIndex("\n",n),a.push(r.bottom>2*t.bottom?this.appendStringToTextAtIndex("\n",n):void 0));return a},g.prototype.getMarginOfBlockElementAtIndex=function(t){var e,n;return!(e=this.blockElements[t])||!e.textContent||(n=c(e),p.call(r(),n)>=0||p.call(this.processedElements,e)>=0)?void 0:y(e)},g.prototype.getMarginOfDefaultBlockElement=function(){var t;return t=a(o.config.blockAttributes.default.tagName),this.containerElement.appendChild(t),y(t)},y=function(t){var e;return"block"===(e=window.getComputedStyle(t)).display?{top:parseInt(e.marginTop),bottom:parseInt(e.marginBottom)}:void 0},E=function(t){return t.replace(RegExp("^"+e.source+"+"),"")},D=function(t){return RegExp("^"+e.source+"*$").test(t)},x=function(t){return/\s$/.test(t)},g}(o.BasicObject)}.call(this),function(){var t,e,n,i,r=function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty,s=[].slice,l=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};t=o.arraysAreEqual,n=o.normalizeRange,i=o.rangeIsCollapsed,e=o.getBlockConfig,o.Document=function(a){function u(t){null==t&&(t=[]),u.__super__.constructor.apply(this,arguments),0===t.length&&(t=[new o.Block]),this.blockList=o.SplittableList.box(t)}var c;return r(u,a),u.fromJSON=function(t){var e,n;return n=function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(o.Block.fromJSON(e));return r}(),new this(n)},u.fromHTML=function(t,e){return o.HTMLParser.parse(t,e).getDocument()},u.fromString=function(t,e){var n;return n=o.Text.textForStringWithAttributes(t,e),new this([new o.Block(n)])},u.prototype.isEmpty=function(){var t;return 1===this.blockList.length&&((t=this.getBlockAtIndex(0)).isEmpty()&&!t.hasAttributes())},u.prototype.copy=function(t){var e;return null==t&&(t={}),e=t.consolidateBlocks?this.blockList.consolidate().toArray():this.blockList.toArray(),new this.constructor(e)},u.prototype.copyUsingObjectsFromDocument=function(t){var e;return e=new o.ObjectMap(t.getObjects()),this.copyUsingObjectMap(e)},u.prototype.copyUsingObjectMap=function(t){var e,n,i;return n=function(){var n,r,o,a;for(a=[],n=0,r=(o=this.getBlocks()).length;r>n;n++)e=o[n],a.push((i=t.find(e))?i:e.copyUsingObjectMap(t));return a}.call(this),new this.constructor(n)},u.prototype.copyWithBaseBlockAttributes=function(t){var e,n,i;return null==t&&(t=[]),i=function(){var i,r,o,a;for(a=[],i=0,r=(o=this.getBlocks()).length;r>i;i++)n=o[i],e=t.concat(n.getAttributes()),a.push(n.copyWithAttributes(e));return a}.call(this),new this.constructor(i)},u.prototype.replaceBlock=function(t,e){var n;return-1===(n=this.blockList.indexOf(t))?this:new this.constructor(this.blockList.replaceObjectAtIndex(e,n))},u.prototype.insertDocumentAtRange=function(t,e){var r,o,a,s,l,u,c;return o=t.blockList,l=(e=n(e))[0],a=(u=this.locationFromPosition(l)).index,s=u.offset,c=this,r=this.getBlockAtPosition(l),i(e)&&r.isEmpty()&&!r.hasAttributes()?c=new this.constructor(c.blockList.removeObjectAtIndex(a)):r.getBlockBreakPosition()===s&&l++,c=c.removeTextAtRange(e),new this.constructor(c.blockList.insertSplittableListAtPosition(o,l))},u.prototype.mergeDocumentAtRange=function(e,i){var r,o,a,s,l,u,c,d,h,f,p,g;return p=(i=n(i))[0],f=this.locationFromPosition(p),o=this.getBlockAtIndex(f.index).getAttributes(),r=e.getBaseBlockAttributes(),g=o.slice(-r.length),t(r,g)?(c=o.slice(0,-r.length),u=e.copyWithBaseBlockAttributes(c)):u=e.copy({consolidateBlocks:!0}).copyWithBaseBlockAttributes(o),a=u.getBlockCount(),s=u.getBlockAtIndex(0),t(o,s.getAttributes())?(l=s.getTextWithoutBlockBreak(),h=this.insertTextAtRange(l,i),a>1&&(u=new this.constructor(u.getBlocks().slice(1)),d=p+l.getLength(),h=h.insertDocumentAtRange(u,d))):h=this.insertDocumentAtRange(u,i),h},u.prototype.insertTextAtRange=function(t,e){var i,r,o,a,s;return s=(e=n(e))[0],r=(a=this.locationFromPosition(s)).index,o=a.offset,i=this.removeTextAtRange(e),new this.constructor(i.blockList.editObjectAtIndex(r,(function(e){return e.copyWithText(e.text.insertTextAtPosition(t,o))})))},u.prototype.removeTextAtRange=function(t){var e,r,o,a,s,l,u,c,d,h,f,p,g,m,v,y,b,E;return c=(h=t=n(t))[0],y=h[1],i(t)?this:(l=(f=this.locationRangeFromRange(t))[0],m=f[1],s=l.index,u=l.offset,a=this.getBlockAtIndex(s),g=m.index,v=m.offset,p=this.getBlockAtIndex(g),y-c==1&&a.getBlockBreakPosition()===u&&p.getBlockBreakPosition()!==v&&"\n"===p.text.getStringAtPosition(v)?o=this.blockList.editObjectAtIndex(g,(function(t){return t.copyWithText(t.text.removeTextAtRange([v,v+1]))})):(d=a.text.getTextAtRange([0,u]),b=p.text.getTextAtRange([v,p.getLength()]),E=d.appendText(b),r=s!==g&&0===u&&a.getAttributeLevel()>=p.getAttributeLevel()?p.copyWithText(E):a.copyWithText(E),e=g+1-s,o=this.blockList.splice(s,e,r)),new this.constructor(o))},u.prototype.moveTextFromRangeToPosition=function(t,e){var i,r,o,a,l,u,c,d,h,f;return h=(u=t=n(t))[0],o=u[1],e>=h&&o>=e?this:(r=this.getDocumentAtRange(t),d=this.removeTextAtRange(t),(l=e>h)&&(e-=r.getLength()),a=(c=r.getBlocks())[0],0===(i=2<=c.length?s.call(c,1):[]).length?(f=a.getTextWithoutBlockBreak(),l&&(e+=1)):f=a.text,d=d.insertTextAtRange(f,e),0===i.length?d:(r=new this.constructor(i),e+=f.getLength(),d.insertDocumentAtRange(r,e)))},u.prototype.addAttributeAtRange=function(t,n,i){var r;return r=this.blockList,this.eachBlockAtRange(i,(function(i,o,a){return r=r.editObjectAtIndex(a,(function(){return e(t)?i.addAttribute(t,n):o[0]===o[1]?i:i.copyWithText(i.text.addAttributeAtRange(t,n,o))}))})),new this.constructor(r)},u.prototype.addAttribute=function(t,e){var n;return n=this.blockList,this.eachBlock((function(i,r){return n=n.editObjectAtIndex(r,(function(){return i.addAttribute(t,e)}))})),new this.constructor(n)},u.prototype.removeAttributeAtRange=function(t,n){var i;return i=this.blockList,this.eachBlockAtRange(n,(function(n,r,o){return e(t)?i=i.editObjectAtIndex(o,(function(){return n.removeAttribute(t)})):r[0]!==r[1]?i=i.editObjectAtIndex(o,(function(){return n.copyWithText(n.text.removeAttributeAtRange(t,r))})):void 0})),new this.constructor(i)},u.prototype.updateAttributesForAttachment=function(t,e){var n,i,r;return i=this.getRangeOfAttachment(e)[0],n=this.locationFromPosition(i).index,r=this.getTextAtIndex(n),new this.constructor(this.blockList.editObjectAtIndex(n,(function(n){return n.copyWithText(r.updateAttributesForAttachment(t,e))})))},u.prototype.removeAttributeForAttachment=function(t,e){var n;return n=this.getRangeOfAttachment(e),this.removeAttributeAtRange(t,n)},u.prototype.insertBlockBreakAtRange=function(t){var e,i,r,a;return a=(t=n(t))[0],r=this.locationFromPosition(a).offset,i=this.removeTextAtRange(t),0===r&&(e=[new o.Block]),new this.constructor(i.blockList.insertSplittableListAtPosition(new o.SplittableList(e),a))},u.prototype.applyBlockAttributeAtRange=function(t,n,i){var r,o,a,s;return o=(a=this.expandRangeToLineBreaksAndSplitBlocks(i)).document,i=a.range,(r=e(t)).listAttribute?(s=(o=o.removeLastListAttributeAtRange(i,{exceptAttributeName:t})).convertLineBreaksToBlockBreaksInRange(i),o=s.document,i=s.range):o=r.exclusive?o.removeBlockAttributesAtRange(i):r.terminal?o.removeLastTerminalAttributeAtRange(i):o.consolidateBlocksAtRange(i),o.addAttributeAtRange(t,n,i)},u.prototype.removeLastListAttributeAtRange=function(t,n){var i;return null==n&&(n={}),i=this.blockList,this.eachBlockAtRange(t,(function(t,r,o){var a;if((a=t.getLastAttribute())&&e(a).listAttribute&&a!==n.exceptAttributeName)return i=i.editObjectAtIndex(o,(function(){return t.removeAttribute(a)}))})),new this.constructor(i)},u.prototype.removeLastTerminalAttributeAtRange=function(t){var n;return n=this.blockList,this.eachBlockAtRange(t,(function(t,i,r){var o;if((o=t.getLastAttribute())&&e(o).terminal)return n=n.editObjectAtIndex(r,(function(){return t.removeAttribute(o)}))})),new this.constructor(n)},u.prototype.removeBlockAttributesAtRange=function(t){var e;return e=this.blockList,this.eachBlockAtRange(t,(function(t,n,i){return t.hasAttributes()?e=e.editObjectAtIndex(i,(function(){return t.copyWithoutAttributes()})):void 0})),new this.constructor(e)},u.prototype.expandRangeToLineBreaksAndSplitBlocks=function(t){var e,i,r,o,a,s,l,u,c;return c=(s=t=n(t))[0],o=s[1],u=this.locationFromPosition(c),r=this.locationFromPosition(o),l=(e=this).getBlockAtIndex(u.index),null!=(u.offset=l.findLineBreakInDirectionFromPosition("backward",u.offset))&&(a=e.positionFromLocation(u),e=e.insertBlockBreakAtRange([a,a+1]),r.index+=1,r.offset-=e.getBlockAtIndex(u.index).getLength(),u.index+=1),u.offset=0,0===r.offset&&r.index>u.index?(r.index-=1,r.offset=e.getBlockAtIndex(r.index).getBlockBreakPosition()):("\n"===(i=e.getBlockAtIndex(r.index)).text.getStringAtRange([r.offset-1,r.offset])?r.offset-=1:r.offset=i.findLineBreakInDirectionFromPosition("forward",r.offset),r.offset!==i.getBlockBreakPosition()&&(a=e.positionFromLocation(r),e=e.insertBlockBreakAtRange([a,a+1]))),c=e.positionFromLocation(u),o=e.positionFromLocation(r),{document:e,range:t=n([c,o])}},u.prototype.convertLineBreaksToBlockBreaksInRange=function(t){var e,i,r;return i=(t=n(t))[0],r=this.getStringAtRange(t).slice(0,-1),e=this,r.replace(/.*?\n/g,(function(t){return i+=t.length,e=e.insertBlockBreakAtRange([i-1,i])})),{document:e,range:t}},u.prototype.consolidateBlocksAtRange=function(t){var e,i,r,o,a;return a=(r=t=n(t))[0],i=r[1],o=this.locationFromPosition(a).index,e=this.locationFromPosition(i).index,new this.constructor(this.blockList.consolidateFromIndexToIndex(o,e))},u.prototype.getDocumentAtRange=function(t){var e;return t=n(t),e=this.blockList.getSplittableListInRange(t).toArray(),new this.constructor(e)},u.prototype.getStringAtRange=function(t){var e,i;return(i=t=n(t))[i.length-1]!==this.getLength()&&(e=-1),this.getDocumentAtRange(t).toString().slice(0,e)},u.prototype.getBlockAtIndex=function(t){return this.blockList.getObjectAtIndex(t)},u.prototype.getBlockAtPosition=function(t){var e;return e=this.locationFromPosition(t).index,this.getBlockAtIndex(e)},u.prototype.getTextAtIndex=function(t){var e;return null!=(e=this.getBlockAtIndex(t))?e.text:void 0},u.prototype.getTextAtPosition=function(t){var e;return e=this.locationFromPosition(t).index,this.getTextAtIndex(e)},u.prototype.getPieceAtPosition=function(t){var e,n,i;return e=(i=this.locationFromPosition(t)).index,n=i.offset,this.getTextAtIndex(e).getPieceAtPosition(n)},u.prototype.getCharacterAtPosition=function(t){var e,n,i;return e=(i=this.locationFromPosition(t)).index,n=i.offset,this.getTextAtIndex(e).getStringAtRange([n,n+1])},u.prototype.getLength=function(){return this.blockList.getEndPosition()},u.prototype.getBlocks=function(){return this.blockList.toArray()},u.prototype.getBlockCount=function(){return this.blockList.length},u.prototype.getEditCount=function(){return this.editCount},u.prototype.eachBlock=function(t){return this.blockList.eachObject(t)},u.prototype.eachBlockAtRange=function(t,e){var i,r,o,a,s,l,u,c,d,h,f,p;if(f=(l=t=n(t))[0],o=l[1],h=this.locationFromPosition(f),r=this.locationFromPosition(o),h.index===r.index)return i=this.getBlockAtIndex(h.index),p=[h.offset,r.offset],e(i,p,h.index);for(d=[],s=a=u=h.index,c=r.index;c>=u?c>=a:a>=c;s=c>=u?++a:--a)(i=this.getBlockAtIndex(s))?(p=function(){switch(s){case h.index:return[h.offset,i.text.getLength()];case r.index:return[0,r.offset];default:return[0,i.text.getLength()]}}(),d.push(e(i,p,s))):d.push(void 0);return d},u.prototype.getCommonAttributesAtRange=function(t){var e,r,a;return r=(t=n(t))[0],i(t)?this.getCommonAttributesAtPosition(r):(a=[],e=[],this.eachBlockAtRange(t,(function(t,n){return n[0]!==n[1]?(a.push(t.text.getCommonAttributesAtRange(n)),e.push(c(t))):void 0})),o.Hash.fromCommonAttributesOfObjects(a).merge(o.Hash.fromCommonAttributesOfObjects(e)).toObject())},u.prototype.getCommonAttributesAtPosition=function(t){var e,n,i,r,a,s,u,d,h,f;if(a=(h=this.locationFromPosition(t)).index,d=h.offset,!(i=this.getBlockAtIndex(a)))return{};for(u in r=c(i),e=i.text.getAttributesAtPosition(d),n=i.text.getAttributesAtPosition(d-1),s=function(){var t,e;for(u in e=[],t=o.config.textAttributes)(f=t[u]).inheritable&&e.push(u);return e}(),n)((f=n[u])===e[u]||l.call(s,u)>=0)&&(r[u]=f);return r},u.prototype.getRangeOfCommonAttributeAtPosition=function(t,e){var i,r,o,a,s,l,u,c;return o=(s=this.locationFromPosition(e)).index,a=s.offset,c=(l=this.getTextAtIndex(o).getExpandedRangeForAttributeAtOffset(t,a))[0],r=l[1],u=this.positionFromLocation({index:o,offset:c}),i=this.positionFromLocation({index:o,offset:r}),n([u,i])},u.prototype.getBaseBlockAttributes=function(){var t,e,n,i,r,o,a;for(t=this.getBlockAtIndex(0).getAttributes(),n=i=1,a=this.getBlockCount();a>=1?a>i:i>a;n=a>=1?++i:--i)e=this.getBlockAtIndex(n).getAttributes(),o=Math.min(t.length,e.length),t=function(){var n,i,a;for(a=[],r=n=0,i=o;(i>=0?i>n:n>i)&&e[r]===t[r];r=i>=0?++n:--n)a.push(e[r]);return a}();return t},c=function(t){var e,n;return n={},(e=t.getLastAttribute())&&(n[e]=!0),n},u.prototype.getAttachmentById=function(t){var e,n,i,r;for(n=0,i=(r=this.getAttachments()).length;i>n;n++)if((e=r[n]).id===t)return e},u.prototype.getAttachmentPieces=function(){var t;return t=[],this.blockList.eachObject((function(e){var n;return n=e.text,t=t.concat(n.getAttachmentPieces())})),t},u.prototype.getAttachments=function(){var t,e,n,i,r;for(r=[],t=0,e=(i=this.getAttachmentPieces()).length;e>t;t++)n=i[t],r.push(n.attachment);return r},u.prototype.getRangeOfAttachment=function(t){var e,i,r,o,a,s,l;for(o=0,i=e=0,r=(a=this.blockList.toArray()).length;r>e;i=++e){if(l=(s=a[i].text).getRangeOfAttachment(t))return n([o+l[0],o+l[1]]);o+=s.getLength()}},u.prototype.getLocationRangeOfAttachment=function(t){var e;return e=this.getRangeOfAttachment(t),this.locationRangeFromRange(e)},u.prototype.getAttachmentPieceForAttachment=function(t){var e,n,i,r;for(e=0,n=(r=this.getAttachmentPieces()).length;n>e;e++)if((i=r[e]).attachment===t)return i},u.prototype.findRangesForBlockAttribute=function(t){var e,n,i,r,o,a,s;for(o=0,a=[],n=0,i=(s=this.getBlocks()).length;i>n;n++)r=(e=s[n]).getLength(),e.hasAttribute(t)&&a.push([o,o+r]),o+=r;return a},u.prototype.findRangesForTextAttribute=function(t,e){var n,i,r,o,a,s,l,u,c,d;for(d=(null!=e?e:{}).withValue,s=0,l=[],u=[],o=function(e){return null!=d?e.getAttribute(t)===d:e.hasAttribute(t)},n=0,i=(c=this.getPieces()).length;i>n;n++)r=(a=c[n]).getLength(),o(a)&&(l[1]===s?l[1]=s+r:u.push(l=[s,s+r])),s+=r;return u},u.prototype.locationFromPosition=function(t){var e,n;return null!=(n=this.blockList.findIndexAndOffsetAtPosition(Math.max(0,t))).index?n:{index:(e=this.getBlocks()).length-1,offset:e[e.length-1].getLength()}},u.prototype.positionFromLocation=function(t){return this.blockList.findPositionAtIndexAndOffset(t.index,t.offset)},u.prototype.locationRangeFromPosition=function(t){return n(this.locationFromPosition(t))},u.prototype.locationRangeFromRange=function(t){var e,i,r,o;if(t=n(t))return o=t[0],i=t[1],r=this.locationFromPosition(o),e=this.locationFromPosition(i),n([r,e])},u.prototype.rangeFromLocationRange=function(t){var e,r;return t=n(t),e=this.positionFromLocation(t[0]),i(t)||(r=this.positionFromLocation(t[1])),n([e,r])},u.prototype.isEqualTo=function(t){return this.blockList.isEqualTo(null!=t?t.blockList:void 0)},u.prototype.getTexts=function(){var t,e,n,i,r;for(r=[],e=0,n=(i=this.getBlocks()).length;n>e;e++)t=i[e],r.push(t.text);return r},u.prototype.getPieces=function(){var t,e,n,i,r;for(n=[],t=0,e=(i=this.getTexts()).length;e>t;t++)r=i[t],n.push.apply(n,r.getPieces());return n},u.prototype.getObjects=function(){return this.getBlocks().concat(this.getTexts()).concat(this.getPieces())},u.prototype.toSerializableDocument=function(){var t;return t=[],this.blockList.eachObject((function(e){return t.push(e.copyWithText(e.text.toSerializableText()))})),new this.constructor(t)},u.prototype.toString=function(){return this.blockList.toString()},u.prototype.toJSON=function(){return this.blockList.toJSON()},u.prototype.toConsole=function(){var t;return JSON.stringify(function(){var e,n,i,r;for(r=[],e=0,n=(i=this.blockList.toArray()).length;n>e;e++)t=i[e],r.push(JSON.parse(t.text.toConsole()));return r}.call(this))},u}(o.Object)}.call(this),function(){o.LineBreakInsertion=function(){function t(t){var e;this.composition=t,this.document=this.composition.document,e=this.composition.getSelectedRange(),this.startPosition=e[0],this.endPosition=e[1],this.startLocation=this.document.locationFromPosition(this.startPosition),this.endLocation=this.document.locationFromPosition(this.endPosition),this.block=this.document.getBlockAtIndex(this.endLocation.index),this.breaksOnReturn=this.block.breaksOnReturn(),this.previousCharacter=this.block.text.getStringAtPosition(this.endLocation.offset-1),this.nextCharacter=this.block.text.getStringAtPosition(this.endLocation.offset)}return t.prototype.shouldInsertBlockBreak=function(){return this.block.hasAttributes()&&this.block.isListItem()&&!this.block.isEmpty()?0!==this.startLocation.offset:this.breaksOnReturn&&"\n"!==this.nextCharacter},t.prototype.shouldBreakFormattedBlock=function(){return this.block.hasAttributes()&&!this.block.isListItem()&&(this.breaksOnReturn&&"\n"===this.nextCharacter||"\n"===this.previousCharacter)},t.prototype.shouldDecreaseListLevel=function(){return this.block.hasAttributes()&&this.block.isListItem()&&this.block.isEmpty()},t.prototype.shouldPrependListItem=function(){return this.block.isListItem()&&0===this.startLocation.offset&&!this.block.isEmpty()},t.prototype.shouldRemoveLastBlockAttribute=function(){return this.block.hasAttributes()&&!this.block.isListItem()&&this.block.isEmpty()},t}()}.call(this),function(){var t,e,n,i,r,a,s,l,u,c,d=function(t,e){function n(){this.constructor=t}for(var i in e)h.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},h={}.hasOwnProperty;a=o.normalizeRange,u=o.rangesAreEqual,l=o.rangeIsCollapsed,s=o.objectsAreEqual,t=o.arrayStartsWith,c=o.summarizeArrayChange,n=o.getAllAttributeNames,i=o.getBlockConfig,r=o.getTextConfig,e=o.extend,o.Composition=function(h){function f(){this.document=new o.Document,this.attachments=[],this.currentAttributes={},this.revision=0}return d(f,h),f.prototype.setDocument=function(t){var e;return t.isEqualTo(this.document)?void 0:(this.document=t,this.refreshAttachments(),this.revision++,null!=(e=this.delegate)&&"function"==typeof e.compositionDidChangeDocument?e.compositionDidChangeDocument(t):void 0)},f.prototype.getSnapshot=function(){return{document:this.document,selectedRange:this.getSelectedRange()}},f.prototype.loadSnapshot=function(t){var e,n,i,r;return e=t.document,r=t.selectedRange,null!=(n=this.delegate)&&"function"==typeof n.compositionWillLoadSnapshot&&n.compositionWillLoadSnapshot(),this.setDocument(null!=e?e:new o.Document),this.setSelection(null!=r?r:[0,0]),null!=(i=this.delegate)&&"function"==typeof i.compositionDidLoadSnapshot?i.compositionDidLoadSnapshot():void 0},f.prototype.insertText=function(t,e){var n,i,r,o;return o=(null!=e?e:{updatePosition:!0}).updatePosition,i=this.getSelectedRange(),this.setDocument(this.document.insertTextAtRange(t,i)),n=(r=i[0])+t.getLength(),o&&this.setSelection(n),this.notifyDelegateOfInsertionAtRange([r,n])},f.prototype.insertBlock=function(t){var e;return null==t&&(t=new o.Block),e=new o.Document([t]),this.insertDocument(e)},f.prototype.insertDocument=function(t){var e,n,i;return null==t&&(t=new o.Document),n=this.getSelectedRange(),this.setDocument(this.document.insertDocumentAtRange(t,n)),e=(i=n[0])+t.getLength(),this.setSelection(e),this.notifyDelegateOfInsertionAtRange([i,e])},f.prototype.insertString=function(t,e){var n,i;return n=this.getCurrentTextAttributes(),i=o.Text.textForStringWithAttributes(t,n),this.insertText(i,e)},f.prototype.insertBlockBreak=function(){var t,e,n;return e=this.getSelectedRange(),this.setDocument(this.document.insertBlockBreakAtRange(e)),t=(n=e[0])+1,this.setSelection(t),this.notifyDelegateOfInsertionAtRange([n,t])},f.prototype.insertLineBreak=function(){var t,e;return(e=new o.LineBreakInsertion(this)).shouldDecreaseListLevel()?(this.decreaseListLevel(),this.setSelection(e.startPosition)):e.shouldPrependListItem()?(t=new o.Document([e.block.copyWithoutText()]),this.insertDocument(t)):e.shouldInsertBlockBreak()?this.insertBlockBreak():e.shouldRemoveLastBlockAttribute()?this.removeLastBlockAttribute():e.shouldBreakFormattedBlock()?this.breakFormattedBlock(e):this.insertString("\n")},f.prototype.insertHTML=function(t){var e,n,i,r;return e=o.Document.fromHTML(t),i=this.getSelectedRange(),this.setDocument(this.document.mergeDocumentAtRange(e,i)),n=(r=i[0])+e.getLength()-1,this.setSelection(n),this.notifyDelegateOfInsertionAtRange([r,n])},f.prototype.replaceHTML=function(t){var e,n,i;return e=o.Document.fromHTML(t).copyUsingObjectsFromDocument(this.document),n=this.getLocationRange({strict:!1}),i=this.document.rangeFromLocationRange(n),this.setDocument(e),this.setSelection(i)},f.prototype.insertFile=function(t){return this.insertFiles([t])},f.prototype.insertFiles=function(t){var e,n,i,r,a,s;for(n=[],r=0,a=t.length;a>r;r++)i=t[r],(null!=(s=this.delegate)?s.compositionShouldAcceptFile(i):void 0)&&(e=o.Attachment.attachmentForFile(i),n.push(e));return this.insertAttachments(n)},f.prototype.insertAttachment=function(t){return this.insertAttachments([t])},f.prototype.insertAttachments=function(t){var e,n,i,r,a,s,l,u,c;for(u=new o.Text,r=0,a=t.length;a>r;r++)c=(e=t[r]).getType(),s=null!=(l=o.config.attachments[c])?l.presentation:void 0,i=this.getCurrentTextAttributes(),s&&(i.presentation=s),n=o.Text.textForAttachmentWithAttributes(e,i),u=u.appendText(n);return this.insertText(u)},f.prototype.shouldManageDeletingInDirection=function(t){var e;if(e=this.getLocationRange(),l(e)){if("backward"===t&&0===e[0].offset)return!0;if(this.shouldManageMovingCursorInDirection(t))return!0}else if(e[0].index!==e[1].index)return!0;return!1},f.prototype.deleteInDirection=function(t,e){var n,i,r,o,a,s,u,c;return o=(null!=e?e:{}).length,a=this.getLocationRange(),s=this.getSelectedRange(),(u=l(s))?r="backward"===t&&0===a[0].offset:c=a[0].index!==a[1].index,!(r&&this.canDecreaseBlockAttributeLevel()&&(i=this.getBlock(),i.isListItem()?this.decreaseListLevel():this.decreaseBlockAttributeLevel(),this.setSelection(s[0]),i.isEmpty()))&&(u&&(s=this.getExpandedRangeInDirection(t,{length:o}),"backward"===t&&(n=this.getAttachmentAtRange(s))),n?(this.editAttachment(n),!1):(this.setDocument(this.document.removeTextAtRange(s)),this.setSelection(s[0]),!r&&!c&&void 0))},f.prototype.moveTextFromRange=function(t){var e;return e=this.getSelectedRange()[0],this.setDocument(this.document.moveTextFromRangeToPosition(t,e)),this.setSelection(e)},f.prototype.removeAttachment=function(t){var e;return(e=this.document.getRangeOfAttachment(t))?(this.stopEditingAttachment(),this.setDocument(this.document.removeTextAtRange(e)),this.setSelection(e[0])):void 0},f.prototype.removeLastBlockAttribute=function(){var t,e,n,i;return i=(n=this.getSelectedRange())[0],e=n[1],t=this.document.getBlockAtPosition(e),this.removeCurrentAttribute(t.getLastAttribute()),this.setSelection(i)},f.prototype.insertPlaceholder=function(){return this.placeholderPosition=this.getPosition(),this.insertString(" ")},f.prototype.selectPlaceholder=function(){return null!=this.placeholderPosition?(this.setSelectedRange([this.placeholderPosition,this.placeholderPosition+1]),this.getSelectedRange()):void 0},f.prototype.forgetPlaceholder=function(){return this.placeholderPosition=null},f.prototype.hasCurrentAttribute=function(t){var e;return null!=(e=this.currentAttributes[t])&&!1!==e},f.prototype.toggleCurrentAttribute=function(t){var e;return(e=!this.currentAttributes[t])?this.setCurrentAttribute(t,e):this.removeCurrentAttribute(t)},f.prototype.canSetCurrentAttribute=function(t){return i(t)?this.canSetCurrentBlockAttribute(t):this.canSetCurrentTextAttribute(t)},f.prototype.canSetCurrentTextAttribute=function(){var t,e,n,i;if(t=this.getSelectedDocument()){for(e=0,n=(i=t.getAttachments()).length;n>e;e++)if(!i[e].hasContent())return!1;return!0}},f.prototype.canSetCurrentBlockAttribute=function(){var t;if(t=this.getBlock())return!t.isTerminalBlock()},f.prototype.setCurrentAttribute=function(t,e){return i(t)?this.setBlockAttribute(t,e):(this.setTextAttribute(t,e),this.currentAttributes[t]=e,this.notifyDelegateOfCurrentAttributesChange())},f.prototype.setTextAttribute=function(t,e){var n,i;if(n=this.getSelectedRange())return n[0]!==n[1]?this.setDocument(this.document.addAttributeAtRange(t,e,n)):"href"===t?(i=o.Text.textForStringWithAttributes(e,{href:e}),this.insertText(i)):void 0},f.prototype.setBlockAttribute=function(t,e){var n;if(n=this.getSelectedRange())return this.canSetCurrentAttribute(t)?(this.getBlock(),this.setDocument(this.document.applyBlockAttributeAtRange(t,e,n)),this.setSelection(n)):void 0},f.prototype.removeCurrentAttribute=function(t){return i(t)?(this.removeBlockAttribute(t),this.updateCurrentAttributes()):(this.removeTextAttribute(t),delete this.currentAttributes[t],this.notifyDelegateOfCurrentAttributesChange())},f.prototype.removeTextAttribute=function(t){var e;if(e=this.getSelectedRange())return this.setDocument(this.document.removeAttributeAtRange(t,e))},f.prototype.removeBlockAttribute=function(t){var e;if(e=this.getSelectedRange())return this.setDocument(this.document.removeAttributeAtRange(t,e))},f.prototype.canDecreaseNestingLevel=function(){var t;return(null!=(t=this.getBlock())?t.getNestingLevel():void 0)>0},f.prototype.canIncreaseNestingLevel=function(){var e,n,r;if(e=this.getBlock())return null!=(r=i(e.getLastNestableAttribute()))&&r.listAttribute?(n=this.getPreviousBlock())?t(n.getListItemAttributes(),e.getListItemAttributes()):void 0:e.getNestingLevel()>0},f.prototype.decreaseNestingLevel=function(){var t;if(t=this.getBlock())return this.setDocument(this.document.replaceBlock(t,t.decreaseNestingLevel()))},f.prototype.increaseNestingLevel=function(){var t;if(t=this.getBlock())return this.setDocument(this.document.replaceBlock(t,t.increaseNestingLevel()))},f.prototype.canDecreaseBlockAttributeLevel=function(){var t;return(null!=(t=this.getBlock())?t.getAttributeLevel():void 0)>0},f.prototype.decreaseBlockAttributeLevel=function(){var t,e;return(t=null!=(e=this.getBlock())?e.getLastAttribute():void 0)?this.removeCurrentAttribute(t):void 0},f.prototype.decreaseListLevel=function(){var t,e,n,i,r,o;for(o=this.getSelectedRange()[0],n=r=this.document.locationFromPosition(o).index,t=this.getBlock().getAttributeLevel();(e=this.document.getBlockAtIndex(n+1))&&e.isListItem()&&e.getAttributeLevel()>t;)n++;return o=this.document.positionFromLocation({index:r,offset:0}),i=this.document.positionFromLocation({index:n,offset:0}),this.setDocument(this.document.removeLastListAttributeAtRange([o,i]))},f.prototype.updateCurrentAttributes=function(){var t,e,i,r,o,a;if(a=this.getSelectedRange({ignoreLock:!0})){for(e=this.document.getCommonAttributesAtRange(a),i=0,r=(o=n()).length;r>i;i++)e[t=o[i]]||this.canSetCurrentAttribute(t)||(e[t]=!1);if(!s(e,this.currentAttributes))return this.currentAttributes=e,this.notifyDelegateOfCurrentAttributesChange()}},f.prototype.getCurrentAttributes=function(){return e.call({},this.currentAttributes)},f.prototype.getCurrentTextAttributes=function(){var t,e,n,i;for(e in t={},n=this.currentAttributes)!1!==(i=n[e])&&r(e)&&(t[e]=i);return t},f.prototype.freezeSelection=function(){return this.setCurrentAttribute("frozen",!0)},f.prototype.thawSelection=function(){return this.removeCurrentAttribute("frozen")},f.prototype.hasFrozenSelection=function(){return this.hasCurrentAttribute("frozen")},f.proxyMethod("getSelectionManager().getPointRange"),f.proxyMethod("getSelectionManager().setLocationRangeFromPointRange"),f.proxyMethod("getSelectionManager().createLocationRangeFromDOMRange"),f.proxyMethod("getSelectionManager().locationIsCursorTarget"),f.proxyMethod("getSelectionManager().selectionIsExpanded"),f.proxyMethod("delegate?.getSelectionManager"),f.prototype.setSelection=function(t){var e,n;return e=this.document.locationRangeFromRange(t),null!=(n=this.delegate)?n.compositionDidRequestChangingSelectionToLocationRange(e):void 0},f.prototype.getSelectedRange=function(){var t;return(t=this.getLocationRange())?this.document.rangeFromLocationRange(t):void 0},f.prototype.setSelectedRange=function(t){var e;return e=this.document.locationRangeFromRange(t),this.getSelectionManager().setLocationRange(e)},f.prototype.getPosition=function(){var t;return(t=this.getLocationRange())?this.document.positionFromLocation(t[0]):void 0},f.prototype.getLocationRange=function(t){var e,n;return null!=(e=null!=(n=this.targetLocationRange)?n:this.getSelectionManager().getLocationRange(t))?e:a({index:0,offset:0})},f.prototype.withTargetLocationRange=function(t,e){var n;this.targetLocationRange=t;try{n=e()}finally{this.targetLocationRange=null}return n},f.prototype.withTargetRange=function(t,e){var n;return n=this.document.locationRangeFromRange(t),this.withTargetLocationRange(n,e)},f.prototype.withTargetDOMRange=function(t,e){var n;return n=this.createLocationRangeFromDOMRange(t,{strict:!1}),this.withTargetLocationRange(n,e)},f.prototype.getExpandedRangeInDirection=function(t,e){var n,i,r,o;return i=(null!=e?e:{}).length,o=(r=this.getSelectedRange())[0],n=r[1],"backward"===t?i?o-=i:o=this.translateUTF16PositionFromOffset(o,-1):i?n+=i:n=this.translateUTF16PositionFromOffset(n,1),a([o,n])},f.prototype.shouldManageMovingCursorInDirection=function(t){var e;return!!this.editingAttachment||(e=this.getExpandedRangeInDirection(t),null!=this.getAttachmentAtRange(e))},f.prototype.moveCursorInDirection=function(t){var e,n,i,r;return this.editingAttachment?i=this.document.getRangeOfAttachment(this.editingAttachment):(r=this.getSelectedRange(),i=this.getExpandedRangeInDirection(t),n=!u(r,i)),this.setSelectedRange("backward"===t?i[0]:i[1]),n&&(e=this.getAttachmentAtRange(i))?this.editAttachment(e):void 0},f.prototype.expandSelectionInDirection=function(t,e){var n,i;return n=(null!=e?e:{}).length,i=this.getExpandedRangeInDirection(t,{length:n}),this.setSelectedRange(i)},f.prototype.expandSelectionForEditing=function(){return this.hasCurrentAttribute("href")?this.expandSelectionAroundCommonAttribute("href"):void 0},f.prototype.expandSelectionAroundCommonAttribute=function(t){var e,n;return e=this.getPosition(),n=this.document.getRangeOfCommonAttributeAtPosition(t,e),this.setSelectedRange(n)},f.prototype.selectionContainsAttachments=function(){var t;return(null!=(t=this.getSelectedAttachments())?t.length:void 0)>0},f.prototype.selectionIsInCursorTarget=function(){return this.editingAttachment||this.positionIsCursorTarget(this.getPosition())},f.prototype.positionIsCursorTarget=function(t){var e;return(e=this.document.locationFromPosition(t))?this.locationIsCursorTarget(e):void 0},f.prototype.positionIsBlockBreak=function(t){var e;return null!=(e=this.document.getPieceAtPosition(t))?e.isBlockBreak():void 0},f.prototype.getSelectedDocument=function(){var t;return(t=this.getSelectedRange())?this.document.getDocumentAtRange(t):void 0},f.prototype.getSelectedAttachments=function(){var t;return null!=(t=this.getSelectedDocument())?t.getAttachments():void 0},f.prototype.getAttachments=function(){return this.attachments.slice(0)},f.prototype.refreshAttachments=function(){var t,e,n,i,r,o,a,s,l,u,d,h;for(n=this.document.getAttachments(),t=(s=c(this.attachments,n)).added,d=s.removed,this.attachments=n,i=0,o=d.length;o>i;i++)(e=d[i]).delegate=null,null!=(l=this.delegate)&&"function"==typeof l.compositionDidRemoveAttachment&&l.compositionDidRemoveAttachment(e);for(h=[],r=0,a=t.length;a>r;r++)(e=t[r]).delegate=this,h.push(null!=(u=this.delegate)&&"function"==typeof u.compositionDidAddAttachment?u.compositionDidAddAttachment(e):void 0);return h},f.prototype.attachmentDidChangeAttributes=function(t){var e;return this.revision++,null!=(e=this.delegate)&&"function"==typeof e.compositionDidEditAttachment?e.compositionDidEditAttachment(t):void 0},f.prototype.attachmentDidChangePreviewURL=function(t){var e;return this.revision++,null!=(e=this.delegate)&&"function"==typeof e.compositionDidChangeAttachmentPreviewURL?e.compositionDidChangeAttachmentPreviewURL(t):void 0},f.prototype.editAttachment=function(t,e){var n;if(t!==this.editingAttachment)return this.stopEditingAttachment(),this.editingAttachment=t,null!=(n=this.delegate)&&"function"==typeof n.compositionDidStartEditingAttachment?n.compositionDidStartEditingAttachment(this.editingAttachment,e):void 0},f.prototype.stopEditingAttachment=function(){var t;if(this.editingAttachment)return null!=(t=this.delegate)&&"function"==typeof t.compositionDidStopEditingAttachment&&t.compositionDidStopEditingAttachment(this.editingAttachment),this.editingAttachment=null},f.prototype.updateAttributesForAttachment=function(t,e){return this.setDocument(this.document.updateAttributesForAttachment(t,e))},f.prototype.removeAttributeForAttachment=function(t,e){return this.setDocument(this.document.removeAttributeForAttachment(t,e))},f.prototype.breakFormattedBlock=function(t){var e,n,i,r,a;return n=t.document,e=t.block,a=[(r=t.startPosition)-1,r],e.getBlockBreakPosition()===t.startLocation.offset?(e.breaksOnReturn()&&"\n"===t.nextCharacter?r+=1:n=n.removeTextAtRange(a),a=[r,r]):"\n"===t.nextCharacter?"\n"===t.previousCharacter?a=[r-1,r+1]:(a=[r,r+1],r+=1):t.startLocation.offset-1!=0&&(r+=1),i=new o.Document([e.removeLastAttribute().copyWithoutText()]),this.setDocument(n.insertDocumentAtRange(i,a)),this.setSelection(r)},f.prototype.getPreviousBlock=function(){var t,e;return(e=this.getLocationRange())&&(t=e[0].index)>0?this.document.getBlockAtIndex(t-1):void 0},f.prototype.getBlock=function(){var t;return(t=this.getLocationRange())?this.document.getBlockAtIndex(t[0].index):void 0},f.prototype.getAttachmentAtRange=function(t){var e;return(e=this.document.getDocumentAtRange(t)).toString()===o.OBJECT_REPLACEMENT_CHARACTER+"\n"?e.getAttachments()[0]:void 0},f.prototype.notifyDelegateOfCurrentAttributesChange=function(){var t;return null!=(t=this.delegate)&&"function"==typeof t.compositionDidChangeCurrentAttributes?t.compositionDidChangeCurrentAttributes(this.currentAttributes):void 0},f.prototype.notifyDelegateOfInsertionAtRange=function(t){var e;return null!=(e=this.delegate)&&"function"==typeof e.compositionDidPerformInsertionAtRange?e.compositionDidPerformInsertionAtRange(t):void 0},f.prototype.translateUTF16PositionFromOffset=function(t,e){var n,i;return n=(i=this.document.toUTF16String()).offsetFromUCS2Offset(t),i.offsetToUCS2Offset(n+e)},f}(o.BasicObject)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;o.UndoManager=function(e){function n(t){this.composition=t,this.undoEntries=[],this.redoEntries=[]}var i;return t(n,e),n.prototype.recordUndoEntry=function(t,e){var n,r,o,a,s;return r=(a=null!=e?e:{}).context,n=a.consolidatable,o=this.undoEntries.slice(-1)[0],n&&i(o,t,r)?void 0:(s=this.createEntry({description:t,context:r}),this.undoEntries.push(s),this.redoEntries=[])},n.prototype.undo=function(){var t,e;return(e=this.undoEntries.pop())?(t=this.createEntry(e),this.redoEntries.push(t),this.composition.loadSnapshot(e.snapshot)):void 0},n.prototype.redo=function(){var t,e;return(t=this.redoEntries.pop())?(e=this.createEntry(t),this.undoEntries.push(e),this.composition.loadSnapshot(t.snapshot)):void 0},n.prototype.canUndo=function(){return this.undoEntries.length>0},n.prototype.canRedo=function(){return this.redoEntries.length>0},n.prototype.createEntry=function(t){var e,n,i;return n=(i=null!=t?t:{}).description,e=i.context,{description:null!=n?n.toString():void 0,context:JSON.stringify(e),snapshot:this.composition.getSnapshot()}},i=function(t,e,n){return(null!=t?t.description:void 0)===(null!=e?e.toString():void 0)&&(null!=t?t.context:void 0)===JSON.stringify(n)},n}(o.BasicObject)}.call(this),function(){var t;o.attachmentGalleryFilter=function(e){var n;return(n=new t(e)).perform(),n.getSnapshot()},t=function(){function t(t){this.document=t.document,this.selectedRange=t.selectedRange}var e;return e="attachmentGallery",t.prototype.perform=function(){return this.removeBlockAttribute(),this.applyBlockAttribute()},t.prototype.getSnapshot=function(){return{document:this.document,selectedRange:this.selectedRange}},t.prototype.removeBlockAttribute=function(){var t,n,i,r,o;for(o=[],t=0,n=(r=this.findRangesOfBlocks()).length;n>t;t++)i=r[t],o.push(this.document=this.document.removeAttributeAtRange(e,i));return o},t.prototype.applyBlockAttribute=function(){var t,n,i,r,o,a;for(i=0,a=[],t=0,n=(o=this.findRangesOfPieces()).length;n>t;t++)(r=o[t])[1]-r[0]>1&&(r[0]+=i,r[1]+=i,"\n"!==this.document.getCharacterAtPosition(r[1])&&(this.document=this.document.insertBlockBreakAtRange(r[1]),r[1]<this.selectedRange[1]&&this.moveSelectedRangeForward(),r[1]++,i++),0!==r[0]&&"\n"!==this.document.getCharacterAtPosition(r[0]-1)&&(this.document=this.document.insertBlockBreakAtRange(r[0]),r[0]<this.selectedRange[0]&&this.moveSelectedRangeForward(),r[0]++,i++),a.push(this.document=this.document.applyBlockAttributeAtRange(e,!0,r)));return a},t.prototype.findRangesOfBlocks=function(){return this.document.findRangesForBlockAttribute(e)},t.prototype.findRangesOfPieces=function(){return this.document.findRangesForTextAttribute("presentation",{withValue:"gallery"})},t.prototype.moveSelectedRangeForward=function(){return this.selectedRange[0]+=1,this.selectedRange[1]+=1},t}()}.call(this),function(){o.Editor=function(){function t(t,n,i){this.composition=t,this.selectionManager=n,this.element=i,this.insertFiles=function(t,e){return function(){return t.apply(e,arguments)}}(this.insertFiles,this),this.undoManager=new o.UndoManager(this.composition),this.filters=e.slice(0)}var e;return e=[o.attachmentGalleryFilter],t.prototype.loadDocument=function(t){return this.loadSnapshot({document:t,selectedRange:[0,0]})},t.prototype.loadHTML=function(t){return null==t&&(t=""),this.loadDocument(o.Document.fromHTML(t,{referenceElement:this.element}))},t.prototype.loadJSON=function(t){var e,n;return e=t.document,n=t.selectedRange,e=o.Document.fromJSON(e),this.loadSnapshot({document:e,selectedRange:n})},t.prototype.loadSnapshot=function(t){return this.undoManager=new o.UndoManager(this.composition),this.composition.loadSnapshot(t)},t.prototype.getDocument=function(){return this.composition.document},t.prototype.getSelectedDocument=function(){return this.composition.getSelectedDocument()},t.prototype.getSnapshot=function(){return this.composition.getSnapshot()},t.prototype.toJSON=function(){return this.getSnapshot()},t.prototype.deleteInDirection=function(t){return this.composition.deleteInDirection(t)},t.prototype.insertAttachment=function(t){return this.composition.insertAttachment(t)},t.prototype.insertAttachments=function(t){return this.composition.insertAttachments(t)},t.prototype.insertDocument=function(t){return this.composition.insertDocument(t)},t.prototype.insertFile=function(t){return this.composition.insertFile(t)},t.prototype.insertFiles=function(t){return this.composition.insertFiles(t)},t.prototype.insertHTML=function(t){return this.composition.insertHTML(t)},t.prototype.insertString=function(t){return this.composition.insertString(t)},t.prototype.insertText=function(t){return this.composition.insertText(t)},t.prototype.insertLineBreak=function(){return this.composition.insertLineBreak()},t.prototype.getSelectedRange=function(){return this.composition.getSelectedRange()},t.prototype.getPosition=function(){return this.composition.getPosition()},t.prototype.getClientRectAtPosition=function(t){var e;return e=this.getDocument().locationRangeFromRange([t,t+1]),this.selectionManager.getClientRectAtLocationRange(e)},t.prototype.expandSelectionInDirection=function(t){return this.composition.expandSelectionInDirection(t)},t.prototype.moveCursorInDirection=function(t){return this.composition.moveCursorInDirection(t)},t.prototype.setSelectedRange=function(t){return this.composition.setSelectedRange(t)},t.prototype.activateAttribute=function(t,e){return null==e&&(e=!0),this.composition.setCurrentAttribute(t,e)},t.prototype.attributeIsActive=function(t){return this.composition.hasCurrentAttribute(t)},t.prototype.canActivateAttribute=function(t){return this.composition.canSetCurrentAttribute(t)},t.prototype.deactivateAttribute=function(t){return this.composition.removeCurrentAttribute(t)},t.prototype.canDecreaseNestingLevel=function(){return this.composition.canDecreaseNestingLevel()},t.prototype.canIncreaseNestingLevel=function(){return this.composition.canIncreaseNestingLevel()},t.prototype.decreaseNestingLevel=function(){return this.canDecreaseNestingLevel()?this.composition.decreaseNestingLevel():void 0},t.prototype.increaseNestingLevel=function(){return this.canIncreaseNestingLevel()?this.composition.increaseNestingLevel():void 0},t.prototype.canRedo=function(){return this.undoManager.canRedo()},t.prototype.canUndo=function(){return this.undoManager.canUndo()},t.prototype.recordUndoEntry=function(t,e){var n,i,r;return i=(r=null!=e?e:{}).context,n=r.consolidatable,this.undoManager.recordUndoEntry(t,{context:i,consolidatable:n})},t.prototype.redo=function(){return this.canRedo()?this.undoManager.redo():void 0},t.prototype.undo=function(){return this.canUndo()?this.undoManager.undo():void 0},t}()}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;o.ManagedAttachment=function(e){function n(t,e){var n;this.attachmentManager=t,this.attachment=e,n=this.attachment,this.id=n.id,this.file=n.file}return t(n,e),n.prototype.remove=function(){return this.attachmentManager.requestRemovalOfAttachment(this.attachment)},n.proxyMethod("attachment.getAttribute"),n.proxyMethod("attachment.hasAttribute"),n.proxyMethod("attachment.setAttribute"),n.proxyMethod("attachment.getAttributes"),n.proxyMethod("attachment.setAttributes"),n.proxyMethod("attachment.isPending"),n.proxyMethod("attachment.isPreviewable"),n.proxyMethod("attachment.getURL"),n.proxyMethod("attachment.getHref"),n.proxyMethod("attachment.getFilename"),n.proxyMethod("attachment.getFilesize"),n.proxyMethod("attachment.getFormattedFilesize"),n.proxyMethod("attachment.getExtension"),n.proxyMethod("attachment.getContentType"),n.proxyMethod("attachment.getFile"),n.proxyMethod("attachment.setFile"),n.proxyMethod("attachment.releaseFile"),n.proxyMethod("attachment.getUploadProgress"),n.proxyMethod("attachment.setUploadProgress"),n}(o.BasicObject)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;o.AttachmentManager=function(e){function n(t){var e,n,i;for(null==t&&(t=[]),this.managedAttachments={},n=0,i=t.length;i>n;n++)e=t[n],this.manageAttachment(e)}return t(n,e),n.prototype.getAttachments=function(){var t,e,n,i;for(e in i=[],n=this.managedAttachments)t=n[e],i.push(t);return i},n.prototype.manageAttachment=function(t){var e,n;return null!=(e=this.managedAttachments)[n=t.id]?e[n]:e[n]=new o.ManagedAttachment(this,t)},n.prototype.attachmentIsManaged=function(t){return t.id in this.managedAttachments},n.prototype.requestRemovalOfAttachment=function(t){var e;return this.attachmentIsManaged(t)&&null!=(e=this.delegate)&&"function"==typeof e.attachmentManagerDidRequestRemovalOfAttachment?e.attachmentManagerDidRequestRemovalOfAttachment(t):void 0},n.prototype.unmanageAttachment=function(t){var e;return e=this.managedAttachments[t.id],delete this.managedAttachments[t.id],e},n}(o.BasicObject)}.call(this),function(){var t,e,n,i,r,a,s,l,u,c,d;t=o.elementContainsNode,e=o.findChildIndexOfNode,r=o.nodeIsBlockStart,a=o.nodeIsBlockStartComment,i=o.nodeIsBlockContainer,s=o.nodeIsCursorTarget,l=o.nodeIsEmptyTextNode,u=o.nodeIsTextNode,n=o.nodeIsAttachmentElement,c=o.tagName,d=o.walkTree,o.LocationMapper=function(){function o(t){this.element=t}var h,f,p,g;return o.prototype.findLocationFromContainerAndOffset=function(n,i,o){var a,l,c,h,g,m,v;for(m=(null!=o?o:{strict:!0}).strict,l=0,c=!1,h={index:0,offset:0},(a=this.findAttachmentElementParentForNode(n))&&(n=a.parentNode,i=e(a)),v=d(this.element,{usingFilter:p});v.nextNode();){if((g=v.currentNode)===n&&u(n)){s(g)||(h.offset+=i);break}if(g.parentNode===n){if(l++===i)break}else if(!t(n,g)&&l>0)break;r(g,{strict:m})?(c&&h.index++,h.offset=0,c=!0):h.offset+=f(g)}return h},o.prototype.findContainerAndOffsetFromLocation=function(t){var n,o,a,l,c;if(0===t.index&&0===t.offset){for(n=this.element,l=0;n.firstChild;)if(n=n.firstChild,i(n)){l=1;break}return[n,l]}if(o=(c=this.findNodeAndOffsetFromLocation(t))[0],a=c[1],o){if(u(o))0===f(o)?(n=o.parentNode.parentNode,l=e(o.parentNode),s(o,{name:"right"})&&l++):(n=o,l=t.offset-a);else{if(n=o.parentNode,!r(o.previousSibling)&&!i(n))for(;o===n.lastChild&&(o=n,n=n.parentNode,!i(n)););l=e(o),0!==t.offset&&l++}return[n,l]}},o.prototype.findNodeAndOffsetFromLocation=function(t){var e,n,i,r,o,a,l,c;for(l=0,n=0,i=(c=this.getSignificantNodesForIndex(t.index)).length;i>n;n++){if(e=c[n],r=f(e),t.offset<=l+r)if(u(e)){if(o=e,a=l,t.offset===a&&s(o))break}else o||(o=e,a=l);if((l+=r)>t.offset)break}return[o,a]},o.prototype.findAttachmentElementParentForNode=function(t){for(;t&&t!==this.element;){if(n(t))return t;t=t.parentNode}},o.prototype.getSignificantNodesForIndex=function(t){var e,n,i,r,o;for(i=[],o=d(this.element,{usingFilter:h}),r=!1;o.nextNode();)if(n=o.currentNode,a(n)){if(null!=e?e++:e=0,e===t)r=!0;else if(r)break}else r&&i.push(n);return i},f=function(t){return t.nodeType===Node.TEXT_NODE?s(t)?0:t.textContent.length:"br"===c(t)||n(t)?1:0},h=function(t){return g(t)===NodeFilter.FILTER_ACCEPT?p(t):NodeFilter.FILTER_REJECT},g=function(t){return l(t)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},p=function(t){return n(t.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},o}()}.call(this),function(){var t,e,n=[].slice;t=o.getDOMRange,e=o.setDOMRange,o.PointMapper=function(){function i(){}return i.prototype.createDOMRangeFromPoint=function(n){var i,r,o,a,s,l,u,c;if(u=n.x,c=n.y,document.caretPositionFromPoint)return o=(s=document.caretPositionFromPoint(u,c)).offsetNode,r=s.offset,(i=document.createRange()).setStart(o,r),i;if(document.caretRangeFromPoint)return document.caretRangeFromPoint(u,c);if(document.body.createTextRange){a=t();try{(l=document.body.createTextRange()).moveToPoint(u,c),l.select()}catch(t){}return i=t(),e(a),i}},i.prototype.getClientRectsForDOMRange=function(t){var e;return[(e=n.call(t.getClientRects()))[0],e[e.length-1]]},i}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty,r=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};t=o.getDOMRange,o.SelectionChangeObserver=function(i){function o(){this.run=e(this.run,this),this.update=e(this.update,this),this.selectionManagers=[]}var a;return n(o,i),o.prototype.start=function(){return this.started?void 0:(this.started=!0,"onselectionchange"in document?document.addEventListener("selectionchange",this.update,!0):this.run())},o.prototype.stop=function(){return this.started?(this.started=!1,document.removeEventListener("selectionchange",this.update,!0)):void 0},o.prototype.registerSelectionManager=function(t){return r.call(this.selectionManagers,t)<0?(this.selectionManagers.push(t),this.start()):void 0},o.prototype.unregisterSelectionManager=function(t){var e;return this.selectionManagers=function(){var n,i,r,o;for(o=[],n=0,i=(r=this.selectionManagers).length;i>n;n++)(e=r[n])!==t&&o.push(e);return o}.call(this),0===this.selectionManagers.length?this.stop():void 0},o.prototype.notifySelectionManagersOfSelectionChange=function(){var t,e,n,i,r;for(i=[],t=0,e=(n=this.selectionManagers).length;e>t;t++)r=n[t],i.push(r.selectionDidChange());return i},o.prototype.update=function(){var e;return e=t(),a(e,this.domRange)?void 0:(this.domRange=e,this.notifySelectionManagersOfSelectionChange())},o.prototype.reset=function(){return this.domRange=null,this.update()},o.prototype.run=function(){return this.started?(this.update(),requestAnimationFrame(this.run)):void 0},a=function(t,e){return(null!=t?t.startContainer:void 0)===(null!=e?e.startContainer:void 0)&&(null!=t?t.startOffset:void 0)===(null!=e?e.startOffset:void 0)&&(null!=t?t.endContainer:void 0)===(null!=e?e.endContainer:void 0)&&(null!=t?t.endOffset:void 0)===(null!=e?e.endOffset:void 0)},o}(o.BasicObject),null==o.selectionChangeObserver&&(o.selectionChangeObserver=new o.SelectionChangeObserver)}.call(this),function(){var t,e,n,i,r,a,s,l,u,c,d=function(t,e){return function(){return t.apply(e,arguments)}},h=function(t,e){function n(){this.constructor=t}for(var i in e)f.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;n=o.getDOMSelection,e=o.getDOMRange,c=o.setDOMRange,t=o.elementContainsNode,a=o.nodeIsCursorTarget,r=o.innerElementIsActive,i=o.handleEvent,s=o.normalizeRange,l=o.rangeIsCollapsed,u=o.rangesAreEqual,o.SelectionManager=function(f){function p(t){this.element=t,this.selectionDidChange=d(this.selectionDidChange,this),this.didMouseDown=d(this.didMouseDown,this),this.locationMapper=new o.LocationMapper(this.element),this.pointMapper=new o.PointMapper,this.lockCount=0,i("mousedown",{onElement:this.element,withCallback:this.didMouseDown})}return h(p,f),p.prototype.getLocationRange=function(t){var n;return null==t&&(t={}),!1===t.strict?this.createLocationRangeFromDOMRange(e(),{strict:!1}):t.ignoreLock?this.currentLocationRange:null!=(n=this.lockedLocationRange)?n:this.currentLocationRange},p.prototype.setLocationRange=function(t){var e;if(!this.lockedLocationRange)return t=s(t),(e=this.createDOMRangeFromLocationRange(t))?(c(e),this.updateCurrentLocationRange(t)):void 0},p.prototype.setLocationRangeFromPointRange=function(t){var e,n;return t=s(t),n=this.getLocationAtPoint(t[0]),e=this.getLocationAtPoint(t[1]),this.setLocationRange([n,e])},p.prototype.getClientRectAtLocationRange=function(t){var e;return(e=this.createDOMRangeFromLocationRange(t))?this.getClientRectsForDOMRange(e)[1]:void 0},p.prototype.locationIsCursorTarget=function(t){var e,n;return e=(n=this.findNodeAndOffsetFromLocation(t))[0],n[1],a(e)},p.prototype.lock=function(){return 0==this.lockCount++?(this.updateCurrentLocationRange(),this.lockedLocationRange=this.getLocationRange()):void 0},p.prototype.unlock=function(){var t;return 0==--this.lockCount&&(t=this.lockedLocationRange,this.lockedLocationRange=null,null!=t)?this.setLocationRange(t):void 0},p.prototype.clearSelection=function(){var t;return null!=(t=n())?t.removeAllRanges():void 0},p.prototype.selectionIsCollapsed=function(){var t;return!0===(null!=(t=e())?t.collapsed:void 0)},p.prototype.selectionIsExpanded=function(){return!this.selectionIsCollapsed()},p.prototype.createLocationRangeFromDOMRange=function(t,e){var n,i;if(null!=t&&this.domRangeWithinElement(t)&&(i=this.findLocationFromContainerAndOffset(t.startContainer,t.startOffset,e)))return t.collapsed||(n=this.findLocationFromContainerAndOffset(t.endContainer,t.endOffset,e)),s([i,n])},p.proxyMethod("locationMapper.findLocationFromContainerAndOffset"),p.proxyMethod("locationMapper.findContainerAndOffsetFromLocation"),p.proxyMethod("locationMapper.findNodeAndOffsetFromLocation"),p.proxyMethod("pointMapper.createDOMRangeFromPoint"),p.proxyMethod("pointMapper.getClientRectsForDOMRange"),p.prototype.didMouseDown=function(){return this.pauseTemporarily()},p.prototype.pauseTemporarily=function(){var e,n,r,o;return this.paused=!0,n=function(e){return function(){var n,i;for(e.paused=!1,clearTimeout(o),n=0,i=r.length;i>n;n++)r[n].destroy();return t(document,e.element)?e.selectionDidChange():void 0}}(this),o=setTimeout(n,200),r=function(){var t,r,o,a;for(a=[],t=0,r=(o=["mousemove","keydown"]).length;r>t;t++)e=o[t],a.push(i(e,{onElement:document,withCallback:n}));return a}()},p.prototype.selectionDidChange=function(){return this.paused||r(this.element)?void 0:this.updateCurrentLocationRange()},p.prototype.updateCurrentLocationRange=function(t){var n;return(null!=t?t:t=this.createLocationRangeFromDOMRange(e()))&&!u(t,this.currentLocationRange)?(this.currentLocationRange=t,null!=(n=this.delegate)&&"function"==typeof n.locationRangeDidChange?n.locationRangeDidChange(this.currentLocationRange.slice(0)):void 0):void 0},p.prototype.createDOMRangeFromLocationRange=function(t){var e,n,i,r;return i=this.findContainerAndOffsetFromLocation(t[0]),n=l(t)?i:null!=(r=this.findContainerAndOffsetFromLocation(t[1]))?r:i,null!=i&&null!=n?((e=document.createRange()).setStart.apply(e,i),e.setEnd.apply(e,n),e):void 0},p.prototype.getLocationAtPoint=function(t){var e,n;return(e=this.createDOMRangeFromPoint(t))&&null!=(n=this.createLocationRangeFromDOMRange(e))?n[0]:void 0},p.prototype.domRangeWithinElement=function(e){return e.collapsed?t(this.element,e.startContainer):t(this.element,e.startContainer)&&t(this.element,e.endContainer)},p}(o.BasicObject)}.call(this),function(){var t,e,n,i,r=function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty,s=[].slice;n=o.rangeIsCollapsed,i=o.rangesAreEqual,e=o.objectsAreEqual,t=o.getBlockConfig,o.EditorController=function(a){function l(t){var e,n;this.editorElement=t.editorElement,e=t.document,n=t.html,this.selectionManager=new o.SelectionManager(this.editorElement),this.selectionManager.delegate=this,this.composition=new o.Composition,this.composition.delegate=this,this.attachmentManager=new o.AttachmentManager(this.composition.getAttachments()),this.attachmentManager.delegate=this,this.inputController=new(o["Level"+o.config.input.getLevel()+"InputController"])(this.editorElement),this.inputController.delegate=this,this.inputController.responder=this.composition,this.compositionController=new o.CompositionController(this.editorElement,this.composition),this.compositionController.delegate=this,this.toolbarController=new o.ToolbarController(this.editorElement.toolbarElement),this.toolbarController.delegate=this,this.editor=new o.Editor(this.composition,this.selectionManager,this.editorElement),null!=e?this.editor.loadDocument(e):this.editor.loadHTML(n)}var u;return r(l,a),l.prototype.registerSelectionManager=function(){return o.selectionChangeObserver.registerSelectionManager(this.selectionManager)},l.prototype.unregisterSelectionManager=function(){return o.selectionChangeObserver.unregisterSelectionManager(this.selectionManager)},l.prototype.render=function(){return this.compositionController.render()},l.prototype.reparse=function(){return this.composition.replaceHTML(this.editorElement.innerHTML)},l.prototype.compositionDidChangeDocument=function(){return this.notifyEditorElement("document-change"),this.handlingInput?void 0:this.render()},l.prototype.compositionDidChangeCurrentAttributes=function(t){return this.currentAttributes=t,this.toolbarController.updateAttributes(this.currentAttributes),this.updateCurrentActions(),this.notifyEditorElement("attributes-change",{attributes:this.currentAttributes})},l.prototype.compositionDidPerformInsertionAtRange=function(t){return this.pasting?this.pastedRange=t:void 0},l.prototype.compositionShouldAcceptFile=function(t){return this.notifyEditorElement("file-accept",{file:t})},l.prototype.compositionDidAddAttachment=function(t){var e;return e=this.attachmentManager.manageAttachment(t),this.notifyEditorElement("attachment-add",{attachment:e})},l.prototype.compositionDidEditAttachment=function(t){var e;return this.compositionController.rerenderViewForObject(t),e=this.attachmentManager.manageAttachment(t),this.notifyEditorElement("attachment-edit",{attachment:e}),this.notifyEditorElement("change")},l.prototype.compositionDidChangeAttachmentPreviewURL=function(t){return this.compositionController.invalidateViewForObject(t),this.notifyEditorElement("change")},l.prototype.compositionDidRemoveAttachment=function(t){var e;return e=this.attachmentManager.unmanageAttachment(t),this.notifyEditorElement("attachment-remove",{attachment:e})},l.prototype.compositionDidStartEditingAttachment=function(t,e){return this.attachmentLocationRange=this.composition.document.getLocationRangeOfAttachment(t),this.compositionController.installAttachmentEditorForAttachment(t,e),this.selectionManager.setLocationRange(this.attachmentLocationRange)},l.prototype.compositionDidStopEditingAttachment=function(){return this.compositionController.uninstallAttachmentEditor(),this.attachmentLocationRange=null},l.prototype.compositionDidRequestChangingSelectionToLocationRange=function(t){return!this.loadingSnapshot||this.isFocused()?(this.requestedLocationRange=t,this.compositionRevisionWhenLocationRangeRequested=this.composition.revision,this.handlingInput?void 0:this.render()):void 0},l.prototype.compositionWillLoadSnapshot=function(){return this.loadingSnapshot=!0},l.prototype.compositionDidLoadSnapshot=function(){return this.compositionController.refreshViewCache(),this.render(),this.loadingSnapshot=!1},l.prototype.getSelectionManager=function(){return this.selectionManager},l.proxyMethod("getSelectionManager().setLocationRange"),l.proxyMethod("getSelectionManager().getLocationRange"),l.prototype.attachmentManagerDidRequestRemovalOfAttachment=function(t){return this.removeAttachment(t)},l.prototype.compositionControllerWillSyncDocumentView=function(){return this.inputController.editorWillSyncDocumentView(),this.selectionManager.lock(),this.selectionManager.clearSelection()},l.prototype.compositionControllerDidSyncDocumentView=function(){return this.inputController.editorDidSyncDocumentView(),this.selectionManager.unlock(),this.updateCurrentActions(),this.notifyEditorElement("sync")},l.prototype.compositionControllerDidRender=function(){return null!=this.requestedLocationRange&&(this.compositionRevisionWhenLocationRangeRequested===this.composition.revision&&this.selectionManager.setLocationRange(this.requestedLocationRange),this.requestedLocationRange=null,this.compositionRevisionWhenLocationRangeRequested=null),this.renderedCompositionRevision!==this.composition.revision&&(this.runEditorFilters(),this.composition.updateCurrentAttributes(),this.notifyEditorElement("render")),this.renderedCompositionRevision=this.composition.revision},l.prototype.compositionControllerDidFocus=function(){return this.isFocusedInvisibly()&&this.setLocationRange({index:0,offset:0}),this.toolbarController.hideDialog(),this.notifyEditorElement("focus")},l.prototype.compositionControllerDidBlur=function(){return this.notifyEditorElement("blur")},l.prototype.compositionControllerDidSelectAttachment=function(t,e){return this.toolbarController.hideDialog(),this.composition.editAttachment(t,e)},l.prototype.compositionControllerDidRequestDeselectingAttachment=function(t){var e,n;return e=null!=(n=this.attachmentLocationRange)?n:this.composition.document.getLocationRangeOfAttachment(t),this.selectionManager.setLocationRange(e[1])},l.prototype.compositionControllerWillUpdateAttachment=function(t){return this.editor.recordUndoEntry("Edit Attachment",{context:t.id,consolidatable:!0})},l.prototype.compositionControllerDidRequestRemovalOfAttachment=function(t){return this.removeAttachment(t)},l.prototype.inputControllerWillHandleInput=function(){return this.handlingInput=!0,this.requestedRender=!1},l.prototype.inputControllerDidRequestRender=function(){return this.requestedRender=!0},l.prototype.inputControllerDidHandleInput=function(){return this.handlingInput=!1,this.requestedRender?(this.requestedRender=!1,this.render()):void 0},l.prototype.inputControllerDidAllowUnhandledInput=function(){return this.notifyEditorElement("change")},l.prototype.inputControllerDidRequestReparse=function(){return this.reparse()},l.prototype.inputControllerWillPerformTyping=function(){return this.recordTypingUndoEntry()},l.prototype.inputControllerWillPerformFormatting=function(t){return this.recordFormattingUndoEntry(t)},l.prototype.inputControllerWillCutText=function(){return this.editor.recordUndoEntry("Cut")},l.prototype.inputControllerWillPaste=function(t){return this.editor.recordUndoEntry("Paste"),this.pasting=!0,this.notifyEditorElement("before-paste",{paste:t})},l.prototype.inputControllerDidPaste=function(t){return t.range=this.pastedRange,this.pastedRange=null,this.pasting=null,this.notifyEditorElement("paste",{paste:t})},l.prototype.inputControllerWillMoveText=function(){return this.editor.recordUndoEntry("Move")},l.prototype.inputControllerWillAttachFiles=function(){return this.editor.recordUndoEntry("Drop Files")},l.prototype.inputControllerWillPerformUndo=function(){return this.editor.undo()},l.prototype.inputControllerWillPerformRedo=function(){return this.editor.redo()},l.prototype.inputControllerDidReceiveKeyboardCommand=function(t){return this.toolbarController.applyKeyboardCommand(t)},l.prototype.inputControllerDidStartDrag=function(){return this.locationRangeBeforeDrag=this.selectionManager.getLocationRange()},l.prototype.inputControllerDidReceiveDragOverPoint=function(t){return this.selectionManager.setLocationRangeFromPointRange(t)},l.prototype.inputControllerDidCancelDrag=function(){return this.selectionManager.setLocationRange(this.locationRangeBeforeDrag),this.locationRangeBeforeDrag=null},l.prototype.locationRangeDidChange=function(t){return this.composition.updateCurrentAttributes(),this.updateCurrentActions(),this.attachmentLocationRange&&!i(this.attachmentLocationRange,t)&&this.composition.stopEditingAttachment(),this.notifyEditorElement("selection-change")},l.prototype.toolbarDidClickButton=function(){return this.getLocationRange()?void 0:this.setLocationRange({index:0,offset:0})},l.prototype.toolbarDidInvokeAction=function(t){return this.invokeAction(t)},l.prototype.toolbarDidToggleAttribute=function(t){return this.recordFormattingUndoEntry(t),this.composition.toggleCurrentAttribute(t),this.render(),this.selectionFrozen?void 0:this.editorElement.focus()},l.prototype.toolbarDidUpdateAttribute=function(t,e){return this.recordFormattingUndoEntry(t),this.composition.setCurrentAttribute(t,e),this.render(),this.selectionFrozen?void 0:this.editorElement.focus()},l.prototype.toolbarDidRemoveAttribute=function(t){return this.recordFormattingUndoEntry(t),this.composition.removeCurrentAttribute(t),this.render(),this.selectionFrozen?void 0:this.editorElement.focus()},l.prototype.toolbarWillShowDialog=function(){return this.composition.expandSelectionForEditing(),this.freezeSelection()},l.prototype.toolbarDidShowDialog=function(t){return this.notifyEditorElement("toolbar-dialog-show",{dialogName:t})},l.prototype.toolbarDidHideDialog=function(t){return this.thawSelection(),this.editorElement.focus(),this.notifyEditorElement("toolbar-dialog-hide",{dialogName:t})},l.prototype.freezeSelection=function(){return this.selectionFrozen?void 0:(this.selectionManager.lock(),this.composition.freezeSelection(),this.selectionFrozen=!0,this.render())},l.prototype.thawSelection=function(){return this.selectionFrozen?(this.composition.thawSelection(),this.selectionManager.unlock(),this.selectionFrozen=!1,this.render()):void 0},l.prototype.actions={undo:{test:function(){return this.editor.canUndo()},perform:function(){return this.editor.undo()}},redo:{test:function(){return this.editor.canRedo()},perform:function(){return this.editor.redo()}},link:{test:function(){return this.editor.canActivateAttribute("href")}},increaseNestingLevel:{test:function(){return this.editor.canIncreaseNestingLevel()},perform:function(){return this.editor.increaseNestingLevel()&&this.render()}},decreaseNestingLevel:{test:function(){return this.editor.canDecreaseNestingLevel()},perform:function(){return this.editor.decreaseNestingLevel()&&this.render()}},attachFiles:{test:function(){return!0},perform:function(){return o.config.input.pickFiles(this.editor.insertFiles)}}},l.prototype.canInvokeAction=function(t){var e,n;return!!this.actionIsExternal(t)||!!(null!=(e=this.actions[t])&&null!=(n=e.test)?n.call(this):void 0)},l.prototype.invokeAction=function(t){var e,n;return this.actionIsExternal(t)?this.notifyEditorElement("action-invoke",{actionName:t}):null!=(e=this.actions[t])&&null!=(n=e.perform)?n.call(this):void 0},l.prototype.actionIsExternal=function(t){return/^x-./.test(t)},l.prototype.getCurrentActions=function(){var t,e;for(t in e={},this.actions)e[t]=this.canInvokeAction(t);return e},l.prototype.updateCurrentActions=function(){var t;return t=this.getCurrentActions(),e(t,this.currentActions)?void 0:(this.currentActions=t,this.toolbarController.updateActions(this.currentActions),this.notifyEditorElement("actions-change",{actions:this.currentActions}))},l.prototype.runEditorFilters=function(){var t,e,n,i,r,o,a,s;for(s=this.composition.getSnapshot(),n=0,i=(r=this.editor.filters).length;i>n;n++)e=r[n],t=s.document,a=s.selectedRange,null==(s=null!=(o=e.call(this.editor,s))?o:{}).document&&(s.document=t),null==s.selectedRange&&(s.selectedRange=a);return u(s,this.composition.getSnapshot())?void 0:this.composition.loadSnapshot(s)},u=function(t,e){return i(t.selectedRange,e.selectedRange)&&t.document.isEqualTo(e.document)},l.prototype.updateInputElement=function(){var t,e;return t=this.compositionController.getSerializableElement(),e=o.serializeToContentType(t,"text/html"),this.editorElement.setInputElementValue(e)},l.prototype.notifyEditorElement=function(t,e){switch(t){case"document-change":this.documentChangedSinceLastRender=!0;break;case"render":this.documentChangedSinceLastRender&&(this.documentChangedSinceLastRender=!1,this.notifyEditorElement("change"));break;case"change":case"attachment-add":case"attachment-edit":case"attachment-remove":this.updateInputElement()}return this.editorElement.notify(t,e)},l.prototype.removeAttachment=function(t){return this.editor.recordUndoEntry("Delete Attachment"),this.composition.removeAttachment(t),this.render()},l.prototype.recordFormattingUndoEntry=function(e){var i,r;return i=t(e),r=this.selectionManager.getLocationRange(),i||!n(r)?this.editor.recordUndoEntry("Formatting",{context:this.getUndoContext(),consolidatable:!0}):void 0},l.prototype.recordTypingUndoEntry=function(){return this.editor.recordUndoEntry("Typing",{context:this.getUndoContext(this.currentAttributes),consolidatable:!0})},l.prototype.getUndoContext=function(){var t;return t=1<=arguments.length?s.call(arguments,0):[],[this.getLocationContext(),this.getTimeContext()].concat(s.call(t))},l.prototype.getLocationContext=function(){var t;return t=this.selectionManager.getLocationRange(),n(t)?t[0].index:t},l.prototype.getTimeContext=function(){return o.config.undoInterval>0?Math.floor((new Date).getTime()/o.config.undoInterval):0},l.prototype.isFocused=function(){var t;return this.editorElement===(null!=(t=this.editorElement.ownerDocument)?t.activeElement:void 0)},l.prototype.isFocusedInvisibly=function(){return this.isFocused()&&!this.getLocationRange()},l}(o.Controller)}.call(this),function(){var t,e,n,i,r,a,s,l,u,c,d,h,f,p,g,m,v=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};e=o.browser,a=o.makeElement,s=o.triggerEvent,i=o.handleEvent,r=o.handleEventOnce,n=o.findClosestElementFromNode,t=o.AttachmentView.attachmentSelector,o.registerElement("trix-editor",(p=0,u=function(t){return!document.querySelector(":focus")&&t.hasAttribute("autofocus")&&document.querySelector("[autofocus]")===t?t.focus():void 0},g=function(t){return t.hasAttribute("contenteditable")?void 0:(t.setAttribute("contenteditable",""),r("focus",{onElement:t,withCallback:function(){return c(t)}}))},c=function(t){return h(t),m(t)},h=function(t){return("function"==typeof document.queryCommandSupported?document.queryCommandSupported("enableObjectResizing"):void 0)?(document.execCommand("enableObjectResizing",!1,!1),i("mscontrolselect",{onElement:t,preventDefault:!0})):void 0},m=function(){var t;return!("function"==typeof document.queryCommandSupported?document.queryCommandSupported("DefaultParagraphSeparator"):void 0)||"div"!==(t=o.config.blockAttributes.default.tagName)&&"p"!==t?void 0:document.execCommand("DefaultParagraphSeparator",!1,t)},l=function(t){return t.hasAttribute("role")?void 0:t.setAttribute("role","textbox")},f=function(t){var e;if(!t.hasAttribute("aria-label")&&!t.hasAttribute("aria-labelledby"))return(e=function(){var e,n,i;return i=function(){var n,i,r,o;for(o=[],n=0,i=(r=t.labels).length;i>n;n++)(e=r[n]).contains(t)||o.push(e.textContent);return o}(),(n=i.join(" "))?t.setAttribute("aria-label",n):t.removeAttribute("aria-label")})(),i("focus",{onElement:t,withCallback:e})},d=e.forcesObjectResizing?{display:"inline",width:"auto"}:{display:"inline-block",width:"1px"},{defaultCSS:"%t {\n  display: block;\n}\n\n%t:empty:not(:focus)::before {\n  content: attr(placeholder);\n  color: graytext;\n  cursor: text;\n  pointer-events: none;\n}\n\n%t a[contenteditable=false] {\n  cursor: text;\n}\n\n%t img {\n  max-width: 100%;\n  height: auto;\n}\n\n%t "+t+" figcaption textarea {\n  resize: none;\n}\n\n%t "+t+" figcaption textarea.trix-autoresize-clone {\n  position: absolute;\n  left: -9999px;\n  max-height: 0px;\n}\n\n%t "+t+" figcaption[data-trix-placeholder]:empty::before {\n  content: attr(data-trix-placeholder);\n  color: graytext;\n}\n\n%t [data-trix-cursor-target] {\n  display: "+d.display+" !important;\n  width: "+d.width+" !important;\n  padding: 0 !important;\n  margin: 0 !important;\n  border: none !important;\n}\n\n%t [data-trix-cursor-target=left] {\n  vertical-align: top !important;\n  margin-left: -1px !important;\n}\n\n%t [data-trix-cursor-target=right] {\n  vertical-align: bottom !important;\n  margin-right: -1px !important;\n}",trixId:{get:function(){return this.hasAttribute("trix-id")?this.getAttribute("trix-id"):(this.setAttribute("trix-id",++p),this.trixId)}},labels:{get:function(){var t,e,i;return e=[],this.id&&this.ownerDocument&&e.push.apply(e,this.ownerDocument.querySelectorAll("label[for='"+this.id+"']")),(t=n(this,{matchingSelector:"label"}))&&((i=t.control)===this||null===i)&&e.push(t),e}},toolbarElement:{get:function(){var t,e,n;return this.hasAttribute("toolbar")?null!=(e=this.ownerDocument)?e.getElementById(this.getAttribute("toolbar")):void 0:this.parentNode?(n="trix-toolbar-"+this.trixId,this.setAttribute("toolbar",n),t=a("trix-toolbar",{id:n}),this.parentNode.insertBefore(t,this),t):void 0}},inputElement:{get:function(){var t,e,n;return this.hasAttribute("input")?null!=(n=this.ownerDocument)?n.getElementById(this.getAttribute("input")):void 0:this.parentNode?(e="trix-input-"+this.trixId,this.setAttribute("input",e),t=a("input",{type:"hidden",id:e}),this.parentNode.insertBefore(t,this.nextElementSibling),t):void 0}},editor:{get:function(){var t;return null!=(t=this.editorController)?t.editor:void 0}},name:{get:function(){var t;return null!=(t=this.inputElement)?t.name:void 0}},value:{get:function(){var t;return null!=(t=this.inputElement)?t.value:void 0},set:function(t){var e;return this.defaultValue=t,null!=(e=this.editor)?e.loadHTML(this.defaultValue):void 0}},notify:function(t,e){return this.editorController?s("trix-"+t,{onElement:this,attributes:e}):void 0},setInputElementValue:function(t){var e;return null!=(e=this.inputElement)?e.value=t:void 0},initialize:function(){return this.hasAttribute("data-trix-internal")?void 0:(g(this),l(this),f(this))},connect:function(){return this.hasAttribute("data-trix-internal")?void 0:(this.editorController||(s("trix-before-initialize",{onElement:this}),this.editorController=new o.EditorController({editorElement:this,html:this.defaultValue=this.value}),requestAnimationFrame(function(t){return function(){return s("trix-initialize",{onElement:t})}}(this))),this.editorController.registerSelectionManager(),this.registerResetListener(),this.registerClickListener(),u(this))},disconnect:function(){var t;return null!=(t=this.editorController)&&t.unregisterSelectionManager(),this.unregisterResetListener(),this.unregisterClickListener()},registerResetListener:function(){return this.resetListener=this.resetBubbled.bind(this),window.addEventListener("reset",this.resetListener,!1)},unregisterResetListener:function(){return window.removeEventListener("reset",this.resetListener,!1)},registerClickListener:function(){return this.clickListener=this.clickBubbled.bind(this),window.addEventListener("click",this.clickListener,!1)},unregisterClickListener:function(){return window.removeEventListener("click",this.clickListener,!1)},resetBubbled:function(t){var e;if(!t.defaultPrevented&&t.target===(null!=(e=this.inputElement)?e.form:void 0))return this.reset()},clickBubbled:function(t){var e;if(!(t.defaultPrevented||this.contains(t.target)||!(e=n(t.target,{matchingSelector:"label"}))||v.call(this.labels,e)<0))return this.focus()},reset:function(){return this.value=this.defaultValue}}))}.call(this),function(){}.call(this)}).call(this),t.exports?t.exports=o:void 0===(r="function"==typeof(i=o)?i.call(e,n,e,t):i)||(t.exports=r)}.call(this)}},n={};function i(t){var r=n[t];if(void 0!==r)return r.exports;var o=n[t]={exports:{}};return e[t].call(o.exports,o,o.exports,i),o.exports}i.m=e,t=[],i.O=(e,n,r,o)=>{if(!n){var a=1/0;for(c=0;c<t.length;c++){for(var[n,r,o]=t[c],s=!0,l=0;l<n.length;l++)(!1&o||a>=o)&&Object.keys(i.O).every((t=>i.O[t](n[l])))?n.splice(l--,1):(s=!1,o<a&&(a=o));if(s){t.splice(c--,1);var u=r();void 0!==u&&(e=u)}}return e}o=o||0;for(var c=t.length;c>0&&t[c-1][2]>o;c--)t[c]=t[c-1];t[c]=[n,r,o]},i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={847:0,252:0};i.O.j=e=>0===t[e];var e=(e,n)=>{var r,o,[a,s,l]=n,u=0;if(a.some((e=>0!==t[e]))){for(r in s)i.o(s,r)&&(i.m[r]=s[r]);if(l)var c=l(i)}for(e&&e(n);u<a.length;u++)o=a[u],i.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return i.O(c)},n=self.webpackChunk=self.webpackChunk||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),i.O(void 0,[252],(()=>i(297)));var r=i.O(void 0,[252],(()=>i(229)));r=i.O(r)})();